!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),u=r(a),l=n(19),c=r(l),f=n(1),s=r(f),d=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function u(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}l((r=r.apply(e,t||[])).next())})},m=function(){function e(){i(this,e)}return o(e,null,[{key:"addAnimationType",value:function(t,n){if(this._knownTypeNames.has(t))throw new Error("Specified animation "+t+" was loaded already.");this._knownTypeNames.add(t),this.animationGenerators[t]=n,e.onRegisterHandlers[t]&&e.onRegisterHandlers[t].forEach(function(e){return e()})}},{key:"addAnimation",value:function(t,n){var r=u.default.parse(n);e.addAnimationType(t,function(){return new s.default(r)})}},{key:"addAnimationFromURL",value:function(t,n){return d(this,void 0,void 0,regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._knownTypeNames.has(t)){r.next=2;break}throw new Error("Specified animation "+t+" was loaded already.");case 2:return this._knownTypeNames.add(t),r.next=5,c.default.resolve(n);case 5:i=r.sent,this._knownTypeNames.delete(t),e.addAnimation(t,i);case 8:case"end":return r.stop()}},r,this)}))}},{key:"_onRegister",value:function(t,n){e.onRegisterHandlers[t]?e.onRegisterHandlers[t].push(n):e.onRegisterHandlers[t]=[n]}},{key:"instanciate",value:function(t){return d(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.animationGenerators[t]){n.next=4;break}return n.abrupt("return",e.animationGenerators[t]());case 4:return n.next=6,this._waitForRegistered(t);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n,this)}))}},{key:"_waitForRegistered",value:function(t){return new Promise(function(n){e._onRegister(t,function(){n(e.animationGenerators[t]())})})}}]),e}();t.default=m,m.animationGenerators={},m.onRegisterHandlers={},m._knownTypeNames=new Set},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(t){r(this,e),this.clips={};for(var n in t)this.clips[n]=new a.default(t[n])}return i(e,[{key:"getClip",value:function(e){if(void 0===this.clips[e])throw new Error("Animation type "+e+" is not exist.");return this.clips[e]}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(10),u=r(a),l=n(3),c=r(l),f=function(){function e(t){i(this,e),this._timeline={};for(var n in t)this.timeline[n]=t[n]}return o(e,[{key:"step",value:function(e,t){var n=this;for(var r in this.timeline)!function(r){var i=n.timeline[r];if("@"===i.query){var o=e.getComponent(i.component),a=o.getAttributeRaw(i.attribute);o.setAttribute(i.attribute,c.default.calc(t,i,a))}else e.element.querySelectorAll(i.query).forEach(function(e){var n=u.default.fromElement(e),r=n.getComponent(i.component),o=r.getAttributeRaw(i.attribute);n.getComponent(i.component).setAttribute(i.attribute,c.default.calc(t,i,o))})}(r)}},{key:"timeline",get:function(){return this._timeline}},{key:"length",get:function(){var e=0;for(var t in this.timeline){var n=this.timeline[t].timeline[this.timeline[t].timeline.length-1];e=n>e?n:e}return e}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(11),u=n(12),l=r(u),c=n(13),f=r(c),s=n(14),d=r(s),m=n(15),p=r(m),h=n(16),v=r(h),w=n(17),_=r(w),y=function(){function e(){i(this,e)}return o(e,null,[{key:"calc",value:function(e,t,n){var r=this._decideTimelinePosition(e,t.timeline);if(t.values.length-1===r)return t.values[r];var i=Math.max(0,Math.min(1,(e-t.timeline[r])/(t.timeline[r+1]-t.timeline[r]))),o=n.converter.convert(t.values[r],n),u=n.converter.convert(t.values[r+1],n);if(t.defaultEffect===a.EffectName.LINEAR||void 0===t.defaultEffect)switch(n.converter.name.name){case"Number":return o+(u-o)*i;case"Vector2":return d.default.lerp(o,u,i);case"Vector3":return f.default.lerp(o,u,i);case"Vector4":return l.default.lerp(o,u,i);case"Rotation3":return _.default.slerp(o,u,i);case"Color3":var c=f.default.lerp(o.toVector(),u.toVector(),i);return new p.default(c.X,c.Y,c.Z);case"Color4":var s=l.default.lerp(o.toVector(),u.toVector(),i);return new v.default(s.X,s.Y,s.Z,s.W);case"NumberArray":return o.map(function(e,t){return(u[t]-e)*i+e});default:throw new Error("Converter "+n.converter.name+" is not supported with LINEAR.")}else if(t.defaultEffect===a.EffectName.DESCRETE)return t.values[r]}},{key:"_decideTimelinePosition",value:function(e,t){var n=0,r=t.length-1,i=void 0;if(e<t[n])return n;if(e>t[r])return r;for(;r-n>1;){if(i=Math.floor((n+r)/2),t[i]===e)return i;t[i]<e?n=i:e<t[i]&&(r=i)}return n}}]),e}();t.default=y},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(18),a=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(){r(this,e)}return i(e,null,[{key:"parse",value:function(t){var n=a.default.calcHash(t);return void 0!==e._parsedCache[n]?e._parsedCache[n]:(e._parsedCache[n]=JSON.parse(t),e._parsedCache[n])}}]),e}();t.default=u,u._parsedCache={}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),c=r(l),f=n(6),s=r(f),d=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function u(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}l((r=r.apply(e,t||[])).next())})},m=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){if(this.__bindAttributes(),!this.animation||"string"!=typeof this.animation)throw new Error("Animation type name must be sppecified and string");this._animationPromise=c.default.instanciate(this.animation),this._registerAttributes()}},{key:"$update",value:function(e){this._ready&&0!==this.timeScale&&this._update(e.timer)}},{key:"$render",value:function(e){this._ready&&0!==this.timeScale&&this._update(e.timer)}},{key:"_registerAttributes",value:function(){return d(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._animationPromise;case 2:this._animation=e.sent,this._ready=!0;case 4:case"end":return e.stop()}},e,this)}))}},{key:"_update",value:function(e){for(var t in this.clips){var n=this._animation.getClip(this.clips[t]).length,r=e.deltaTime*this.timeScale+this.initialTime;this._animationTime=this.loop?r%n:Math.max(r,n),this._animation.getClip(this.clips[t]).step(this.node,this._animationTime)}}},{key:"getClip",value:function(e){return this._animation.getClip(e)}},{key:"Animation",get:function(){return this._animation}},{key:"AnimationTime",get:function(){return this._animationTime}}]),t}(s.default);t.default=m,m.attributes={animation:{converter:"String",default:null},clips:{converter:"StringArray",default:null},timeScale:{converter:"Number",default:1},loop:{converter:"Boolean",default:!0},initialTime:{converter:"Number",default:0}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),c=r(l),f=n(6),s=r(f),d=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){if(this.__bindAttributes(),this.getAttributeRaw("typeName").watch(function(e){console.warn("Changeing 'typeName' on AnimationImporter makes no sense. This change won't affect anything.")}),this.getAttributeRaw("src").watch(function(e){console.warn("Changeing 'src' on AnimationImporter makes no sense. This change won't affect anything.")}),!this.typeName||!this.src)throw new Error("type or src cannot be null in Animation importer");c.default.addAnimationFromURL(this.typeName,this.src)}}]),t}(s.default);t.default=d,d.attributes={typeName:{default:null,converter:"String"},src:{default:null,converter:"String"}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.__NAME__=t.__VERSION__=void 0;var i=n(1),o=r(i),a=n(2),u=r(a),l=n(0),c=r(l),f=n(4),s=r(f),d=n(5),m=r(d),p=n(7),h=r(p),v=n(3),w=r(v),_=n(20),y=r(_),b=n(8),g=r(b),O=t.__VERSION__="1.4.0",E=t.__NAME__="grimoirejs-animation",S={Animation:{Animation:o.default,AnimationClip:u.default,AnimationFactory:c.default,AnimationParser:s.default},Components:{AnimationComponent:m.default,AnimationImporterComponent:h.default},Util:{TimelineCalculator:w.default}};g.default.notifyRegisteringPlugin(E);var j=(0,y.default)();Object.assign(S,{__VERSION__:O,__NAME__:E}),Object.assign(j||{},S),window.GrimoireJS.lib.animation=S,t.default=j},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.GomlNode},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.EffectName=void 0;!function(e){e.LINEAR="LINEAR",e.DESCRETE="DESCRETE",e.BEZIER="BEZIER"}(r||(t.EffectName=r={})),t.default=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Vector4:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Vector3:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Vector2:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Color3:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Color4:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Quaternion:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Util.HashCalculator:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Asset.TextFileResolver:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(7),u=r(a),l=n(5),c=r(l),f=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function u(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}l((r=r.apply(e,t||[])).next())})};t.default=function(){o.default.register(function(){return f(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.default.registerNode("import-animation",["AnimationImporter"]),o.default.registerComponent("Animation",c.default),o.default.registerComponent("AnimationImporter",u.default);case 3:case"end":return e.stop()}},e,this)}))})}}])});
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=r(o),a=n(7),u=r(a),f=n(8),s=r(f),l=n(9),c=r(l),d=n(3),m=r(d),y=n(1),b=r(y),p=n(4),v=r(p),h=n(5),_=r(h),w=n(10),g=r(w),S={Accessor:{Accessor:i.default},Animator:{Animator:u.default,Interpolators:s.default},Components:{GLTFAnimatorComponent:c.default,GLTFModelComponent:m.default},Parser:{ConstantConverter:b.default,MaterialsCommonParser:v.default,Parser:_.default}},x=(0,g.default)();Object.assign(x||{},S),window.GrimoireJS.lib.gltf=S,t.default=x},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(18),u=r(a),f=n(19),s=r(f),l=function(){function e(){o(this,e)}return i(e,null,[{key:"asColorValue",value:function(e){return 3===e.length?new u.default(e[0],e[1],e[2]):new s.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:return 4;default:throw new Error("Unknown index size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}},{key:"asGrAttribName",value:function(e){switch(e){case"POSITION":return"position";case"NORMAL":return"normal";case"TEXCOORD_0":return"texCoord";case"JOINT":return"joint";case"WEIGHT":return"weight";default:throw new Error("Unknown semantic"+e)}}}]),e}();t.default=l},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,r,o,i,a,u){n(this,e),this.bufffer=t,this.count=r,this.componentType=o,this.elementSize=i,this.byteOffset=a,this.byteStride=u,this._resultMemoryCache=[],this._getSingleByIndex=this._generateSingleSamplerDelegate(),this._resultMemoryCache=new Array(i)}return r(e,[{key:"getByIndex",value:function(e){for(var t=0;t<this.elementSize;t++)this._resultMemoryCache[t]=this._getSingleByIndex(e,t);return this._resultMemoryCache}},{key:"_generateSingleSamplerDelegate",value:function(){var e=this;switch(this.componentType){case WebGLRenderingContext.FLOAT:return function(t,n){return e.bufffer.getFloat32(e.byteOffset+t*(4*e.elementSize+e.byteStride)+4*n,!0)};case WebGLRenderingContext.INT:return function(t,n){return e.bufffer.getInt32(e.byteOffset+t*(4*e.elementSize+e.byteStride)+4*n,!0)};case WebGLRenderingContext.SHORT:return function(t,n){return e.bufffer.getInt16(e.byteOffset+t*(2*e.elementSize+e.byteStride)+2*n,!0)};case WebGLRenderingContext.BYTE:return function(t,n){return e.bufffer.getInt8(e.byteOffset+t*(1*e.elementSize+e.byteStride)+1*n)};case WebGLRenderingContext.UNSIGNED_INT:return function(t,n){return e.bufffer.getUint32(e.byteOffset+t*(4*e.elementSize+e.byteStride)+4*n,!0)};case WebGLRenderingContext.UNSIGNED_SHORT:return function(t,n){return e.bufffer.getUint16(e.byteOffset+t*(2*e.elementSize+e.byteStride)+2*n,!0)};case WebGLRenderingContext.UNSIGNED_BYTE:return function(t,n){return e.bufffer.getUint8(e.byteOffset+t*(1*e.elementSize+e.byteStride)+1*n)}}}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(20),s=r(f),l=n(6),c=r(l),d=n(5),m=r(d),y=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,t=this.getValue("src");if(t){var n=this.companion.get("gl");m.default.parseFromURL(n,t).then(function(t){e._populateAssets(t),e._populateScene(t)})}}},{key:"_populateScene",value:function(e){var t=this.getValue("scene");t||(t=e.tf.scene);var n=e.tf.scenes[t],r=!0,o=!1,i=void 0;try{for(var a,u=n.nodes[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var f=a.value;this._populateNode(e,f,this.node)}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}},{key:"_populateAssets",value:function(e){var t=this.node.addChildByName("gltf-assets",{});for(var n in e.materials){var r=t.addChildByName("material",e.materials[n]);r.element.className=e.materials[n].class}}},{key:"_populateNode",value:function(e,t,n){var r=e.tf.nodes[t],o=void 0;if(void 0!==r.meshes&&e.meshes[r.meshes[0]]){var i=e.meshes[r.meshes[0]];o=n.addChildByName("gltf-mesh",{geometry:i,material:".gltf-"+e.tf.meshes[r.meshes[0]].primitives[0].material})}else o=n.addChildByName("object",{});if(r.translation&&o.setAttribute("position",r.translation),r.scale&&o.setAttribute("scale",r.scale),r.rotation&&o.setAttribute("rotation",r.rotation),r.matrix){var a=new s.default(r.matrix);o.setAttribute("position",a.getTranslation()),o.setAttribute("scale",a.getScaling()),o.setAttribute("rotation",a.getRotation())}if(r.children){var u=!0,f=!1,l=void 0;try{for(var c,d=r.children[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var m=c.value;this._populateNode(e,m,o)}}catch(e){f=!0,l=e}finally{try{!u&&d.return&&d.return()}finally{if(f)throw l}}}}}]),t}(c.default);t.default=y,y.componentName="GLTFModelComponent",y.attributes={src:{converter:"String",defaultValue:null},scene:{converter:"String",defaultValue:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),f=function(){function e(){o(this,e)}return i(e,null,[{key:"parse",value:function(e,t,n,r){var o=e.materials[t];if(o.extensions.KHR_materials_common){var i=o.extensions.KHR_materials_common,a=i.values;switch(i.technique){case"PHONG":case"BLINN":var f={type:"gltf-unlit",class:"gltf-"+t};return"string"==typeof a.diffuse?f.texture=r[a.diffuse]:Array.isArray(a.diffuse)&&(f.diffuse=u.default.asColorValue(a.diffuse)),f;default:throw new Error("Unsupported common material technique "+i.technique)}}}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),u=r(a),f=n(1),s=r(f),l=n(21),c=r(l),d=n(17),m=r(d),y=n(12),b=r(y),p=n(15),v=r(p),h=n(13),_=r(h),w=n(11),g=r(w),S=n(16),x=r(S),O=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{f(r.next(e))}catch(e){i(e)}}function u(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t)).next())})},C=function(){function e(){o(this,e)}return i(e,null,[{key:"parseFromURL",value:function(t,n){return O(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o,i,a,f,s,l,c,d,m,y,p,h,_,w,S,O,C,T,R,G,N,A,P,E,M,I,j,U;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.getBaseDir(n),r.next=3,b.default.resolve(n);case 3:i=r.sent,a=JSON.parse(i),f={},s={},l={},c={},d={},m={},y={},p={},r.t0=regeneratorRuntime.keys(a.buffers);case 14:if((r.t1=r.t0()).done){r.next=21;break}return h=r.t1.value,r.next=18,e.bufferFromURL(a,h,o);case 18:f[h]=r.sent,r.next=14;break;case 21:for(_ in a.bufferViews)w=a.bufferViews[_],void 0===w.target||(S=f[w.buffer],O=c[_]=new v.default(t,w.target,WebGLRenderingContext.STATIC_DRAW),s[_]=S.slice(w.byteOffset,w.byteOffset+w.byteLength),O.update(s[_]));for(C in a.meshes)l[C]=e._parseMesh(t,a,C,c,s);T=[],R=function(t){e.isDataUri(a.images[t].uri)?(N=document.createElement("canvas"),A=N.getContext("2d"),P=new Image,P.src=a.images[t].uri,N.width=P.width,N.height=P.height,A.drawImage(P,0,0),d[t]=N):T.push(g.default.resolve(o+a.images[t].uri).then(function(e){d[t]=e}))};for(G in a.images)R(G);return r.next=28,Promise.all(T);case 28:for(E in a.textures)M=a.textures[E],I=m[E]=new x.default(t),I.update(d[M.source]);for(j in a.materials)U=a.materials[j],void 0!==U.extensions&&U.extensions.KHR_materials_common?y[j]=u.default.parse(a,j,o,m):(console.warn("program is not parsed. Common material configuration are used alternatively"),a.materials[j].extensions={},a.materials[j].extensions.KHR_materials_common={values:U.values,technique:"PHONG",transparent:!0,jointCount:0,doubleSided:!0},y[j]=u.default.parse(a,j,o,m));return r.abrupt("return",{meshes:l,textures:m,tf:a,materials:y});case 31:case"end":return r.stop()}},r,this)}))}},{key:"_parseMesh",value:function(t,n,r,o,i){var a=n.meshes[r],u=a.primitives[0],f={};if(f.topology=u.mode||WebGLRenderingContext.TRIANGLES,u.indices){var l=n.accessors[u.indices];f.byteSize=s.default.asByteSize(l.componentType);var d=i[l.bufferView],y=s.default.elementTypeToTypedArray(l.componentType),b=new y(d.slice(l.byteOffset,l.byteOffset+f.byteSize*l.count)),p=new v.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);p.update(b),f.type=l.componentType,f.index=p,f.byteOffset=0,f.count=l.count}else{var h=n.accessors[u.attributes.POSITION].count,w=s.default.indexCountToBufferInfo(h);f.type=w.elementType,f.index=new v.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW),f.byteSize=w.byteSize,f.byteOffset=0,f.count=h;for(var g=new w.ctor(f.count),S=0;S<f.count;S++)g[S]=S;f.index.update(g)}var x={},O={},C=void 0;if(!u.attributes.TEXCOORD_0){var T=n.accessors[u.attributes.POSITION],R=new v.default(t,WebGLRenderingContext.ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);R.update(new Float32Array(new ArrayBuffer(8*T.count))),O["@@UV"]=R,x.texCoord={bufferName:"@@UV",size:2,offset:0,stride:0,type:WebGLRenderingContext.FLOAT}}for(var G in u.attributes){var N=s.default.asGrAttribName(G),A=n.accessors[u.attributes[G]];O[A.bufferView]=o[A.bufferView],"POSITION"===G&&(C=A.max&&A.min?new m.default([new c.default(A.max[0],A.max[1],A.max[2]),new c.default(A.min[0],A.min[1],A.min[2])]):e._genAABB(i[A.bufferView],A.byteStride,A.byteOffset,A.count)),x[N]={bufferName:A.bufferView,size:s.default.asVectorSize(A.type),type:A.componentType,stride:A.byteStride,offset:A.byteOffset}}var P=new _.default(O,x,{default:f},C);return P.materialName=u.material,P}},{key:"bufferFromURL",value:function(t,n,r){return e.isDataUri(t.buffers[n].uri)?new Promise(function(r,o){r(e.dataUriToArrayBuffer(t.buffers[n].uri))}):new Promise(function(e,o){var i=new XMLHttpRequest;i.open("GET",r+t.buffers[n].uri),i.responseType="arraybuffer",i.onload=function(t){e(i.response)},i.onerror=function(e){o(e)},i.send()})}},{key:"_genAABB",value:function(e,t,n,r){for(var o=new m.default,i=new DataView(e),a=n;a<n+(r-1)*t;a+=t)o.expand(new c.default(i.getFloat32(a,!0),i.getFloat32(a+4,!0),i.getFloat32(a+8,!0)));return o}},{key:"isDataUri",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;a<r;a++)i[a]=n.charCodeAt(a);return o}},{key:"getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=C},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),f=n(2),s=r(f),l=function(){function e(t,n,r){o(this,e),this.tf=t,this.animationKey=n,this._buffers=r,this._accessors={};var i=t.animations[n];for(var a in i.parameters){var f=t.accessors[i.parameters[a]];this._accessors[a]=new s.default(new DataView(r[f.bufferView]),f.count,f.componentType,u.default.asVectorSize(f.type),f.byteOffset,f.byteStride)}}return i(e,[{key:"getFrame",value:function(e){}}]),e}();t.default=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={LINEAR:function(e){return e}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(6),f=r(u),s=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),t}(f.default);t.default=s,s.attributes={}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),i=r(o),a=n(22),u=r(a),f=n(14),s=r(f),l=n(23),c=r(l),d=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{f(r.next(e))}catch(e){i(e)}}function u(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t)).next())})};t.default=function(){u.default.register(function(){return d(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:u.default.registerComponent("GLTFModel",i.default),u.default.registerNode("model",["GLTFModel"],{},"object"),u.default.registerNode("gltf-mesh",[],{material:"new(gltf-unlit)"},"mesh"),u.default.registerNode("gltf-assets",[],{}),s.default.addSORTMaterial("gltf-unlit",c.default);case 5:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Buffer},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.AABB},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){e.exports='@Pass\n@NoCull()\nFS_PREC(mediump,float)\n varying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n  attribute vec3 normal;\n  attribute vec3 position;\n  attribute vec2 texCoord;\n\n  uniform mat4 _matPVM;\n\n  void main(){\n    gl_Position = _matPVM * vec4(position,1);\n    vNormal = normal;\n    vUV = texCoord;\n  }\n\n\n#endif\n\n\n#ifdef FS\n  @{usedFlag:"_textureUsed"}\n  uniform sampler2D texture;\n\n  uniform bool _textureUsed;\n\n  @{type:"color"}\n  uniform vec4 diffuse;\n\n  void main(){\n    if(_textureUsed){\n      gl_FragColor = texture2D(texture,vUV);\n    }else{\n      gl_FragColor = diffuse;\n    }\n  }\n#endif\n'}])});
//# sourceMappingURL=grimoire-gltf.min.js.map
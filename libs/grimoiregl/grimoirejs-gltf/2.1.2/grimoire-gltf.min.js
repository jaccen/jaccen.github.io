!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=22)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(10),s=function(e){return e&&e.__esModule?e:{default:e}}(u),f=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.parser=e,i.baseDirectory=n,i.__gl=e.gl,i}return i(t,e),a(t,[{key:"fetchGLTF",value:function(e){}},{key:"loadAsGLTF",value:function(e){}},{key:"fetchTextureResource",value:function(e){}},{key:"loadTextureResources",value:function(e){}},{key:"convertTotexture",value:function(e){}},{key:"loadBufferResource",value:function(e){}},{key:"loadBufferResources",value:function(e){}},{key:"loadBufferViews",value:function(e){}},{key:"loadPrimitivesOfMesh",value:function(e){}},{key:"loadPrimitive",value:function(e){}},{key:"appendIndices",value:function(e){}},{key:"addVertexAttributes",value:function(e){}},{key:"complementVertexAttributes",value:function(e){}},{key:"loadMaterials",value:function(e){}},{key:"loadMaterial",value:function(e){}},{key:"loadAnimations",value:function(e){}},{key:"loadAnimation",value:function(e){}}]),t}(s.default);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(18),f=r(s),l=n(9),c=r(l),d=n(4),m=r(d),p=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.jointMatrices={},e.skeletons={},e}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,n=this.getAttribute("src");if(n){var r=this.companion.get("gl"),o=c.default.parseFromURL(r,n).then(function(n){t.instanciator.instanciateAll(n,e,e.getAttribute("scene"))});if(this.getAttribute("waitForLoad")){this.companion.get("loader").register(o)}}}}]),t}(f.default);t.default=p,p.instanciator=new m.default,p.componentName="GLTFModelComponent",p.attributes={src:{converter:"String",default:null},scene:{converter:"String",default:null},waitForLoad:{converter:"Boolean",default:!1}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(32),u=r(a),s=n(33),f=r(s),l=function(){function e(){o(this,e)}return i(e,null,[{key:"asColorValue",value:function(e){return 3===e.length?new u.default(e[0],e[1],e[2]):new f.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:case WebGLRenderingContext.SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:case WebGLRenderingContext.INT:case WebGLRenderingContext.FLOAT:return 4;default:throw new Error("Unknown size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.FLOAT:return Float32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(15),f=r(s),l=n(13),c=r(l),d=n(18),m=r(d),p=n(1),v=r(p),b=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this._model=this.node.getComponentInAncestor(v.default),this._transform=this.node.getComponent(c.default),this._invBindMatrix=new f.default(this.getAttribute("invBindShapeMatrix")),this._skinIndex=this.getAttribute("skinIndex"),this._jointIndex=this.getAttribute("jointIndex")}},{key:"$update",value:function(){for(var e=this._model.skeletons[this._skinIndex].globalTransformInverse.multiplyWith(this._transform.globalTransform).multiplyWith(this._invBindMatrix),t=0;t<16;t++)this._model.jointMatrices[this._skinIndex][16*this._jointIndex+t]=e.rawElements[t]}}]),t}(m.default);t.default=b,b.attributes={invBindShapeMatrix:{converter:"Object",default:null},skinIndex:{converter:"Number",default:null},jointIndex:{converter:"Number",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(13),u=r(a),s=n(25),f=r(s),l=n(16),c=r(l),d=n(17),m=r(d),p=n(15),v=r(p),b=n(23),h=r(b),y=function(){function e(){o(this,e)}return i(e,[{key:"instanciateAll",value:function(e,t,n){var r=n;if(null===r&&(r=e.tf.scene),"number"!=typeof r)for(var o in e.tf.scenes){r=o;break}var i=e.tf.scenes[r];this.__instanciateScene(i,t,e),this.__instanciateAnimations(t,e)}},{key:"__instanciateScene",value:function(e,t,n){var r=!0,o=!1,i=void 0;try{for(var a,u=e.nodes[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;this.__instanciateNode(n,s,{},t.node,t)}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}},{key:"__instanciateAnimations",value:function(e,t){for(var n in t.animations)h.default.addAnimation("gltf-animation-"+n,JSON.stringify(t.animations[n])),e.node.addComponent("Animation",{animation:"gltf-animation-"+n,clip:"default"})}},{key:"__instanciateNode",value:function(e,t,n,r,o){var i=e.tf.nodes[t],a=void 0,s=[];if(void 0!==i.mesh){var l=e.primitives[i.mesh],c=e.tf.meshes[i.mesh];if(1===l.length){var d=e.materials[c.primitives[0].material],m=r.addChildByName("mesh",{geometry:l[0],material:d});s.push(m),a=m}else{for(var p=r.addChildByName("object",{}),v=0;v<l.length;v++){var b=e.materials[c.primitives[v].material],h=p.addChildByName("mesh",{geometry:l[v],material:b});s.push(h)}a=p}}else a=r.addChildByName("object",{});if(n[t]=a,a.setAttribute("class","gltf-node-"+t),this.__applyTransform(a,i),i.children){var y=!0,_=!1,g=void 0;try{for(var w,T=i.children[Symbol.iterator]();!(y=(w=T.next()).done);y=!0){var x=w.value;this.__instanciateNode(e,x,n,a,o)}}catch(e){_=!0,g=e}finally{try{!y&&T.return&&T.return()}finally{if(_)throw g}}}if(void 0!==i.skin){var O=e.tf.skins[i.skin];o.skeletons[i.skin]=a.getComponent(u.default);var C=e.tf.accessors[O.inverseBindMatrices],M=e.bufferViews[C.bufferView],R=new Float32Array(M.buffer,M.byteOffset,M.byteLength/4),S=C.byteStride?C.byteStride:4,P=function(e){return R[C.byteOffset/4+S/4*e]};void 0===o.jointMatrices[i.skin]&&(o.jointMatrices[i.skin]=new Float32Array(16*O.joints.length));for(var E=0;E<s.length;E++)s[E].setAttribute("fundamental.MaterialContainer.jointCount",O.joints.length),s[E].getComponent(f.default).renderArgs["gltf-jointMatrices"]=o.jointMatrices[i.skin];O.joints.forEach(function(e,t){if(!n[e])throw new Error("specified node was not found");for(var r=new Array(16),o=0;o<16;o++)r[o]=P(o+16*t);n[e].setAttribute("class",n[e].getAttribute("class")+" gltf-joint-"+t),n[e].addComponent("GLTFJoint",{invBindShapeMatrix:r,skinIndex:i.skin,jointIndex:t})})}}},{key:"__applyTransform",value:function(e,t){var n=e.getComponent(u.default);if(t.rotation&&n.setAttribute("rotation",new c.default([].concat(t.rotation))),t.translation&&n.setAttribute("position",new m.default([].concat(t.translation))),t.scale&&n.setAttribute("scale",new m.default([].concat(t.scale))),t.matrix){if(t.rotation||t.translation||t.scale)throw new Error("Matrix property can not be existed with other transoform property");var r=new v.default(t.matrix);n.applyMatrix(r)}}}]),e}();t.default=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),l=n(2),c=r(l),d=n(29),m=r(d),p=n(26),v=r(p),b=n(14),h=r(b),y=n(16),_=r(y),g=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})},w=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"fetchGLTF",value:function(e){return this.__fetchBuffer(e)}},{key:"loadAsGLTF",value:function(e){var t=this.__bufferToString(e);return JSON.parse(t)}},{key:"loadTextureResources",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},r=[],e.images){o=function(t){var o=e.textures[t],i=a.parser.callParserModule(function(e){return e.fetchTextureResource},e.images[o.source]).then(function(r){var o=a.parser.callParserModule(function(e){return e.convertTotexture},{tf:e,image:r,texIndex:t});n[t]=o});r.push(i)};for(i in e.textures)o(i)}return t.next=5,Promise.all(r);case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}},t,this)}))}},{key:"fetchTextureResource",value:function(e){return this.__fetchImage(this.baseDirectory+e.uri)}},{key:"convertTotexture",value:function(e){var t=new m.default(this.__gl);t.update(e.image);var n=e.tf.textures[e.texIndex],r={};return n||(r=e.tf.samplers[n.sampler]),t.magFilter=r.magFilter||WebGLRenderingContext.LINEAR,t.minFilter=r.minFilter||WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,t.wrapS=r.wrapS||WebGLRenderingContext.REPEAT,t.wrapT=r.wrapT||WebGLRenderingContext.REPEAT,t}},{key:"loadBufferResource",value:function(e){return this.__fetchBuffer(this.baseDirectory+e.uri)}},{key:"loadBufferResources",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},r=[],o=function(t){r.push(a.parser.callParserModule(function(e){return e.loadBufferResource},e.buffers[t]).then(function(e){n[t]=e}))};for(i in e.buffers)o(i);return t.next=6,Promise.all(r);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}},t,this)}))}},{key:"loadBufferViews",value:function(e){var t={};for(var n in e.tf.bufferViews){var r=e.tf.bufferViews[n];t[n]=new Uint8Array(e.buffers[r.buffer],r.byteOffset,r.byteLength)}return t}},{key:"loadPrimitivesOfMesh",value:function(e){var t={};for(var n in e.tf.meshes){var r=e.tf.meshes[n],o=[];t[n]=o;for(var i in r.primitives)o.push(this.parser.callParserModule(function(e){return e.loadPrimitive},{tf:e.tf,bufferViews:e.bufferViews,primitive:r.primitives[i]}))}return t}},{key:"loadPrimitive",value:function(e){var t=new v.default(this.__gl);return this.parser.callParserModule(function(e){return e.appendIndices},{tf:e.tf,bufferViews:e.bufferViews,primitive:e.primitive,geometry:t}),this.parser.callParserModule(function(e){return e.addVertexAttributes},{tf:e.tf,bufferViews:e.bufferViews,primitive:e.primitive,geometry:t}),t}},{key:"appendIndices",value:function(e){if(void 0!==e.primitive.indices){var t=e.primitive.mode||WebGLRenderingContext.TRIANGLES,n=e.tf.accessors[e.primitive.indices];return e.geometry.addIndex("default",e.bufferViews[n.bufferView],t,n.byteOffset,n.count,n.componentType),!0}}},{key:"addVertexAttributes",value:function(e){for(var t in e.primitive.attributes){var n=e.tf.accessors[e.primitive.attributes[t]],r={};r[t]={size:c.default.asVectorSize(n.type),type:n.componentType,stride:n.byteStride,offset:n.byteOffset},e.geometry.addAttributes(e.bufferViews[n.bufferView],r)}return this.parser.callParserModule(function(e){return e.complementVertexAttributes},e),!0}},{key:"complementVertexAttributes",value:function(e){return!0}},{key:"loadMaterials",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},t.t0=regeneratorRuntime.keys(e.tf.materials);case 2:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.next=6,this.parser.callParserModule(function(e){return e.loadMaterial},{material:e.tf.materials[r],textures:e.textures});case 6:n[r]=t.sent,t.next=2;break;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}},t,this)}))}},{key:"loadMaterial",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.material.pbrMetallicRoughness){t.next=18;break}return t.next=3,h.default.get(this.__gl).instanciate("gltf-pbr-metallic-roughness");case 3:return n=t.sent,r=e.material.pbrMetallicRoughness,o=n.arguments,r.baseColorFactor&&(o.baseColorFactor=r.baseColorFactor),r.baseColorTexture&&(o.baseColorTexture=e.textures[r.baseColorTexture.index]),r.metallicFactor&&(o.metallicFactor=r.metallicFactor),r.metallicTexture&&(o.metallicTexture=e.textures[r.metallicTexture.index]),r.roughnessFactor&&(o.roughnessFactor=r.roughnessFactor),r.roughnessTexture&&(o.roughnessTexture=e.textures[r.roughnessTexture.index]),r.metallicRoughnessTexture&&(o.metallicRoughnessTexture=e.textures[r.metallicRoughnessTexture.index]),e.material.emissiveFactor&&(o.emissiveFactor=e.material.emissiveFactor),e.material.emissiveTexture&&(o.emissiveTexture=e.textures[e.material.emissiveTexture.index]),e.material.normalTexture&&(o.normalTexture=e.textures[e.material.normalTexture.index]),e.material.occlusionTexture&&(o.occlusionTexture=e.textures[e.material.occlusionTexture.index]),t.abrupt("return",n);case 18:case"end":return t.stop()}},t,this)}))}},{key:"loadAnimations",value:function(e){var t={};for(var n in e.tf.animations){var r=e.tf.animations[n];t[n]=this.parser.callParserModule(function(e){return e.loadAnimation},{tf:e.tf,bufferViews:e.bufferViews,animation:r})}return t}},{key:"loadAnimation",value:function(e){for(var t=[],n=0;n<e.animation.channels.length;n++){var r={},o=e.animation.channels[n],i=".gltf-node-"+o.target.node,a=this._pathNameToGrimoire(o.target.path),u=e.animation.samplers[o.sampler];r.query=i,r.component=a.component,r.attribute=a.attributeName,r.timelines=[];for(var s=e.tf.accessors[u.input],f=e.tf.accessors[u.output],l=e.bufferViews[s.bufferView],d=e.bufferViews[f.bufferView],m=c.default.asVectorSize(f.type),p=new Float32Array(l.buffer,l.byteOffset+s.byteOffset,s.count),v=new Float32Array(d.buffer,d.byteOffset+f.byteOffset,f.count*m),b=new Array(s.count),h=0;h<s.count;h++)b[h]=1e3*p[h];var y=[];if(4===m&&"rotation"===a.attributeName){y=[];for(var g=0;g<3;g++)y.push([]);for(var w=0;w<f.count;w++){var T=v[w*m+0],x=v[w*m+1],O=v[w*m+2],C=v[w*m+3],M=new _.default([T,x,O,C]).factoringQuaternionXYZ();y[0].push(M.x),y[1].push(M.y),y[2].push(M.z)}m=3}else{for(var R=0;R<m;R++)y.push([]);for(var S=0;S<f.count;S++)for(var P=0;P<m;P++)y[P].push(v[S*m+P])}for(var E=0;E<m;E++)r.timelines.push({times:b,values:y[E]});t.push(r)}return{default:t}}},{key:"_pathNameToGrimoire",value:function(e){switch(e){case"translation":return{component:"Transform",attributeName:"position"};case"rotation":return{component:"Transform",attributeName:"rotation"};case"scale":return{component:"Transform",attributeName:"scale"};default:throw new Error("Unsupported path type on grimoire")}}}]),t}(f.default);t.default=w},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),s=function(e){return e&&e.__esModule?e:{default:e}}(u),f=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,[{key:"loadBufferResource",value:function(e){if(this.__isDataUri(e.uri))return Promise.resolve(this.__dataUriToArrayBuffer(e.uri))}}]),t}(s.default);t.default=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),s=function(e){return e&&e.__esModule?e:{default:e}}(u),f=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,[{key:"appendIndices",value:function(e){if(void 0===e.primitive.indices){var t=e.primitive.mode||WebGLRenderingContext.TRIANGLES,n=e.tf.accessors[e.primitive.attributes.POSITION];if(void 0===n.count)throw new Error("POSITION buffer should have count parameter. Construction of index buffer was failed.");if(t!==WebGLRenderingContext.TRIANGLES)throw new Error("Complementing index buffer is only supported for TRIANGLES topology currently.");for(var r=new Array(n.count),o=0;o<n.count;o++)r[o]=o;return e.geometry.addIndex("default",r),!0}}}]),t}(s.default);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),l=n(17),c=r(l),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"complementVertexAttributes",value:function(e){if(void 0===e.primitive.attributes.NORMAL&&void 0!==e.primitive.attributes.POSITION){var t=e.tf.accessors[e.primitive.attributes.POSITION],n=e.bufferViews[t.bufferView],r=new Float32Array(n.buffer,n.byteOffset+t.byteOffset);if(void 0!==t.byteStride&&0!==t.byteStride)throw new Error("Complementing normal with a position buffer which buffer has stride as a parameter");if(!t.count)throw new Error("Accessor count of POSITION buffer should be defined for complementing NORMAL buffer");var o=e.tf.accessors[e.primitive.indices],i=new Float32Array(3*t.count);if(o)for(var a=e.bufferViews[o.bufferView],u=this.__getBufferReader(a,o.componentType,o.byteOffset,o.byteStride),s=0;s<t.count/3;s++)this._calcFlatNormal(r,i,u(3*s),u(3*s+1),u(3*s+2));else for(var f=0;f<t.count/3;f++)this._calcFlatNormal(r,i,3*f,3*f+1,3*f+2);e.geometry.addAttributes(i,{NORMAL:{size:3}})}return!1}},{key:"_getElement",value:function(e,t,n){return e[t+n]}},{key:"_calcFlatNormal",value:function(e,t,n,r,o){var i=new c.default(this._getElement(e,3*r,0)-this._getElement(e,3*n,0),this._getElement(e,3*r,1)-this._getElement(e,3*n,1),this._getElement(e,3*r,2)-this._getElement(e,3*n,2)),a=new c.default(this._getElement(e,3*o,0)-this._getElement(e,3*n,0),this._getElement(e,3*o,1)-this._getElement(e,3*n,1),this._getElement(e,3*o,2)-this._getElement(e,3*n,2)),u=c.default.cross(i,a).normalizeThis();t[3*n]=u.X,t[3*n+1]=u.Y,t[3*n+2]=u.Z,t[3*r]=u.X,t[3*r+1]=u.Y,t[3*r+2]=u.Z,t[3*o]=u.X,t[3*o+1]=u.Y,t[3*o+2]=u.Z}}]),t}(f.default);t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(5),u=r(a),s=n(8),f=r(s),l=n(7),c=r(l),d=n(6),m=r(d),p=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})},v=function(){function e(t,n){o(this,e),this.gl=t,this.url=n,this.parserModuleInstances=[];for(var r=0;r<e.parserModules.length;r++){var i=e.parserModules[r];this.parserModuleInstances.push(new i(this,n.substr(0,n.lastIndexOf("/")+1)))}}return i(e,[{key:"callParserModule",value:function(e,t){for(var n=0;n<this.parserModuleInstances.length;n++){var r=this.parserModuleInstances[n],o=e(r);if(void 0!==o){var i=o.call(r,t);if(void 0!==i)return i}}throw new Error('Parsing gltf failed. At the module "'+e.toString()+'"')}},{key:"parse",value:function(){return p(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,o,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,this.callParserModule(function(e){return e.fetchGLTF},this.url);case 3:return n=e.sent,r=this.callParserModule(function(e){return e.loadAsGLTF},n),t.tf=r,e.next=8,this.callParserModule(function(e){return e.loadTextureResources},r).then(function(e){return a.callParserModule(function(e){return e.loadMaterials},{tf:r,textures:e})}).then(function(e){t.materials=e});case 8:return o=e.sent,e.next=11,this.callParserModule(function(e){return e.loadBufferResources},r).then(function(e){var n=a.callParserModule(function(e){return e.loadBufferViews},{tf:r,buffers:e}),o=a.callParserModule(function(e){return e.loadPrimitivesOfMesh},{tf:r,bufferViews:n}),i=a.callParserModule(function(e){return e.loadAnimations},{tf:r,bufferViews:n});t.primitives=o,t.bufferViews=n,t.animations=i});case 11:return i=e.sent,e.abrupt("return",t);case 13:case"end":return e.stop()}},e,this)}))}}],[{key:"parseFromURL",value:function(t,n){return p(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=new e(t,n),r.abrupt("return",o.parse());case 2:case"end":return r.stop()}},r,this)}))}}]),e}();t.default=v,v.parserModules=[m.default,c.default,f.default,u.default]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(12),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(){r(this,e)}return o(e,[{key:"__fetchBuffer",value:function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onload=function(e){t(r.response)},r.onerror=function(t){n({message:"Loading resource at '"+e+" failed. Is there resource file in dependency at correct location?'",error:t})},r.send()})}},{key:"__fetchImage",value:function(e){return a.default.resolve(e)}},{key:"__isDataUri",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"__getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}},{key:"__dataUriToText",value:function(e){var t=e.split(",");return atob(t[1])}},{key:"__dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;a<r;a++)i[a]=n.charCodeAt(a);return o}},{key:"__dataUriToImage",value:function(e){return new Promise(function(t,n){var r=new Image;r.src=e,r.onload=function(){t(r)}})}},{key:"__bufferToString",value:function(e){for(var t="",n=0;n<e.byteLength;n+=1024)t+=this._smallBufferToString(new Uint8Array(e.slice(n,n+1024)));return t}},{key:"__getBufferReader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGLRenderingContext.UNSIGNED_BYTE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(t){case WebGLRenderingContext.UNSIGNED_BYTE:e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);break;case WebGLRenderingContext.UNSIGNED_SHORT:e=new Uint16Array(e.buffer,e.byteOffset,e.byteLength);break;case WebGLRenderingContext.UNSIGNED_BYTE:e=new Uint32Array(e.buffer,e.byteOffset,e.byteLength);break;default:throw new Error("Unknown array buffer")}if(0!==r)throw new Error("Accessing a buffer with stride is not supported yet.");return function(t){return e[n+t]}}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}}]),e}();t.default=u},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Components.TransformComponent},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Quaternion},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(t,n,o,i,u,s){r(this,e),this.buffer=t,this.count=n,this.componentType=o,this.elementSize=i,this.byteOffset=u,this.byteStride=s,this._dView=new DataView(t.buffer,t.byteOffset+u),this._elementByteSize=a.default.asByteSize(o),0===s&&(this.byteStride=this.elementSize*this._elementByteSize)}return o(e,[{key:"getByIndex",value:function(e){if(e<0||e>=this.count)return null;for(var t=new Array(this.elementSize),n=0;n<this.elementSize;n++)t[n]=this._getSingleByIndex(e,n);return t}},{key:"_getSingleByIndex",value:function(e,t){switch(this.componentType){case WebGLRenderingContext.FLOAT:return this._dView.getFloat32(e*this.byteStride+this._elementByteSize*t,!0);default:throw new Error("Unsupported element type")}}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(24),u=r(a),s=n(12),f=r(s),l=n(31),c=r(l),d=function(){function e(t){o(this,e),this._rootPath=t,this.baseDirectory=this._getBaseDir(t)}return i(e,[{key:"loadGLTFFile",value:function(){var e=this;return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e._rootPath),r.responseType="arraybuffer",r.onload=function(n){for(var o=new Uint8Array(r.response),i=[103,108,84,70],a=!0,u=0;u<i.length;u++)o[u]!==i[u]&&(a=!1);var s=void 0;if(a){var f=new DataView(r.response),l=f.getUint32(8,!0),d=f.getUint32(12,!0);s=e._bufferToString(r.response.slice(20,20+d)),e.binaryGLTFBuffer=r.response.slice(20+d,l)}else s=e._bufferToString(r.response);e.tf=JSON.parse(s),e.tf.id=c.default.calcHash(s),t(e.tf)},r.onerror=function(e){},r.send()})}},{key:"loadImage",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,o=this.tf.bufferViews[r.bufferView],i=new Blob([new Uint8Array(this.binaryGLTFBuffer,o.byteOffset,o.byteLength)],{type:r.mimeType});t=window.URL.createObjectURL(i),n=!0}return this._isDataUrl(t)?this._dataUriToImage(t):f.default.resolve(n?t:this.baseDirectory+t)}},{key:"loadBuffer",value:function(e){var t=this;return this._isDataUrl(e)?new Promise(function(n,r){n(t._dataUriToArrayBuffer(e))}):new Promise(function(n,r){var o=new XMLHttpRequest;o.open("GET",t.baseDirectory+e),o.responseType="arraybuffer",o.onload=function(e){n(o.response)},o.onerror=function(n){r({message:"Loading resource at '"+(t.baseDirectory+e)+" failed. Is there resource file in dependency at correct location?'",error:n})},o.send()})}},{key:"loadShader",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,o=this.tf.bufferViews[r.bufferView],i=new Blob([new Uint8Array(this.binaryGLTFBuffer,o.byteOffset,o.byteLength)],{type:"text/plain"});t=window.URL.createObjectURL(i),n=!0}return this._isDataUrl(t)?Promise.resolve(this._dataUriToText(t)):u.default.resolve(n?t:this.baseDirectory+t)}},{key:"_dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;a<r;a++)i[a]=n.charCodeAt(a);return o}},{key:"_dataUriToImage",value:function(e){var t=this;return new Promise(function(n,r){var o=document.createElement("canvas"),i=(o.getContext("2d"),new Image);i.src=e,i.onload=function(){n(t._ensureCorrectSize(i))}})}},{key:"_dataUriToText",value:function(e){var t=e.split(",");return atob(t[1])}},{key:"_ensureCorrectSize",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=Math.pow(2,Math.ceil(Math.log(e.width)/Math.LN2)),o=Math.pow(2,Math.ceil(Math.log(e.height)/Math.LN2));return r===e.width&&o===e.height?e:(t.width=r,t.height=o,n.drawImage(e,0,0,e.width,e.height,0,0,r,o),t)}},{key:"_bufferToString",value:function(e){for(var t="",n=0;n<e.byteLength;n+=1024)t+=this._smallBufferToString(new Uint8Array(e.slice(n,n+1024)));return t}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}},{key:"_isDataUrl",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"_getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),i=r(o),a=n(1),u=r(a),s=n(11),f=r(s),l=n(14),c=r(l),d=n(27),m=r(d),p=n(35),v=r(p),b=n(34),h=r(b),y=n(30),_=r(y),g=n(28),w=r(g),T=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})};t.default=function(){"string"!=typeof _.default.staticImports["forward-shading"]&&(_.default.staticImports["forward-shading"]=""),w.default.request("OES_standard_derivatives"),w.default.request("OES_element_index_uint"),f.default.register(function(){return T(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f.default.registerComponent("GLTFModel",u.default),f.default.registerComponent("GLTFJoint",i.default),f.default.registerNode("model",["GLTFModel"],{},"object"),f.default.registerNode("gltf-mesh",[],{material:"new(gltf-unlit)"},"mesh"),f.default.registerNode("gltf-joint",["GLTFJoint"],{},"object"),f.default.registerNode("gltf-assets",[],{}),c.default.addSORTMaterial("gltf-unlit",v.default),c.default.addSORTMaterial("gltf-pbr-metallic-roughness",h.default),m.default.add("JOINTMATRIX",function(e,t){return function(t,n){n.renderable.renderArgs["gltf-jointMatrices"]&&t.uniformMatrixArray(e.name,n.renderable.renderArgs["gltf-jointMatrices"])}});case 9:case"end":return e.stop()}},e,this)}))})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(19),i=r(o),a=n(3),u=r(a),s=n(1),f=r(s),l=n(4),c=r(l),d=n(2),m=r(d),p=n(5),v=r(p),b=n(6),h=r(b),y=n(7),_=r(y),g=n(8),w=r(g),T=n(9),x=r(T),O=n(0),C=r(O),M=n(10),R=r(M),S=n(20),P=r(S),E=n(21),A=r(E),k=n(11),N=r(k),j={Accessor:{Accessor:i.default},Components:{GLTFJointComponent:u.default,GLTFModelComponent:f.default},Instanciator:{DefaultInstanciator:c.default},Parser:{ConstantConverter:m.default,DefaultParserModule:v.default,Modules:{EmbeddedBufferModule:h.default,IndexComplementorModule:_.default,NormalComplementorModule:w.default},Parser:x.default,ParserModule:C.default,ParserModuleBase:R.default},Util:{ResourceResolver:P.default}};N.default.notifyRegisteringPlugin("grimoirejs-gltf");var I=(0,A.default)();Object.assign(j,{__VERSION__:"2.1.2",__NAME__:"grimoirejs-gltf"}),Object.assign(I||{},j),window.GrimoireJS.lib.gltf=j,t.default=I},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.animation.Animation.AnimationFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Components.MeshRendererComponent},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.UniformResolverRegistry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.GLExtRequestor},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Sort.ImportResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Util.HashCalculator},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){e.exports='@Pass{\n#extension GL_OES_standard_derivatives : enable\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\n@ExposeMacro(int,jointCount,JOINT_COUNT,0)\nFS_PREC(mediump,float)\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n#if JOINT_COUNT > 0\n  @JOINTMATRIX\n  uniform mat4 boneMatrices[JOINT_COUNT];\n#endif\n  @NORMAL\n  attribute vec3 normal;\n  @POSITION\n  attribute vec3 position;\n#ifdef ATTRIBUTE_TEXCOORD_0_ENABLED\n  @TEXCOORD_0\n  attribute vec2 texCoord;\n#endif\n#if JOINT_COUNT > 0\n  @JOINTS_0\n  attribute vec4 joint;\n  @WEIGHTS_0\n  attribute vec4 weight;\n#endif\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n  void main(){\n    mat4 transform = _matM;\n    mat4 projectionTransform = _matPVM;\n    #if JOINT_COUNT > 0\n      mat4 skinMat = weight.x * boneMatrices[int(joint.x)] + weight.y * boneMatrices[int(joint.y)] + weight.z * boneMatrices[int(joint.z)] + weight.w * boneMatrices[int(joint.w)];\n      transform *= skinMat;\n      projectionTransform *= skinMat;\n    #endif\n    #ifdef ATTRIBUTE_TEXCOORD_0_ENABLED\n        vUV = texCoord;\n    #else\n        vUV  = position.xy /2.0 + vec2(0.5);\n    #endif\n    vNormal = normalize((transform * vec4(normal,0.0)).xyz);\n    vPosition = (transform * vec4(position,1.0)).xyz;\n    gl_Position = projectionTransform * vec4(position,1.0);\n  }\n\n\n#endif\n\n\n#ifdef FS\n  @HAS_TEXTURE{sampler:"normalTexture"}\n  uniform bool has_normalTexture;\n\n  uniform sampler2D normalTexture;\n\n  @{default:"1,1,1,1"}\n  uniform vec4 baseColorFactor;\n\n  uniform sampler2D baseColorTexture;\n\n  @HAS_TEXTURE{sampler:"baseColorTexture"}\n  uniform bool has_baseColorTexture;\n\n  @{default:"1"}\n  uniform float metallicFactor;\n\n  uniform sampler2D metallicTexture;\n\n  @HAS_TEXTURE{sampler:"metallicTexture"}\n  uniform bool has_metallicTexture;\n\n  @{default:"1"}\n  uniform float roughnessFactor;\n\n  uniform sampler2D roughnessTexture;\n\n  @HAS_TEXTURE{sampler:"roughnessTexture"}\n  uniform bool has_roughnessTexture;\n\n  @{default:"0,0,0"}\n  uniform vec3 emissiveFactor;\n\n  uniform sampler2D emissiveTexture;\n\n  @HAS_TEXTURE{sampler:"emissiveTexture"}\n  uniform bool has_emissiveTexture;\n\n  uniform sampler2D metallicRoughnessTexture;\n\n  @HAS_TEXTURE{sampler:"metallicRoughnessTexture"}\n  uniform bool has_metallicRoughnessTexture;\n\n  uniform sampler2D occlusionTexture;\n\n  @HAS_TEXTURE{sampler:"occlusionTexture"}\n  uniform bool has_occlusionTexture;\n\n  @CAMERA_POSITION\n  uniform vec3 _cameraPosition;\n\n  @import "forward-shading"\n\n  #ifndef GR_FORWARD_SHADING_ENABLED\n\n  struct simple_pbr_params{\n    vec3 diffuseColor;\n    vec3 f0;\n    float alpha;\n    float roughness;\n  };\n\n    @{default:"n(3,0.5,10)"}\n    uniform vec3 simpleLightDirection;\n\n    @{type:"color",default:"gray"}\n    uniform vec3 simpleLightColor;\n\n    @{default:0.3}\n    uniform float simpleLightIntencity;\n\n    float lambert(vec3 lightDirection,vec3 surfaceNormal) {\n      return max(0.0, dot(lightDirection, surfaceNormal));\n    }\n\n    float ctd_GGX_Distribution(simple_pbr_params param,vec3 l,vec3 v,vec3 n,vec3 h){\n      float alpha2 = pow(param.alpha,2.0);\n      float nh2 = pow(dot(n,h),2.0);\n      return alpha2/(PI*pow(nh2*(alpha2 - 1.0) + 1.0,2.0));\n    }\n\n    float ctg_GGX_SingleGeometryTerm(simple_pbr_params param,vec3 n,vec3 v){\n      float d = dot(n,v);\n      return 2.*d /(d + sqrt(d*d + param.alpha*param.alpha*(1. - d*d)));\n    }\n\n    vec3 ctf_Schlick(simple_pbr_params param,vec3 l,vec3 v,vec3 n,vec3 h){\n      vec3 f0 = param.f0;\n      float vh = dot(v,n);\n      return f0 + pow(1.0-vh,5.0) * (vec3(1.0) - f0);\n    }\n\n    vec3 cookTorranceBRDF(simple_pbr_params param,vec3 l,vec3 v,vec3 n){\n      vec3 h = normalize(l+v);\n      return  ctf_Schlick(param,l,v,n,h) * ctd_GGX_Distribution(param,l,v,n,h) * ctg_GGX_SingleGeometryTerm(param,n,l) * ctg_GGX_SingleGeometryTerm(param,n,v)/(4.0 * dot(l,n) * dot(v,n));\n    }\n\n    vec3 BRDF(simple_pbr_params params,vec3 li,vec3 lo,vec3 n){\n      return params.diffuseColor/PI + cookTorranceBRDF(params,li,lo,n);\n    }\n\n  #endif\n\n\n  void main(){\n    vec4 baseColor = baseColorFactor;\n    if(has_baseColorTexture){\n      baseColor *= texture2D(baseColorTexture,vUV);\n    }\n    vec3 emissive = emissiveFactor;\n    if(has_emissiveTexture){\n      emissive *= texture2D(emissiveTexture,vUV).rgb;\n    }\n    float metallic = metallicFactor;\n    if(has_metallicTexture){\n      metallic *= texture2D(metallicTexture,vUV).r;\n    }\n    float roughness = roughnessFactor;\n    if(has_roughnessTexture){\n      roughness *= texture2D(roughnessTexture,vUV).r;\n    }\n    if(has_metallicRoughnessTexture){\n      vec3 rm = texture2D(metallicRoughnessTexture,vUV).rgb;\n      metallic *= rm.b;\n      roughness *= rm.g;\n    }\n    vec3 normal = vNormal;\n    if(has_normalTexture){\n      vec3 pos_dx = dFdx(vPosition);\n      vec3 pos_dy = dFdy(vPosition);\n      vec3 tex_dx = dFdx(vec3(vUV, 0.0));\n      vec3 tex_dy = dFdy(vec3(vUV, 0.0));\n      vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n      t = normalize(t - vNormal * dot(vNormal, t));\n      vec3 b = normalize(cross(vNormal, t));\n      mat3 tbn = mat3(t, b, vNormal);\n      vec3 n = texture2D(normalTexture, vUV).rgb;\n      normal = normalize(tbn * (2.0 * n - 1.0));\n    }\n    vec3 dielectricSpecular = vec3(0.04);\n    vec3 diffuse = mix(baseColor.rgb * (1. - dielectricSpecular.r),vec3(0),metallic);\n    vec3 f0 = mix(dielectricSpecular,baseColor.rgb,metallic);\n    float alpha = roughness * roughness;\n    #ifdef GR_FORWARD_SHADING_ENABLED\n      pbr_params param = pbr_params(diffuse,f0,alpha,roughness);\n      gl_FragColor.rgb = shading(param,normal,vPosition);\n    #endif\n    #ifndef GR_FORWARD_SHADING_ENABLED\n      simple_pbr_params params = simple_pbr_params(diffuse,f0,alpha,roughness);\n      float lam = lambert(simpleLightDirection,normal);\n      vec3 brdfCoeff = BRDF(params,-simpleLightDirection,normalize(_cameraPosition - vPosition),normal);\n      gl_FragColor.rgb = vec3(lam) * simpleLightIntencity * simpleLightColor * brdfCoeff;\n    #endif\n    gl_FragColor.rgb += emissive;\n    gl_FragColor.rgb = pow(gl_FragColor.rgb,1.0/vec3(2.2));\n    if(has_occlusionTexture){\n      gl_FragColor.rgb *= texture2D(occlusionTexture,vUV).r;\n    }\n    gl_FragColor.a = baseColor.a;\n  }\n#endif\n}\n'},function(e,t){e.exports='@Pass{\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\n@ExposeMacro(int,jointCount,JOINT_COUNT,0)\nFS_PREC(mediump,float)\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n#if JOINT_COUNT > 0\n  @JOINTMATRIX\n  uniform mat4 boneMatrices[JOINT_COUNT];\n#endif\n  @NORMAL\n  attribute vec3 normal;\n  @POSITION\n  attribute vec3 position;\n  @TEXCOORD_0\n  attribute vec2 texCoord;\n#if JOINT_COUNT > 0\n  @JOINT\n  attribute vec4 joint;\n  @WEIGHT\n  attribute vec4 weight;\n#endif\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n  void main(){\n    mat4 transform = _matM;\n    mat4 projectionTransform = _matPVM;\n    #if JOINT_COUNT > 0\n      mat4 skinMat = weight.x * boneMatrices[int(joint.x)] + weight.y * boneMatrices[int(joint.y)] + weight.z * boneMatrices[int(joint.z)] + weight.w * boneMatrices[int(joint.w)];\n      transform *= skinMat;\n      projectionTransform *= skinMat;\n    #endif\n    vUV = texCoord;\n    vNormal = normalize((transform * vec4(normal,0.0)).xyz);\n    vPosition = (transform * vec4(position,1.0)).xyz;\n    gl_Position = projectionTransform * vec4(position,1.0);\n  }\n\n\n#endif\n\n\n#ifdef FS\n\n  @{type:"color"}\n  uniform vec3 ambient;\n\n  @AMBIENT_COEFFICIENT\n  uniform float ambientCoefficient;\n\n  uniform sampler2D ambientTexture;\n\n  @HAS_TEXTURE{sampler:"ambientTexture"}\n  uniform bool ambientTextureUsed;\n\n  @{type:"color"}\n  uniform vec4 diffuse;\n\n  uniform sampler2D diffuseTexture;\n\n  @HAS_TEXTURE{sampler:"diffuseTexture"}\n  uniform bool diffuseTextureUsed;\n\n  @{type:"color"}\n  uniform vec3 specular;\n\n  uniform sampler2D specularTexture;\n\n  @HAS_TEXTURE{sampler:"specularTexture"}\n  uniform bool specularTextureUsed;\n\n  @{type:"color"}\n  uniform vec3 emission;\n\n  uniform sampler2D emissionTexture;\n\n  @HAS_TEXTURE{sampler:"emissionTexture"}\n  uniform bool emissionTextureUsed;\n\n  @{default:"1.0"}\n  uniform float shininess;\n\n  @{default:"1.0"}\n  uniform float transparency;\n\n  uniform vec3 _cameraPosition;\n\n  @{default:"n(1,1,-1)"}\n  uniform vec3 sunDir;\n\n  void main(){\n    vec4 dColor = vec4(0);\n    vec3 sColor = vec3(0);\n    vec3 eColor = vec3(0);\n    vec3 aColor = vec3(0);\n    vec3 hVec = normalize(normalize(_cameraPosition - vPosition) + sunDir);\n    if(ambientTextureUsed){\n      aColor = texture2D(ambientTexture,vUV).rgb;\n    }else{\n      aColor = ambient;\n    }\n    if(diffuseTextureUsed){\n      dColor = texture2D(diffuseTexture,vUV);\n    }else{\n      dColor = diffuse;\n    }\n    dColor.rgb = max(0.,dot(sunDir,vNormal)) * dColor.rgb;\n    if(specularTextureUsed){\n      sColor = texture2D(specularTexture,vUV).rgb;\n    }else{\n      sColor = specular;\n    }\n    if(emissionTextureUsed){\n      eColor = texture2D(emissionTexture,vUV).rgb;\n    }else{\n      eColor = emission;\n    }\n    sColor = sColor * pow(max(0.,dot(hVec,vNormal)),shininess);\n    gl_FragColor.rgb = dColor.rgb + sColor + aColor * ambientCoefficient;// + eColor;// + aColor;\n    gl_FragColor.a = dColor.a * transparency;\n  }\n#endif\n}\n'}])});
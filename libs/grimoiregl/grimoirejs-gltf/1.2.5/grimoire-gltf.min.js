!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=r(o),i=n(3),u=r(i),f=n(8),s=r(f),l=n(9),c=r(l),d=n(4),m=r(d),y=n(1),p=r(y),b=n(5),v=r(b),h=n(6),_=r(h),w=n(10),g=r(w),x={Accessor:{Accessor:a.default},Animator:{Animator:u.default,Interpolators:s.default},Components:{GLTFAnimatorComponent:c.default,GLTFModelComponent:m.default},Parser:{ConstantConverter:p.default,MaterialsCommonParser:v.default,Parser:_.default}},C=(0,g.default)();Object.assign(C||{},x),window.GrimoireJS.lib.gltf=x,t.default=C},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(18),u=r(i),f=n(19),s=r(f),l=function(){function e(){o(this,e)}return a(e,null,[{key:"asColorValue",value:function(e){return 3===e.length?new u.default(e[0],e[1],e[2]):new s.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:case WebGLRenderingContext.SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:case WebGLRenderingContext.INT:case WebGLRenderingContext.FLOAT:return 4;default:throw new Error("Unknown size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.FLOAT:return Float32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}},{key:"asGrAttribName",value:function(e){switch(e){case"POSITION":return"position";case"NORMAL":return"normal";case"TEXCOORD_0":return"texCoord";case"JOINT":return"joint";case"WEIGHT":return"weight";default:throw new Error("Unknown semantic"+e)}}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),u=r(i),f=function(){function e(t,n,r,a,i,f){o(this,e),this.buffer=t,this.count=n,this.componentType=r,this.elementSize=a,this.byteOffset=i,this.byteStride=f,this._resultMemoryCache=[],this._resultMemoryCache=new Array(a),this._dView=new DataView(t.buffer,t.byteOffset+i),this._elementByteSize=u.default.asByteSize(r)}return a(e,[{key:"getByIndex",value:function(e){for(var t=0;t<this.elementSize;t++)this._resultMemoryCache[t]=this._getSingleByIndex(e,t);return this._resultMemoryCache}},{key:"_getSingleByIndex",value:function(e,t){switch(this.componentType){case WebGLRenderingContext.FLOAT:return this._dView.getFloat32(e*(this.elementSize*this._elementByteSize+this.byteStride)+this._elementByteSize*t,!0);default:throw new Error("Unsupported element type")}}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),u=r(i),f=n(2),s=r(f),l=function(){function e(t,n,r){o(this,e),this.tf=t,this.animationKey=n,this._buffers=r;var a=t.animations[n],i={};for(var f in a.parameters){var l=t.accessors[a.parameters[f]];i[f]=new s.default(r[l.bufferView],l.count,l.componentType,u.default.asVectorSize(l.type),l.byteOffset||0,l.byteStride||0)}}return a(e,[{key:"getFrame",value:function(e){}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(20),s=r(f),l=n(7),c=r(l),d=n(6),m=r(d),y=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"$mount",value:function(){var e=this,t=this.getValue("src");if(t){var n=this.companion.get("gl");m.default.parseFromURL(n,t).then(function(t){e._populateAssets(t),e._populateScene(t)})}}},{key:"_populateScene",value:function(e){var t=this.getValue("scene");t||(t=e.tf.scene);var n=e.tf.scenes[t],r=!0,o=!1,a=void 0;try{for(var i,u=n.nodes[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var f=i.value;this._populateNode(e,f,this.node)}}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_populateAssets",value:function(e){var t=this.node.addChildByName("gltf-assets",{});for(var n in e.materials){var r=t.addChildByName("material",e.materials[n]);r.element.className=e.materials[n].class}}},{key:"_populateNode",value:function(e,t,n){var r=e.tf.nodes[t],o=void 0;if(o=n.addChildByName("object",{}),void 0!==r.meshes)for(var a=0;a<r.meshes.length;a++)for(var i=e.meshes[r.meshes[a]],u=0;u<i.length;u++)o.addChildByName("gltf-mesh",{geometry:i[u],material:".gltf-"+e.tf.meshes[r.meshes[a]].primitives[u].material});if(r.translation&&o.setAttribute("position",r.translation),r.scale&&o.setAttribute("scale",r.scale),r.rotation&&o.setAttribute("rotation",r.rotation),r.matrix){var f=new s.default(r.matrix);o.setAttribute("position",f.getTranslation()),o.setAttribute("scale",f.getScaling()),o.setAttribute("rotation",f.getRotation())}if(r.children){var l=!0,c=!1,d=void 0;try{for(var m,y=r.children[Symbol.iterator]();!(l=(m=y.next()).done);l=!0){var p=m.value;this._populateNode(e,p,o)}}catch(e){c=!0,d=e}finally{try{!l&&y.return&&y.return()}finally{if(c)throw d}}}}}]),t}(c.default);t.default=y,y.componentName="GLTFModelComponent",y.attributes={src:{converter:"String",defaultValue:null},scene:{converter:"String",defaultValue:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),u=r(i),f=function(){function e(){o(this,e)}return a(e,null,[{key:"parse",value:function(e,t,n,r){var o=e.materials[t];if(o.extensions.KHR_materials_common){var a=o.extensions.KHR_materials_common,i=a.values;switch(a.technique){case"PHONG":case"BLINN":var f={type:"gltf-unlit",class:"gltf-"+t};return"string"==typeof i.diffuse?f.texture=r[i.diffuse]:Array.isArray(i.diffuse)&&(f.diffuse=u.default.asColorValue(i.diffuse)),f;default:throw new Error("Unsupported common material technique "+a.technique)}}}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),u=r(i),f=n(5),s=r(f),l=n(1),c=r(l),d=n(21),m=r(d),y=n(17),p=r(y),b=n(12),v=r(b),h=n(15),_=r(h),w=n(13),g=r(w),x=n(11),C=r(x),O=n(16),S=r(O),T=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{f(r.next(e))}catch(e){a(e)}}function u(e){try{f(r.throw(e))}catch(e){a(e)}}function f(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,u)}f((r=r.apply(e,t)).next())})},R=function(){function e(){o(this,e)}return a(e,null,[{key:"parseFromURL",value:function(t,n){return T(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o,a,i,f,l,c,d,m,y,p,b,h,w,g,x,O,T,R,A,G,N,M,P,E,L,j,I,U,k,B;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.getBaseDir(n),r.next=3,v.default.resolve(n);case 3:a=r.sent,i=JSON.parse(a),f={},l={},c={},d={},m={},y={},p={},b={},h={},r.t0=regeneratorRuntime.keys(i.buffers);case 15:if((r.t1=r.t0()).done){r.next=22;break}return w=r.t1.value,r.next=19,e.bufferFromURL(i,w,o);case 19:f[w]=r.sent,r.next=15;break;case 22:for(g in i.bufferViews)x=i.bufferViews[g],O=f[x.buffer],l[g]=new Uint8Array(O,x.byteOffset,x.byteLength),void 0===x.target||(T=d[g]=new _.default(t,x.target,WebGLRenderingContext.STATIC_DRAW),T.update(l[g]));for(R in i.meshes)c[R]=e._parseMesh(t,i,R,d,l);A=[],G=function(t){e.isDataUri(i.images[t].uri)?(M=document.createElement("canvas"),P=M.getContext("2d"),E=new Image,E.src=i.images[t].uri,M.width=E.width,M.height=E.height,P.drawImage(E,0,0),m[t]=M):A.push(C.default.resolve(o+i.images[t].uri).then(function(e){m[t]=e}))};for(N in i.images)G(N);return r.next=29,Promise.all(A);case 29:for(L in i.textures)j=i.textures[L],I=y[L]=new S.default(t),I.update(m[j.source]);for(U in i.materials)k=i.materials[U],void 0!==k.extensions&&k.extensions.KHR_materials_common?b[U]=s.default.parse(i,U,o,y):(console.warn("program is not parsed. Common material configuration are used alternatively"),i.materials[U].extensions={},i.materials[U].extensions.KHR_materials_common={values:k.values,technique:"PHONG",transparent:!0,jointCount:0,doubleSided:!0},b[U]=s.default.parse(i,U,o,y));if(i.animations)for(B in i.animations)p[B]=new u.default(i,B,l);return r.abrupt("return",{meshes:c,textures:y,tf:i,materials:b});case 33:case"end":return r.stop()}},r,this)}))}},{key:"_parseMesh",value:function(t,n,r,o,a){for(var i=n.meshes[r],u=[],f=0;f<i.primitives.length;f++){var s=i.primitives[f],l={};if(l.topology=s.mode||WebGLRenderingContext.TRIANGLES,s.indices){var d=n.accessors[s.indices];l.byteSize=c.default.asByteSize(d.componentType);var y=a[d.bufferView],b=c.default.elementTypeToTypedArray(d.componentType),v=new b(y.buffer,d.byteOffset+y.byteOffset),h=new _.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);h.update(v),l.type=d.componentType,l.index=h,l.byteOffset=0,l.count=d.count}else{var w=n.accessors[s.attributes.POSITION].count,x=c.default.indexCountToBufferInfo(w);l.type=x.elementType,l.index=new _.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW),l.byteSize=x.byteSize,l.byteOffset=0,l.count=w;for(var C=new x.ctor(l.count),O=0;O<l.count;O++)C[O]=O;l.index.update(C)}var S={},T={},R=void 0;if(!s.attributes.TEXCOORD_0){var A=n.accessors[s.attributes.POSITION],G=new _.default(t,WebGLRenderingContext.ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);G.update(new Float32Array(new ArrayBuffer(8*A.count))),T["@@UV"]=G,S.texCoord={bufferName:"@@UV",size:2,offset:0,stride:0,type:WebGLRenderingContext.FLOAT}}for(var N in s.attributes){var M=c.default.asGrAttribName(N),P=n.accessors[s.attributes[N]];T[P.bufferView]=o[P.bufferView],"POSITION"===N&&(R=P.max&&P.min?new p.default([new m.default(P.max[0],P.max[1],P.max[2]),new m.default(P.min[0],P.min[1],P.min[2])]):e._genAABB(a[P.bufferView],P.byteStride,P.byteOffset,P.count)),S[M]={bufferName:P.bufferView,size:c.default.asVectorSize(P.type),type:P.componentType,stride:P.byteStride,offset:P.byteOffset}}var E=new g.default(T,S,{default:l},R);E.materialName=s.material,u.push(E)}return u}},{key:"bufferFromURL",value:function(t,n,r){return e.isDataUri(t.buffers[n].uri)?new Promise(function(r,o){r(e.dataUriToArrayBuffer(t.buffers[n].uri))}):new Promise(function(e,o){var a=new XMLHttpRequest;a.open("GET",r+t.buffers[n].uri),a.responseType="arraybuffer",a.onload=function(t){e(a.response)},a.onerror=function(e){o(e)},a.send()})}},{key:"_genAABB",value:function(e,t,n,r){for(var o=new p.default,a=new Float32Array(e.buffer,e.byteOffset),i=n;i<n+(r-1)*t;i+=t)o.expand(new m.default(a[i],a[i+1],a[i+2]));return o}},{key:"isDataUri",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,o=new ArrayBuffer(r),a=new Uint8Array(o),i=0;i<r;i++)a[i]=n.charCodeAt(i);return o}},{key:"getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=R},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={LINEAR:function(e){return e}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(7),s=r(f),l=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"$mount",value:function(){}},{key:"$update",value:function(){}},{key:"$unmount",value:function(){}}]),t}(s.default);t.default=l,l.attributes={play:{converter:"Boolean",defaultValue:!1}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=r(o),i=n(22),u=r(i),f=n(14),s=r(f),l=n(23),c=r(l),d=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{f(r.next(e))}catch(e){a(e)}}function u(e){try{f(r.throw(e))}catch(e){a(e)}}function f(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,u)}f((r=r.apply(e,t)).next())})};t.default=function(){u.default.register(function(){return d(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:u.default.registerComponent("GLTFModel",a.default),u.default.registerNode("model",["GLTFModel"],{},"object"),u.default.registerNode("gltf-mesh",[],{material:"new(gltf-unlit)"},"mesh"),u.default.registerNode("gltf-assets",[],{}),s.default.addSORTMaterial("gltf-unlit",c.default);case 5:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Buffer},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.AABB},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){e.exports='@Pass\n@NoCull()\nFS_PREC(mediump,float)\n varying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n  attribute vec3 normal;\n  attribute vec3 position;\n  attribute vec2 texCoord;\n\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n\n  void main(){\n    gl_Position = _matPVM * vec4(position,1);\n    vNormal = normalize((_matM * vec4(normal,0)).xyz);\n    vUV = texCoord;\n  }\n\n\n#endif\n\n\n#ifdef FS\n  @{usedFlag:"_textureUsed"}\n  uniform sampler2D texture;\n\n  uniform bool _textureUsed;\n\n  @{type:"color"}\n  uniform vec4 diffuse;\n\n  @{default:"n(1,1,-1)"}\n  uniform vec3 sunDir;\n\n  void main(){\n    vec4 dColor;\n    if(_textureUsed){\n      dColor = texture2D(texture,vUV);\n    }else{\n      dColor = diffuse;\n    }\n    gl_FragColor.xyz = dot(sunDir,vNormal) * dColor.xyz;\n    gl_FragColor.w = dColor.w;\n  }\n#endif\n'}])});
//# sourceMappingURL=grimoire-gltf.min.js.map
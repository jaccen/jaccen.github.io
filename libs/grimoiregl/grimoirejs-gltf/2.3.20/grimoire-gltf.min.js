!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=22)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(24),u=r(a),f=n(25),s=r(f),l=function(){function e(){i(this,e)}return o(e,null,[{key:"asTypedArrayConstructor",value:function(e){switch(e){case WebGLRenderingContext.FLOAT:return Float32Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;default:throw new Error("Unsupported typed array constructor type "+e)}}},{key:"asColorValue",value:function(e){return 3===e.length?new u.default(e[0],e[1],e[2]):new s.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:case WebGLRenderingContext.SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:case WebGLRenderingContext.INT:case WebGLRenderingContext.FLOAT:return 4;default:throw new Error("Unknown size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.FLOAT:return Float32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(10),f=function(e){return e&&e.__esModule?e:{default:e}}(u),s=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.parser=e,o.baseDirectory=n,o.__gl=e.gl,o}return o(t,e),a(t,[{key:"fetchGLTF",value:function(e){}},{key:"loadAsGLTF",value:function(e){}},{key:"fetchTextureResource",value:function(e){}},{key:"loadTextureResources",value:function(e){}},{key:"convertTotexture",value:function(e){}},{key:"loadBufferResource",value:function(e){}},{key:"loadBufferResources",value:function(e){}},{key:"loadBufferViews",value:function(e){}},{key:"loadPrimitivesOfMesh",value:function(e){}},{key:"loadPrimitive",value:function(e){}},{key:"appendIndices",value:function(e){}},{key:"addVertexAttributes",value:function(e){}},{key:"complementVertexAttributes",value:function(e){}},{key:"loadMaterials",value:function(e){}},{key:"loadMaterial",value:function(e){}},{key:"loadAnimations",value:function(e){}},{key:"loadAnimation",value:function(e){}}]),t}(f.default);t.default=s},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(2),s=r(f),l=n(8),c=r(l),d=n(18),m=r(d),p=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.jointMatrices={},e.skeletons={},e}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,n=this.getAttribute("src");if(n){var r=this.companion.get("gl"),i=c.default.parseFromURL(r,n).then(function(n){e.modelMeta=n.tf,t.instanciator.instanciateAll(n,e,e.getAttribute("scene"))});if(this.loadPromise=i,this.getAttribute("waitForLoad")){this.companion.get("loader").register(i,this)}}}},{key:"$update",value:function(){}}]),t}(s.default);t.default=p,p.instanciator=new m.default,p.componentName="GLTFModelComponent",p.attributes={src:{converter:"String",default:null},scene:{converter:"String",default:null},waitForLoad:{converter:"Boolean",default:!1}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Vector3:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(6),s=r(f),l=n(7),c=r(l),d=n(2),m=r(d),p=n(3),v=r(p),b=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this._model=this.node.getComponentInAncestor(v.default),this._transform=this.node.getComponent(c.default),this._invBindMatrix=new s.default(this.getAttribute("invBindShapeMatrix")),this._skinIndex=this.getAttribute("skinIndex"),this._jointIndex=this.getAttribute("jointIndex")}},{key:"$update",value:function(){for(var e=this._model.skeletons[this._skinIndex].globalTransformInverse.multiplyWith(this._transform.globalTransform).multiplyWith(this._invBindMatrix),t=0;t<16;t++)this._model.jointMatrices[this._skinIndex][16*this._jointIndex+t]=e.rawElements[t]}}]),t}(m.default);t.default=b,b.attributes={invBindShapeMatrix:{converter:"Object",default:null},skinIndex:{converter:"Number",default:null},jointIndex:{converter:"Number",default:null}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Matrix:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Components.TransformComponent:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(9),u=r(a),f=n(15),s=r(f),l=n(16),c=r(l),d=n(17),m=r(d),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{f(r.next(e))}catch(e){o(e)}}function u(e){try{f(r.throw(e))}catch(e){o(e)}}function f(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t||[])).next())})},v=function(){function e(t,n){i(this,e),this.gl=t,this.url=n,this.parserModuleInstances=[];for(var r=0;r<e.parserModules.length;r++){var o=e.parserModules[r];this.parserModuleInstances.push(new o(this,n.substr(0,n.lastIndexOf("/")+1)))}}return o(e,[{key:"callParserModule",value:function(e,t){for(var n=0;n<this.parserModuleInstances.length;n++){var r=this.parserModuleInstances[n],i=e(r);if(void 0!==i){var o=i.call(r,t);if(void 0!==o)return o}}throw new Error('Parsing gltf failed. At the module "'+e.toString()+'"')}},{key:"parse",value:function(){return p(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,i,o,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,this.callParserModule(function(e){return e.fetchGLTF},this.url);case 3:return n=e.sent,r=this.callParserModule(function(e){return e.loadAsGLTF},n),t.tf=r,e.next=8,this.callParserModule(function(e){return e.loadTextureResources},r).then(function(e){return a.callParserModule(function(e){return e.loadMaterials},{tf:r,textures:e})}).then(function(e){t.materials=e});case 8:return i=e.sent,e.next=11,this.callParserModule(function(e){return e.loadBufferResources},r).then(function(e){var n=a.callParserModule(function(e){return e.loadBufferViews},{tf:r,buffers:e}),i=a.callParserModule(function(e){return e.loadPrimitivesOfMesh},{tf:r,bufferViews:n}),o=a.callParserModule(function(e){return e.loadAnimations},{tf:r,bufferViews:n});t.primitives=i,t.bufferViews=n,t.animations=o});case 11:return o=e.sent,e.abrupt("return",t);case 13:case"end":return e.stop()}},e,this)}))}}],[{key:"parseFromURL",value:function(t,n){return p(this,void 0,void 0,regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=new e(t,n),r.abrupt("return",i.parse());case 2:case"end":return r.stop()}},r,this)}))}}]),e}();t.default=v,v.parserModules=[m.default,c.default,s.default,u.default]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(1),s=r(f),l=n(0),c=r(l),d=n(26),m=r(d),p=n(27),v=r(p),b=n(28),y=r(b),h=n(4),_=r(h),w=n(12),g=r(w),T=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{f(r.next(e))}catch(e){o(e)}}function u(e){try{f(r.throw(e))}catch(e){o(e)}}function f(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t||[])).next())})},x=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"fetchGLTF",value:function(e){return this.__fetchBuffer(e)}},{key:"loadAsGLTF",value:function(e){var t=this.__bufferToString(e);return JSON.parse(t)}},{key:"loadTextureResources",value:function(e){return T(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,i,o,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},r=[],e.images){i=function(t){var i=e.textures[t],o=a.parser.callParserModule(function(e){return e.fetchTextureResource},e.images[i.source]).then(function(r){var i=a.parser.callParserModule(function(e){return e.convertTotexture},{tf:e,image:r,texIndex:t});n[t]=i});r.push(o)};for(o in e.textures)i(o)}return t.next=5,Promise.all(r);case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}},t,this)}))}},{key:"fetchTextureResource",value:function(e){return this.__fetchImage(this.__asAbsoluteURL(this.baseDirectory,e.uri))}},{key:"convertTotexture",value:function(e){var t=new m.default(this.__gl);t.update(e.image,{flipY:!1});var n=e.tf.textures[e.texIndex],r={};return n&&void 0!==n.sampler&&(r=e.tf.samplers[n.sampler]),t.magFilter=r.magFilter||WebGLRenderingContext.LINEAR,t.minFilter=r.minFilter||WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,t.wrapS=r.wrapS||WebGLRenderingContext.REPEAT,t.wrapT=r.wrapT||WebGLRenderingContext.REPEAT,t}},{key:"loadBufferResource",value:function(e){return this.__fetchBuffer(this.__asAbsoluteURL(this.baseDirectory,e.uri))}},{key:"loadBufferResources",value:function(e){return T(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,i,o,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},r=[],i=function(t){r.push(a.parser.callParserModule(function(e){return e.loadBufferResource},e.buffers[t]).then(function(e){n[t]=e}))};for(o in e.buffers)i(o);return t.next=6,Promise.all(r);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}},t,this)}))}},{key:"loadBufferViews",value:function(e){var t={};for(var n in e.tf.bufferViews){var r=e.tf.bufferViews[n];void 0===r.byteOffset&&(r.byteOffset=0),t[n]=new Uint8Array(e.buffers[r.buffer],r.byteOffset,r.byteLength)}return t}},{key:"loadPrimitivesOfMesh",value:function(e){var t={};for(var n in e.tf.meshes){var r=e.tf.meshes[n],i=[];t[n]=i;for(var o in r.primitives)i.push(this.parser.callParserModule(function(e){return e.loadPrimitive},{tf:e.tf,bufferViews:e.bufferViews,primitive:r.primitives[o]}))}return t}},{key:"loadPrimitive",value:function(e){var t=void 0===e.primitive.targets?new v.default(this.__gl):new y.default(this.__gl);return this.parser.callParserModule(function(e){return e.appendIndices},{tf:e.tf,bufferViews:e.bufferViews,primitive:e.primitive,geometry:t}),this.parser.callParserModule(function(e){return e.addVertexAttributes},{tf:e.tf,bufferViews:e.bufferViews,primitive:e.primitive,geometry:t}),t}},{key:"appendIndices",value:function(e){if(void 0!==e.primitive.indices){var t=e.primitive.mode||WebGLRenderingContext.TRIANGLES,n=e.tf.accessors[e.primitive.indices];return e.geometry.addIndex("default",e.bufferViews[n.bufferView],t,n.byteOffset,n.count,n.componentType),!0}}},{key:"addVertexAttributes",value:function(e){for(var t in e.primitive.attributes){var n=e.primitive,r=e.tf.accessors[n.attributes[t]],i=e.tf.bufferViews[r.bufferView],o={},a=c.default.asVectorSize(r.type),u=!1;if(n.targets&&n.targets.length>=1){var f=!0,s=!1,l=void 0;try{for(var d,m=n.targets[Symbol.iterator]();!(f=(d=m.next()).done);f=!0){if(t in d.value){u=!0;break}}}catch(e){s=!0,l=e}finally{try{!f&&m.return&&m.return()}finally{if(s)throw l}}}o[t]={size:a,type:r.componentType,stride:i.byteStride,offset:0,keepOnBuffer:u};var p=e.bufferViews[r.bufferView],v=c.default.asTypedArrayConstructor(r.componentType),b=this.__convertBufferView(v,p,i,r);if(e.geometry.addAttributes(b,o),"POSITION"===t){var y=i.byteStride/4;isNaN(y)&&(y=3);for(var h=0;h<r.count;h++){var w=h*y;e.geometry.aabb.expand(new _.default(b[w],b[w+1],b[w+2]))}}if(void 0!==e.primitive.targets&&void 0!==e.primitive.targets[0][t]){for(var g=e.geometry,T=[],x=e.primitive.targets,S=0;S<x.length;S++){var O=e.tf.accessors[x[S][t]],E=e.tf.bufferViews[O.bufferView],A=e.bufferViews[O.bufferView],R=this.__convertBufferView(Float32Array,A,E,O);T.push({buffer:R,accessor:{size:c.default.asVectorSize(O.type),stride:E.byteStride,offset:0}})}g.addMorphAttribute(t,T)}}return this.parser.callParserModule(function(e){return e.complementVertexAttributes},e),!0}},{key:"complementVertexAttributes",value:function(e){return!0}},{key:"loadMaterials",value:function(e){return T(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},t.t0=regeneratorRuntime.keys(e.tf.materials);case 2:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.next=6,this.parser.callParserModule(function(e){return e.loadMaterial},{material:e.tf.materials[r],textures:e.textures});case 6:n[r]=t.sent,t.next=2;break;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}},t,this)}))}},{key:"loadMaterial",value:function(e){return T(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",g.default.get(this.__gl).getInstanciator(e.material,e.textures,e.tf,this.parser));case 1:case"end":return t.stop()}},t,this)}))}},{key:"loadAnimations",value:function(e){var t={};for(var n in e.tf.animations){var r=e.tf.animations[n];t[n]=this.parser.callParserModule(function(e){return e.loadAnimation},{tf:e.tf,bufferViews:e.bufferViews,animation:r})}return t}},{key:"loadAnimation",value:function(e){for(var t=[],n=0;n<e.animation.channels.length;n++){var r={},i=e.animation.channels[n],o=".gltf-node-"+i.target.node,a=this._pathNameToGrimoire(i.target.path),u=e.animation.samplers[i.sampler];r.query=o,r.component=a.component,r.attribute=a.attributeName;for(var f=e.tf.accessors[u.input],s=e.tf.accessors[u.output],l=e.tf.bufferViews[f.bufferView],c=e.bufferViews[f.bufferView],d=e.bufferViews[s.bufferView],m=e.tf.bufferViews[s.bufferView],p=this.__convertBufferView(Float32Array,c,l,f),v=this.__convertBufferView(Float32Array,d,m,s),b=v.length/p.length,y=new Array(f.count),h=0;h<f.count;h++)y[h]=1e3*p[h];r.timeline=y,r.defaultEffect="LINEAR";for(var _=[],w=0;w<s.count;w++){_[w]=[];for(var g=0;g<b;g++)_[w][g]=v[w*b+g]}r.values=_,t.push(r)}return{default:t}}},{key:"_pathNameToGrimoire",value:function(e){switch(e){case"translation":return{component:"Transform",attributeName:"position"};case"rotation":return{component:"Transform",attributeName:"rotation"};case"scale":return{component:"Transform",attributeName:"scale"};case"weights":return{component:"GLTFVertexMorpher",attributeName:"weights"};default:throw new Error("Unsupported path type on grimoire")}}}]),t}(s.default);t.default=x},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(11),u=r(a),f=n(0),s=r(f),l=function(){function e(){i(this,e)}return o(e,[{key:"__convertBufferView",value:function(e,t,n,r){var i=0;t.byteOffset&&(i+=t.byteOffset),r.byteOffset&&(i+=r.byteOffset);var o=r.count*s.default.asVectorSize(r.type);return n.byteStride&&(o=n.byteStride*r.count/s.default.asByteSize(r.componentType)),new e(t.buffer,i,o)}},{key:"__fetchBuffer",value:function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onload=function(e){t(r.response)},r.onerror=function(t){n({message:"Loading resource at '"+e+" failed. Is there resource file in dependency at correct location?'",error:t})},r.send()})}},{key:"__fetchImage",value:function(e){return u.default.resolve(e)}},{key:"__asAbsoluteURL",value:function(e,t){return this.__isDataUri(t)?t:e+t}},{key:"__isDataUri",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"__getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}},{key:"__dataUriToText",value:function(e){var t=e.split(",");return atob(t[1])}},{key:"__dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,i=new ArrayBuffer(r),o=new Uint8Array(i),a=0;a<r;a++)o[a]=n.charCodeAt(a);return i}},{key:"__dataUriToImage",value:function(e){return new Promise(function(t,n){var r=new Image;r.src=e,r.onload=function(){t(r)}})}},{key:"__bufferToString",value:function(e){for(var t="",n=0;n<e.byteLength;n+=1024)t+=this._smallBufferToString(new Uint8Array(e.slice(n,n+1024)));return t}},{key:"__getBufferReader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGLRenderingContext.UNSIGNED_BYTE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(t){case WebGLRenderingContext.UNSIGNED_BYTE:e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);break;case WebGLRenderingContext.UNSIGNED_SHORT:e=new Uint16Array(e.buffer,e.byteOffset,e.byteLength);break;case WebGLRenderingContext.UNSIGNED_BYTE:e=new Uint32Array(e.buffer,e.byteOffset,e.byteLength);break;default:throw new Error("Unknown array buffer")}if(0!==r)throw new Error("Accessing a buffer with stride is not supported yet.");return function(t){return e[n+t]}}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}}]),e}();t.default=l},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Asset.ImageResolver:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(29),s=r(f),l=n(13),c=r(l),d=n(14),m=r(d),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{f(r.next(e))}catch(e){o(e)}}function u(e){try{f(r.throw(e))}catch(e){o(e)}}function f(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t||[])).next())})},v=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.gl=e,n}return a(t,e),u(t,[{key:"getInstanciator",value:function(e,n,r,i){return p(this,void 0,void 0,regeneratorRuntime.mark(function o(){var a,u,f,s;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:a=c.default.get(this.gl),u=0;case 2:if(!(u<t.instanciators.length)){o.next=12;break}return f=t.instanciators[t.instanciators.length-1-u],o.next=6,f.tryInstanciate(a,e,n,r,i);case 6:if(!(s=o.sent)){o.next=9;break}return o.abrupt("return",s);case 9:u++,o.next=2;break;case 12:throw new Error("Can't find any material for specified model."+JSON.stringify(e));case 13:case"end":return o.stop()}},o,this)}))}}],[{key:"get",value:function(e){return this.__get(e,t)}}]),t}(s.default);t.default=v,v.instanciators=[new m.default],v.registryName="gltf-material-instanciator"},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Material.MaterialFactory:void 0},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(30),a=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{f(r.next(e))}catch(e){o(e)}}function u(e){try{f(r.throw(e))}catch(e){o(e)}}function f(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t||[])).next())})},f=function(){function e(){r(this,e)}return i(e,[{key:"tryInstanciate",value:function(e,t,n,r,i){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.pbrMetallicRoughness){r.next=9;break}return r.next=3,e.instanciate("gltf-pbr-metallic-roughness");case 3:return i=r.sent,o=i.techniques.default.passes[0],this.__applyPBRMetallicRoughnessParameters(t,o,n),r.abrupt("return",i);case 9:return r.abrupt("return",null);case 10:case"end":return r.stop()}},r,this)}))}},{key:"__applyPBRMetallicRoughnessParameters",value:function(e,t,n){var r=e.pbrMetallicRoughness;r.baseColorFactor&&t.setArgument("baseColorFactor",r.baseColorFactor,null),r.baseColorTexture&&t.setArgument("baseColorTexture",new a.default(n[r.baseColorTexture.index]),null),r.metallicFactor&&t.setArgument("metallicFactor",r.metallicFactor,null),r.metallicTexture&&t.setArgument("metallicTexture",new a.default(n[r.metallicTexture.index]),null),r.roughnessTexture&&t.setArgument("roughnessTexture",new a.default(n[r.roughnessTexture.index]),null),r.roughnessFactor&&t.setArgument("roughnessFactor",r.roughnessFactor,null),r.metallicRoughnessTexture&&t.setArgument("metallicRoughnessTexture",new a.default(n[r.metallicRoughnessTexture.index]),null),e.emissiveFactor&&t.setArgument("emissiveFactor",e.emissiveFactor,null),e.emissiveTexture&&t.setArgument("emissiveTexture",new a.default(n[e.emissiveTexture.index]),null),e.normalTexture&&t.setArgument("normalTexture",new a.default(n[e.normalTexture.index]),null),e.occlusionTexture&&t.setArgument("occlusionTexture",new a.default(n[e.occlusionTexture.index]),null),r.baseColorTexture&&t.setArgument("baseColorTexture",new a.default(n[r.baseColorTexture.index]),null),r.metallicFactor&&t.setArgument("metallicFactor",r.metallicFactor,null),r.metallicTexture&&t.setArgument("metallicTexture",new a.default(n[r.metallicTexture.index]),null),r.roughnessTexture&&t.setArgument("roughnessTexture",new a.default(n[r.roughnessTexture.index]),null),r.roughnessFactor&&t.setArgument("roughnessFactor",r.roughnessFactor,null),r.metallicRoughnessTexture&&t.setArgument("metallicRoughnessTexture",new a.default(n[r.metallicRoughnessTexture.index]),null),e.emissiveFactor&&t.setArgument("emissiveFactor",e.emissiveFactor,null),e.emissiveTexture&&t.setArgument("emissiveTexture",new a.default(n[e.emissiveTexture.index]),null),e.normalTexture&&t.setArgument("normalTexture",new a.default(n[e.normalTexture.index]),null),e.occlusionTexture&&t.setArgument("occlusionTexture",new a.default(n[e.occlusionTexture.index]),null)}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(1),s=r(f),l=n(4),c=r(l),d=n(0),m=r(d),p=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"complementVertexAttributes",value:function(e){if(void 0===e.primitive.attributes.NORMAL&&void 0!==e.primitive.attributes.POSITION){var t=e.tf.accessors[e.primitive.attributes.POSITION],n=e.tf.bufferViews[t.bufferView],r=e.bufferViews[t.bufferView],i=this.__convertBufferView(m.default.asTypedArrayConstructor(t.componentType),r,n,t);if(!t.count)throw new Error("Accessor count of POSITION buffer should be defined for complementing NORMAL buffer");var o=e.tf.accessors[e.primitive.indices],a=new Float32Array(3*t.count);if(o)for(var u=e.tf.bufferViews[o.bufferView],f=e.bufferViews[o.bufferView],s=this.__convertBufferView(m.default.asTypedArrayConstructor(o.componentType),f,u,o),l=0;l<o.count/3;l++)this._calcFlatNormal(i,a,s[3*l],s[3*l+1],s[3*l+2]);else for(var c=0;c<t.count/3;c++)this._calcFlatNormal(i,a,3*c,3*c+1,3*c+2);e.geometry.addAttributes(a,{NORMAL:{size:3}})}return!1}},{key:"_getElement",value:function(e,t,n){return e[t+n]}},{key:"_calcFlatNormal",value:function(e,t,n,r,i){var o=new c.default(this._getElement(e,3*r,0)-this._getElement(e,3*n,0),this._getElement(e,3*r,1)-this._getElement(e,3*n,1),this._getElement(e,3*r,2)-this._getElement(e,3*n,2)),a=new c.default(this._getElement(e,3*i,0)-this._getElement(e,3*n,0),this._getElement(e,3*i,1)-this._getElement(e,3*n,1),this._getElement(e,3*i,2)-this._getElement(e,3*n,2)),u=c.default.cross(o,a).normalizeThis();t[3*n]=u.X,t[3*n+1]=u.Y,t[3*n+2]=u.Z,t[3*r]=u.X,t[3*r+1]=u.Y,t[3*r+2]=u.Z,t[3*i]=u.X,t[3*i+1]=u.Y,t[3*i+2]=u.Z}}]),t}(s.default);t.default=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),f=function(e){return e&&e.__esModule?e:{default:e}}(u),s=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"appendIndices",value:function(e){if(void 0===e.primitive.indices){var t=e.primitive.mode||WebGLRenderingContext.TRIANGLES,n=e.tf.accessors[e.primitive.attributes.POSITION];if(void 0===n.count)throw new Error("POSITION buffer should have count parameter. Construction of index buffer was failed.");if(t!==WebGLRenderingContext.TRIANGLES)throw new Error("Complementing index buffer is only supported for TRIANGLES topology currently.");for(var r=new Array(n.count),i=0;i<n.count;i++)r[i]=i;return e.geometry.addIndex("default",r),!0}}}]),t}(f.default);t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),f=function(e){return e&&e.__esModule?e:{default:e}}(u),s=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"loadBufferResource",value:function(e){if(this.__isDataUri(e.uri))return Promise.resolve(this.__dataUriToArrayBuffer(e.uri))}}]),t}(f.default);t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(7),u=r(a),f=n(19),s=r(f),l=n(0),c=r(l),d=n(31),m=r(d),p=n(4),v=r(p),b=n(6),y=r(b),h=n(32),_=r(h),w=function(){function e(){i(this,e),this._skinInstanciators=[]}return o(e,[{key:"instanciateAll",value:function(e,t,n){var r=n;if(null===r&&(r=e.tf.scene),"number"!=typeof r)for(var i in e.tf.scenes){r=i;break}var o=e.tf.scenes[r];this.__instanciateScene(o,t,e),this.__instanciateAnimations(t,e)}},{key:"__instanciateScene",value:function(e,t,n){var r={},i=!0,o=!1,a=void 0;try{for(var u,f=e.nodes[Symbol.iterator]();!(i=(u=f.next()).done);i=!0){var s=u.value;this.__instanciateNode(n,s,r,t.node,t)}}catch(e){o=!0,a=e}finally{try{!i&&f.return&&f.return()}finally{if(o)throw a}}this._skinInstanciators.forEach(function(e){return e()})}},{key:"__instanciateAnimations",value:function(e,t){for(var n in t.animations)_.default.addAnimation("gltf-animation-"+n,JSON.stringify(t.animations[n])),e.node.addComponent("Animation",{animation:"gltf-animation-"+n,clips:"default"})}},{key:"__instanciateNode",value:function(e,t,n,r,i){var o=this,a=e.tf.nodes[t],f=void 0,l=[];if(void 0!==a.mesh){var c=e.primitives[a.mesh],d=e.tf.meshes[a.mesh];if(1===c.length){var m=e.materials[d.primitives[0].material],p=e.tf.meshes[a.mesh].primitives[0],v="back";e.tf.materials&&void 0!==d.primitives[0].material&&void 0!==e.tf.materials[d.primitives[0].material]&&(v=e.tf.materials[d.primitives[0].material].doubleSided?"none":"back");var b=r.addChildByName("mesh",{geometry:c[0],material:m,cull:v});void 0!==p.targets&&p.targets.length>=1&&b.addComponent("GLTFVertexMorpher",{weights:d.weights}),l.push(b),f=b}else{for(var y=r.addChildByName("object",{}),h=0;h<c.length;h++){var _=e.materials[d.primitives[h].material],w="back";e.tf.materials&&void 0!==d.primitives[h].material&&void 0!==e.tf.materials[d.primitives[h].material]&&(w=e.tf.materials[d.primitives[h].material].doubleSided?"none":"back");var g=y.addChildByName("mesh",{geometry:c[h],material:_,cull:w});l.push(g)}f=y}}else f=r.addChildByName("object",{});n[t]=f;var T="";if(a.name&&(T=" gltf-node-name-"+a.name.replace(/\s+/g,"")),f.setAttribute("class","gltf-node-"+t+T),this.__applyTransform(f,a),a.children){var x=!0,S=!1,O=void 0;try{for(var E,A=a.children[Symbol.iterator]();!(x=(E=A.next()).done);x=!0){var R=E.value;this.__instanciateNode(e,R,n,f,i)}}catch(e){S=!0,O=e}finally{try{!x&&A.return&&A.return()}finally{if(S)throw O}}}void 0!==a.skin&&this._skinInstanciators.push(function(){var t=e.tf.skins[a.skin];i.skeletons[a.skin]=f.getComponent(u.default);var r=e.tf.accessors[t.inverseBindMatrices],c=e.tf.bufferViews[r.bufferView],d=e.bufferViews[r.bufferView],m=o.__convertBufferView(Float32Array,d,c,r),p=c.byteStride?c.byteStride:4,v=function(e){return m[p/4*e]};void 0===i.jointMatrices[a.skin]&&(i.jointMatrices[a.skin]=new Float32Array(16*t.joints.length));for(var b=0;b<l.length;b++)l[b].setAttribute("fundamental.MaterialContainer.jointCount",t.joints.length),l[b].getComponent(s.default).renderArgs["gltf-jointMatrices"]=i.jointMatrices[a.skin];t.joints.forEach(function(e,t){if(!n[e])throw new Error("specified node was not found");for(var r=new Array(16),i=0;i<16;i++)r[i]=v(i+16*t);n[e].setAttribute("class",n[e].getAttribute("class")+" gltf-joint-"+t),n[e].addComponent("GLTFJoint",{invBindShapeMatrix:r,skinIndex:a.skin,jointIndex:t})})})}},{key:"__applyTransform",value:function(e,t){var n=e.getComponent(u.default);if(t.rotation&&n.setAttribute("rotation",new m.default([].concat(t.rotation))),t.translation&&n.setAttribute("position",new v.default([].concat(t.translation))),t.scale&&n.setAttribute("scale",new v.default([].concat(t.scale))),t.matrix){if(t.rotation||t.translation||t.scale)throw new Error("Matrix property can not be existed with other transoform property");var r=new y.default(t.matrix);n.applyMatrix(r)}}},{key:"__convertBufferView",value:function(e,t,n,r){var i=0;t.byteOffset&&(i+=t.byteOffset),r.byteOffset&&(i+=r.byteOffset);var o=r.count*c.default.asVectorSize(r.type);return n.byteStride&&(o=n.byteStride*r.count/c.default.asByteSize(r.componentType)),new e(t.buffer,i,o)}}]),e}();t.default=w},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Components.MeshRendererComponent:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(2),s=r(f),l=n(19),c=r(l),d=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this;this._meshComponent=this.node.getComponent(c.default),this._meshComponent.geometry.then(function(t){return e._morphTarget=t}),this.getAttributeRaw("weights").watch(function(t){e._morphTarget&&e._morphTarget.setWeight(t)})}}]),t}(s.default);t.default=d,d.attributes={weights:{default:[],converter:"NumberArray"}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.__NAME__=t.__VERSION__=void 0;var i=n(23),o=r(i),a=n(5),u=r(a),f=n(3),s=r(f),l=n(20),c=r(l),d=n(18),m=r(d),p=n(0),v=r(p),b=n(9),y=r(b),h=n(14),_=r(h),w=n(12),g=r(w),T=n(17),x=r(T),S=n(16),O=r(S),E=n(15),A=r(E),R=n(8),M=r(R),C=n(1),P=r(C),G=n(10),N=r(G),I=n(33),k=r(I),U=n(36),j=r(U),L=n(21),F=r(L),V=t.__VERSION__="2.3.20",B=t.__NAME__="grimoirejs-gltf",J={Accessor:{Accessor:o.default},Components:{GLTFJointComponent:u.default,GLTFModelComponent:s.default,GLTFVertexMorpher:c.default},Instanciator:{DefaultInstanciator:m.default},Parser:{ConstantConverter:v.default,DefaultParserModule:y.default,MaterialInstanciator:{DefaultPBRMetallicRoughnessInstanciator:_.default,GLTFMaterialInstanciatorRegistry:g.default},Modules:{EmbeddedBufferModule:x.default,IndexComplementorModule:O.default,NormalComplementorModule:A.default},Parser:M.default,ParserModule:P.default,ParserModuleBase:N.default},Util:{ResourceResolver:k.default}};F.default.notifyRegisteringPlugin(B);var D=(0,j.default)();Object.assign(J,{__VERSION__:V,__NAME__:B}),Object.assign(D||{},J),window.GrimoireJS.lib.gltf=J,t.default=D},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(t,n,i,o,u,f){r(this,e),this.buffer=t,this.count=n,this.componentType=i,this.elementSize=o,this.byteOffset=u,this.byteStride=f,this._dView=new DataView(t.buffer,t.byteOffset+u),this._elementByteSize=a.default.asByteSize(i),0===f&&(this.byteStride=this.elementSize*this._elementByteSize)}return i(e,[{key:"getByIndex",value:function(e){if(e<0||e>=this.count)return null;for(var t=new Array(this.elementSize),n=0;n<this.elementSize;n++)t[n]=this._getSingleByIndex(e,n);return t}},{key:"_getSingleByIndex",value:function(e,t){switch(this.componentType){case WebGLRenderingContext.FLOAT:return this._dView.getFloat32(e*this.byteStride+this._elementByteSize*t,!0);default:throw new Error("Unsupported element type")}}}]),e}();t.default=u},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Color3:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Color4:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Resource.Texture2D:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Geometry.Geometry:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Geometry.MorphGeometry:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Resource.GLRelatedRegistryBase:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Material.TextureReference:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.math?window.GrimoireJS.lib.math.Quaternion:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.animation?window.GrimoireJS.lib.animation.Animation.AnimationFactory:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(34),u=r(a),f=n(11),s=r(f),l=n(35),c=r(l),d=function(){function e(t){i(this,e),this._rootPath=t,this.baseDirectory=this._getBaseDir(t)}return o(e,[{key:"loadGLTFFile",value:function(){var e=this;return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e._rootPath),r.responseType="arraybuffer",r.onload=function(n){for(var i=new Uint8Array(r.response),o=[103,108,84,70],a=!0,u=0;u<o.length;u++)i[u]!==o[u]&&(a=!1);var f=void 0;if(a){var s=new DataView(r.response),l=s.getUint32(8,!0),d=s.getUint32(12,!0);f=e._bufferToString(r.response.slice(20,20+d)),e.binaryGLTFBuffer=r.response.slice(20+d,l)}else f=e._bufferToString(r.response);e.tf=JSON.parse(f),e.tf.id=c.default.calcHash(f),t(e.tf)},r.onerror=function(e){},r.send()})}},{key:"loadImage",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,i=this.tf.bufferViews[r.bufferView],o=new Blob([new Uint8Array(this.binaryGLTFBuffer,i.byteOffset,i.byteLength)],{type:r.mimeType});t=window.URL.createObjectURL(o),n=!0}return this._isDataUrl(t)?this._dataUriToImage(t):s.default.resolve(n?t:this.baseDirectory+t)}},{key:"loadBuffer",value:function(e){var t=this;return this._isDataUrl(e)?new Promise(function(n,r){n(t._dataUriToArrayBuffer(e))}):new Promise(function(n,r){var i=new XMLHttpRequest;i.open("GET",t.baseDirectory+e),i.responseType="arraybuffer",i.onload=function(e){n(i.response)},i.onerror=function(n){r({message:"Loading resource at '"+(t.baseDirectory+e)+" failed. Is there resource file in dependency at correct location?'",error:n})},i.send()})}},{key:"loadShader",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,i=this.tf.bufferViews[r.bufferView],o=new Blob([new Uint8Array(this.binaryGLTFBuffer,i.byteOffset,i.byteLength)],{type:"text/plain"});t=window.URL.createObjectURL(o),n=!0}return this._isDataUrl(t)?Promise.resolve(this._dataUriToText(t)):u.default.resolve(n?t:this.baseDirectory+t)}},{key:"_dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,i=new ArrayBuffer(r),o=new Uint8Array(i),a=0;a<r;a++)o[a]=n.charCodeAt(a);return i}},{key:"_dataUriToImage",value:function(e){var t=this;return new Promise(function(n,r){var i=document.createElement("canvas"),o=(i.getContext("2d"),new Image);o.src=e,o.onload=function(){n(t._ensureCorrectSize(o))}})}},{key:"_dataUriToText",value:function(e){var t=e.split(",");return atob(t[1])}},{key:"_ensureCorrectSize",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=Math.pow(2,Math.ceil(Math.log(e.width)/Math.LN2)),i=Math.pow(2,Math.ceil(Math.log(e.height)/Math.LN2));return r===e.width&&i===e.height?e:(t.width=r,t.height=i,n.drawImage(e,0,0,e.width,e.height,0,0,r,i),t)}},{key:"_bufferToString",value:function(e){for(var t="",n=0;n<e.byteLength;n+=1024)t+=this._smallBufferToString(new Uint8Array(e.slice(n,n+1024)));return t}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}},{key:"_isDataUrl",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"_getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=d},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Asset.TextFileResolver:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Util.HashCalculator:void 0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=r(i),a=n(3),u=r(a),f=n(21),s=r(f),l=n(13),c=r(l),d=n(37),m=r(d),p=n(38),v=r(p),b=n(39),y=r(b),h=n(40),_=r(h),w=n(20),g=r(w),T=n(41),x=r(T),S=n(42),O=r(S),E=n(43),A=r(E),R=n(44),M=r(R),C=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{f(r.next(e))}catch(e){o(e)}}function u(e){try{f(r.throw(e))}catch(e){o(e)}}function f(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t||[])).next())})};t.default=function(){_.default.request("OES_standard_derivatives"),_.default.request("OES_element_index_uint"),s.default.register(function(){return C(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y.default.staticImports["gltf-vertex"]=x.default,y.default.staticImports["gltf-varying"]=O.default,y.default.staticImports["gltf-varying-vertex"]=A.default,y.default.staticImports["gltf-fragment"]=M.default,s.default.registerComponent("GLTFModel",u.default),s.default.registerComponent("GLTFJoint",o.default),s.default.registerComponent("GLTFVertexMorpher",g.default),s.default.registerNode("model",["GLTFModel"],{},"object"),c.default.addSORTMaterial("gltf-pbr-metallic-roughness",v.default),m.default.add("JOINTMATRIX",function(e,t){return function(t,n){n.renderable.renderArgs["gltf-jointMatrices"]&&t.uniformMatrixArray(e.name,n.renderable.renderArgs["gltf-jointMatrices"])}});case 10:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Material.UniformResolverRegistry:void 0},function(e,t){e.exports='@Pass{\n@DynamicState(dynamic-cull)\n#extension GL_OES_standard_derivatives : enable\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\nFS_PREC(mediump,float)\n\n@import "gltf-varying-vertex"\n\n@import "gltf-fragment"\n}'},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Sort.ImportResolver:void 0},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS&&window.GrimoireJS.lib.fundamental?window.GrimoireJS.lib.fundamental.Resource.GLExtRequestor:void 0},function(e,t){e.exports="@ExposeMacro(int,jointCount,JOINT_COUNT,0)\n#ifdef VS\n#if JOINT_COUNT > 0\n  @JOINTMATRIX\n  uniform mat4 boneMatrices[JOINT_COUNT];\n#endif\n  @NORMAL\n  attribute vec3 normal;\n  @POSITION\n  attribute vec3 position;\n#ifdef ATTRIBUTE_TEXCOORD_0_ENABLED\n  @TEXCOORD_0\n  attribute vec2 texCoord;\n#endif\n#ifdef ATTRIBUTE_TANGENT_ENABLED\n  @TANGENT\n  attribute vec3 tangent;\n#endif\n#if JOINT_COUNT > 0\n  @JOINTS_0\n  attribute vec4 joint;\n  @WEIGHTS_0\n  attribute vec4 weight;\n#endif\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n  @MODELINVERSETRANSPOSE\n  uniform mat4 normalMatrix;\n\n  @CAMERA_POSITION\n  uniform vec3 _cameraPositionVert;\n  void main(){\n    mat4 transform = _matM;\n    mat4 projectionTransform = _matPVM;\n    mat4 normalTransform = _matM;\n    #if JOINT_COUNT > 0\n      mat4 skinMat = weight.x * boneMatrices[int(joint.x)] + weight.y * boneMatrices[int(joint.y)] + weight.z * boneMatrices[int(joint.z)] + weight.w * boneMatrices[int(joint.w)];\n      transform *= skinMat;\n      normalTransform *= skinMat;\n      projectionTransform *= skinMat;\n    #endif\n    #ifdef ATTRIBUTE_TEXCOORD_0_ENABLED\n        vUV = texCoord;\n    #else\n        vUV  = position.xy /2.0 + vec2(0.5);\n    #endif\n    vNormal = normalize(mat3(normalTransform) * normal);\n    vPosition = (transform * vec4(position,1.0)).xyz;\n    #ifdef ATTRIBUTE_TANGENT_ENABLED\n    vTangent = normalize(mat3(normalTransform) * tangent);\n    #endif\n    gl_Position = projectionTransform * vec4(position,1.0);\n  }\n#endif\n"},function(e,t){e.exports="varying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n#ifdef ATTRIBUTE_TANGENT_ENABLED\nvarying vec3 vTangent;\n#endif"},function(e,t){e.exports='@import "gltf-varying"\n@import "gltf-vertex"'},function(e,t){e.exports='#ifdef FS\n  @{flag:"USE_NORMAL_TEXTURE"}\n  uniform sampler2D normalTexture;\n\n  @{default:"white",type:"color"}\n  uniform vec4 baseColorFactor;\n\n  @{flag:"USE_BASECOLOR_TEXTURE"}\n  uniform sampler2D baseColorTexture;\n\n  @{default:"1"}\n  uniform float metallicFactor;\n\n  @{flag:"USE_METALLIC_TEXTURE"}\n  uniform sampler2D metallicTexture;\n\n  @{default:"1"}\n  uniform float roughnessFactor;\n\n  @{flag:"USE_ROUGHNESS_TEXTURE"}\n  uniform sampler2D roughnessTexture;\n\n  @{default:"black",type:"color"}\n  uniform vec3 emissiveFactor;\n\n  @{flag:"USE_EMISSIVE_TEXTURE"}\n  uniform sampler2D emissiveTexture;\n\n  @{flag:"USE_METALLIC_ROUGHNESS_TEXTURE"}\n  uniform sampler2D metallicRoughnessTexture;\n\n  @{flag:"USE_OCCLUSION_TEXTURE"}\n  uniform sampler2D occlusionTexture;\n\n  @CAMERA_POSITION\n  uniform vec3 _cameraPosition;\n\n  @import "forward-shading"\n\n  #ifndef POST_SHADING_SURFACE_FUNCTION\n    #define POST_SHADING_SURFACE_FUNCTION postShadingSurfaceFunction\n\n    vec4 postShadingSurfaceFunction(vec4 result,vec4 baseColor,vec3 normal,vec3 position){\n        return result;\n    }\n  #endif\n\n    #ifndef PRE_SHADING_SURFACE_FUNCTION\n    #define PRE_SHADING_SURFACE_FUNCTION preShadingSurfaceFunction\n\n    vec4 preShadingSurfaceFunction(vec4 baseColor,vec3 normal,vec3 position){\n        return baseColor;\n    }\n  #endif\n\n  void main(){\n    vec4 baseColor = baseColorFactor;\n    float occlusion = 1.0;\n    #ifdef USE_BASECOLOR_TEXTURE\n      baseColor *= texture2D(baseColorTexture,vUV);\n    #endif\n    vec3 emissive = emissiveFactor;\n    #ifdef USE_EMISSIVE_TEXTURE\n      emissive *= texture2D(emissiveTexture,vUV).rgb;\n    #endif\n    float metallic = metallicFactor;\n    #ifdef USE_METALLIC_TEXTURE\n      metallic *= texture2D(metallicTexture,vUV).r;\n    #endif\n    float roughness = roughnessFactor;\n    #ifdef USE_ROUGHNESS_TEXTURE\n      roughness *= texture2D(roughnessTexture,vUV).r;\n    #endif\n    #ifdef USE_METALLIC_ROUGHNESS_TEXTURE\n      vec3 rm = texture2D(metallicRoughnessTexture,vUV).rgb;\n      metallic *= rm.b;\n      roughness *= rm.g;\n    #endif\n    vec3 normal = normalize(vNormal);\n    #ifdef USE_NORMAL_TEXTURE\n      #ifndef ATTRIBUTE_TANGENT_ENABLED\n      vec3 pos_dx = dFdx(vPosition);\n      vec3 pos_dy = dFdy(vPosition);\n      vec3 tex_dx = dFdx(vec3(vUV, 0.0));\n      vec3 tex_dy = dFdy(vec3(vUV, 0.0));\n      vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n      t = normalize(t - vNormal * dot(vNormal, t));\n      #endif\n      #ifdef ATTRIBUTE_TANGENT_ENABLED\n      vec3 t = vTangent;\n      #endif\n      vec3 b = normalize(cross(vNormal, t));\n      mat3 tbn = mat3(t, b, vNormal);\n      vec3 n = texture2D(normalTexture, vUV).rgb;\n      normal = normalize(tbn * (2.0 * n - 1.0));\n    #endif\n    #ifdef CONTEXT_STATE_CULL\n    #if (CONTEXT_STATE_CULL == 0)\n    normal *= (float(gl_FrontFacing) - 0.5) * 2.0;\n    #endif\n    #endif\n    baseColor = PRE_SHADING_SURFACE_FUNCTION(baseColor,normal,vPosition);\n    vec3 dielectricSpecular = vec3(0.04);\n    vec3 diffuse = mix(baseColor.rgb * (1. - dielectricSpecular.r),vec3(0),metallic);\n    vec3 f0 = mix(dielectricSpecular,baseColor.rgb,metallic);\n    float alpha = roughness * roughness;\n    pbr_params param = pbr_params(diffuse,f0,alpha,roughness);\n    vec3 shadeResult = shading(param,normal,vPosition);\n    shadeResult += emissive;\n    #ifdef USE_OCCLUSION_TEXTURE\n      occlusion = texture2D(occlusionTexture,vUV).r;\n    #endif\n    shadeResult *= occlusion;\n    gl_FragColor = POST_SHADING_SURFACE_FUNCTION(vec4(shadeResult,baseColor.a),baseColor,normal,vPosition);\n  }\n#endif'}])});
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(28),u=r(a),s=n(29),l=r(s),f=function(){function e(){o(this,e)}return i(e,null,[{key:"asColorValue",value:function(e){return 3===e.length?new u.default(e[0],e[1],e[2]):new l.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:case WebGLRenderingContext.SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:case WebGLRenderingContext.INT:case WebGLRenderingContext.FLOAT:return 4;default:throw new Error("Unknown size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.FLOAT:return Float32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}}]),e}();t.default=f},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(t,n,o){r(this,e),this.tf=t,this.animationKey=n,this._buffers=o,this.accessors={},this.timeLength=0,this.targetNodes=[],this._animationData=t.animations[n]}return o(e,[{key:"processCurrentFrame",value:function(e,t){for(var n=0;n<this._animationData.channels.length;n++){var r=this._animationData.channels[n],o=this._getBySampler(r.sampler,e);t(r.target.id,r.target.path,o)}}},{key:"_getBySampler",value:function(e,t){var n=this._animationData.samplers[e],r=this.accessors[n.input],o=this.accessors[n.output],i=0;for(i=0;i<r.count;i++){if(r.getByIndex(i)[0]>t)return this._complementFrame(t,r.getByIndex(i-1),r.getByIndex(i),o.getByIndex(i-1),o.getByIndex(i),n.interpolation)}return this._complementFrame(t,r.getByIndex(i-1),null,o.getByIndex(i-1),null,n.interpolation)}},{key:"_complementFrame",value:function(e,t,n,r,o,i){if(!r)return o;if(!o)return r;var u=(e-t[0])/(n[0]-t[0]);return a.default[i](u,r,o)}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i=o.default.quat;t.default={LINEAR:function(e,t,n){for(var r=new Array(t.length),o=0;o<t.length;o++)r[o]=t[o]+(n[o]-t[o])*e;return r},SPHERICAL:function(e,t,n){var r=new Array(t.length);return i.slerp(r,t,n,e),r}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(15),l=r(s),f=n(16),c=r(f),d=n(13),m=r(d),p=n(1),v=r(p),h=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this._startTime=(new Date).getTime(),this._animation=this.getAttribute("animation")}},{key:"$update",value:function(){var e=this;if(!this._targetTransforms){this._targetTransforms={};var t=this._animation.targetNodes,n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var u=i.value,s=this.node.parent.parent.getChildrenByClass(u);s.length>0&&(this._targetTransforms[u]=s[0].getComponent(m.default))}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}var f=((new Date).getTime()-this._startTime)/1e3;this._animation.processCurrentFrame(f%this._animation.timeLength,function(t,n,r){var o=e._targetTransforms[t];if(o)switch(n){case"translation":o.position=new c.default(r);break;case"rotation":o.rotation=new l.default(r);break;case"scale":o.scale=new c.default(r)}});for(var d in this._targetTransforms)this._targetTransforms[d].notifyUpdateTransform()}},{key:"$unmount",value:function(){}}]),t}(v.default);t.default=h,h.attributes={play:{converter:"Boolean",default:!1},animation:{converter:"Object",default:null},frame:{converter:"Number",default:0}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(31),l=r(s),f=n(13),c=r(f),d=n(1),m=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this._transform=this.node.getComponent(c.default),this._skeletonTransform=this.getAttribute("skeletonTransform");var e=this.getAttribute("skinInfo");this._poseIndex=e.jointNames.indexOf(this.getAttribute("jointName")),this._jointMatrices=this.getAttribute("jointMatrices"),this._bindShapeMatrix=e.bindShapeMatrix,this._invBindMatrix=new l.default(e.inverseBindMatrices.getByIndex(this._poseIndex))}},{key:"$update",value:function(){for(var e=l.default.inverse(this._skeletonTransform.globalTransform).multiplyWith(this._transform.globalTransform).multiplyWith(this._invBindMatrix).multiplyWith(this._bindShapeMatrix),t=0;t<16;t++)this._jointMatrices[16*this._poseIndex+t]=e.rawElements[t]}}]),t}(m.default);t.default=p,p.attributes={skinInfo:{converter:"Object",default:null},jointName:{converter:"String",default:null},skeletonTransform:{converter:"Object",default:null},jointMatrices:{converter:"Object",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(s),f=n(9),c=r(f),d=n(7),m=r(d),p=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._jointMatrices={},e}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,n=this.getAttribute("src");if(n){var r=this.companion.get("gl");c.default.parseFromURL(r,n).then(function(n){t.instanciator.instanciateAll(n,e.node,e.getAttribute("scene"))})}}}]),t}(l.default);t.default=p,p.instanciator=new m.default,p.componentName="GLTFModelComponent",p.attributes={src:{converter:"String",default:null},scene:{converter:"String",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(15),u=r(a),s=n(16),l=r(s),f=function(){function e(){o(this,e)}return i(e,[{key:"instanciateAll",value:function(e,t,n){var r=n;if(null===r&&(r=e.tf.scene),"number"!=typeof r)for(var o in e.tf.scenes){r=o;break}var i=e.tf.scenes[r];this.__instanciateScene(i,t,e)}},{key:"__instanciateScene",value:function(e,t,n){var r=!0,o=!1,i=void 0;try{for(var a,u=e.nodes[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;this.__instanciateNode(n,s,t)}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}},{key:"__instanciateNode",value:function(e,t,n){var r=e.tf.nodes[t],o=void 0;if(void 0!==r.mesh){var i=e.primitives[r.mesh];if(1===i.length){var a=e.tf.meshes[r.mesh],u=e.materials[a.primitives[0].material];o=n.addChildByName("mesh",{geometry:i[0],material:u})}else console.error("multiple mesh is not supported yet")}else o=n.addChildByName("object",{});if(this.__applyTransform(o,r),r.children){var s=!0,l=!1,f=void 0;try{for(var c,d=r.children[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var m=c.value;this.__instanciateNode(e,m,o)}}catch(e){l=!0,f=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw f}}}}},{key:"__applyTransform",value:function(e,t){t.rotation&&e.setAttribute("rotation",new u.default([].concat(t.rotation))),t.translation&&e.setAttribute("position",new l.default([].concat(t.translation))),t.scale&&e.setAttribute("scale",new l.default([].concat(t.scale)))}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(10),l=r(s),f=n(2),c=r(f),d=n(25),m=r(d),p=n(22),v=r(p),h=n(14),b=r(h),_=n(0),y=r(_),g=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})},T=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"fetchGLTF",value:function(e){return this.__fetchBuffer(e)}},{key:"loadAsGLTF",value:function(e){var t=this.__bufferToString(e);return JSON.parse(t)}},{key:"loadTextureResources",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},r=[],e.images){o=function(t){var o=e.textures[t],i=a.parser.callParserModule(function(e){return e.fetchTextureResource},e.images[o.source]).then(function(r){var o=a.parser.callParserModule(function(e){return e.convertTotexture},{tf:e,image:r,texIndex:t});n[t]=o});r.push(i)};for(i in e.textures)o(i)}return t.next=5,Promise.all(r);case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}},t,this)}))}},{key:"fetchTextureResource",value:function(e){return this.__fetchImage(this.baseDirectory+e.uri)}},{key:"convertTotexture",value:function(e){var t=new m.default(this.__gl);t.update(e.image);var n=e.tf.textures[e.texIndex],r={};return n||(r=e.tf.samplers[n.sampler]),t.magFilter=r.magFilter||WebGLRenderingContext.LINEAR,t.minFilter=r.minFilter||WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,t.wrapS=r.wrapS||WebGLRenderingContext.REPEAT,t.wrapT=r.wrapT||WebGLRenderingContext.REPEAT,t}},{key:"loadBufferResource",value:function(e){return this.__fetchBuffer(this.baseDirectory+e.uri)}},{key:"loadBufferResources",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},r=[],o=function(t){r.push(a.parser.callParserModule(function(e){return e.loadBufferResource},e.buffers[t]).then(function(e){n[t]=e}))};for(i in e.buffers)o(i);return t.next=6,Promise.all(r);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}},t,this)}))}},{key:"loadBufferViews",value:function(e){var t={};for(var n in e.tf.bufferViews){var r=e.tf.bufferViews[n];t[n]=new Uint8Array(e.buffers[r.buffer],r.byteOffset,r.byteLength)}return t}},{key:"loadPrimitivesOfMesh",value:function(e){var t={};for(var n in e.tf.meshes){var r=e.tf.meshes[n],o=[];t[n]=o;for(var i in r.primitives)o.push(this.parser.callParserModule(function(e){return e.loadPrimitive},{tf:e.tf,bufferViews:e.bufferViews,primitive:r.primitives[i]}))}return t}},{key:"loadPrimitive",value:function(e){var t=new v.default(this.__gl);return this.parser.callParserModule(function(e){return e.appendIndices},{tf:e.tf,bufferViews:e.bufferViews,primitive:e.primitive,geometry:t}),this.parser.callParserModule(function(e){return e.addVertexAttributes},{tf:e.tf,bufferViews:e.bufferViews,primitive:e.primitive,geometry:t}),t}},{key:"appendIndices",value:function(e){if(void 0!==e.primitive.indices){var t=e.primitive.mode||WebGLRenderingContext.TRIANGLES,n=e.tf.accessors[e.primitive.indices];return e.geometry.addIndex("default",e.bufferViews[n.bufferView],t,n.byteOffset,n.count,n.componentType),!0}}},{key:"addVertexAttributes",value:function(e){for(var t in e.primitive.attributes){var n=e.tf.accessors[e.primitive.attributes[t]],r={};r[t]={size:y.default.asVectorSize(n.type),type:n.componentType,stride:n.byteStride,offset:n.byteOffset},e.geometry.addAttributes(e.bufferViews[n.bufferView],r)}return!0}},{key:"loadMaterials",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},t.t0=regeneratorRuntime.keys(e.tf.materials);case 2:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.next=6,this.parser.callParserModule(function(e){return e.loadMaterial},{material:e.tf.materials[r],textures:e.textures});case 6:n[r]=t.sent,t.next=2;break;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}},t,this)}))}},{key:"loadMaterial",value:function(e){return g(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.material.pbrMetallicRoughness){t.next=18;break}return t.next=3,b.default.get(this.__gl).instanciate("gltf-pbr-metalic-roughness");case 3:return n=t.sent,r=e.material.pbrMetallicRoughness,o=n.arguments,r.baseColorFactor&&(o.baseColorFactor=r.baseColorFactor),r.baseColorTexture&&(o.baseColorTexture=e.textures[r.baseColorTexture.index]),r.metalicFactor&&(o.metalicFactor=r.metalicFactor),r.metalicTexture&&(o.metalicTexture=e.textures[r.metalicTexture.index]),r.roughnessFactor&&(o.roughnessFactor=r.roughnessFactor),r.roughnessTexture&&(o.roughnessTexture=e.textures[r.roughnessTexture.index]),e.material.emissiveFactor&&(o.emissiveFactor=e.material.emissiveFactor),e.material.emissiveTexture&&(o.emissiveTexture=e.textures[e.material.emissiveTexture.index]),e.material.normalTexture&&(o.normalTexture=e.textures[e.material.normalTexture.index]),e.material.metalicRoughnessTexture&&(o.metalicRoughnessTexture=e.textures[e.material.metalicRoughnessTexture.index]),e.material.occlusionTexture&&(o.occlusionTexture=e.textures[e.material.occlusionTexture.index]),t.abrupt("return",n);case 18:case"end":return t.stop()}},t,this)}))}},{key:"loadAnimations",value:function(e){var t={};for(var n in e.tf.animations)t[n]=new c.default(e.tf,n,e.bufferViews);return t}}]),t}(l.default);t.default=T},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(8),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})},s=function(){function e(t,n){r(this,e),this.gl=t,this.url=n,this.parserModuleInstances=[];for(var o=0;o<e.parserModules.length;o++){var i=e.parserModules[o];this.parserModuleInstances.push(new i(this,n.substr(0,n.lastIndexOf("/")+1)))}}return o(e,[{key:"callParserModule",value:function(e,t){for(var n=0;n<this.parserModuleInstances.length;n++){var r=this.parserModuleInstances[n],o=e(r);if(void 0!==o){var i=o.call(r,t);if(void 0!==i)return i}}throw new Error('Parsing gltf failed. At the module "'+e.toString()+'"')}},{key:"parse",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,o,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,this.callParserModule(function(e){return e.fetchGLTF},this.url);case 3:return n=e.sent,r=this.callParserModule(function(e){return e.loadAsGLTF},n),t.tf=r,e.next=8,this.callParserModule(function(e){return e.loadTextureResources},r).then(function(e){return a.callParserModule(function(e){return e.loadMaterials},{tf:r,textures:e})}).then(function(e){t.materials=e});case 8:return o=e.sent,e.next=11,this.callParserModule(function(e){return e.loadBufferResources},r).then(function(e){var n=a.callParserModule(function(e){return e.loadBufferViews},{tf:r,buffers:e}),o=a.callParserModule(function(e){return e.loadPrimitivesOfMesh},{tf:r,bufferViews:n});a.callParserModule(function(e){return e.loadAnimations},{tf:r,bufferViews:n});t.primitives=o});case 11:return i=e.sent,e.abrupt("return",t);case 13:case"end":return e.stop()}},e,this)}))}}],[{key:"parseFromURL",value:function(t,n){return u(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=new e(t,n),r.abrupt("return",o.parse());case 2:case"end":return r.stop()}},r,this)}))}}]),e}();t.default=s,s.parserModules=[a.default]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(11),s=function(e){return e&&e.__esModule?e:{default:e}}(u),l=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.parser=e,i.baseDirectory=n,i.__gl=e.gl,i}return i(t,e),a(t,[{key:"fetchGLTF",value:function(e){}},{key:"loadAsGLTF",value:function(e){}},{key:"fetchTextureResource",value:function(e){}},{key:"loadTextureResources",value:function(e){}},{key:"convertTotexture",value:function(e){}},{key:"loadBufferResource",value:function(e){}},{key:"loadBufferResources",value:function(e){}},{key:"loadBufferViews",value:function(e){}},{key:"loadPrimitivesOfMesh",value:function(e){}},{key:"loadPrimitive",value:function(e){}},{key:"appendIndices",value:function(e){}},{key:"addVertexAttributes",value:function(e){}},{key:"loadMaterials",value:function(e){}},{key:"loadMaterial",value:function(e){}},{key:"loadAnimations",value:function(e){}}]),t}(s.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(12),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(){r(this,e)}return o(e,[{key:"__fetchBuffer",value:function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onload=function(e){t(r.response)},r.onerror=function(t){n({message:"Loading resource at '"+e+" failed. Is there resource file in dependency at correct location?'",error:t})},r.send()})}},{key:"__fetchImage",value:function(e){return a.default.resolve(e)}},{key:"__isDataUri",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"__getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}},{key:"__dataUriToText",value:function(e){var t=e.split(",");return atob(t[1])}},{key:"__dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;a<r;a++)i[a]=n.charCodeAt(a);return o}},{key:"__dataUriToImage",value:function(e){return new Promise(function(t,n){var r=new Image;r.src=e,r.onload=function(){t(r)}})}},{key:"__bufferToString",value:function(e){for(var t="",n=0;n<e.byteLength;n+=1024)t+=this._smallBufferToString(new Uint8Array(e.slice(n,n+1024)));return t}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}}]),e}();t.default=u},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Components.TransformComponent},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Quaternion},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(t,n,o,i,u,s){r(this,e),this.buffer=t,this.count=n,this.componentType=o,this.elementSize=i,this.byteOffset=u,this.byteStride=s,this._dView=new DataView(t.buffer,t.byteOffset+u),this._elementByteSize=a.default.asByteSize(o),0===s&&(this.byteStride=this.elementSize*this._elementByteSize)}return o(e,[{key:"getByIndex",value:function(e){if(e<0||e>=this.count)return null;for(var t=new Array(this.elementSize),n=0;n<this.elementSize;n++)t[n]=this._getSingleByIndex(e,n);return t}},{key:"_getSingleByIndex",value:function(e,t){switch(this.componentType){case WebGLRenderingContext.FLOAT:return this._dView.getFloat32(e*this.byteStride+this._elementByteSize*t,!0);default:throw new Error("Unsupported element type")}}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(21),u=r(a),s=n(12),l=r(s),f=n(27),c=r(f),d=function(){function e(t){o(this,e),this._rootPath=t,this.baseDirectory=this._getBaseDir(t)}return i(e,[{key:"loadGLTFFile",value:function(){var e=this;return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e._rootPath),r.responseType="arraybuffer",r.onload=function(n){for(var o=new Uint8Array(r.response),i=[103,108,84,70],a=!0,u=0;u<i.length;u++)o[u]!==i[u]&&(a=!1);var s=void 0;if(a){var l=new DataView(r.response),f=l.getUint32(8,!0),d=l.getUint32(12,!0);s=e._bufferToString(r.response.slice(20,20+d)),e.binaryGLTFBuffer=r.response.slice(20+d,f)}else s=e._bufferToString(r.response);e.tf=JSON.parse(s),e.tf.id=c.default.calcHash(s),t(e.tf)},r.onerror=function(e){},r.send()})}},{key:"loadImage",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,o=this.tf.bufferViews[r.bufferView],i=new Blob([new Uint8Array(this.binaryGLTFBuffer,o.byteOffset,o.byteLength)],{type:r.mimeType});t=window.URL.createObjectURL(i),n=!0}return this._isDataUrl(t)?this._dataUriToImage(t):l.default.resolve(n?t:this.baseDirectory+t)}},{key:"loadBuffer",value:function(e){var t=this;return this._isDataUrl(e)?new Promise(function(n,r){n(t._dataUriToArrayBuffer(e))}):new Promise(function(n,r){var o=new XMLHttpRequest;o.open("GET",t.baseDirectory+e),o.responseType="arraybuffer",o.onload=function(e){n(o.response)},o.onerror=function(n){r({message:"Loading resource at '"+(t.baseDirectory+e)+" failed. Is there resource file in dependency at correct location?'",error:n})},o.send()})}},{key:"loadShader",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,o=this.tf.bufferViews[r.bufferView],i=new Blob([new Uint8Array(this.binaryGLTFBuffer,o.byteOffset,o.byteLength)],{type:"text/plain"});t=window.URL.createObjectURL(i),n=!0}return this._isDataUrl(t)?Promise.resolve(this._dataUriToText(t)):u.default.resolve(n?t:this.baseDirectory+t)}},{key:"_dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;a<r;a++)i[a]=n.charCodeAt(a);return o}},{key:"_dataUriToImage",value:function(e){var t=this;return new Promise(function(n,r){var o=document.createElement("canvas"),i=(o.getContext("2d"),new Image);i.src=e,i.onload=function(){n(t._ensureCorrectSize(i))}})}},{key:"_dataUriToText",value:function(e){var t=e.split(",");return atob(t[1])}},{key:"_ensureCorrectSize",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=Math.pow(2,Math.ceil(Math.log(e.width)/Math.LN2)),o=Math.pow(2,Math.ceil(Math.log(e.height)/Math.LN2));return r===e.width&&o===e.height?e:(t.width=r,t.height=o,n.drawImage(e,0,0,e.width,e.height,0,0,r,o),t)}},{key:"_bufferToString",value:function(e){for(var t="",n=0;n<e.byteLength;n+=1024)t+=this._smallBufferToString(new Uint8Array(e.slice(n,n+1024)));return t}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}},{key:"_isDataUrl",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"_getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),i=r(o),a=n(4),u=r(a),s=n(6),l=r(s),f=n(32),c=r(f),d=n(14),m=r(d),p=n(23),v=r(p),h=n(34),b=r(h),_=n(33),y=r(_),g=n(26),T=r(g),x=n(24),w=r(x),O=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})};t.default=function(){"string"!=typeof T.default.staticImports["forward-shading"]&&(T.default.staticImports["forward-shading"]=""),w.default.request("OES_standard_derivatives"),w.default.request("OES_element_index_uint"),c.default.register(function(){return O(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.default.registerComponent("GLTFModel",l.default),c.default.registerComponent("GLTFAnimation",u.default),c.default.registerComponent("GLTFJoint",i.default),c.default.registerNode("model",["GLTFModel"],{},"object"),c.default.registerNode("gltf-mesh",[],{material:"new(gltf-unlit)"},"mesh"),c.default.registerNode("gltf-joint",["GLTFJoint"],{},"object"),c.default.registerNode("gltf-assets",[],{}),c.default.registerNode("gltf-animation",["GLTFAnimation"],{}),m.default.addSORTMaterial("gltf-unlit",b.default),m.default.addSORTMaterial("gltf-pbr-metalic-roughness",y.default),v.default.add("JOINTMATRIX",function(e,t){return function(t,n){n.renderable.renderArgs["gltf-boneMatrices"]&&t.uniformMatrixArray(e.name,n.renderable.renderArgs["gltf-boneMatrices"])}}),v.default.add("AMBIENT_COEFFICIENT",function(e,t){return function(t,n){var r=n.sceneDescription.ambientCoefficient;t.uniformFloat(e.name,r||.1)}});case 12:case"end":return e.stop()}},e,this)}))})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),i=r(o),a=n(2),u=r(a),s=n(3),l=r(s),f=n(4),c=r(f),d=n(5),m=r(d),p=n(6),v=r(p),h=n(7),b=r(h),_=n(0),y=r(_),g=n(8),T=r(g),x=n(9),w=r(x),O=n(10),M=r(O),C=n(11),R=r(C),P=n(18),S=r(P),A=n(19),k=r(A),j={Accessor:{Accessor:i.default},Animation:{Animation:u.default,Interpolators:l.default},Components:{GLTFAnimationComponent:c.default,GLTFJointComponent:m.default,GLTFModelComponent:v.default},Instanciator:{DefaultInstanciator:b.default},Parser:{ConstantConverter:y.default,DefaultParserModule:T.default,Parser:w.default,ParserModule:M.default,ParserModuleBase:R.default},Util:{ResourceResolver:S.default}},I=(0,k.default)();Object.assign(j,{__VERSION__:"0.0.2-development",__NAME__:"grimoirejs-gltf"}),Object.assign(I||{},j),window.GrimoireJS.lib.gltf=j,t.default=I},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.UniformResolverRegistry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.GLExtRequestor},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Sort.ImportResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Util.HashCalculator},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.GLM},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){e.exports='@Pass{\n#extension GL_OES_standard_derivatives : enable\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\n@ExposeMacro(int,jointCount,JOINT_COUNT,0)\nFS_PREC(mediump,float)\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n#if JOINT_COUNT > 0\n  @JOINTMATRIX\n  uniform mat4 boneMatrices[JOINT_COUNT];\n#endif\n  @NORMAL\n  attribute vec3 normal;\n  @POSITION\n  attribute vec3 position;\n  @TEXCOORD_0\n  attribute vec2 texCoord;\n#if JOINT_COUNT > 0\n  @JOINT\n  attribute vec4 joint;\n  @WEIGHT\n  attribute vec4 weight;\n#endif\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n  void main(){\n    mat4 transform = _matM;\n    mat4 projectionTransform = _matPVM;\n    #if JOINT_COUNT > 0\n      mat4 skinMat = weight.x * boneMatrices[int(joint.x)] + weight.y * boneMatrices[int(joint.y)] + weight.z * boneMatrices[int(joint.z)] + weight.w * boneMatrices[int(joint.w)];\n      transform *= skinMat;\n      projectionTransform *= skinMat;\n    #endif\n    vUV = texCoord;\n    vNormal = normalize((transform * vec4(normal,0.0)).xyz);\n    vPosition = (transform * vec4(position,1.0)).xyz;\n    gl_Position = projectionTransform * vec4(position,1.0);\n  }\n\n\n#endif\n\n\n#ifdef FS\n  @HAS_TEXTURE{sampler:"normalTexture"}\n  uniform bool has_normalTexture;\n\n  uniform sampler2D normalTexture;\n\n  @{default:"1,1,1,1"}\n  uniform vec4 baseColorFactor;\n\n  uniform sampler2D baseColorTexture;\n\n  @HAS_TEXTURE{sampler:"baseColorTexture"}\n  uniform bool has_baseColorTexture;\n\n  @{default:"1"}\n  uniform float metalicFactor;\n\n  uniform sampler2D metalicTexture;\n\n  @HAS_TEXTURE{sampler:"metalicTexture"}\n  uniform bool has_metalicTexture;\n\n  @{default:"1"}\n  uniform float roughnessFactor;\n\n  uniform sampler2D roughnessTexture;\n\n  @HAS_TEXTURE{sampler:"roughnessTexture"}\n  uniform bool has_roughnessTexture;\n\n  @{default:"0,0,0"}\n  uniform vec3 emissiveFactor;\n\n  uniform sampler2D emissiveTexture;\n\n  @HAS_TEXTURE{sampler:"emissiveTexture"}\n  uniform bool has_emissiveTexture;\n\n  uniform sampler2D metalicRoughnessTexture;\n\n  @HAS_TEXTURE{sampler:"metalicRoughnessTexture"}\n  uniform bool has_metalicRoughnessTexture;\n\n  uniform sampler2D occlusionTexture;\n\n  @HAS_TEXTURE{sampler:"occlusionTexture"}\n  uniform bool has_occlusionTexture;\n\n  @CAMERA_POSITION\n  uniform vec3 _cameraPosition;\n\n  @import "forward-shading"\n\n  #ifndef GR_FORWARD_SHADING_ENABLED\n\n  struct simple_pbr_params{\n    vec3 diffuseColor;\n    vec3 f0;\n    float alpha;\n    float roughness;\n  };\n\n    @{default:"n(3,0.5,10)"}\n    uniform vec3 simpleLightDirection;\n\n    @{type:"color",default:"gray"}\n    uniform vec3 simpleLightColor;\n\n    @{default:0.3}\n    uniform float simpleLightIntencity;\n\n    float lambert(vec3 lightDirection,vec3 surfaceNormal) {\n      return max(0.0, dot(lightDirection, surfaceNormal));\n    }\n\n    float ctd_GGX_Distribution(simple_pbr_params param,vec3 l,vec3 v,vec3 n,vec3 h){\n      float alpha2 = pow(param.alpha,2.0);\n      float nh2 = pow(dot(n,h),2.0);\n      return alpha2/(PI*pow(nh2*(alpha2 - 1.0) + 1.0,2.0));\n    }\n\n    float ctg_GGX_SingleGeometryTerm(simple_pbr_params param,vec3 n,vec3 v){\n      float d = dot(n,v);\n      return 2.*d /(d + sqrt(d*d + param.alpha*param.alpha*(1. - d*d)));\n    }\n\n    vec3 ctf_Schlick(simple_pbr_params param,vec3 l,vec3 v,vec3 n,vec3 h){\n      vec3 f0 = param.f0;\n      float vh = dot(v,n);\n      return f0 + pow(1.0-vh,5.0) * (vec3(1.0) - f0);\n    }\n\n    vec3 cookTorranceBRDF(simple_pbr_params param,vec3 l,vec3 v,vec3 n){\n      vec3 h = normalize(l+v);\n      return  ctf_Schlick(param,l,v,n,h) * ctd_GGX_Distribution(param,l,v,n,h) * ctg_GGX_SingleGeometryTerm(param,n,l) * ctg_GGX_SingleGeometryTerm(param,n,v)/(4.0 * dot(l,n) * dot(v,n));\n    }\n\n    vec3 BRDF(simple_pbr_params params,vec3 li,vec3 lo,vec3 n){\n      return params.diffuseColor/PI + cookTorranceBRDF(params,li,lo,n);\n    }\n\n  #endif\n\n\n  void main(){\n    vec4 baseColor = baseColorFactor;\n    if(has_baseColorTexture){\n      baseColor *= texture2D(baseColorTexture,vUV);\n    }\n    vec3 emissive = emissiveFactor;\n    if(has_emissiveTexture){\n      emissive *= texture2D(emissiveTexture,vUV).rgb;\n    }\n    float metalic = metalicFactor;\n    if(has_metalicTexture){\n      metalic *= texture2D(metalicTexture,vUV).r;\n    }\n    float roughness = roughnessFactor;\n    if(has_roughnessTexture){\n      roughness *= texture2D(roughnessTexture,vUV).r;\n    }\n    if(has_metalicRoughnessTexture){\n      vec2 rm = texture2D(metalicRoughnessTexture,vUV).rg;\n      metalic *= rm.r;\n      roughness *= rm.g;\n    }\n    vec3 normal = vNormal;\n    if(has_normalTexture){\n      vec3 pos_dx = dFdx(vPosition);\n      vec3 pos_dy = dFdy(vPosition);\n      vec3 tex_dx = dFdx(vec3(vUV, 0.0));\n      vec3 tex_dy = dFdy(vec3(vUV, 0.0));\n      vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n      t = normalize(t - vNormal * dot(vNormal, t));\n      vec3 b = normalize(cross(vNormal, t));\n      mat3 tbn = mat3(t, b, vNormal);\n      vec3 n = texture2D(normalTexture, vUV).rgb;\n      normal = normalize(tbn * (2.0 * n - 1.0));\n    }\n    vec3 dielectricSpecular = vec3(0.04);\n    vec3 diffuse = mix(baseColor.rgb * (1. - dielectricSpecular.r),vec3(0),metalic);\n    vec3 f0 = mix(dielectricSpecular,baseColor.rgb,metalic);\n    float alpha = roughness * roughness;\n    #ifdef GR_FORWARD_SHADING_ENABLED\n      pbr_params param = pbr_params(diffuse,f0,alpha,roughness);\n      gl_FragColor.rgb = shading(param,normal,vPosition);\n    #endif\n    #ifndef GR_FORWARD_SHADING_ENABLED\n      simple_pbr_params params = simple_pbr_params(diffuse,f0,alpha,roughness);\n      float lam = lambert(simpleLightDirection,normal);\n      vec3 brdfCoeff = BRDF(params,-simpleLightDirection,normalize(_cameraPosition - vPosition),normal);\n      gl_FragColor.rgb = vec3(lam) * simpleLightIntencity * simpleLightColor * brdfCoeff;\n    #endif\n    gl_FragColor.rgb += emissive;\n    gl_FragColor.rgb = pow(gl_FragColor.rgb,1.0/vec3(2.2));\n    if(has_occlusionTexture){\n      gl_FragColor.rgb *= texture2D(occlusionTexture,vUV).r;\n    }\n    gl_FragColor.a = baseColor.a;\n  }\n#endif\n}\n'},function(e,t){e.exports='@Pass{\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\n@ExposeMacro(int,jointCount,JOINT_COUNT,0)\nFS_PREC(mediump,float)\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n#if JOINT_COUNT > 0\n  @JOINTMATRIX\n  uniform mat4 boneMatrices[JOINT_COUNT];\n#endif\n  @NORMAL\n  attribute vec3 normal;\n  @POSITION\n  attribute vec3 position;\n  @TEXCOORD_0\n  attribute vec2 texCoord;\n#if JOINT_COUNT > 0\n  @JOINT\n  attribute vec4 joint;\n  @WEIGHT\n  attribute vec4 weight;\n#endif\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n  void main(){\n    mat4 transform = _matM;\n    mat4 projectionTransform = _matPVM;\n    #if JOINT_COUNT > 0\n      mat4 skinMat = weight.x * boneMatrices[int(joint.x)] + weight.y * boneMatrices[int(joint.y)] + weight.z * boneMatrices[int(joint.z)] + weight.w * boneMatrices[int(joint.w)];\n      transform *= skinMat;\n      projectionTransform *= skinMat;\n    #endif\n    vUV = texCoord;\n    vNormal = normalize((transform * vec4(normal,0.0)).xyz);\n    vPosition = (transform * vec4(position,1.0)).xyz;\n    gl_Position = projectionTransform * vec4(position,1.0);\n  }\n\n\n#endif\n\n\n#ifdef FS\n\n  @{type:"color"}\n  uniform vec3 ambient;\n\n  @AMBIENT_COEFFICIENT\n  uniform float ambientCoefficient;\n\n  uniform sampler2D ambientTexture;\n\n  @HAS_TEXTURE{sampler:"ambientTexture"}\n  uniform bool ambientTextureUsed;\n\n  @{type:"color"}\n  uniform vec4 diffuse;\n\n  uniform sampler2D diffuseTexture;\n\n  @HAS_TEXTURE{sampler:"diffuseTexture"}\n  uniform bool diffuseTextureUsed;\n\n  @{type:"color"}\n  uniform vec3 specular;\n\n  uniform sampler2D specularTexture;\n\n  @HAS_TEXTURE{sampler:"specularTexture"}\n  uniform bool specularTextureUsed;\n\n  @{type:"color"}\n  uniform vec3 emission;\n\n  uniform sampler2D emissionTexture;\n\n  @HAS_TEXTURE{sampler:"emissionTexture"}\n  uniform bool emissionTextureUsed;\n\n  @{default:"1.0"}\n  uniform float shininess;\n\n  @{default:"1.0"}\n  uniform float transparency;\n\n  uniform vec3 _cameraPosition;\n\n  @{default:"n(1,1,-1)"}\n  uniform vec3 sunDir;\n\n  void main(){\n    vec4 dColor = vec4(0);\n    vec3 sColor = vec3(0);\n    vec3 eColor = vec3(0);\n    vec3 aColor = vec3(0);\n    vec3 hVec = normalize(normalize(_cameraPosition - vPosition) + sunDir);\n    if(ambientTextureUsed){\n      aColor = texture2D(ambientTexture,vUV).rgb;\n    }else{\n      aColor = ambient;\n    }\n    if(diffuseTextureUsed){\n      dColor = texture2D(diffuseTexture,vUV);\n    }else{\n      dColor = diffuse;\n    }\n    dColor.rgb = max(0.,dot(sunDir,vNormal)) * dColor.rgb;\n    if(specularTextureUsed){\n      sColor = texture2D(specularTexture,vUV).rgb;\n    }else{\n      sColor = specular;\n    }\n    if(emissionTextureUsed){\n      eColor = texture2D(emissionTexture,vUV).rgb;\n    }else{\n      eColor = emission;\n    }\n    sColor = sColor * pow(max(0.,dot(hVec,vNormal)),shininess);\n    gl_FragColor.rgb = dColor.rgb + sColor + aColor * ambientCoefficient;// + eColor;// + aColor;\n    gl_FragColor.a = dColor.a * transparency;\n  }\n#endif\n}\n'}])});
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pexContext=t():e.pexContext=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";(function(t){var n=r(7);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function i(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function a(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=r(8),s=Object.prototype.hasOwnProperty,u=Array.prototype.slice,c="foo"===function(){}.name;function l(e){return Object.prototype.toString.call(e)}function f(e){return!a(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var d=e.exports=b,p=/\s*function\s+([^\(\s]*)\s*/;function h(e){if(o.isFunction(e)){if(c)return e.name;var t=e.toString().match(p);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(c||!o.isFunction(e))return o.inspect(e);var t=h(e);return"[Function"+(t?": "+t:"")+"]"}function E(e,t,r,n,i){throw new d.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function b(e,t){e||E(e,!0,t,"==",d.ok)}function y(e,t,r,n){if(e===t)return!0;if(a(e)&&a(t))return 0===i(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(f(e)&&f(t)&&l(e)===l(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var s=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=A(e),a=A(t);if(i&&!a||!i&&a)return!1;if(i)return e=u.call(e),t=u.call(t),y(e,t,r);var s,c,l=_(e),f=_(t);if(l.length!==f.length)return!1;for(l.sort(),f.sort(),c=l.length-1;c>=0;c--)if(l[c]!==f[c])return!1;for(c=l.length-1;c>=0;c--)if(s=l[c],!y(e[s],t[s],r,n))return!1;return!0}(e,t,r,n))}return r?e===t:e==t}function A(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function T(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function v(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&E(i,r,"Missing expected exception"+n);var a="string"==typeof n,s=!e&&i&&!r;if((!e&&o.isError(i)&&a&&T(i,r)||s)&&E(i,r,"Got unwanted exception"+n),e&&i&&r&&!T(i,r)||!e&&i)throw i}d.AssertionError=function(e){var t;this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=g(m((t=this).actual),128)+" "+t.operator+" "+g(m(t.expected),128),this.generatedMessage=!0);var r=e.stackStartFunction||E;if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var n=new Error;if(n.stack){var i=n.stack,a=h(r),o=i.indexOf("\n"+a);if(o>=0){var s=i.indexOf("\n",o+1);i=i.substring(s+1)}this.stack=i}}},o.inherits(d.AssertionError,Error),d.fail=E,d.ok=b,d.equal=function(e,t,r){e!=t&&E(e,t,r,"==",d.equal)},d.notEqual=function(e,t,r){e==t&&E(e,t,r,"!=",d.notEqual)},d.deepEqual=function(e,t,r){y(e,t,!1)||E(e,t,r,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(e,t,r){y(e,t,!0)||E(e,t,r,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(e,t,r){y(e,t,!1)&&E(e,t,r,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function e(t,r,n){y(t,r,!0)&&E(t,r,n,"notDeepStrictEqual",e)},d.strictEqual=function(e,t,r){e!==t&&E(e,t,r,"===",d.strictEqual)},d.notStrictEqual=function(e,t,r){e===t&&E(e,t,r,"!==",d.notStrictEqual)},d.throws=function(e,t,r){v(!0,e,t,r)},d.doesNotThrow=function(e,t,r){v(!1,e,t,r)},d.ifError=function(e){if(e)throw e},d.strict=n(function e(t,r){t||E(t,!0,r,"==",e)},d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var _=Object.keys||function(e){var t=[];for(var r in e)s.call(e,r)&&t.push(r);return t}}).call(this,r(4))},function(e,t){e.exports=function(e,t){Object.keys(t).forEach(t=>{if(-1===e.indexOf(t))throw new Error(`Unknown prop "${t}"`)})}},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){(function(n){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=r(14)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(a=i))}),e.splice(a,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,r(2))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){const n=r(6),i=r(11),a=r(0),o=r(12),s=r(3)("context"),u=r(16),c=r(17),l=r(18),f=r(19),d=r(20),p=r(21),h=r(22),g=r(23),m=r(1);let E=0;const b=["name","pass","pipeline","uniforms","attributes","indices","count","instances","viewport","scissor"];e.exports=function(e){a(!e||"object"==typeof e,"pex-context: createContext requires opts argument to be null or an object");let t=null;(e=Object.assign({},{pixelRatio:1},e)).pixelRatio&&(e=Object.assign(e,{pixelRatio:Math.min(e.pixelRatio,window.devicePixelRatio)})),e&&e.gl?e&&e.gl&&(t=e.gl):t=n(e),a(t,"pex-context: createContext failed");const r={maxColorAttachments:1,maxTextureImageUnits:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubeMapTextureSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),instancedArrays:!1,instancing:!1,elementIndexUint32:!!t.getExtension("OES_element_index_uint"),standardDerivatives:!!t.getExtension("OES_standard_derivatives"),depthTexture:!!t.getExtension("WEBGL_depth_texture"),shaderTextureLod:!!t.getExtension("EXT_shader_texture_lod"),textureFloat:!!t.getExtension("OES_texture_float"),textureFloatLinear:!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:!!t.getExtension("OES_texture_half_float_linear"),textureFilterAnisotropic:!!t.getExtension("EXT_texture_filter_anisotropic")};if(!t.HALF_FLOAT){const e=t.getExtension("OES_texture_half_float");e&&(t.HALF_FLOAT=e.HALF_FLOAT_OES)}if(!t.createQuery){const e=t.getExtension("EXT_disjoint_timer_query");e?(t.TIME_ELAPSED=e.TIME_ELAPSED_EXT,t.QUERY_RESULT_AVAILABLE=e.QUERY_RESULT_AVAILABLE_EXT,t.GPU_DISJOINT=e.GPU_DISJOINT_EXT,t.QUERY_RESULT=e.QUERY_RESULT_EXT,t.createQuery=e.createQueryEXT.bind(e),t.deleteQuery=e.deleteQueryEXT.bind(e),t.beginQuery=e.beginQueryEXT.bind(e),t.endQuery=e.endQueryEXT.bind(e),t.getQueryObject=e.getQueryObjectEXT.bind(e)):(t.TIME_ELAPSED="TIME_ELAPSED",t.QUERY_RESULT_AVAILABLE="QUERY_RESULT_AVAILABLE",t.GPU_DISJOINT="GPU_DISJOINT",t.QUERY_RESULT="QUERY_RESULT",t.createQuery=function(){return{}},t.deleteQuery=function(){},t.beginQuery=function(){},t.endQuery=function(){},t.getQueryObject=function(e,r){return r===t.QUERY_RESULT_AVAILABLE||(r===t.QUERY_RESULT?0:void 0)})}const y={One:t.ONE,Zero:t.ZERO,SrcAlpha:t.SRC_ALPHA,OneMinusSrcAlpha:t.ONE_MINUS_SRC_ALPHA,DstAlpha:t.DST_ALPHA,OneMinusDstAlpha:t.ONE_MINUS_DST_ALPHA,SrcColor:t.SRC_COLOR,OneMinusSrcColor:t.ONE_MINUS_SRC_COLOR,DstColor:t.DST_COLOR,OneMinusDstColor:t.ONE_MINUS_DST_COLOR},A={PositiveX:t.TEXTURE_CUBE_MAP_POSITIVE_X,NegativeX:t.TEXTURE_CUBE_MAP_NEGATIVE_X,PositiveY:t.TEXTURE_CUBE_MAP_POSITIVE_Y,NegativeY:t.TEXTURE_CUBE_MAP_NEGATIVE_Y,PositiveZ:t.TEXTURE_CUBE_MAP_POSITIVE_Z,NegativeZ:t.TEXTURE_CUBE_MAP_NEGATIVE_Z},T={Never:t.NEVER,Less:t.LESS,Equal:t.EQUAL,LessEqual:t.LEQUAL,Greater:t.GREATER,NotEqual:t.NOTEQUAL,GreaterEqual:t.GEQUAL,Always:t.ALWAYS},v={Float32:t.FLOAT,Uint8:t.UNSIGNED_BYTE,Uint16:t.UNSIGNED_SHORT,Uint32:t.UNSIGNED_INT},_={Front:t.FRONT,Back:t.BACK,FrontAndBack:t.FRONT_AND_BACK},w={Nearest:t.NEAREST,Linear:t.LINEAR,NearestMipmapNearest:t.NEAREST_MIPMAP_NEAREST,NearestMipmapLinear:t.NEAREST_MIPMAP_LINEAR,LinearMipmapNearest:t.LINEAR_MIPMAP_NEAREST,LinearMipmapLinear:t.LINEAR_MIPMAP_LINEAR},x={Points:t.POINTS,Lines:t.LINES,LineStrip:t.LINE_STRIP,Triangles:t.TRIANGLES,TriangleStrip:t.TRIANGLE_STRIP},F={StaticDraw:t.STATIC_DRAW,DynamicDraw:t.DYNAMIC_DRAW,StreamDraw:t.STREAM_DRAW},R={ClampToEdge:t.CLAMP_TO_EDGE,Repeat:t.REPEAT},S={TimeElapsed:t.TIME_ELAPSED},O={gl:t,BlendFactor:y,CubemapFace:A,DataType:v,DepthFunc:T,Face:_,Filter:w,PixelFormat:{RGBA8:"rgba8",RGBA32F:"rgba32f",RGBA16F:"rgba16f",R32F:"r32f",R16F:"r16f",Depth:"depth",Depth16:"depth16"},Encoding:{Linear:1,Gamma:2,SRGB:3,RGBM:4},Primitive:x,Usage:F,Wrap:R,QueryTarget:S,QueryState:{Ready:"ready",Active:"active",Pending:"pending"}},M={pass:{framebuffer:{target:t.FRAMEBUFFER,handle:null,width:t.drawingBufferWidth,height:t.drawingBufferHeight},clearColor:[0,0,0,1],clearDepth:1},pipeline:d(O,{}),viewport:[0,0,t.drawingBufferWidth,t.drawingBufferHeight],scissor:null,count:0};if(t.drawElementsInstanced)r.instancedArrays=!0,r.instancing=!0;else{const e=t.getExtension("ANGLE_instanced_arrays");e?(t.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),t.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),t.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e),r.instancedArrays=!0,r.instancing=!0):(t.drawElementsInstanced=function(){throw new Error("gl.drawElementsInstanced not available. ANGLE_instanced_arrays not supported")},t.drawArraysInstanced=function(){throw new Error("gl.drawArraysInstanced not available. ANGLE_instanced_arrays not supported")},t.vertexAttribDivisor=function(){throw new Error("gl.vertexAttribDivisor not available. ANGLE_instanced_arrays not supported")})}if(t.drawBuffers)r.maxColorAttachments=t.getParameter("MAX_COLOR_ATTACHMENTS");else{const e=t.getExtension("WEBGL_draw_buffers");e?(t.drawBuffers=e.drawBuffersWEBGL.bind(e),r.maxColorAttachments=t.getParameter(e.MAX_COLOR_ATTACHMENTS_WEBGL)):t.drawBuffers=function(){throw new Error("WEBGL_draw_buffers not supported")}}return s("capabilities",r),Object.assign(O,{debugMode:!1,capabilities:r,debugCommands:[],resources:[],stats:[],queries:[],stack:[M],defaultState:M,pixelRatio:e.pixelRatio||1,state:{pass:{framebuffer:M.pass.framebuffer},pipeline:d(O,{}),activeTextures:[],activeAttributes:[]},getGLString:function(e){let r="";for(let n in t)t[n]===e&&(r=n);return r||(r="UNDEFINED"),r},set:function(e){a(i,"changing resolution is not supported in Plask"),e.pixelRatio&&(this.updatePixelRatio=Math.min(e.pixelRatio,window.devicePixelRatio)),e.width&&(this.updateWidth=e.width),e.height&&(this.updateHeight=e.height)},debug:function(e){this.debugMode=e},checkError:function(){if(this.debugMode){var e=t.getError();if(e)throw this.debugMode=!1,i&&s("State",this.state.state),new Error(`GL error ${e} : ${this.getGLString(e)}`)}},resource:function(e){return e.id=e.class+"_"+E++,this.stats[e.class]||(this.stats[e.class]={alive:0,total:0}),this.stats[e.class].alive++,this.stats[e.class].total++,this.resources.push(e),this.checkError(),e},texture2D:function(e){return s("texture2D",e),e.target=t.TEXTURE_2D,this.resource(u(this,e))},textureCube:function(e){return s("textureCube",e),e.target=t.TEXTURE_CUBE_MAP,this.resource(u(this,e))},framebuffer:function(e){return s("framebuffer",e),this.resource(c(this,e))},renderbuffer:function(e){return s("renderbuffer",e),this.resource(l(this,e))},vertexBuffer:function(e){return s("vertexBuffer",e),e.length&&(e={data:e}),e.target=t.ARRAY_BUFFER,this.resource(h(this,e))},indexBuffer:function(e){return s("indexBuffer",e),e.length&&(e={data:e}),e.target=t.ELEMENT_ARRAY_BUFFER,this.resource(h(this,e))},program:function(e){return s("program",e),this.resource(p(this,e))},pipeline:function(e){return s("pipeline",e),this.resource(d(this,e))},pass:function(e){return s("pass",e,e.color?e.color.map(e=>e.texture?e.texture.info:e.info):""),this.resource(f(this,e))},query:function(e){return s("query",e),this.resource(g(this,e))},beginQuery:function(e){a(!this.activeQuery,"Only one query can be active at the time"),e._begin(this,e)&&(this.activeQuery=e)},endQuery:function(e){e._end(this,e)&&(this.queries.push(e),this.activeQuery=null)},readPixels:function(e){const r=e.x||0,n=e.y||0,i=e.width,a=e.height,o=t.RGBA,s=t.UNSIGNED_BYTE;let u=null;return u=new Uint8Array(i*a*4),t.readPixels(r,n,i,a,o,s,u),u},update:function(e,t){this.debugMode&&s("update",{resource:e,opts:t}),e._update(this,e,t)},mergeCommands:function(e,t,r){const n=Object.assign({},e);if(r||(n.pass=Object.assign({},e.pass),n.pass.clearColor=void 0,n.pass.clearDepth=void 0),Object.assign(n,t),!t.viewport&&t.pass&&t.pass.opts.color){let e=null;t.pass.opts.color[0]&&(e=t.pass.opts.color[0].texture||t.pass.opts.color[0]),t.pass.opts.depth&&(e=t.pass.opts.depth.texture||t.pass.opts.depth),e&&(n.viewport=[0,0,e.width,e.height])}return n.uniforms=e.uniforms||t.uniforms?Object.assign({},e.uniforms,t.uniforms):null,n},applyPass:function(e){const t=this.gl,r=this.state;r.pass.id!==e.id&&(this.debugMode&&s("change framebuffer",r.pass.framebuffer,"->",e.framebuffer),r.pass=e,e.framebuffer._update&&this.update(e.framebuffer,e.opts),t.bindFramebuffer(e.framebuffer.target,e.framebuffer.handle),e.framebuffer.drawBuffers&&e.framebuffer.drawBuffers.length>1&&t.drawBuffers(e.framebuffer.drawBuffers));let n=0;void 0!==e.clearColor&&(this.debugMode&&s("clearing color",e.clearColor),n|=t.COLOR_BUFFER_BIT,t.clearColor(e.clearColor[0],e.clearColor[1],e.clearColor[2],e.clearColor[3])),void 0!==e.clearDepth&&(this.debugMode&&s("clearing depth",e.clearDepth),n|=t.DEPTH_BUFFER_BIT,r.depthWrite||(r.depthWrite=!0,t.depthMask(!0)),t.clearDepth(e.clearDepth)),n&&t.clear(n),this.checkError()},applyPipeline:function(e){const t=this.gl,r=this.state;e.depthWrite!==r.depthWrite&&(r.depthWrite=e.depthWrite,t.depthMask(r.depthWrite)),e.depthTest!==r.depthTest&&(r.depthTest=e.depthTest,r.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),e.depthFunc!==r.depthFunc&&(r.depthFunc=e.depthFunc,t.depthFunc(r.depthFunc)),e.blend===r.blend&&e.blendSrcRGBFactor===r.blendSrcRGBFactor&&e.blendSrcAlphaFactor===r.blendSrcAlphaFactor&&e.blendDstRGBFactor===r.blendDstRGBFactor&&e.blendDstAlphaFactor===r.blendDstAlphaFactor||(r.blend=e.blend,r.blendSrcRGBFactor=e.blendSrcRGBFactor,r.blendSrcAlphaFactor=e.blendSrcAlphaFactor,r.blendDstRGBFactor=e.blendDstRGBFactor,r.blendDstAlphaFactor=e.blendDstAlphaFactor,r.blend?t.enable(t.BLEND):t.disable(t.BLEND),t.blendFuncSeparate(r.blendSrcRGBFactor,r.blendDstRGBFactor,r.blendSrcAlphaFactor,r.blendDstAlphaFactor)),e.cullFace===r.cullFace&&e.cullFaceMode===r.cullFaceMode||(r.cullFace=e.cullFace,r.cullFaceMode=e.cullFaceMode,r.cullFace?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),r.cullFace&&t.cullFace(r.cullFaceMode)),e.colorMask[0]===r.pipeline.colorMask[0]&&e.colorMask[1]===r.pipeline.colorMask[1]&&e.colorMask[2]===r.pipeline.colorMask[2]&&e.colorMask[3]===r.pipeline.colorMask[3]||(r.pipeline.colorMask[0]=e.colorMask[0],r.pipeline.colorMask[1]=e.colorMask[1],r.pipeline.colorMask[2]=e.colorMask[2],r.pipeline.colorMask[3]=e.colorMask[3],t.colorMask(e.colorMask[0],e.colorMask[1],e.colorMask[2],e.colorMask[3])),e.program!==r.program&&(r.program=e.program,r.program&&t.useProgram(r.program.handle)),e.vertexLayout&&(r.vertexLayout=e.vertexLayout),this.checkError()},applyUniforms:function(e,t){const r=this.gl,n=this.state;let i=0;n.program||a.fail("Trying to draw without an active program");const o=this.debugMode?Object.keys(n.program.uniforms):null;for(var u in e){let f=e[u];if(n.program.uniforms[u]||n.program.uniforms[u+"[0]"])if(null==f&&(s("invalid command",t),a.fail(`Can't set uniform "${u}" with a null value`)),Array.isArray(f)&&!n.program.uniforms[u]){this.debugMode&&s("unknown uniform",u,Object.keys(n.program.uniforms));for(var c=0;c<f.length;c++){var l=u+"["+c+"]";n.program.setUniform(l,f[c]),this.debugMode&&o.splice(o.indexOf(l),1)}}else if(f.target){const e=i++;r.activeTexture(r.TEXTURE0+e),n.activeTextures[e]!==f&&(r.bindTexture(f.target,f.handle),n.activeTextures[e]=f),n.program.setUniform(u,e),this.debugMode&&o.splice(o.indexOf(u),1)}else f.length||"object"!=typeof f?(n.program.setUniform(u,f),this.debugMode&&o.splice(o.indexOf(u),1)):(s("invalid command",t),a.fail(`Can set uniform "${u}" with an Object value`))}this.debugMode&&o.length>0&&(s("invalid command",t),a.fail(`Trying to draw with missing uniforms: ${o.join(", ")}`)),this.checkError()},drawVertexData:function(e){const n=this.state,i=n.vertexLayout;n.program||a.fail("Trying to draw without an active program"),this.debugMode&&i.length!==Object.keys(n.program.attributes).length&&(s("Invalid vertex layout not matching the shader",i,n.program.attributes,e),a.fail("Invalid vertex layout not matching the shader"));let o=!1;for(let e=0;e<16;e++)n.activeAttributes[e]=null,t.disableVertexAttribArray(e);for(let u=0;u<i.length;u++){const c=i[u],l=c[0],f=c[1],d=c[2],p=e.attributes[u]||e.attributes[l];p||(s("Invalid command",e,"doesn't satisfy vertex layout",i),a.fail(`Command is missing attribute "${l}" at location ${f} with ${p}`));let h=p.buffer;h||"vertexBuffer"!==p.class||(h=p),h&&h.target||(s("Invalid command",e),a.fail(`Trying to draw arrays with invalid buffer for attribute : ${l}`)),t.bindBuffer(h.target,h.handle),16===d?(t.enableVertexAttribArray(f+0),t.enableVertexAttribArray(f+1),t.enableVertexAttribArray(f+2),t.enableVertexAttribArray(f+3),n.activeAttributes[f+0]=h,n.activeAttributes[f+1]=h,n.activeAttributes[f+2]=h,n.activeAttributes[f+3]=h,t.vertexAttribPointer(f,4,p.type||h.type,p.normalized||!1,p.stride||64,p.offset||0),t.vertexAttribPointer(f+1,4,p.type||h.type,p.normalized||!1,p.stride||64,p.offset||16),t.vertexAttribPointer(f+2,4,p.type||h.type,p.normalized||!1,p.stride||64,p.offset||32),t.vertexAttribPointer(f+3,4,p.type||h.type,p.normalized||!1,p.stride||64,p.offset||48),p.divisor?(t.vertexAttribDivisor(f+0,p.divisor),t.vertexAttribDivisor(f+1,p.divisor),t.vertexAttribDivisor(f+2,p.divisor),t.vertexAttribDivisor(f+3,p.divisor),o=!0):r.instancing&&(t.vertexAttribDivisor(f+0,0),t.vertexAttribDivisor(f+1,0),t.vertexAttribDivisor(f+2,0),t.vertexAttribDivisor(f+3,0))):(t.enableVertexAttribArray(f),n.activeAttributes[f]=h,t.vertexAttribPointer(f,d,p.type||h.type,p.normalized||!1,p.stride||0,p.offset||0),p.divisor?(t.vertexAttribDivisor(f,p.divisor),o=!0):r.instancing&&t.vertexAttribDivisor(f,0))}let u=e.pipeline.primitive;if(e.indices){let r=e.indices.buffer;r||"indexBuffer"!==e.indices.class||(r=e.indices),r&&r.target||(s("Invalid command",e),a.fail("Trying to draw arrays with invalid buffer for elements")),n.indexBuffer=r,t.bindBuffer(r.target,r.handle);var c=e.indices.count||r.length,l=e.indices.offset||0,f=e.indices.type||r.type;o?t.drawElementsInstanced(u,c,f,l,e.instances):t.drawElements(u,c,f,l)}else if(e.count){const r=0;o?t.drawArraysInstanced(u,r,e.count,e.instances):t.drawArrays(u,r,e.count)}else a.fail("Vertex arrays requres elements or count to draw");this.checkError()},frame:function(e){const r=this;o(function n(){r.updatePixelRatio&&(r.pixelRatio=r.updatePixelRatio,r.updateWidth||(r.updateWidth=parseInt(t.canvas.style.width)||t.canvas.width),r.updateHeight||(r.updateHeight=parseInt(t.canvas.style.height)||t.canvas.height),r.updatePixelRatio=0),r.updateWidth&&(t.canvas.style.width=r.updateWidth+"px",t.canvas.width=r.updateWidth*r.pixelRatio,r.updateWidth=0),r.updateHeight&&(t.canvas.style.height=r.updateHeight+"px",t.canvas.height=r.updateHeight*r.pixelRatio,r.updateHeight=0),r.defaultState.viewport[2]===t.drawingBufferWidth&&r.defaultState.viewport[3]===t.drawingBufferHeight||(r.defaultState.viewport[2]=t.drawingBufferWidth,r.defaultState.viewport[3]=t.drawingBufferHeight,r.defaultState.pass.framebuffer.width=t.drawingBufferWidth,r.defaultState.pass.framebuffer.height=t.drawingBufferHeight,t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),!1!==e()&&(r.queries.length&&(r.queries=r.queries.filter(e=>!e._available(r,e))),o(n))})},apply:function(e){const r=this.state;this.debugMode&&s("apply",e.name||e.id,{cmd:e,state:JSON.parse(JSON.stringify(r))}),this.checkError(),e.scissor?e.scissor!==r.scissor&&(r.scissor=e.scissor,t.enable(t.SCISSOR_TEST),t.scissor(r.scissor[0],r.scissor[1],r.scissor[2],r.scissor[3])):e.scissor!==r.scissor&&(r.scissor=e.scissor,t.disable(t.SCISSOR_TEST)),e.pass&&this.applyPass(e.pass),e.pipeline&&this.applyPipeline(e.pipeline),e.uniforms&&this.applyUniforms(e.uniforms),e.viewport&&e.viewport!==r.viewport&&(r.viewport=e.viewport,t.viewport(r.viewport[0],r.viewport[1],r.viewport[2],r.viewport[3])),e.attributes&&this.drawVertexData(e)},submit:function(e,t,r){if(this.debugMode&&(this.debugCommands.push(e),m(b,e),s("submit",e.name||e.id,t&&r?{depth:this.stack.length,cmd:e,batches:t,subCommand:r,state:this.state,stack:this.stack}:t?{depth:this.stack.length,cmd:e,batches:t,state:this.state,stack:this.stack}:{depth:this.stack.length,cmd:e,state:this.state,stack:this.stack})),t){if(Array.isArray(t)){for(let n=0;n<t.length;n++){const i=t[n];this.submit(this.mergeCommands(e,i,!0),r)}return}if("object"==typeof t)return void this.submit(this.mergeCommands(e,t,!0),r);r=t}const n=this.stack[this.stack.length-1],i=this.mergeCommands(n,e,!1);if(this.apply(i),r){if(this.debugMode&&(this.debugGraph+=`subgraph cluster_${e.name||e.id} {\n`,this.debugGraph+=`label = "${e.name}"\n`,e.program&&(this.debugGraph+=`${e.program.id} -> cluster_${e.name||e.id}\n`),e.framebuffer)){this.debugGraph+=`${e.framebuffer.id} -> cluster_${e.name||e.id}\n`;for(let t=0;t<e.framebuffer.color;t++){const r=e.framebuffer.color[t];this.debugGraph+=`${r.texture.id} -> ${e.framebuffer.id}\n`}e.framebuffer.depth&&(this.debugGraph+=`${e.framebuffer.depth.texture.id} -> ${e.framebuffer.id}\n`)}this.stack.push(i),r(),this.stack.pop(),this.debugMode&&(this.debugGraph+="}\n")}else if(this.debugMode){let t=`${e.name||e.id} [style=filled fillcolor = "#DDFFDD" label="`,r=[e.name||e.id];if(e.uniforms){r.push(" "),r.push("uniforms");const t=Object.keys(e.uniforms);for(let n=0;n<t.length;n++){const i=t[n];r.push(`<u${n}>${i}`);const o=e.uniforms[i];null==o&&(s("Invalid command",e),a.fail(`Trying to draw with uniform "${i}" = null`)),o.id&&(this.debugGraph+=`${o.id} -> ${e.name||e.id}:u${n}\n`)}}t+=r.join("|"),t+='"]',this.debugGraph+=`${t}\n`}this.checkError()},dispose:function(e){if(s("dispose",e),a(e||0===arguments.length,"Trying to dispose undefined resource"),e){e._dispose||a(e._dispose,"Trying to dispose non resource");const t=this.resources.indexOf(e);a(-1!==t,"Trying to dispose resource from another context"),this.resources.splice(t,1),this.stats[e.class].alive--,e._dispose()}else for(;this.resources.length;)this.dispose(this.resources[0]);this.gl.canvas.width=1,this.gl.canvas.height=1}}),O.apply(M),O}},function(e,t,r){const n=r(0);e.exports=function(e){n(!e||"object"==typeof e,"pex-gl: createGL requires opts argument to be null or an object"),e||(e={});let t=e.canvas;const r=e.pixelRatio||1,i=!e.width&&!e.height;if(!t){if(t=document.createElement("canvas"),i){const e=document.createElement("meta");e.setAttribute("name","viewport"),e.setAttribute("content","width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=0.0"),document.head.appendChild(e)}const n=()=>{i&&(document.body.style.margin="0px",document.body.style.overflow="hidden",document.body.style.background="#000"),document.body.appendChild(t)},a=e.width||window.innerWidth,o=e.height||window.innerHeight;1!==r?(t.style.width=a+"px",t.style.height=o+"px",t.width=a*r,t.height=o*r):(t.width=a*r,t.height=o*r),document.body?n():document.addEventListener("DOMContentLoaded",n)}const a=["webgl","experimental-webgl"];for(var o=0;o<a.length;o++)try{const r=t.getContext(a[o],e);if(!r)throw new Error("Canvas.getContext returned null");return console.info("pex-gl","Creating",a[o],"succeeded"),r}catch(e){console.warn("pex-gl","Creating",a[o],"failed",e)}}},function(e,t,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,o,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in r=Object(arguments[u]))i.call(r,c)&&(s[c]=r[c]);if(n){o=n(r);for(var l=0;l<o.length;l++)a.call(r,o[l])&&(s[o[l]]=r[o[l]])}}return s}},function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},i=/%[sdj%]/g;t.format=function(e){if(!E(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,o=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),u=n[r];r<a;u=n[++r])g(u)||!A(u)?o+=" "+u:o+=" "+s(u);return o},t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var a,o={};function s(e,r){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(r)?n.showHidden=r:r&&t._extend(n,r),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),l(n,e,n.depth)}function u(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function c(e,t){return e}function l(e,r,n){if(e.customInspect&&r&&_(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return E(i)||(i=l(e,i,n)),i}var a=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(E(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(m(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,r);if(a)return a;var o=Object.keys(r),s=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),v(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return f(r);if(0===o.length){if(_(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(y(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(T(r))return e.stylize(Date.prototype.toString.call(r),"date");if(v(r))return f(r)}var c,A="",w=!1,x=["{","}"];(p(r)&&(w=!0,x=["[","]"]),_(r))&&(A=" [Function"+(r.name?": "+r.name:"")+"]");return y(r)&&(A=" "+RegExp.prototype.toString.call(r)),T(r)&&(A=" "+Date.prototype.toUTCString.call(r)),v(r)&&(A=" "+f(r)),0!==o.length||w&&0!=r.length?n<0?y(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),c=w?function(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)R(t,String(o))?a.push(d(e,t,r,n,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(d(e,t,r,n,i,!0))}),a}(e,r,n,s,o):o.map(function(t){return d(e,r,n,s,t,w)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,A,x)):x[0]+A+x[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,a){var o,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),R(n,i)||(o="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=g(r)?l(e,u.value,null):l(e,u.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),b(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function E(e){return"string"==typeof e}function b(e){return void 0===e}function y(e){return A(e)&&"[object RegExp]"===w(e)}function A(e){return"object"==typeof e&&null!==e}function T(e){return A(e)&&"[object Date]"===w(e)}function v(e){return A(e)&&("[object Error]"===w(e)||e instanceof Error)}function _(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(r){if(b(a)&&(a=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!o[r])if(new RegExp("\\b"+r+"\\b","i").test(a)){var n=e.pid;o[r]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",r,n,e)}}else o[r]=function(){};return o[r]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=h,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=E,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=y,t.isObject=A,t.isDate=T,t.isError=v,t.isFunction=_,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(9);var F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,r;console.log("%s - %s",(e=new Date,r=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":"),[e.getDate(),F[e.getMonth()],r].join(" ")),t.format.apply(t,arguments))},t.inherits=r(10),t._extend=function(e,t){if(!t||!A(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var S="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(S&&e[S]){var t;if("function"!=typeof(t=e[S]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,S,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise(function(e,n){t=e,r=n}),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push(function(e,n){e?r(e):t(n)});try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),S&&Object.defineProperty(t,S,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=S,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};t.apply(this,r).then(function(t){e.nextTick(o,null,t)},function(t){e.nextTick(O,t,o)})}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,n(t)),r}}).call(this,r(2))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){e.exports=!0},function(e,t,r){(function(t){for(var n=r(13),i="undefined"==typeof window?t:window,a=["moz","webkit"],o="AnimationFrame",s=i["request"+o],u=i["cancel"+o]||i["cancelRequest"+o],c=0;!s&&c<a.length;c++)s=i[a[c]+"Request"+o],u=i[a[c]+"Cancel"+o]||i[a[c]+"CancelRequest"+o];if(!s||!u){var l=0,f=0,d=[];s=function(e){if(0===d.length){var t=n(),r=Math.max(0,1e3/60-(t-l));l=r+t,setTimeout(function(){var e=d.slice(0);d.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(l)}catch(e){setTimeout(function(){throw e},0)}},Math.round(r))}return d.push({handle:++f,callback:e,cancelled:!1}),f},u=function(e){for(var t=0;t<d.length;t++)d[t].handle===e&&(d[t].cancelled=!0)}}e.exports=function(e){return s.call(i,e)},e.exports.cancel=function(){u.apply(i,arguments)},e.exports.polyfill=function(){i.requestAnimationFrame=s,i.cancelAnimationFrame=u}}).call(this,r(4))},function(e,t,r){(function(t){(function(){var r,n,i;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=t&&t.hrtime?(e.exports=function(){return(r()-i)/1e6},n=t.hrtime,i=(r=function(){var e;return 1e9*(e=n())[0]+e[1]})()):Date.now?(e.exports=function(){return Date.now()-i},i=Date.now()):(e.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)}).call(this,r(2))},function(e,t,r){var n;function i(e){function r(){if(r.enabled){var e=r,i=+new Date,a=i-(n||i);e.diff=a,e.prev=n,e.curr=i,n=i;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var u=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;u++;var i=t.formatters[n];if("function"==typeof i){var a=o[u];r=i.call(e,a),o.splice(u,1),u--}return r}),t.formatArgs.call(e,o),(r.log||t.log||console.log.bind(console)).apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length,i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(15),t.names=[],t.skips=[],t.formatters={}},function(e,t){var r=1e3,n=60*r,i=60*n,a=24*i,o=365.25*a;function s(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var u,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*o;case"days":case"day":case"d":return s*a;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?s(u=e,a,"day")||s(u,i,"hour")||s(u,n,"minute")||s(u,r,"second")||u+" ms":function(e){if(e>=a)return Math.round(e/a)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=n)return Math.round(e/n)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){const n=r(0),i=r(1),a=["name","data","width","height","pixelFormat","encoding","flipY","mipmap","target","min","mag","wrap","wrapS","wrapT","aniso","premultiplayAlpha"];function o(e,t){return void 0!==e?e:t}function s(e,t,r){const i=e.gl,a=e.PixelFormat;let s,u,c,l=null,f=r.width,d=r.height,p=o(r.flipY,o(t.flipY,!1)),h=r.target||t.target,g=r.pixelFormat||t.pixelFormat||e.PixelFormat.RGBA8,m=r.encoding||t.encoding||e.Encoding.Linear,E=r.min||t.min||i.NEAREST,b=r.mag||t.mag||i.NEAREST,y=r.wrapS||t.wrapS||r.wrap||t.wrap||i.CLAMP_TO_EDGE,A=r.wrapT||t.wrapT||r.wrap||t.wrap||i.CLAMP_TO_EDGE,T=r.aniso||t.aniso||0,v=o(r.premultiplayAlpha,o(t.premultiplayAlpha,!1));var _=i.getExtension("EXT_texture_filter_anisotropic");i.activeTexture(i.TEXTURE0+0),i.bindTexture(t.target,t.handle),e.state.activeTextures[0]=t,i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,p),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,v),i.texParameteri(h,i.TEXTURE_MAG_FILTER,b),i.texParameteri(h,i.TEXTURE_MIN_FILTER,E),i.texParameteri(h,i.TEXTURE_WRAP_S,y),i.texParameteri(h,i.TEXTURE_WRAP_T,A),_&&T>0&&i.texParameterf(h,_.TEXTURE_MAX_ANISOTROPY_EXT,T);const w=r.data?r.data:r;if(w&&w.nodeName)n(w instanceof window.HTMLImageElement||w instanceof window.HTMLVideoElement||w instanceof window.HTMLCanvasElement,"Texture2D.update opts has to be Image, Canvas or Video element"),f=w.width||w.videoHeight,d=w.height||w.videoHeight,s=i.RGBA,c=i.RGBA,u=i.UNSIGNED_BYTE,i.texImage2D(h,0,s,c,u,w),t.width=f,t.height=d;else if("object"==typeof r){if(n(!l||Array.isArray(r.data)||r.data instanceof Uint8Array||r.data instanceof Float32Array,"Texture2D.update opts.data has to be null or an Array, Uint8Array or Float32Array"),l=r.data?r.data.data||r.data:null,!r.width&&l&&l.width&&(f=l.width),!r.height&&l&&l.height&&(f=l.height),n(!l||void 0!==f&&void 0!==d,"Texture2D.update opts.width and opts.height are required when providing opts.data"),g===a.Depth?(c=i.DEPTH_COMPONENT,s=i.DEPTH_COMPONENT,u=i.UNSIGNED_SHORT):g===a.RGBA8?(c=i.RGBA,s=i.RGBA,u=i.UNSIGNED_BYTE):g===a.RGBA32F?(c=i.RGBA,s=i.RGBA,u=i.FLOAT):g===a.RGBA16F?(c=i.RGBA,s=i.RGBA,u=i.HALF_FLOAT):g===a.R32F?(c=i.ALPHA,s=i.ALPHA,u=i.FLOAT):g&&n.fail(`Unknown texture pixel format: ${r.format}`),h===i.TEXTURE_2D)Array.isArray(l)&&(u===i.UNSIGNED_BYTE?l=new Uint8Array(l):u===i.FLOAT?l=new Float32Array(l):u===i.HALF_FLOAT?l=new Float32Array(l):n.fail(`Unknown texture data type: ${u}`)),f&&d&&(i.texImage2D(h,0,s,f,d,0,c,u,l),t.width=f,t.height=d);else if(h===i.TEXTURE_CUBE_MAP){n(!l||Array.isArray(l)&&6===l.length,"TextureCube requires data for 6 faces");for(let e=0;e<6;e++){let r=l?l[e].data||l[e]:null;const a=i.TEXTURE_CUBE_MAP_POSITIVE_X+e;Array.isArray(r)?(u===i.UNSIGNED_BYTE?r=new Uint8Array(r):u===i.FLOAT?r=new Float32Array(l):n.fail(`Unknown texture data type: ${u}`),i.texImage2D(a,0,s,f,d,0,c,u,r)):r&&r.nodeName?i.texImage2D(a,0,s,c,u,r):i.texImage2D(a,0,s,f,d,0,c,u,r),t.width=f,t.height=d}}}else n.fail("Texture2D.update opts has to be a HTMLElement or Object");return r.mipmap&&i.generateMipmap(t.target),t.target=h,t.pixelFormat=g,t.encoding=m,t.min=E,t.mag=b,t.wrapS=y,t.wrapT=A,t.format=c,t.flipY=p,t.internalFormat=s,t.type=u,t.info="",t.info+=Object.keys(e.PixelFormat).find(t=>e.PixelFormat[t]===g),t.info+="_",t.info+=Object.keys(e.Encoding).find(t=>e.Encoding[t]===m),t}e.exports=function(e,t){i(a,t);const r=e.gl,n={class:"texture",handle:r.createTexture(),target:t.target,width:0,height:0,_update:s,_dispose:function(){r.deleteTexture(this.handle),this.handle=null}};return s(e,n,t),n}},function(e,t,r){const n=r(0),i=r(3)("context/framebuffer");function a(e,t,r){const a=e.gl;t.color=r.color.map(e=>{const t=e.texture?e:{texture:e};return t.level=0,t.target||(t.target=t.texture.target),t}),r.depth&&!r.depth.texture&&(r.depth={texture:r.depth}),t.depth=r.depth,t.width=t.color[0].texture.width,t.height=t.color[0].texture.height,a.bindFramebuffer(t.target,t.handle),t.drawBuffers.length=0;for(let e=0;e<t.color.length;e++){const r=t.color[e];t.drawBuffers.push(a.COLOR_ATTACHMENT0+e),a.framebufferTexture2D(t.target,a.COLOR_ATTACHMENT0+e,r.target,r.texture.handle,r.level)}for(let r=t.color.length;r<e.capabilities.maxColorAttachments;r++)a.framebufferTexture2D(t.target,a.COLOR_ATTACHMENT0+r,a.TEXTURE_2D,null,0);if(t.depth){e.debugMode&&i("fbo attaching depth",t.depth);const r=t.depth;r.texture.target===a.RENDERBUFFER?a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,r.texture.handle):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,r.texture.target,r.texture.handle,r.level)}else e.debugMode&&i("fbo deattaching depth"),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,null),a.framebufferTexture2D(t.target,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,null,0);var o=[];o[a.FRAMEBUFFER_COMPLETE]="FRAMEBUFFER_COMPLETE",o[a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",o[a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",o[a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",o[a.FRAMEBUFFER_UNSUPPORTED]="FRAMEBUFFER_UNSUPPORTED";var s=a.checkFramebufferStatus(a.FRAMEBUFFER);n(s===a.FRAMEBUFFER_COMPLETE,`FBO incomplete ${o[s]}`),a.bindFramebuffer(t.target,null)}e.exports=function(e,t){const r=e.gl,n={class:"framebuffer",handle:r.createFramebuffer(),target:r.FRAMEBUFFER,drawBuffers:[],color:[],depth:null,width:0,height:0,refCount:0,_update:a,_dispose:function(){r.deleteFramebuffer(this.handle),this.color=null,this.depth=null}};return(t.color||t.depth)&&a(e,n,t),n}},function(e,t,r){const n=r(0);function i(e,t,r){Object.assign(t,r);const i=e.gl;n(t.pixelFormat===e.PixelFormat.Depth16,"Only PixelFormat.Depth16 is supported for renderbuffers"),t.format=i.DEPTH_COMPONENT16,i.bindRenderbuffer(t.target,t.handle),i.renderbufferStorage(t.target,t.format,t.width,t.height),i.bindRenderbuffer(t.target,null)}e.exports=function(e,t){const r=e.gl,n={class:"renderbuffer",handle:r.createRenderbuffer(),target:r.RENDERBUFFER,width:0,height:0,_update:i,_dispose:function(){r.deleteRenderbuffer(this.handle),this.color=null,this.depth=null}};return i(e,n,t),n}},function(e,t,r){const n=r(1),i=["name","framebuffer","color","depth","clearColor","clearDepth"];e.exports=function(e,t){n(i,t);const r={class:"pass",opts:t,clearColor:t.clearColor,clearDepth:t.clearDepth,_dispose:function(){this.opts=null,this.clearColor=null,this.clearDepth=null,this.framebuffer===e.defaultState.pass.sharedFramebuffer&&0==--e.defaultState.pass.sharedFramebuffer.refCount&&(e.defaultState.pass.sharedFramebuffer._dispose(),e.defaultState.pass.sharedFramebuffer=null),this.framebuffer=null}};return(t.color||t.depth)&&(e.defaultState.pass.sharedFramebuffer||(e.defaultState.pass.sharedFramebuffer=e.framebuffer({})),r.framebuffer=e.defaultState.pass.sharedFramebuffer,e.defaultState.pass.sharedFramebuffer.refCount++),r.framebuffer||(r.framebuffer=e.defaultState.pass.framebuffer),r}},function(e,t,r){const n=r(1),i=["vert","frag","program","depthWrite","depthTest","depthFunc","blend","blendSrcRGBFactor","blendSrcAlphaFactor","blendDstRGBFactor","blendDstAlphaFactor","cullFace","cullFaceMode","colorMask","primitive"];e.exports=function(e,t){n(i,t);const r=Object.assign({class:"pipeline",vert:null,frag:null,program:null,depthWrite:!0,depthTest:!1,depthFunc:e.DepthFunc.LessEqual,blend:!1,blendSrcRGBFactor:e.BlendFactor.One,blendSrcAlphaFactor:e.BlendFactor.One,blendDstRGBFactor:e.BlendFactor.One,blendDstAlphaFactor:e.BlendFactor.One,cullFace:!1,cullFaceMode:e.Face.Back,colorMask:[!0,!0,!0,!0],primitive:e.Primitive.Triangles,_dispose:function(){this.vert=null,this.frag=null,this.program&&0==--this.program.refCount&&e.dispose(this.program),this.program=null}},t);if(t.vert&&t.frag&&(r.program=e.program({vert:t.vert,frag:t.frag})),r.program&&!r.vertexLayout){r.program.refCount++;const e=r.program.attributesPerLocation;r.vertexLayout=Object.keys(e).map(t=>{const r=e[t];return[r.name,parseInt(t,10),r.size]})}return r}},function(e,t,r){const n=r(3)("context/program"),i=r(0);function a(e,t,r){i("string"==typeof r.vert,"Vertex shader source must be a string"),i("string"==typeof r.frag,"Fragment shader source must be a string");const n=e.gl,a=o(e,t,n.VERTEX_SHADER,r.vert),s=o(e,t,n.FRAGMENT_SHADER,r.frag);if(n.attachShader(t.handle,a),n.attachShader(t.handle,s),n.linkProgram(t.handle),!n.getProgramParameter(t.handle,n.LINK_STATUS))throw new Error("Program: "+n.getProgramInfoLog(t.handle));n.deleteShader(a),n.deleteShader(s),function(e,t){const r=e.gl;t.uniforms={};const n=r.getProgramParameter(t.handle,r.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=r.getActiveUniform(t.handle,i),a=n.name;let o=0;switch(n.type){case r.INT:case r.BOOL:case r.FLOAT:o=1;break;case r.FLOAT_VEC2:o=2;break;case r.FLOAT_VEC3:o=3;break;case r.FLOAT_VEC4:case r.FLOAT_MAT2:o=4;break;case r.FLOAT_MAT3:o=9;break;case r.FLOAT_MAT4:o=16;break;case r.SAMPLER_2D:case r.SAMPLER_CUBE:o=0;break;default:throw new Error(`Unknwon attribute type ${n.type} : ${e.getGLString(n.type)}`)}if(t.uniforms[a]={name:a,type:n.type,size:o,location:r.getUniformLocation(t.handle,a)},n.size>1)for(let e=1;e<n.size;e++){const i=n.name.substr(0,n.name.indexOf("[")+1)+e+"]";t.uniforms[i]={type:n.type,location:r.getUniformLocation(t.handle,i)}}}}(e,t),function(e,t){const r=e.gl;t.attributes={},t.attributesPerLocation={};const n=r.getProgramParameter(t.handle,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;++i){const n=r.getActiveAttrib(t.handle,i),a=n.name;let o=0;switch(n.type){case r.FLOAT:o=1;break;case r.FLOAT_VEC2:o=2;break;case r.FLOAT_VEC3:o=3;break;case r.FLOAT_VEC4:o=4;break;case r.FLOAT_MAT4:o=16;break;default:throw new Error(`Unknwon attribute type ${n.type} : ${e.getGLString(n.type)}`)}const s={name:a,type:n.type,size:o,location:r.getAttribLocation(t.handle,a)};t.attributes[a]=s,t.attributesPerLocation[s.location]=s}}(e,t)}function o(e,t,r,i){const a=e.gl,o=a.createShader(r);if(a.shaderSource(o,i+"\n"),a.compileShader(o),!a.getShaderParameter(o,a.COMPILE_STATUS)){const e=r===a.VERTEX_SHADER?"Vertex":"Fragment";throw n(e+" shader compilation failed"),n(i),new Error(e+" shader error: "+a.getShaderInfoLog(o))}return o}e.exports=function(e,t){const r=e.gl,n={class:"program",handle:r.createProgram(),attributes:[],attributesPerLocation:{},uniforms:{},refCount:0,_update:a,_dispose:function(){r.deleteProgram(this.handle),this.handle=null,this.attributes=null,this.attributesPerLocation=null,this.uniforms=null},setUniform:function(t,r){const n=this.uniforms[t];if(void 0===n)throw new Error(`Uniform ${t} is not defined`);const i=e.gl,a=n.type,o=n.location;switch(n.type){case i.INT:case i.BOOL:i.uniform1i(o,r);break;case i.FLOAT:i.uniform1f(o,r);break;case i.FLOAT_VEC2:i.uniform2fv(o,r);break;case i.FLOAT_VEC3:i.uniform3fv(o,r);break;case i.FLOAT_VEC4:i.uniform4fv(o,r);break;case i.FLOAT_MAT2:i.uniformMatrix2fv(o,!1,r);break;case i.FLOAT_MAT3:i.uniformMatrix3fv(o,!1,r);break;case i.FLOAT_MAT4:i.uniformMatrix4fv(o,!1,r);break;case i.SAMPLER_2D:case i.SAMPLER_CUBE:i.uniform1i(o,r);break;default:throw new Error(`Invalid uniform type ${a} : ${e.getGLString(a)}`)}}};return a(e,n,t),n}},function(e,t,r){const n=r(0),i=r(1),a=["target","data","usage","type"];function o(e,t,r){i(a,r);const n=e.gl;let o=r.data||r,s=r.type||t.type;if(Array.isArray(o)){s||(r.target===n.ARRAY_BUFFER&&(s=e.DataType.Float32),r.target===n.ELEMENT_ARRAY_BUFFER&&(s=e.DataType.Uint16));var u=o,c=Array.isArray(u[0])?u[0].length:1,l=c*u.length;if(s===e.DataType.Float32?o=new Float32Array(1===c?u:l):s===e.DataType.Uint8?o=new Uint8Array(1===c?u:l):s===e.DataType.Uint16?o=new Uint16Array(1===c?u:l):s===e.DataType.Uint32&&(o=new Uint32Array(1===c?u:l)),c>1)for(var f=0;f<u.length;f++)for(var d=0;d<c;d++){o[f*c+d]=u[f][d]}}else if(o instanceof Float32Array)s=e.DataType.Float32;else if(o instanceof Uint8Array)s=e.DataType.Uint8;else if(o instanceof Uint16Array)s=e.DataType.Uint16;else if(o instanceof Uint32Array)s=e.DataType.Uint32;else if(!(o instanceof ArrayBuffer))throw new Error(`Unknown buffer data type: ${o.constructor}`);t.type=s,t.length=o.length,n.bindBuffer(t.target,t.handle),n.bufferData(t.target,o,t.usage)}e.exports=function(e,t){const r=e.gl;i(a,t),n(t.target===r.ARRAY_BUFFER||t.target===r.ELEMENT_ARRAY_BUFFER,"Invalid buffer target");const s={class:t.target===r.ARRAY_BUFFER?"vertexBuffer":"indexBuffer",handle:r.createBuffer(),target:t.target,usage:t.usage||r.STATIC_DRAW,_update:o,_dispose:function(){r.deleteBuffer(this.handle),this.handle=null}};return o(e,s,t),s}},function(e,t,r){const n=r(1),i=["target"];function a(e,t){return t.state===e.QueryState.Ready&&(e.gl.beginQuery(t.target,t.handle),t.state=e.QueryState.Active,t.result=null,!0)}function o(e,t){return t.state===e.QueryState.Active&&(e.gl.endQuery(t.target),t.state=e.QueryState.Pending,!0)}function s(e,t){return!!e.gl.getQueryObject(t.handle,e.gl.QUERY_RESULT_AVAILABLE)&&(t.result=e.gl.getQueryObject(t.handle,e.gl.QUERY_RESULT),t.state=e.QueryState.Ready,!0)}e.exports=function(e,t){const r=e.gl;n(i,t=t||{});const u=Object.assign({class:"query",handle:r.createQuery(),target:null,state:e.QueryState.Ready,result:null,_begin:a,_end:o,_available:s,_dispose:function(){r.deleteQuery(this.handle),this.handle=null}},t);return u.target||(u.target=e.QueryTarget.TimeElapsed),u}}])});
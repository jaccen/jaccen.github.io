/* @preserve
author : RedCamel
github : https://github.com/redcamel/RedGL2
email : webseon@gmail.com
Copyright (c) 2018 RedCamel

MIT License

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
var RedDefinePropertyInfo,RedGLDetect,RedGLUtil,RedGL,RedBaseController,RedImageLoader,RedBaseTexture,RedBaseObject3D,RedBaseContainer,RedBaseLight,RedFrameBuffer,RedBuffer,RedGeometry,RedInterleaveInfo,RedBaseMaterial,RedTextureOptionChecker,RedBitmapTexture,RedVideoTexture,RedDDSTexture,RedBitmapCubeTexture,RedColorMaterial,RedColorPhongMaterial,RedColorPhongTextureMaterial,RedEnvironmentMaterial,RedBitmapMaterial,RedParticleMaterial,RedBitmapPointCloudMaterial,RedSheetMaterial,RedStandardMaterial,RedVideoMaterial,RedPBRMaterial,RedColorPointCloudMaterial,RedPBRMaterial_System,RedTextMaterial,RedAmbientLight,RedDirectionalLight,RedPointLight,JsonModelLoader,RedMTLLoader,RedOBJLoader,Red3DSLoader,RedDAELoader,RedGLTFLoader,RedAxis,RedGrid,RedMesh,RedLine,RedSkyBox,RedSprite3D,RedPointCloud,RedParticleUnit,RedColorPointCloud,RedBitmapPointCloud,RedParticleEmitter,RedBox,RedCylinder,RedPlane,RedSphere,RedProgram,RedSystemShaderCode,RedShader,RedRenderer,RedRenderDebuger,RedSystemUniformUpdater,RedView,RedWorld,RedScene,RedCamera,RedBasicController,RedObitController,RedGridMaterial,RedSkyBoxMaterial,RedDirectionalShadowMaterial,RedPostEffectMaterial,RedDirectionalShadow,RedShadowManager,RedText,RedMouseEventManager,RedMouseEventMaterial,RedPostEffectManager,RedBasePostEffect,RedPostEffect_Bloom,RedPostEffect_BloomThreshold,RedPostEffect_Blur,RedPostEffect_BlurX,RedPostEffect_BlurY,RedPostEffect_GaussianBlur,RedPostEffect_ZoomBlur,RedPostEffect_BrightnessContrast,RedPostEffect_Threshold,RedPostEffect_Invert,RedPostEffect_Gray,RedPostEffect_HueSaturation,RedPostEffect_HalfTone,RedPostEffect_Pixelize,RedPostEffect_Convolution,RedPostEffect_DoF,RedPostEffect_DoF_DepthMaterial,RedPostEffect_Film,RedPostEffect_Vignetting,RedPostEffect_FXAA,RedGLOffScreen;!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=function(e){t.ARRAY_TYPE=e},t.toRadian=function(e){return e*i},t.equals=function(e,t){return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))};var n=t.EPSILON=1e-6,i=(t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,t.RANDOM=Math.random,Math.PI/180)},function(e,t,r){"use strict";function n(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=t[6],u=t[7],l=t[8],c=r[0],h=r[1],R=r[2],m=r[3],p=r[4],_=r[5],g=r[6],E=r[7],P=r[8];return e[0]=c*n+h*o+R*f,e[1]=c*i+h*s+R*u,e[2]=c*a+h*d+R*l,e[3]=m*n+p*o+_*f,e[4]=m*i+p*s+_*u,e[5]=m*a+p*d+_*l,e[6]=g*n+E*o+P*f,e[7]=g*i+E*s+P*u,e[8]=g*a+E*d+P*l,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){var t=new a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,n,i,o,s,d,f){var u=new a.ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=i,u[5]=o,u[6]=s,u[7]=d,u[8]=f,u},t.set=function(e,t,r,n,i,a,o,s,d,f){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=d,e[8]=f,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],d=t[6],f=t[7],u=t[8],l=u*o-s*f,c=-u*a+s*d,h=f*a-o*d,R=r*l+n*c+i*h;return R?(R=1/R,e[0]=l*R,e[1]=(-u*n+i*f)*R,e[2]=(s*n-i*o)*R,e[3]=c*R,e[4]=(u*r-i*d)*R,e[5]=(-s*r+i*a)*R,e[6]=h*R,e[7]=(-f*r+n*d)*R,e[8]=(o*r-n*a)*R,e):null},t.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],d=t[6],f=t[7],u=t[8];return e[0]=o*u-s*f,e[1]=i*f-n*u,e[2]=n*s-i*o,e[3]=s*d-a*u,e[4]=r*u-i*d,e[5]=i*a-r*s,e[6]=a*f-o*d,e[7]=n*d-r*f,e[8]=r*o-n*a,e},t.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],d=e[7],f=e[8];return t*(f*a-o*d)+r*(-f*i+o*s)+n*(d*i-a*s)},t.multiply=n,t.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=t[6],u=t[7],l=t[8],c=r[0],h=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=d,e[6]=c*n+h*o+f,e[7]=c*i+h*s+u,e[8]=c*a+h*d+l,e},t.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=t[6],u=t[7],l=t[8],c=Math.sin(r),h=Math.cos(r);return e[0]=h*n+c*o,e[1]=h*i+c*s,e[2]=h*a+c*d,e[3]=h*o-c*n,e[4]=h*s-c*i,e[5]=h*d-c*a,e[6]=f,e[7]=u,e[8]=l,e},t.scale=function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,d=i+i,f=r*o,u=n*o,l=n*s,c=i*o,h=i*s,R=i*d,m=a*o,p=a*s,_=a*d;return e[0]=1-l-R,e[3]=u-_,e[6]=c+p,e[1]=u+_,e[4]=1-f-R,e[7]=h-m,e[2]=c-p,e[5]=h+m,e[8]=1-f-l,e},t.normalFromMat4=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],d=t[6],f=t[7],u=t[8],l=t[9],c=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15],g=r*s-n*o,E=r*d-i*o,P=r*f-a*o,y=n*d-i*s,v=n*f-a*s,M=i*f-a*d,T=u*m-l*R,x=u*p-c*R,b=u*_-h*R,L=l*p-c*m,I=l*_-h*m,w=c*_-h*p,D=g*w-E*I+P*L+y*b-v*x+M*T;return D?(D=1/D,e[0]=(s*w-d*I+f*L)*D,e[1]=(d*b-o*w-f*x)*D,e[2]=(o*I-s*b+f*T)*D,e[3]=(i*I-n*w-a*L)*D,e[4]=(r*w-i*b+a*x)*D,e[5]=(n*b-r*I-a*T)*D,e[6]=(m*M-p*v+_*y)*D,e[7]=(p*P-R*M-_*E)*D,e[8]=(R*v-m*P+_*g)*D,e):null},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],d=e[5],f=e[6],u=e[7],l=e[8],c=t[0],h=t[1],R=t[2],m=t[3],p=t[4],_=t[5],g=t[6],E=t[7],P=t[8];return Math.abs(r-c)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-R)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(R))&&Math.abs(o-m)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-p)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(d-_)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(f-g)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(u-E)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-P)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=n,t.sub=i},function(e,t,r){"use strict";function n(){var e=new R.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function i(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function a(e,t,r){var n=new R.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function d(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function f(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function u(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function l(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function c(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=n,t.clone=function(e){var t=new R.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=i,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=o,t.multiply=s,t.divide=d,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},t.distance=f,t.squaredDistance=u,t.squaredLength=l,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=c,t.dot=h,t.cross=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],d=r[2];return e[0]=i*d-a*s,e[1]=a*o-n*d,e[2]=n*s-i*o,e},t.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e},t.hermite=function(e,t,r,n,i,a){var o=a*a,s=o*(2*a-3)+1,d=o*(a-2)+a,f=o*(a-1),u=o*(3-2*a);return e[0]=t[0]*s+r[0]*d+n[0]*f+i[0]*u,e[1]=t[1]*s+r[1]*d+n[1]*f+i[1]*u,e[2]=t[2]*s+r[2]*d+n[2]*f+i[2]*u,e},t.bezier=function(e,t,r,n,i,a){var o=1-a,s=o*o,d=a*a,f=s*o,u=3*a*s,l=3*d*o,c=d*a;return e[0]=t[0]*f+r[0]*u+n[0]*l+i[0]*c,e[1]=t[1]*f+r[1]*u+n[1]*l+i[1]*c,e[2]=t[2]*f+r[2]*u+n[2]*l+i[2]*c,e},t.random=function(e,t){t=t||1;var r=2*R.RANDOM()*Math.PI,n=2*R.RANDOM()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e},t.transformMat3=function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],d=r[2],f=r[3],u=f*n+s*a-d*i,l=f*i+d*n-o*a,c=f*a+o*i-s*n,h=-o*n-s*i-d*a;return e[0]=u*f+h*-o+l*-d-c*-s,e[1]=l*f+h*-s+c*-o-u*-d,e[2]=c*f+h*-d+u*-s-l*-o,e},t.rotateX=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){var r=a(e[0],e[1],e[2]),n=a(t[0],t[1],t[2]);c(r,r),c(n,n);var i=h(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=R.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=R.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=R.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))};var R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=o,t.mul=s,t.div=d,t.dist=f,t.sqrDist=u,t.len=i,t.sqrLen=l,t.forEach=function(){var e=n();return function(t,r,n,i,a,o){var s,d=void 0;for(r||(r=3),n||(n=0),s=i?Math.min(i*r+n,t.length):t.length,d=n;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],a(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2];return t}}()},function(e,t,r){"use strict";function n(){var e=new h.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function s(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function d(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+a*a)}function f(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function u(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function l(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function c(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o),e}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=n,t.clone=function(e){var t=new h.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,n){var i=new h.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=i,t.multiply=a,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=s,t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.distance=d,t.squaredDistance=f,t.length=u,t.squaredLength=l,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=c,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=h.RANDOM(),e[1]=h.RANDOM(),e[2]=h.RANDOM(),e[3]=h.RANDOM(),c(e,e),s(e,e,t),e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e},t.transformQuat=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],d=r[2],f=r[3],u=f*n+s*a-d*i,l=f*i+d*n-o*a,c=f*a+o*i-s*n,h=-o*n-s*i-d*a;return e[0]=u*f+h*-o+l*-d-c*-s,e[1]=l*f+h*-s+c*-o-u*-d,e[2]=c*f+h*-d+u*-s-l*-o,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],d=t[2],f=t[3];return Math.abs(r-o)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-d)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=h.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))};var h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=i,t.mul=a,t.div=o,t.dist=d,t.sqrDist=f,t.len=u,t.sqrLen=l,t.forEach=function(){var e=n();return function(t,r,n,i,a,o){var s,d=void 0;for(r||(r=4),n||(n=0),s=i?Math.min(i*r+n,t.length):t.length,d=n;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],a(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}()},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=t.vec3=t.vec2=t.quat=t.mat4=t.mat3=t.mat2d=t.mat2=t.glMatrix=void 0;var i=n(r(0)),a=n(r(5)),o=n(r(6)),s=n(r(1)),d=n(r(7)),f=n(r(8)),u=n(r(9)),l=n(r(2)),c=n(r(3));t.glMatrix=i,t.mat2=a,t.mat2d=o,t.mat3=s,t.mat4=d,t.quat=f,t.vec2=u,t.vec3=l,t.vec4=c},function(e,t,r){"use strict";function n(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],d=r[1],f=r[2],u=r[3];return e[0]=n*s+a*d,e[1]=i*s+o*d,e[2]=n*f+a*u,e[3]=i*f+o*u,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,n){var i=new a.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*a-i*n;return o?(o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null},t.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=n,t.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=n*d+a*s,e[1]=i*d+o*s,e[2]=n*-s+a*d,e[3]=i*-s+o*d,e},t.scale=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],d=r[1];return e[0]=n*s,e[1]=i*s,e[2]=a*d,e[3]=o*d,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=t[0],d=t[1],f=t[2],u=t[3];return Math.abs(r-s)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-d)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-f)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-u)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=n,t.sub=i},function(e,t,r){"use strict";function n(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=r[0],u=r[1],l=r[2],c=r[3],h=r[4],R=r[5];return e[0]=n*f+a*u,e[1]=i*f+o*u,e[2]=n*l+a*c,e[3]=i*l+o*c,e[4]=n*h+a*R+s,e[5]=i*h+o*R+d,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){var t=new a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,n,i,o){var s=new a.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=i,s[5]=o,s},t.set=function(e,t,r,n,i,a,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],d=r*a-n*i;return d?(d=1/d,e[0]=a*d,e[1]=-n*d,e[2]=-i*d,e[3]=r*d,e[4]=(i*s-a*o)*d,e[5]=(n*o-r*s)*d,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=n,t.rotate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*f,e[1]=i*u+o*f,e[2]=n*-f+a*u,e[3]=i*-f+o*u,e[4]=s,e[5]=d,e},t.scale=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=r[0],u=r[1];return e[0]=n*f,e[1]=i*f,e[2]=a*u,e[3]=o*u,e[4]=s,e[5]=d,e},t.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=r[0],u=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=n*f+a*u+s,e[5]=i*f+o*u+d,e},t.fromRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],d=e[5],f=t[0],u=t[1],l=t[2],c=t[3],h=t[4],R=t[5];return Math.abs(r-f)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-u)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-l)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-h)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(d-R)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=n,t.sub=i},function(e,t,r){"use strict";function n(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],d=t[5],f=t[6],u=t[7],l=t[8],c=t[9],h=t[10],R=t[11],m=t[12],p=t[13],_=t[14],g=t[15],E=r[0],P=r[1],y=r[2],v=r[3];return e[0]=E*n+P*s+y*l+v*m,e[1]=E*i+P*d+y*c+v*p,e[2]=E*a+P*f+y*h+v*_,e[3]=E*o+P*u+y*R+v*g,E=r[4],P=r[5],y=r[6],v=r[7],e[4]=E*n+P*s+y*l+v*m,e[5]=E*i+P*d+y*c+v*p,e[6]=E*a+P*f+y*h+v*_,e[7]=E*o+P*u+y*R+v*g,E=r[8],P=r[9],y=r[10],v=r[11],e[8]=E*n+P*s+y*l+v*m,e[9]=E*i+P*d+y*c+v*p,e[10]=E*a+P*f+y*h+v*_,e[11]=E*o+P*u+y*R+v*g,E=r[12],P=r[13],y=r[14],v=r[15],e[12]=E*n+P*s+y*l+v*m,e[13]=E*i+P*d+y*c+v*p,e[14]=E*a+P*f+y*h+v*_,e[15]=E*o+P*u+y*R+v*g,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,n,i,o,s,d,f,u,l,c,h,R,m,p){var _=new a.ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=n,_[4]=i,_[5]=o,_[6]=s,_[7]=d,_[8]=f,_[9]=u,_[10]=l,_[11]=c,_[12]=h,_[13]=R,_[14]=m,_[15]=p,_},t.set=function(e,t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=d,e[8]=f,e[9]=u,e[10]=l,e[11]=c,e[12]=h,e[13]=R,e[14]=m,e[15]=p,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],d=t[6],f=t[7],u=t[8],l=t[9],c=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15],g=r*s-n*o,E=r*d-i*o,P=r*f-a*o,y=n*d-i*s,v=n*f-a*s,M=i*f-a*d,T=u*m-l*R,x=u*p-c*R,b=u*_-h*R,L=l*p-c*m,I=l*_-h*m,w=c*_-h*p,D=g*w-E*I+P*L+y*b-v*x+M*T;return D?(D=1/D,e[0]=(s*w-d*I+f*L)*D,e[1]=(i*I-n*w-a*L)*D,e[2]=(m*M-p*v+_*y)*D,e[3]=(c*v-l*M-h*y)*D,e[4]=(d*b-o*w-f*x)*D,e[5]=(r*w-i*b+a*x)*D,e[6]=(p*P-R*M-_*E)*D,e[7]=(u*M-c*P+h*E)*D,e[8]=(o*I-s*b+f*T)*D,e[9]=(n*b-r*I-a*T)*D,e[10]=(R*v-m*P+_*g)*D,e[11]=(l*P-u*v-h*g)*D,e[12]=(s*x-o*L-d*T)*D,e[13]=(r*L-n*x+i*T)*D,e[14]=(m*E-R*y-p*g)*D,e[15]=(u*y-l*E+c*g)*D,e):null},t.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],d=t[6],f=t[7],u=t[8],l=t[9],c=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15];return e[0]=s*(c*_-h*p)-l*(d*_-f*p)+m*(d*h-f*c),e[1]=-(n*(c*_-h*p)-l*(i*_-a*p)+m*(i*h-a*c)),e[2]=n*(d*_-f*p)-s*(i*_-a*p)+m*(i*f-a*d),e[3]=-(n*(d*h-f*c)-s*(i*h-a*c)+l*(i*f-a*d)),e[4]=-(o*(c*_-h*p)-u*(d*_-f*p)+R*(d*h-f*c)),e[5]=r*(c*_-h*p)-u*(i*_-a*p)+R*(i*h-a*c),e[6]=-(r*(d*_-f*p)-o*(i*_-a*p)+R*(i*f-a*d)),e[7]=r*(d*h-f*c)-o*(i*h-a*c)+u*(i*f-a*d),e[8]=o*(l*_-h*m)-u*(s*_-f*m)+R*(s*h-f*l),e[9]=-(r*(l*_-h*m)-u*(n*_-a*m)+R*(n*h-a*l)),e[10]=r*(s*_-f*m)-o*(n*_-a*m)+R*(n*f-a*s),e[11]=-(r*(s*h-f*l)-o*(n*h-a*l)+u*(n*f-a*s)),e[12]=-(o*(l*p-c*m)-u*(s*p-d*m)+R*(s*c-d*l)),e[13]=r*(l*p-c*m)-u*(n*p-i*m)+R*(n*c-i*l),e[14]=-(r*(s*p-d*m)-o*(n*p-i*m)+R*(n*d-i*s)),e[15]=r*(s*c-d*l)-o*(n*c-i*l)+u*(n*d-i*s),e},t.determinant=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],d=e[7],f=e[8],u=e[9],l=e[10],c=e[11],h=e[12],R=e[13],m=e[14],p=e[15];return(t*o-r*a)*(l*p-c*m)-(t*s-n*a)*(u*p-c*R)+(t*d-i*a)*(u*m-l*R)+(r*s-n*o)*(f*p-c*h)-(r*d-i*o)*(f*m-l*h)+(n*d-i*s)*(f*R-u*h)},t.multiply=n,t.translate=function(e,t,r){var n=r[0],i=r[1],a=r[2],o=void 0,s=void 0,d=void 0,f=void 0,u=void 0,l=void 0,c=void 0,h=void 0,R=void 0,m=void 0,p=void 0,_=void 0;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],d=t[2],f=t[3],u=t[4],l=t[5],c=t[6],h=t[7],R=t[8],m=t[9],p=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=d,e[3]=f,e[4]=u,e[5]=l,e[6]=c,e[7]=h,e[8]=R,e[9]=m,e[10]=p,e[11]=_,e[12]=o*n+u*i+R*a+t[12],e[13]=s*n+l*i+m*a+t[13],e[14]=d*n+c*i+p*a+t[14],e[15]=f*n+h*i+_*a+t[15]),e},t.scale=function(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,n){var i=n[0],o=n[1],s=n[2],d=Math.sqrt(i*i+o*o+s*s),f=void 0,u=void 0,l=void 0,c=void 0,h=void 0,R=void 0,m=void 0,p=void 0,_=void 0,g=void 0,E=void 0,P=void 0,y=void 0,v=void 0,M=void 0,T=void 0,x=void 0,b=void 0,L=void 0,I=void 0,w=void 0,D=void 0,U=void 0,B=void 0;return Math.abs(d)<a.EPSILON?null:(i*=d=1/d,o*=d,s*=d,f=Math.sin(r),l=1-(u=Math.cos(r)),c=t[0],h=t[1],R=t[2],m=t[3],p=t[4],_=t[5],g=t[6],E=t[7],P=t[8],y=t[9],v=t[10],M=t[11],T=i*i*l+u,x=o*i*l+s*f,b=s*i*l-o*f,L=i*o*l-s*f,I=o*o*l+u,w=s*o*l+i*f,D=i*s*l+o*f,U=o*s*l-i*f,B=s*s*l+u,e[0]=c*T+p*x+P*b,e[1]=h*T+_*x+y*b,e[2]=R*T+g*x+v*b,e[3]=m*T+E*x+M*b,e[4]=c*L+p*I+P*w,e[5]=h*L+_*I+y*w,e[6]=R*L+g*I+v*w,e[7]=m*L+E*I+M*w,e[8]=c*D+p*U+P*B,e[9]=h*D+_*U+y*B,e[10]=R*D+g*U+v*B,e[11]=m*D+E*U+M*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],d=t[7],f=t[8],u=t[9],l=t[10],c=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+f*n,e[5]=o*i+u*n,e[6]=s*i+l*n,e[7]=d*i+c*n,e[8]=f*i-a*n,e[9]=u*i-o*n,e[10]=l*i-s*n,e[11]=c*i-d*n,e},t.rotateY=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],d=t[3],f=t[8],u=t[9],l=t[10],c=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-f*n,e[1]=o*i-u*n,e[2]=s*i-l*n,e[3]=d*i-c*n,e[8]=a*n+f*i,e[9]=o*n+u*i,e[10]=s*n+l*i,e[11]=d*n+c*i,e},t.rotateZ=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],d=t[3],f=t[4],u=t[5],l=t[6],c=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+f*n,e[1]=o*i+u*n,e[2]=s*i+l*n,e[3]=d*i+c*n,e[4]=f*i-a*n,e[5]=u*i-o*n,e[6]=l*i-s*n,e[7]=c*i-d*n,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){var n=r[0],i=r[1],o=r[2],s=Math.sqrt(n*n+i*i+o*o),d=void 0,f=void 0,u=void 0;return Math.abs(s)<a.EPSILON?null:(n*=s=1/s,i*=s,o*=s,d=Math.sin(t),u=1-(f=Math.cos(t)),e[0]=n*n*u+f,e[1]=i*n*u+o*d,e[2]=o*n*u-i*d,e[3]=0,e[4]=n*i*u-o*d,e[5]=i*i*u+f,e[6]=o*i*u+n*d,e[7]=0,e[8]=n*o*u+i*d,e[9]=i*o*u-n*d,e[10]=o*o*u+f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=n+n,d=i+i,f=a+a,u=n*s,l=n*d,c=n*f,h=i*d,R=i*f,m=a*f,p=o*s,_=o*d,g=o*f;return e[0]=1-(h+m),e[1]=l+g,e[2]=c-_,e[3]=0,e[4]=l-g,e[5]=1-(u+m),e[6]=R+p,e[7]=0,e[8]=c+_,e[9]=R-p,e[10]=1-(u+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],o=t[5],s=t[6],d=t[8],f=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(d*d+f*f+u*u),e},t.getRotation=function(e,t){var r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e},t.fromRotationTranslationScale=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],d=i+i,f=a+a,u=o+o,l=i*d,c=i*f,h=i*u,R=a*f,m=a*u,p=o*u,_=s*d,g=s*f,E=s*u,P=n[0],y=n[1],v=n[2];return e[0]=(1-(R+p))*P,e[1]=(c+E)*P,e[2]=(h-g)*P,e[3]=0,e[4]=(c-E)*y,e[5]=(1-(l+p))*y,e[6]=(m+_)*y,e[7]=0,e[8]=(h+g)*v,e[9]=(m-_)*v,e[10]=(1-(l+R))*v,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,n,i){var a=t[0],o=t[1],s=t[2],d=t[3],f=a+a,u=o+o,l=s+s,c=a*f,h=a*u,R=a*l,m=o*u,p=o*l,_=s*l,g=d*f,E=d*u,P=d*l,y=n[0],v=n[1],M=n[2],T=i[0],x=i[1],b=i[2];return e[0]=(1-(m+_))*y,e[1]=(h+P)*y,e[2]=(R-E)*y,e[3]=0,e[4]=(h-P)*v,e[5]=(1-(c+_))*v,e[6]=(p+g)*v,e[7]=0,e[8]=(R+E)*M,e[9]=(p-g)*M,e[10]=(1-(c+m))*M,e[11]=0,e[12]=r[0]+T-(e[0]*T+e[4]*x+e[8]*b),e[13]=r[1]+x-(e[1]*T+e[5]*x+e[9]*b),e[14]=r[2]+b-(e[2]*T+e[6]*x+e[10]*b),e[15]=1,e},t.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,d=i+i,f=r*o,u=n*o,l=n*s,c=i*o,h=i*s,R=i*d,m=a*o,p=a*s,_=a*d;return e[0]=1-l-R,e[1]=u+_,e[2]=c-p,e[3]=0,e[4]=u-_,e[5]=1-f-R,e[6]=h+m,e[7]=0,e[8]=c+p,e[9]=h-m,e[10]=1-f-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,n,i,a,o){var s=1/(r-t),d=1/(i-n),f=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*d,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*d,e[10]=(o+a)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*f,e[15]=0,e},t.perspective=function(e,t,r,n,i){var a=1/Math.tan(t/2),o=1/(n-i);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+n)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*n*o,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),d=2/(o+s),f=2/(i+a);return e[0]=d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=-(o-s)*d*.5,e[9]=(i-a)*f*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},t.ortho=function(e,t,r,n,i,a,o){var s=1/(t-r),d=1/(n-i),f=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*d,e[14]=(o+a)*f,e[15]=1,e},t.lookAt=function(e,t,r,n){var i=void 0,o=void 0,s=void 0,d=void 0,f=void 0,u=void 0,l=void 0,c=void 0,h=void 0,R=void 0,m=t[0],p=t[1],_=t[2],g=n[0],E=n[1],P=n[2],y=r[0],v=r[1],M=r[2];return Math.abs(m-y)<a.EPSILON&&Math.abs(p-v)<a.EPSILON&&Math.abs(_-M)<a.EPSILON?mat4.identity(e):(l=m-y,c=p-v,h=_-M,i=E*(h*=R=1/Math.sqrt(l*l+c*c+h*h))-P*(c*=R),o=P*(l*=R)-g*h,s=g*c-E*l,(R=Math.sqrt(i*i+o*o+s*s))?(i*=R=1/R,o*=R,s*=R):(i=0,o=0,s=0),d=c*s-h*o,f=h*i-l*s,u=l*o-c*i,(R=Math.sqrt(d*d+f*f+u*u))?(d*=R=1/R,f*=R,u*=R):(d=0,f=0,u=0),e[0]=i,e[1]=d,e[2]=l,e[3]=0,e[4]=o,e[5]=f,e[6]=c,e[7]=0,e[8]=s,e[9]=u,e[10]=h,e[11]=0,e[12]=-(i*m+o*p+s*_),e[13]=-(d*m+f*p+u*_),e[14]=-(l*m+c*p+h*_),e[15]=1,e)},t.targetTo=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=n[0],d=n[1],f=n[2],u=i-r[0],l=a-r[1],c=o-r[2],h=u*u+l*l+c*c;h>0&&(u*=h=1/Math.sqrt(h),l*=h,c*=h);var R=d*c-f*l,m=f*u-s*c,p=s*l-d*u;return e[0]=R,e[1]=m,e[2]=p,e[3]=0,e[4]=l*p-c*m,e[5]=c*R-u*p,e[6]=u*m-l*R,e[7]=0,e[8]=u,e[9]=l,e[10]=c,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],d=e[5],f=e[6],u=e[7],l=e[8],c=e[9],h=e[10],R=e[11],m=e[12],p=e[13],_=e[14],g=e[15],E=t[0],P=t[1],y=t[2],v=t[3],M=t[4],T=t[5],x=t[6],b=t[7],L=t[8],I=t[9],w=t[10],D=t[11],U=t[12],B=t[13],S=t[14],G=t[15];return Math.abs(r-E)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(n-P)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(i-y)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-v)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-M)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(d-T)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(f-x)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(u-b)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(l-L)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-I)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(h-w)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(R-D)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(D))&&Math.abs(m-U)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(p-B)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(_-S)<=a.EPSILON*Math.max(1,Math.abs(_),Math.abs(S))&&Math.abs(g-G)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(G))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=n,t.sub=i},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(){var e=new f.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function o(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],d=r[1],f=r[2],u=r[3];return e[0]=n*u+o*s+i*f-a*d,e[1]=i*u+o*d+a*s-n*f,e[2]=a*u+o*f+n*d-i*s,e[3]=o*u-n*s-i*d-a*f,e}function s(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],d=r[0],f=r[1],u=r[2],l=r[3],c=void 0,h=void 0,R=void 0,m=void 0,p=void 0;return(h=i*d+a*f+o*u+s*l)<0&&(h=-h,d=-d,f=-f,u=-u,l=-l),1-h>1e-6?(c=Math.acos(h),R=Math.sin(c),m=Math.sin((1-n)*c)/R,p=Math.sin(n*c)/R):(m=1-n,p=n),e[0]=m*i+p*d,e[1]=m*a+p*f,e[2]=m*o+p*u,e[3]=m*s+p*l,e}function d(e,t){var r=t[0]+t[4]+t[8],n=void 0;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+i]+t[3*i+a])*n,e[o]=(t[3*o+i]+t[3*i+o])*n}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=i,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=a,t.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return 0!=n?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=o,t.rotateX=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=n*d+o*s,e[1]=i*d+a*s,e[2]=a*d-i*s,e[3]=o*d-n*s,e},t.rotateY=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=n*d-a*s,e[1]=i*d+o*s,e[2]=a*d+n*s,e[3]=o*d-i*s,e},t.rotateZ=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=n*d+i*s,e[1]=i*d-n*s,e[2]=a*d+o*s,e[3]=o*d-a*s,e},t.calculateW=function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},t.slerp=s,t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=d,t.fromEuler=function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),d=Math.cos(r),f=Math.sin(n),u=Math.cos(n);return e[0]=a*d*u-o*s*f,e[1]=o*s*u+a*d*f,e[2]=o*d*f-a*s*u,e[3]=o*d*u+a*s*f,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var f=n(r(0)),u=n(r(1)),l=n(r(2)),c=n(r(3)),h=(t.clone=c.clone,t.fromValues=c.fromValues,t.copy=c.copy,t.set=c.set,t.add=c.add,t.mul=o,t.scale=c.scale,t.dot=c.dot,t.lerp=c.lerp,t.length=c.length),R=(t.len=h,t.squaredLength=c.squaredLength),m=(t.sqrLen=R,t.normalize=c.normalize);t.exactEquals=c.exactEquals,t.equals=c.equals,t.rotationTo=function(){var e=l.create(),t=l.fromValues(1,0,0),r=l.fromValues(0,1,0);return function(n,i,o){var s=l.dot(i,o);return s<-.999999?(l.cross(e,t,i),l.len(e)<1e-6&&l.cross(e,r,i),l.normalize(e,e),a(n,e,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(l.cross(e,i,o),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+s,m(n,n))}}(),t.sqlerp=function(){var e=i(),t=i();return function(r,n,i,a,o,d){return s(e,n,o,d),s(t,i,a,d),s(r,e,t,2*d*(1-d)),r}}(),t.setAxes=function(){var e=u.create();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],m(t,d(t,e))}}()},function(e,t,r){"use strict";function n(){var e=new l.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function s(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function d(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function f(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function u(e){var t=e[0],r=e[1];return t*t+r*r}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.sqrDist=t.dist=t.div=t.mul=t.sub=t.len=void 0,t.create=n,t.clone=function(e){var t=new l.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){var r=new l.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=i,t.multiply=a,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},t.distance=s,t.squaredDistance=d,t.length=f,t.squaredLength=u,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},t.lerp=function(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*l.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},t.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},t.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))};var l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.len=f,t.sub=i,t.mul=a,t.div=o,t.dist=s,t.sqrDist=d,t.sqrLen=u,t.forEach=function(){var e=n();return function(t,r,n,i,a,o){var s,d=void 0;for(r||(r=2),n||(n=0),s=i?Math.min(i*r+n,t.length):t.length,d=n;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],a(e,e,o),t[d]=e[0],t[d+1]=e[1];return t}}()}])}),function(){var e;e=function(e,t,r,n,i){var a,o;switch(e.hasOwnProperty(r)&&RedGLUtil.throwFunc(t+" - "+r+" : 이미 정의된 속성"),n){case"hex":a={get:function(){return this["_"+r]},set:function(e){"string"==typeof e||RedGLUtil.throwFunc(t+" - "+r+" 문자열만 허용함","입력값 : "+e),RedGLUtil.regHex(e)||RedGLUtil.throwFunc(t+" - "+r+" : hex 형식만 허용함."+e),this["_"+r]=e,i&&i.callback&&i.callback.call(this,e)}};break;case"boolean":i=null==i||i,a={get:function(){return this["_"+r]},set:function(e){"boolean"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : boolean만 허용함."+e),this["_"+r]=e,i&&i.callback&&i.callback.call(this,e)}};break;case"number":if(i){var s=i.min,d=i.max;i.hasOwnProperty("min")&&i.hasOwnProperty("max")?a={get:function(){return this["_"+r]},set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : 숫자만 허용함.","입력값 : "+e),e<s&&(e=s),e>d&&(e=d),this["_"+r]=e,i&&i.callback&&i.callback.call(this,e)}}:i.hasOwnProperty("min")?a={get:function(){return this["_"+r]},set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : 숫자만 허용함.","입력값 : "+e),e<s&&(e=s),this["_"+r]=e,i&&i.callback&&i.callback.call(this,e)}}:i.hasOwnProperty("max")&&(a={get:function(){return this["_"+r]},set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : 숫자만 허용함.","입력값 : "+e),e>d&&(e=d),this["_"+r]=e,i&&i.callback&&i.callback.call(this,e)}})}else a={get:function(){return this["_"+r]},set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : 숫자만 허용함.","입력값 : "+e),this["_"+r]=e}};break;case"sampler2D":o="RedBaseTexture";break;case"samplerCube":o="RedBitmapCubeTexture";break;case"samplerVideo":o="RedVideoTexture";break;default:RedGLUtil.throwFunc(r+" - type : "+n+" / "+r+" : 정의할수없는 타입입니다.")}if(o){var f=window[o];a=i&&i.essential?{get:function(){return this["_"+r]},set:function(e){f==RedBitmapCubeTexture?e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e):!(e instanceof RedBitmapCubeTexture)&&e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e),this["_"+r]=e,i&&i.callback&&i.callback.call(this)}}:{get:function(){return this["_"+r]},set:function(e){e&&(f==RedBitmapCubeTexture?e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e):!(e instanceof RedBitmapCubeTexture)&&e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e)),this["_"+r]=e,i&&i.callback&&i.callback.call(this)}}}e["_"+r]=null,Object.defineProperty(e,r,a)},(RedDefinePropertyInfo={}).definePrototype=function(t,r,n,i){e(window[t].prototype,t,r,n,i)},Object.freeze(RedDefinePropertyInfo)}(),(RedGLDetect=function(e){if(!(this instanceof RedGLDetect))return new RedGLDetect(e);var t,r,n,i,a,o=this,s=e.gl;for(n in t={basic:["VENDOR","VERSION","SHADING_LANGUAGE_VERSION","RENDERER"],frameBuffer:["MAX_RENDERBUFFER_SIZE","MAX_VIEWPORT_DIMS","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],vertexShader:["MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_VERTEX_UNIFORM_VECTORS"],fragmentShader:["MAX_FRAGMENT_UNIFORM_VECTORS"],texture:["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS"]})for(r=(a=t[n]).length,this[n]={};r--;)this[n][i=a[r]]=s.getParameter(s[i]);this.BROWSER_INFO=RedGLDetect.getBrowserInfo(),requestAnimationFrame(function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=10,t.height=20,r.fillStyle="red",r.fillRect(0,0,10,10),r.fillStyle="blue",r.fillRect(0,10,10,10),t.style.cssText="position:fixed;top:0px;left:0px";var n=RedBitmapTexture(e,t),i=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,i),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n.webglTexture,0);var a=new Uint8Array(4);s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,a),s.bindFramebuffer(s.FRAMEBUFFER,null),o.ableCanvasSourceFlipYonTexture=255==a[0],o.BROWSER_INFO.ableCanvasSourceFlipYonTexture=255==a[0]})}).BROWSER_INFO={},RedGLDetect.getBrowserInfo=function(){var e,t,r,n,i,a=RedGLDetect.BROWSER_INFO,o=window.navigator,s=o.userAgent.toLowerCase(),d=o.platform.toLowerCase(),f=o.appVersion.toLowerCase(),u="pc",l=0,c=function(){return s.indexOf("whale")<0?0:(t=parseFloat(/whale\/([\d]+)/.exec(s)[1]),e="whale")},h=function(){if(!(s.indexOf(i="chrome")<0&&s.indexOf(i="crios")<0))return e="chrome",t=parseFloat(("chrome"==i?/chrome\/([\d]+)/:/crios\/([\d]+)/).exec(s)[1])},R=function(){return s.indexOf("firefox")<0?0:(e="firefox",t=parseFloat(/firefox\/([\d]+)/.exec(s)[1]))},m=function(){return s.indexOf("safari")<0?0:(e="safari",t=parseFloat(/safari\/([\d]+)/.exec(s)[1]))},p=function(){var r;return s.indexOf(r="opera")<0&&s.indexOf(r="opr")<0?0:(e="opera",t="opera"==r?parseFloat(/version\/([\d]+)/.exec(s)[1]):parseFloat(/opr\/([\d]+)/.exec(s)[1]))},_=function(){return s.indexOf("naver")<0?0:e="naver"};if(a||(a={}),s.indexOf("android")>-1)e=r="android",u=-1==s.indexOf("mobile")?(e+="Tablet","tablet"):"mobile",n=(i=/android ([\d.]+)/.exec(s))?(i=i[1].split("."),parseFloat(i[0]+"."+i[1])):0,l=1,c()||_()||p()||h()||R()||(t=i=/safari\/([\d.]+)/.exec(s)?parseFloat(i[1]):0);else if(s.indexOf(i="ipad")>-1||s.indexOf(i="iphone")>-1)u="ipad"==i?"tablet":"mobile",e=r=i,n=(i=/os ([\d_]+)/.exec(s))?(i=i[1].split("_"),parseFloat(i[0]+"."+i[1])):0,l=1,c()||_()||p()||h()||R()||(t=(i=/mobile\/([\S]+)/.exec(s))?parseFloat(i[1]):0);else if(d.indexOf("win")>-1){for(i in g={5.1:"xp","6.0":"vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"})if(s.indexOf("windows nt "+i)>-1){n=g[i];break}r="win",(s.indexOf("edge")>-1?(s.indexOf("iemobile")>-1&&(r="winMobile"),e="edge",t=/edge\/([\d]+)/.exec(s)[1]):s.indexOf("msie")<0&&s.indexOf("trident")<0?void 0:(s.indexOf("iemobile")>-1&&(r="winMobile"),e="ie",t=s.indexOf("msie 7")>-1&&s.indexOf("trident")>-1?-1:s.indexOf("msie")<0?11:parseFloat(/msie ([\d]+)/.exec(s)[1])))||c()||p()||h()||R()||m()}else d.indexOf("mac")>-1?(r="mac",i=/os x ([\d._]+)/.exec(s)[1].replace("_",".").split("."),n=parseFloat(i[0]+"."+i[1]),c()||p()||h()||R()||m()):(r=f.indexOf("x11")>-1?"unix":f.indexOf("linux")>-1?"linux":0,c()||h()||R());for(i in g={device:u,isMobile:l,browser:e,browserVer:t,os:r,osVer:n,down:l?"touchstart":"mousedown",move:l?"touchmove":"mousemove",up:l?"touchend":"mouseup",click:"click",over:"mouseover",out:"mouseout"})g.hasOwnProperty(i)&&(a[i]=g[i]);if(window.OffscreenCanvas){var g=new window.OffscreenCanvas(2,2);try{g.getContext("2d")}catch(e){window.OffscreenCanvas=null}}return a},Object.freeze(RedGLDetect),function(){var e,t,r,n,i,a;RedGLUtil={throwFunc:function(){throw"RedGL Error : "+Array.prototype.slice.call(arguments).join(" ")},hexToRGB_ZeroToOne:function(e){var t,r;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return r=[],3==(t=e.substring(1).split("")).length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),t="0x"+t.join(""),r[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,r;RedGLUtil.throwFunc("RedGLUtil.hexToRGB_ZeroToOne : 잘못된 hex값입니다.",e)},rgb2hex:function(e,t,r){return"#"+(16777216+(r|t<<8|e<<16)).toString(16).slice(1)},regHex:(a=/^#(?:[0-9a-fA-F]{3}){1,2}$/,function(e){return a.test(e)}),getStrFromComment:function(e){if("string"!=typeof e&&RedGLUtil.throwFunc("getStrFromComment : 해석할 값은 문자열만 가능",e),i=e.replace("@preserve","").toString().trim().match(/(\/\*)[\s\S]+(\*\/)/g))return i[0].replace(/\/\*|\*\//g,"").trim();RedGLUtil.throwFunc("getStrFromComment : 해석할 불가능한 값",e)},isPowerOf2:function(e){return 0==(e&e-1)},nextHighestPowerOfTwo:function(e){for(--e,n=1;n<32;n<<=1)e|=e>>n;return e+1},makePowerOf2Source:function(n,i,a){if(r=a,RedGLUtil.isPowerOf2(i.width)&&RedGLUtil.isPowerOf2(i.height))return i;e=RedGLUtil.nextHighestPowerOfTwo(i.width),t=RedGLUtil.nextHighestPowerOfTwo(i.height),e>r&&(e=r),t>r&&(t=r);var o=window.OffscreenCanvas?new OffscreenCanvas(e,t):document.createElement("canvas"),s=o.getContext("2d");return window.OffscreenCanvas||(o.width=e,o.height=t),s.drawImage(i,0,0,e,t),window.OffscreenCanvas?o.transferToImageBitmap():o},calculateNormals:function(e,t){var r,n,i=[];for(r=0;r<e.length;r+=3)i[r+0]=0,i[r+1]=0,i[r+2]=0;for(r=0;r<t.length;r+=3){var a,o,s,d,f=[],u=[],l=[];for(a=3*t[r],o=3*t[r+1],s=3*t[r+2],f[0]=e[s+0]-e[o+0],f[1]=e[s+1]-e[o+1],f[2]=e[s+2]-e[o+2],u[0]=e[a+0]-e[o+0],u[1]=e[a+1]-e[o+1],u[2]=e[a+2]-e[o+2],l[0]=f[1]*u[2]-f[2]*u[1],l[1]=f[2]*u[0]-f[0]*u[2],l[2]=f[0]*u[1]-f[1]*u[0],n=0;n<3;n++)i[(d=3*t[r+n])+0]=i[d+0]+l[0],i[d+1]=i[d+1]+l[1],i[d+2]=i[d+2]+l[2]}for(r=0;r<e.length;r+=3){var c=[];c[0]=i[r+0],c[1]=i[r+1],c[2]=i[r+2];var h=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);0==h&&(h=1),c[0]=c[0]/h,c[1]=c[1]/h,c[2]=c[2]/h,i[r+0]=c[0],i[r+1]=c[1],i[r+2]=c[2]}return i},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},quaternionToRotationMat4:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,d=i+i,f=r*o,u=r*s,l=r*d,c=n*s,h=n*d,R=i*d,m=a*o,p=a*s,_=a*d;return t[0]=1-(c+R),t[4]=u-_,t[8]=l+p,t[1]=u+_,t[5]=1-(f+R),t[9]=h-m,t[2]=l-p,t[6]=h+m,t[10]=1-(f+c),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},quaternionToRotation:function(e,t){var r=[],n=e[0],i=e[1],a=e[2],o=e[3],s=n+n,d=i+i,f=a+a,u=n*s,l=n*d,c=n*f,h=i*d,R=i*f,m=a*f,p=o*s,_=o*d,g=o*f;r[0]=1-(h+m),r[4]=l-g,r[8]=c+_,r[1]=l+g,r[5]=1-(u+m),r[9]=R-p,r[2]=c-_,r[6]=R+p,r[10]=1-(u+h),r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1;var E=[0,0,0];t=t||"XYZ";var P=r[0],y=r[4],v=r[8],M=r[1],T=r[5],x=r[9],b=r[2],L=r[6],I=r[10];return"XYZ"===t?(E[1]=Math.asin(RedGLUtil.clamp(v,-1,1)),Math.abs(v)<.99999?(E[0]=Math.atan2(-x,I),E[2]=Math.atan2(-y,P)):(E[0]=Math.atan2(L,T),E[2]=0)):"YXZ"===t?(E[0]=Math.asin(-RedGLUtil.clamp(x,-1,1)),Math.abs(x)<.99999?(E[1]=Math.atan2(v,I),E[2]=Math.atan2(M,T)):(E[1]=Math.atan2(-b,P),E[2]=0)):"ZXY"===t?(E[0]=Math.asin(RedGLUtil.clamp(L,-1,1)),Math.abs(L)<.99999?(E[1]=Math.atan2(-b,I),E[2]=Math.atan2(-y,T)):(E[1]=0,E[2]=Math.atan2(M,P))):"ZYX"===t?(E[1]=Math.asin(-RedGLUtil.clamp(b,-1,1)),Math.abs(b)<.99999?(E[0]=Math.atan2(L,I),E[2]=Math.atan2(M,P)):(E[0]=0,E[2]=Math.atan2(-y,T))):"YZX"===t?(E[2]=Math.asin(RedGLUtil.clamp(M,-1,1)),Math.abs(M)<.99999?(E[0]=Math.atan2(-x,T),E[1]=Math.atan2(-b,P)):(E[0]=0,E[1]=Math.atan2(v,I))):"XZY"===t&&(E[2]=Math.asin(-RedGLUtil.clamp(y,-1,1)),Math.abs(y)<.99999?(E[0]=Math.atan2(L,T),E[1]=Math.atan2(v,P)):(E[0]=Math.atan2(-x,I),E[1]=0)),E},mat4ToEuler:function(e,t,r){t=t||[0,0,0],r=r||"XYZ";var n=e[0],i=e[4],a=e[8],o=e[1],s=e[5],d=e[9],f=e[2],u=e[6],l=e[10];return"XYZ"===r?(t[1]=Math.asin(RedGLUtil.clamp(a,-1,1)),Math.abs(a)<.99999?(t[0]=Math.atan2(-d,l),t[2]=Math.atan2(-i,n)):(t[0]=Math.atan2(u,s),t[2]=0)):"YXZ"===r?(t[0]=Math.asin(-RedGLUtil.clamp(d,-1,1)),Math.abs(d)<.99999?(t[1]=Math.atan2(a,l),t[2]=Math.atan2(o,s)):(t[1]=Math.atan2(-f,n),t[2]=0)):"ZXY"===r?(t[0]=Math.asin(RedGLUtil.clamp(u,-1,1)),Math.abs(u)<.99999?(t[1]=Math.atan2(-f,l),t[2]=Math.atan2(-i,s)):(t[1]=0,t[2]=Math.atan2(o,n))):"ZYX"===r?(t[1]=Math.asin(-RedGLUtil.clamp(f,-1,1)),Math.abs(f)<.99999?(t[0]=Math.atan2(u,l),t[2]=Math.atan2(o,n)):(t[0]=0,t[2]=Math.atan2(-i,s))):"YZX"===r?(t[2]=Math.asin(RedGLUtil.clamp(o,-1,1)),Math.abs(o)<.99999?(t[0]=Math.atan2(-d,s),t[1]=Math.atan2(-f,n)):(t[0]=0,t[1]=Math.atan2(a,l))):"XZY"===r&&(t[2]=Math.asin(-RedGLUtil.clamp(i,-1,1)),Math.abs(i)<.99999?(t[0]=Math.atan2(u,s),t[1]=Math.atan2(a,n)):(t[0]=Math.atan2(-d,l),t[1]=0)),t}},Object.freeze(RedGLUtil)}(),function(){var e,t,r,n,i,a,o,s,d,f,u,l,c=[];window.addEventListener("resize",function(){c.forEach(function(e){e.setSize(e._width,e._height)})}),a={alpha:!1,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1},u=["OES_element_index_uint","OES_standard_derivatives","EXT_texture_filter_anisotropic","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info"],n="webkit-3d,moz-webgl,3d,experimental-webgl,webgl".split(","),i=[],e=function(e,t,r){if(f=JSON.parse(JSON.stringify(a)),t)for(d in t)f[d]=t[d];for(r?(i.length=0,i.push(r)):i=n.concat(),d=i.length;d--;)if(o=e.getContext(s=i[d],f))return o.glExtension={},u.forEach(function(e){o.glExtension[e]=o.getExtension(e),o.glExtension[e]&&"WEBGL_debug_renderer_info"==e&&(o.vendor=o.getParameter(o.glExtension[e].UNMASKED_VENDOR_WEBGL),o.renderer=o.getParameter(o.glExtension[e].UNMASKED_RENDERER_WEBGL))}),o.version=s,o;return null},t=function(e,t){var r,n,i,a;for(r=e.detect.texture.MAX_COMBINED_TEXTURE_IMAGE_UNITS,a=RedBaseTexture.EMPTY_BASE64,n=RedBitmapTexture(e,a),i=RedBitmapCubeTexture(e,[a,a,a,a,a,a]),e._datas.emptyTexture={"2d":n,"3d":i};r--;)1==r?(t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_CUBE_MAP,i.webglTexture)):(t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,n.webglTexture))},(RedGL=function(n,i,a,o){return this instanceof RedGL?("CANVAS"==n.tagName||RedGLUtil.throwFunc("RedGL : Canvas Element만 허용"),d=this,this._datas={},this._width="100%",this._height="100%",this._renderScale=1,this._viewRect=[0,0,0,0],this._canvas=n,this.gl=s=e(n,a,o),s?(this.detect=RedGLDetect(this),this._UUID=RedGL.makeUUID(),this.setSize=(p=new Uint32Array(2),_=new Uint32Array(2),l=0,h=0,function(e,t,r){null==e&&RedGLUtil.throwFunc("RedGL setSize : width가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedGL setSize : height가 입력되지 않았습니다."),f=this._width=e,u=this._height=t,window.HTMLCanvasElement?("number"!=typeof f&&(f.indexOf("%")>-1?f=(document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)*parseFloat(f)/100:RedGLUtil.throwFunc("RedGL setSize : width는 0이상의 숫자나 %만 허용.",f)),"number"!=typeof u&&(u.indexOf("%")>-1?u=window.innerHeight*parseFloat(u)/100:RedGLUtil.throwFunc("RedGL setSize : height는 0이상의 숫자나 %만 허용.",u)),R=window.devicePixelRatio||1,m=this._canvas,(l!=f||h!=u||r)&&(m.width=f*R*this._renderScale,m.height=u*R*this._renderScale,m.style.width=f+"px",m.style.height=u+"px",l=f,h=u),this._viewRect[2]=l,this._viewRect[3]=h):(f=this._width=e,u=this._height=t,p[0]=f*this._renderScale,_[0]=u*this._renderScale,this._viewRect[2]=f,this._viewRect[3]=u)}),RedSystemShaderCode.init&&RedSystemShaderCode.init(d),t(d,s),c.push(d),void requestAnimationFrame(function(){r||(RedPBRMaterial_System(d),RedStandardMaterial(d,d._datas.emptyTexture["2d"]),RedEnvironmentMaterial(d,null,d._datas.emptyTexture["3d"])),d._mouseEventInfo={type:null,x:0,y:0},[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up].forEach(function(e){d._canvas.addEventListener(e,function(e){e.preventDefault(),RedGLDetect.BROWSER_INFO.isMobile?e.changedTouches[0]&&(d._mouseEventInfo={type:e.type,x:e.changedTouches[0].clientX*window.devicePixelRatio,y:e.changedTouches[0].clientY*window.devicePixelRatio}):d._mouseEventInfo={type:e.type,x:e.x,y:e.y}},!1)}),d.setSize(d._width,d._height),i&&i.call(d,!!s)})):i?i.call(d,!!s):0):new RedGL(n,i,a,o);var s,d,f,u,l,h,R,m,p,_}).makeUUID=(l=0,function(){return l++}),RedGL.prototype={},RedDefinePropertyInfo.definePrototype("RedGL","renderScale","number",{min:.1,max:1,callback:function(){this.setSize(this._width,this._height,!0)}}),RedGL.setDoNotPrepareProgram=function(){r=!0},Object.freeze(RedGL)}(),(RedBaseController=function(){}).prototype={update:function(){RedGLUtil.throwFunc("RedBaseController : update - 재정의 해서 써라")}},Object.freeze(RedBaseController),function(){var e=function(e,t){return createImageBitmap(e,t||{imageOrientation:"none"})};RedImageLoader=function(t,r,n,i){var a,o,s,d,f=this;if(!(this instanceof RedImageLoader))return new RedImageLoader(t,r,n,i);("string"!=typeof t&&RedGLUtil.throwFunc("RedImageLoader : src는 문자열 만 허용.","입력값 : "+t),f._src=t,f._onLoad=r,f._onError=n,window&&window.document)?(d=function(e){e.removeEventListener("error",s),e.removeEventListener("load",o)},s=function(e){d(this),f._onError&&f._onError(e)},o=function(e){d(this),f.source=a,f._onLoad&&f._onLoad(e)},(a=new Image).crossOrigin="anonymous",a.src=t,a.addEventListener("error",s),a.addEventListener("load",o)):2==t.split(",").length&&"data:"==t.substr(0,5)?e(function(e,t){t=t||"";for(var r=atob(e),n=r.length,i=Math.ceil(n/1024),a=new Array(i),o=0;o<i;++o){for(var s=1024*o,d=Math.min(s+1024,n),f=new Array(d-s),u=s,l=0;u<d;++l,++u)f[l]=r[u].charCodeAt(0);a[o]=new Uint8Array(f)}return new Blob(a,{type:t})}(t.split(",")[1],"image/png"),i||{}).then(function(e){e.src=t,f.source=e,f._onLoad&&(f._onLoad(e),f._onLoad=void 0,f._onError=void 0)}):function(t,r,n,i){var a=this,o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="blob",o.onreadystatechange=function(r){4==o.readyState&&(200===o.status?e(o.response,i||{imageOrientation:"none"}).then(function(e){e.src=t,a.source=e,a._onLoad&&(a._onLoad(o),a._onLoad=void 0,a._onError=void 0)}).catch(function(e){a._onError&&(a._onError(o),a._onLoad=void 0,a._onError=void 0)}):a._onError&&(a._onError(o),a._onLoad=void 0,a._onError=void 0))},o.send()}.apply(f,[f._src,r,n,i])},Object.freeze(RedImageLoader)}(),function(){var e;(RedBaseTexture=function(){}).EMPTY_BASE64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIFdpbmRvd3MiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzMxRDhBQzRFNUZFMTFFN0IxMDVGNEEzQjQ0RjAwRDIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzMxRDhBQzVFNUZFMTFFN0IxMDVGNEEzQjQ0RjAwRDIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3MzFEOEFDMkU1RkUxMUU3QjEwNUY0QTNCNDRGMDBEMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3MzFEOEFDM0U1RkUxMUU3QjEwNUY0QTNCNDRGMDBEMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuojYFUAAAAQSURBVHjaYvj//z8DQIABAAj8Av7bok0WAAAAAElFTkSuQmCC",RedImageLoader(RedBaseTexture.EMPTY_BASE64),RedBaseTexture.prototype={setEmptyTexture:(e=new Uint8Array([0,0,0,0]),function(t,r){this instanceof RedBitmapCubeTexture?(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,r),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_CUBE_MAP,null)):(t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8Array([128,64,0,192])),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.generateMipmap(t.TEXTURE_2D),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_2D,null))})},RedBaseTexture.prototype._load=function(){RedGLUtil.throwFunc("RedBaseTexture - _load : 반드시 재정의해야함")},RedBaseTexture.prototype.src=function(){RedGLUtil.throwFunc("RedBaseTexture - src : 반드시 재정의해야함")},RedBaseTexture.prototype.dispose=function(){this.webglTexture&&this._src!=RedBaseTexture.EMPTY_BASE64&&(this.webglTexture.gl.deleteTexture(this.webglTexture),this.webglTexture=null)},Object.defineProperty(RedBaseTexture.prototype,"callback",{get:function(){return this._callback},set:function(e){e&&"function"!=typeof e&&RedGLUtil.throwFunc("RedBaseTexture : callback은 함수만 허용.","입력값 :",e),this._callback=e}}),Object.freeze(RedBaseTexture)}(),function(){var e,t,r,n,i,a;(RedBaseObject3D=function(){}).build=function(e){this.name="object3D_"+(RedGL.makeUUID()+1),this.useTransparentSort=!1,this.useCullFace=!0,this.cullFace=e.BACK,this.useDepthMask=!0,this.useDepthTest=!0,this.depthTestFunc=e.LEQUAL,this.useBlendMode=!0,this.blendSrc=e.SRC_ALPHA,this.blendDst=e.ONE_MINUS_SRC_ALPHA,this.drawMode=e.TRIANGLES,this.pointSize=1,this.x=this.y=this.z=0,this.rotationX=this.rotationY=this.rotationZ=0,this.scaleX=this.scaleY=this.scaleZ=1,this.autoUpdateMatrix=!0,this._renderAutoUpdateMatrix=!0,this.matrix=mat4.create(),this.cachedMatrix=mat4.create(),this.localMatrix=mat4.create(),this.normalMatrix=mat4.create(),this.cachedNormalMatrix=mat4.create(),this.children=[],this.useLOD=!1,this._lodLevels={},this._mouseColorMaterial=null,this._mouseColorID=[parseInt(255*Math.random()),parseInt(255*Math.random()),parseInt(255*Math.random()),255]},RedBaseObject3D.prototype={addLOD:function(e,t,r,n){r||n||RedGLUtil.throwFunc("RedBaseObject3D - addLOD : geometry, material 둘중하나는 반드시 입력되어야함"),"number"==typeof e||RedGLUtil.throwFunc("RedBaseObject3D - level : 숫자만허용함"),a={level:e,distance:t,geometry:r||this.geometry,material:n||this.material},this._lodLevels[e]=a},removeLOD:function(e){this._lodLevels[e]&&delete this._lodLevels[e]},localToWorld:(i=mat4.create(),function(e,t,r){return e=e||0,t=t||0,r=r||0,mat4.identity(i),mat4.translate(i,i,[e,t,r]),mat4.multiply(i,this.matrix,i),[i[12],i[13],i[14]]}),worldToLocal:function(){var e,t;return e=mat4.create(),t=mat4.create(),function(r,n,i){return r=r||0,n=n||0,i=i||0,mat4.translate(e,e,[r,n,i]),mat4.multiply(t,e,this.matrix),[t[0]*r+t[1]*n+t[2]*i+t[3],t[4]*r+t[5]*n+t[6]*i+t[7],t[8]*r+t[9]*n+t[10]*i+t[11]]}}(),getScreenPoint:(n=mat4.create(),r={x:0,y:0,z:0,w:0},function(i){return mat4.identity(n),e=i.camera,t=i._viewRect,e instanceof RedBaseController&&(e=e.camera),mat4.multiply(n,e.perspectiveMTX,e.matrix),mat4.multiply(n,n,this.matrix),r.x=n[12],r.y=n[13],r.z=n[14],r.w=n[15],r.x=.5*r.x/r.w+.5,r.y=.5*r.y/r.w+.5,[(t[0]+r.x*t[2])/window.devicePixelRatio,(t[1]+(1-r.y)*t[3])/window.devicePixelRatio]}),disposeAll:function(){this.disposeAllTexture(),this.disposeAllBuffer()},disposeAllTexture:function(){this.material&&this.material.disposeAllTexture()},disposeTexture:function(e){this.material&&this.material.disposeTexture(e)},disposeAllBuffer:function(){this.geometry&&this.geometry.disposeAllBuffer()},disposeBuffer:function(e){this.geometry&&this.geometry.disposeBuffer(e)}},Object.defineProperty(RedBaseObject3D.prototype,"geometry",{get:function(){return this._geometry},set:function(e){!e||e instanceof RedGeometry||RedGLUtil.throwFunc("geometry : RedGeometry Instance만 허용.","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedBaseObject3D.prototype,"material",{get:function(){return this._material},set:function(e){!e||e instanceof RedBaseMaterial||RedGLUtil.throwFunc("material : RedBaseMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedBaseObject3D)}(),function(){var e;(RedBaseContainer=function(){}).prototype=new RedBaseObject3D,RedBaseContainer.prototype.sortGeometry=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortGeometry&&this.children[t].sortGeometry(e);this.children.sort(function(e,t){return(e=e._geometry.interleaveBuffer._UUID)<(t=t._geometry.interleaveBuffer._UUID)?-1:e>t?1:0})},RedBaseContainer.prototype.sortMaterial=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortMaterial&&this.children[t].sortMaterial(e);this.children.sort(function(e,t){return(e=e._material.program._UUID)<(t=t._material.program._UUID)?-1:e>t?1:0})},RedBaseContainer.prototype.sortGeometryAndMaterial=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortGeometryAndMaterial&&this.children[t].sortGeometryAndMaterial(e);this.children.sort(function(e,t){if((e=e._geometry.interleaveBuffer._UUID)==(t=t._geometry.interleaveBuffer._UUID)){var r=e._material.program._UUID,n=t._material.program._UUID;return r<n?-1:r>n?1:0}return e<t?-1:e>t?1:0})},RedBaseContainer.prototype.addChild=function(e){e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addChild","RedBaseObject3D Instance만 가능","입력값 : "+e),this.children.indexOf(e)>-1&&this.removeChild(e),this.children.push(e)},RedBaseContainer.prototype.addChildAt=function(e,t){"number"==typeof t||RedGLUtil.throwFunc("addChildAt","index는 숫자만 입력가능","입력값 : "+t),e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addChildAt","RedBaseObject3D Instance만 가능","입력값 : "+e),this.children.indexOf(e)>-1&&this.removeChild(e),this.children.length<t&&(t=this.children.length),t?this.children.splice(t,0,e):this.children.push(e)},RedBaseContainer.prototype.removeChild=function(t){-1==(e=this.children.indexOf(t))?RedGLUtil.throwFunc("removeChild","존재하지 않는 RedMesh를 삭제하려고 함"):this.children.splice(e,1)},RedBaseContainer.prototype.removeChildAt=function(e){"number"!=typeof e&&RedGLUtil.throwFunc("removeChildAt","index가 Number형이 아님 ","입력값 : "+e),this.children[e]?this.children.splice(e,1):RedGLUtil.throwFunc("removeChildAt","index 해당인덱스에 위치한 자식이 없음.","입력값 : "+e)},RedBaseContainer.prototype.removeChildAll=function(){this.children.length=0},RedBaseContainer.prototype.getChildAt=function(e){return"number"==typeof e||RedGLUtil.throwFunc("getChildAt","index가 Number형이 아님 "),this.children[e]},RedBaseContainer.prototype.getChildIndex=function(e){return this.children.indexOf(e)},RedBaseContainer.prototype.numChildren=function(){return this.children.length},Object.freeze(RedBaseContainer)}(),function(){var e;(RedBaseLight=function(){}).prototype={},RedDefinePropertyInfo.definePrototype("RedBaseLight","intensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedBaseLight","alpha","number",{min:0,max:1,callback:function(e){this._lightColor[3]=this._alpha=e}}),RedDefinePropertyInfo.definePrototype("RedBaseLight","color","hex",{callback:function(){e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._color),this._lightColor[0]=e[0],this._lightColor[1]=e[1],this._lightColor[2]=e[2],this._lightColor[3]=this._alpha}}),Object.freeze(RedBaseLight)}(),(RedFrameBuffer=function(e,t,r){if(!(this instanceof RedFrameBuffer))return new RedFrameBuffer(e,t,r);var n;e instanceof RedGL||RedGLUtil.throwFunc("RedFrameBuffer : RedGL Instance만 허용.",e),t&&("number"==typeof t||RedGLUtil.throwFunc("RedFrameBuffer : width - 숫자만 허용","입력값 : ",t)),r&&("number"==typeof r||RedGLUtil.throwFunc("RedFrameBuffer : height - 숫자만 허용","입력값 : ",r)),n=e.gl,r=r||1080,(t=t||1920)>e.detect.texture.MAX_TEXTURE_SIZE&&(t=e.detect.texture.MAX_TEXTURE_SIZE),r>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),this.redGL=e,this.width=t,this.height=r,this.webglFrameBuffer=n.createFramebuffer(),this.webglRenderBuffer=n.createRenderbuffer(),this.texture=RedBitmapTexture(e),this._UUID=RedGL.makeUUID(),n.bindFramebuffer(n.FRAMEBUFFER,this.webglFrameBuffer),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture.webglTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindRenderbuffer(n.RENDERBUFFER,this.webglRenderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,this.width,this.height),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.texture.webglTexture,0),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.webglRenderBuffer),n.bindTexture(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null)}).prototype={bind:function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.webglFrameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture.webglTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindRenderbuffer(e.RENDERBUFFER,this.webglRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.webglTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.webglRenderBuffer)},unbind:function(e){e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}},RedDefinePropertyInfo.definePrototype("RedFrameBuffer","width","number",{min:2}),RedDefinePropertyInfo.definePrototype("RedFrameBuffer","height","number",{min:2}),Object.freeze(RedFrameBuffer),function(){var e,t,r;e=function(e,t,r){switch(t){case RedBuffer.ARRAY_BUFFER:if(r instanceof Float32Array)return e.FLOAT;if(r instanceof Float64Array)return e.FLOAT;RedGLUtil.throwFunc("RedBuffer : 올바른 TypedArray(RedBuffer.ARRAY_BUFFER)형식을 사용해야합니다.","입력값 : "+r);break;case RedBuffer.ELEMENT_ARRAY_BUFFER:if(r instanceof Int8Array)return e.BYTE;if(r instanceof Int16Array)return e.SHORT;if(r instanceof Int32Array)return e.INT;if(r instanceof Uint8Array)return e.UNSIGNED_BYTE;if(r instanceof Uint16Array)return e.UNSIGNED_SHORT;if(r instanceof Uint32Array)return e.UNSIGNED_INT;RedGLUtil.throwFunc("RedBuffer : 올바른 TypedArray(RedBuffer.ELEMENT_ARRAY_BUFFER)형식을 사용해야합니다.","입력값 : "+r);break;default:RedGLUtil.throwFunc("RedBuffer : bufferType - 지원하지 않는 버퍼타입입니다. ","입력값 : "+t)}},t=function(e,t){switch(t){case RedBuffer.ARRAY_BUFFER:return e.ARRAY_BUFFER;case RedBuffer.ELEMENT_ARRAY_BUFFER:return e.ELEMENT_ARRAY_BUFFER;default:RedGLUtil.throwFunc("RedBuffer : bufferType - 지원하지 않는 버퍼타입입니다. ")}},r=function(e,t,r,n){var i,a,o,s,d;switch(r instanceof Float32Array?d=Float32Array.BYTES_PER_ELEMENT:r instanceof Float64Array&&(d=Float64Array.BYTES_PER_ELEMENT),i=0,t){case RedBuffer.ARRAY_BUFFER:if(e.interleaveDefineInfoList=n,n){for(0==n.length&&RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList의 정보는 1개이상의 RedInterleaveInfo Instance로 구성되어야함.",n),a=0,o=n.length;a<o;a++)(s=n[a])instanceof RedInterleaveInfo||RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList의 정보는 RedInterleaveInfo Instance로만 구성되어야함.",n),s.offset=o<2?0:i,s.offset_BYTES_PER_ELEMENT=o<2?0:i*d,i+=s.size,s._UUID=RedGL.makeUUID(),n[s.attributeKey]=s;o<2?(e.stride=0,e.stride_BYTES_PER_ELEMENT=0,e.pointNum=r.length/3):(e.stride=i,e.stride_BYTES_PER_ELEMENT=i*d,e.pointNum=r.length/i),e.pointNum!=parseInt(e.pointNum)&&RedGLUtil.throwFunc("RedBuffer : ARRAY_BUFFER의 pointNum이 정수로 떨어지지 않음. 데이터구성과 interleaveDefineInfoList 구성 확인 필요")}else RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList는 반드시 정의 되어야함.");break;case RedBuffer.ELEMENT_ARRAY_BUFFER:e.pointNum=r.length}},(RedBuffer=function(n,i,a,o,s,d){if(!(this instanceof RedBuffer))return new RedBuffer(n,i,a,o,s,d);n instanceof RedGL||RedGLUtil.throwFunc("RedBuffer : RedGL Instance만 허용.",n),"string"==typeof i||RedGLUtil.throwFunc("RedBuffer : key - 문자열만 허용.","입력값 : "+i),a||RedGLUtil.throwFunc("RedBuffer : bufferType : 미입력, 반드시 입력해야함."),a==RedBuffer.ARRAY_BUFFER||a==RedBuffer.ELEMENT_ARRAY_BUFFER||RedGLUtil.throwFunc("RedBuffer : bufferType - RedBuffer.ARRAY_BUFFER or RedBuffer.ELEMENT_ARRAY_BUFFER 만 허용함.","입력값 : "+a);var f=n.gl;if(n._datas.RedBuffer||(n._datas.RedBuffer={},n._datas.RedBuffer[RedBuffer.ARRAY_BUFFER]={},n._datas.RedBuffer[RedBuffer.ELEMENT_ARRAY_BUFFER]={}),n._datas.RedBuffer[a][i])return n._datas.RedBuffer[a][i];n._datas.RedBuffer[a][i]=this,a!=RedBuffer.ARRAY_BUFFER||s||RedGLUtil.throwFunc("RedBuffer : 신규생성시 interleaveDefineInfoList를 반드시 정의해야합니다.","입력값 : "+s),this.key=i,this.data=o,this.bufferType=a,this.glBufferType=t(f,this.bufferType),this.glArrayType=e(f,this.bufferType,this.data),this.drawMode=d||f.STATIC_DRAW,r(this,this.bufferType,this.data,s),this.webglBuffer=f.createBuffer(),this.webglBuffer.gl=f,this.webglBuffer.redGL=n,this._UUID=RedGL.makeUUID(),this.upload=function(t){this.glArrayType==e(f,a,t)?(this.data=t,f.bindBuffer(this.glBufferType,this.webglBuffer),f.bufferData(this.glBufferType,this.data,this.drawMode),r(this,this.bufferType,this.data,this.interleaveDefineInfoList),this.bufferType==RedBuffer.ARRAY_BUFFER&&(this.triangleNum=this.data.length/(this.stride?this.stride:3)),this.bufferType==RedBuffer.ELEMENT_ARRAY_BUFFER&&(this.triangleNum=this.pointNum/3)):RedGLUtil.throwFunc("RedBuffer : upload - data형식이 기존 형식과 다름",t)},this.upload(this.data)}).prototype.dispose=function(){this.webglBuffer&&!this.isPrimitiveBuffer&&(this.webglBuffer.gl.deleteBuffer(this.webglBuffer),delete this.webglBuffer.redGL._datas.RedBuffer[this.bufferType][this.key],this.webglBuffer=null)},RedBuffer.ARRAY_BUFFER="arrayBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER="elementArrayBuffer",Object.freeze(RedBuffer)}(),function(){var e;(RedGeometry=function(e,t){if(!(this instanceof RedGeometry))return new RedGeometry(e,t);e instanceof RedBuffer||RedGLUtil.throwFunc("RedGeometry : interleaveBuffer - RedBuffer Instance만 허용.",e),e.bufferType==RedBuffer.ARRAY_BUFFER||RedGLUtil.throwFunc("RedGeometry : interleaveBuffer - RedBuffer.ARRAY_BUFFER 타입만 허용.",e),t&&(e||RedGLUtil.throwFunc("RedGeometry : indexBuffer는 반드시 interleaveBuffer와 쌍으로 입력되어야함.",t),t instanceof RedBuffer||RedGLUtil.throwFunc("RedGeometry : indexBuffer - RedBuffer Instance만 허용.",t),t.bufferType==RedBuffer.ELEMENT_ARRAY_BUFFER||RedGLUtil.throwFunc("RedGeometry : indexBuffer - RedBuffer.ELEMENT_ARRAY_BUFFER 타입만 허용.",t)),this.interleaveBuffer=e,this.indexBuffer=t,this._volume=null,this._UUID=RedGL.makeUUID()}).prototype={disposeAllBuffer:function(){for(e in this)this&&this[e]instanceof RedBuffer&&this[e].dispose()},disposeBuffer:function(e){this&&this[e]instanceof RedBuffer&&this[e].dispose()}},Object.defineProperty(RedGeometry.prototype,"volume",{get:function(){var e,t,r,n,i,a,o,s,d,f,u,l=this.interleaveBuffer.stride;for(e=t=r=n=i=a=0,f=this.interleaveBuffer.data,u=0,len=this.interleaveBuffer.pointNum;u<len;u++)s=(o=u*l)+1,d=o+2,e=f[o]<e?f[o]:e,n=f[o]>n?f[o]:n,t=f[s]<t?f[s]:t,i=f[s]>i?f[s]:i,r=f[d]<r?f[d]:r,a=f[d]>a?f[d]:a;return this._volume=[n-e,i-t,a-r],this._volume}}),Object.freeze(RedGeometry)}(),RedInterleaveInfo=function(e,t,r){if(!(this instanceof RedInterleaveInfo))return new RedInterleaveInfo(e,t,r);"string"==typeof e||RedGLUtil.throwFunc("RedInterleaveInfo : attributeKey - 문자열만 허용",e),"a"==e.charAt(0)||RedGLUtil.throwFunc("RedInterleaveInfo : attributeKey 첫글자는 a로 시작해야합니다.",e),e.charAt(1)==e.charAt(1).toUpperCase()||RedInterleaveInfo.throwFunc("RedInterleaveInfo : attributeKey 두번째 글자는 대문자 시작해야합니다.",e),"number"==typeof t||RedGLUtil.throwFunc("RedInterleaveInfo : size - 숫자만 허용",t),this.attributeKey=e,this.size=t,this.normalize=null!=r,this.offset=null},Object.freeze(RedInterleaveInfo),function(){var e,t,r,n,i,a,o,s;(RedBaseMaterial=function(){}).prototype={makeProgramList:(s=["fog","sprite3D","skin","directionalShadow"],s.sort(),a=function(e,t,r,n,s,d,f){e.basic[t]||(e.basic[t]=new i(r,e,t,n,s)),d.forEach(function(u,l){d.sort(),f.sort();var c=d.join("_");e[c]||(e[c]={}),e[c][t]||(e[c][t]=new i(r,e,t,n,s,d));var h=d.concat();h.splice(l,1),o(e,c,t,r,n,s,d,f),a(e,t,r,n,s,h,f)})},o=function(e,t,r,n,a,o,s,d){function f(e,t){var r,n,i,a,o;if(t>e.length||t<=0)return[];if(t==e.length)return[e];if(1==t){for(i=[],r=0;r<e.length;r++)i.push([e[r]]);return i}for(i=[],r=0;r<e.length-t+1;r++)for(a=e.slice(r,r+1),o=f(e.slice(r+1),t-1),n=0;n<o.length;n++)i.push(a.concat(o[n]));return i}(function(e){var t,r,n,i;for(n=[],t=1;t<=e.length;t++)for(i=f(e,t),r=0;r<i.length;r++)n.push(i[r]);return n})(d=d||[]).forEach(function(d){var f=d.join("_");e.basic[r+"_"+f]||(e.basic[r+"_"+f]=new i(n,e,r,a,o,null,d)),e[t][r+"_"+f]||(e[t][r+"_"+f]=new i(n,e,r,a,o,s,d))})},i=function(e,t,r,n,i,a,o){0,o=o||[],this.optionList=o.concat(a||[]),this.systemKey=(a||["basic"]).join("_"),this.searchKey=r+(o.length?"_"+o.join("_"):""),this.key=r+(this.optionList.length?"_"+this.optionList.join("_"):""),this._prepareProgramYn=!0,this._makePrepareProgram=function(){return t[this.systemKey][this.searchKey]=RedProgram.makeProgram(e,r,n,i,this.optionList)}},function(e,t,r,n,i,o){o||(o=[]),t._datas.RedProgramGroup||(t._datas.RedProgramGroup={}),t._datas.RedProgramGroup[r]?e._programList=t._datas.RedProgramGroup[r]:(e._programList={basic:{}},a(e._programList,r,t,n,i,s,o),e._programList.basic[r]=RedProgram.makeProgram(t,r,n,i),t._datas.RedProgramGroup[r]=e._programList),e.program=e._programList.basic[r]}),_searchProgram:function(e,i){if(n=[],i)for(t=i.length;t--;)this[r=i[t]]&&n.push(r);n.length?(n.sort(),n=e+"_"+n.join("_")):n=e,this.program=this._programList.basic[n]},checkUniformAndProperty:function(){var e,t,r;return function(){for(this.program._prepareProgramYn&&(this.program=this.program._makePrepareProgram()),t=this.program.uniformLocation,e=t.length;e--;)r=t[e],!r.location||r.materialPropertyName in this||RedGLUtil.throwFunc(this.program.key+"- ",r.materialPropertyName,"속성이 정의 되지않았습니다.")}}(),disposeAllTexture:function(){for(e in this)this[e]instanceof RedBaseTexture&&this[e].dispose()},disposeTexture:function(e){this[e]instanceof RedBaseTexture&&this[e].dispose()}},Object.freeze(RedBaseMaterial)}(),RedTextureOptionChecker={check:function(e,t,r){t&&(t.min&&t.min!=r.LINEAR&&t.min!=r.NEAREST&&t.min!=r.NEAREST_MIPMAP_NEAREST&&t.min!=r.LINEAR_MIPMAP_NEAREST&&t.min!=r.NEAREST_MIPMAP_LINEAR&&t.min!=r.LINEAR_MIPMAP_LINEAR&&RedGLUtil.throwFunc(e+": min 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+t.min),t.mag&&t.mag!=r.LINEAR&&t.mag!=r.NEAREST&&RedGLUtil.throwFunc(e+" : mag 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+t.mag),t.wrap_s&&t.wrap_s!=r.REPEAT&&t.wrap_s!=r.CLAMP_TO_EDGE&&t.wrap_s!=r.MIRRORED_REPEAT&&RedGLUtil.throwFunc(e+" : wrap_s 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+t.wrap_s),t.wrap_t&&t.wrap_t!=r.REPEAT&&t.wrap_t!=r.CLAMP_TO_EDGE&&t.wrap_t!=r.MIRRORED_REPEAT&&RedGLUtil.throwFunc(e+" : wrap_t 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+t.wrap_t))}},Object.freeze(RedTextureOptionChecker),function(){var e,t,r;t=function(e,t,r,n){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.min?n.min:e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.mag?n.mag:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrap_s?n.wrap_s:e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrap_t?n.wrap_t:e.REPEAT),e.glExtension.EXT_texture_filter_anisotropic&&n.anisotropic&&e.texParameterf(e.TEXTURE_2D,e.glExtension.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.anisotropic);try{e.generateMipmap(e.TEXTURE_2D)}catch(e){}e.bindTexture(e.TEXTURE_2D,null)},e=function(e,n,i,a,o,s){if(o||(o={}),window.OffscreenCanvas&&a instanceof OffscreenCanvas||window.HTMLCanvasElement&&a instanceof HTMLCanvasElement){var d=RedGLUtil.makePowerOf2Source(e,a,r);t(e,i,d,o),s&&s.call(n,!0)}else RedImageLoader(a,function(a){var d=RedGLUtil.makePowerOf2Source(e,this.source,r);t(e,i,d,o),s&&s.call(n,!0)},function(e){s&&s.call(n,!1)})},(RedBitmapTexture=function(t,n,i,a){var o;if(!(this instanceof RedBitmapTexture))return new RedBitmapTexture(t,n,i,a);t instanceof RedGL||RedGLUtil.throwFunc("RedBitmapTexture : RedGL Instance만 허용.",t),a&&"function"==typeof a||!a||RedGLUtil.throwFunc("RedBitmapTexture : callback Function만 허용.",a),o=t.gl,r=t.detect.texture.MAX_TEXTURE_SIZE,i=i||{};var s=n+JSON.stringify(i);if("string"==typeof n&&(t._datas.textures||(t._datas.textures={}),t._datas.textures[s]))return a&&setTimeout(function(){a.call(this,!0)},1),t._datas.textures[s];this.webglTexture=o.createTexture(),this.webglTexture.gl=o,this._load=function(t){RedTextureOptionChecker.check("RedBitmapTexture",i,o),t&&this.setEmptyTexture(o,this.webglTexture),this._src&&e(o,this,this.webglTexture,this._src,this._option,this._callback)},this._option=i,this.callback=a,this.src=n,this._UUID=RedGL.makeUUID(),t._datas.textures[s]=this}).prototype=new RedBaseTexture,Object.defineProperty(RedBitmapTexture.prototype,"src",{get:function(){return this._src},set:function(e){if(window.OffscreenCanvas)return this._src=e,void this._load(!0);!e||"string"==typeof e||window.HTMLCanvasElement&&e instanceof HTMLCanvasElement||RedGLUtil.throwFunc("RedBitmapTexture : src는 문자열 or Canvas Element만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),Object.defineProperty(RedBitmapTexture.prototype,"option",{get:function(){return this._option},set:function(e){this._option=e,this._load(!1)}}),Object.freeze(RedBitmapTexture)}(),function(){var e,t;t=function(e,t,r){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null)},e=function(e,r,n,i,a){var o,s,d,f;d=function(e){e.removeEventListener("error",o),e.removeEventListener("canplaythrough",s)},o=function(){d(this),a&&a.call(r,!1)},s=function(){d(this),this.play(),r._videoDom.loaded=!0,t(e,n,this),a&&a.call(r,!0)},i instanceof HTMLVideoElement?f=i:(f=document.createElement("video")).src=i,f.loop=1,f.muted=!0,f.setAttribute("autoplay",""),f.style.cssText="position:absolute;top:0px;left:0px;z-index:200",r._videoDom=f,r._videoDom.loaded=!1,f.addEventListener("error",o),f.addEventListener("canplaythrough",s)},(RedVideoTexture=function(t,r,n){var i;if(!(this instanceof RedVideoTexture))return new RedVideoTexture(t,r,n);t instanceof RedGL||RedGLUtil.throwFunc("RedVideoTexture : RedGL Instance만 허용.",t),i=t.gl,this.webglTexture=i.createTexture(),this.webglTexture.gl=i,this._UUID=RedGL.makeUUID(),this._load=function(t){t&&this.setEmptyTexture(i,this.webglTexture),this._src&&e(i,this,this.webglTexture,this._src,this._callback)},this.callback=n,this.src=r}).prototype=new RedBaseTexture,Object.defineProperty(RedVideoTexture.prototype,"src",{get:function(){return this._src},set:function(e){!e||"string"==typeof e||e instanceof HTMLVideoElement||RedGLUtil.throwFunc("RedVideoTexture : src는 문자열 or HTMLVideoElement만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),Object.freeze(RedVideoTexture)}(),(RedDDSTexture=function(e,t,r,n){var i;if(!(this instanceof RedDDSTexture))return new RedDDSTexture(e,t,r,n);e instanceof RedGL||RedGLUtil.throwFunc("RedDDSTexture : RedGL Instance만 허용.",e),(i=e.gl).glExtension.WEBGL_compressed_texture_s3tc||RedGLUtil.throwFunc("RedDDSTexture : WEBGL_compressed_texture_s3tc확장을 지원하지않는 하드웨어입니다."),this.webglTexture=i.createTexture(),this.webglTexture.gl=i,this._load=function(e){RedTextureOptionChecker.check("RedDDSTexture",r,i),e&&this.setEmptyTexture(i,this.webglTexture),this._src&&this.loadDDSTexture(i,i.glExtension.WEBGL_compressed_texture_s3tc,this._src,this._callback)},this.callback=n,this.src=t,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseTexture,Object.defineProperty(RedDDSTexture.prototype,"src",{get:function(){return this._src},set:function(e){e&&"string"!=typeof e&&RedGLUtil.throwFunc("RedDDSTexture : src는 문자열만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),function(e){"use strict";function t(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r=t("DXT1"),n=t("DXT3"),i=t("DXT5"),a=e.uploadDDSLevels=function(e,t,a,o){var s,d,f,u,l,c,h,R,m,p=new Int32Array(a,0,31);if(542327876!=p[0])return 0;if(4&!p[20])return 0;switch(p[21]){case r:s=8,d=t.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case n:s=16,d=t.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case i:s=16,d=t.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}for(R=1,131072&p[2]&&!1!==o&&(R=Math.max(1,p[7])),f=p[4],u=p[3],c=p[1]+4,m=0;m<R;++m)l=Math.max(4,f)/4*Math.max(4,u)/4*s,h=new Uint8Array(a,c,l),e.compressedTexImage2D(e.TEXTURE_2D,m,d,f,u,0,h),c+=l,f*=.5,u*=.5;return R};e.loadDDSTexture=function(e,t,r,n,i){var o=this.webglTexture,s=new XMLHttpRequest;return s.open("GET",r,!0),s.responseType="arraybuffer",n||(n={}),s.onload=function(){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,o);var r=a(e,t,this.response);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.min?n.min:r>1?e.LINEAR_MIPMAP_NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.mag?n.mag:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i&&i(!0)},s.onerror=function(){i&&i(!1)},s.send(null),o}}(RedDDSTexture.prototype),Object.freeze(RedDDSTexture),function(){var e;e=function(e,t,r,n,i,a){var o,s,d,f,u,l=[];for(i=i||{},o=function(){0==u&&a&&a.call(t,!1),u++},s=function(){if(6==++f){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,i.min?i.min:e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,i.mag?i.mag:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,i.wrap_s?i.wrap_s:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,i.wrap_t?i.wrap_t:e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[0].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[1].source),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[2].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[3].source),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[4].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[5].source),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);try{e.generateMipmap(e.TEXTURE_CUBE_MAP)}catch(e){}e.bindTexture(e.TEXTURE_CUBE_MAP,null),0==u&&a&&a.call(t,!0)}},d=6,f=0,u=0;d--;)l[d]=RedImageLoader(n[d],s,o,{})},(RedBitmapCubeTexture=function(t,r,n,i){var a;if(!(this instanceof RedBitmapCubeTexture))return new RedBitmapCubeTexture(t,r,n,i);t instanceof RedGL||RedGLUtil.throwFunc("RedBitmapCubeTexture : RedGL Instance만 허용.","입력값 : "+t),i&&"function"==typeof i||!i||RedGLUtil.throwFunc("RedBitmapCubeTexture : callback Function만 허용.",i),a=t.gl,n=n||{};var o=r.toString()+JSON.stringify(n);if("array"==typeof r&&(t._datas.textures||(t._datas.textures={}),t._datas.textures[o]))return i&&setTimeout(function(){i.call(this,!0)},1),t._datas.textures[o];this.webglTexture=a.createTexture(),this.webglTexture.gl=a,this._UUID=RedGL.makeUUID(),this._load=function(t){RedTextureOptionChecker.check("RedBitmapCubeTexture",n,a),t&&this.setEmptyTexture(a,this.webglTexture),this._srcList&&e(a,this,this.webglTexture,this._srcList,this._option,this._callback)},this._option=n,this.callback=i,this.srcList=r,t._datas.textures[o]=this}).prototype=new RedBaseTexture,Object.defineProperty(RedBitmapCubeTexture.prototype,"srcList",{get:function(){return this._srcList},set:function(e){e instanceof Array||RedGLUtil.throwFunc("RedBitmapCubeTexture : srcList는 배열만 허용.","입력값 : "+e),6==e.length||RedGLUtil.throwFunc("RedBitmapCubeTexture : srcList 길이는 6이어야함","입력값 : "+e),this._srcList=e,this._load(!0)}}),Object.defineProperty(RedBitmapCubeTexture.prototype,"option",{get:function(){return this._option},set:function(e){this._option=e,this._load(!1)}}),Object.freeze(RedBitmapCubeTexture)}(),function(){var e,t,r,n,i=[];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform vec4 u_color;
void main(void) {
vec4 finalColor = u_color;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedColorMaterial=function(n,a,o){if(!(this instanceof RedColorMaterial))return new RedColorMaterial(n,a,o);n instanceof RedGL||RedGLUtil.throwFunc("RedColorMaterial : RedGL Instance만 허용.","입력값 : "+n),this.makeProgramList(this,n,"RedColorMaterialProgram",e,t,i),this._color=new Float32Array(4),this.alpha=null==o?1:o,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedColorMaterial.DEFINE_OBJECT_COLOR={get:function(){return this._colorHex},set:function(e){this._colorHex=e||"#ff2211",n=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._colorHex),this._color[0]=n[0],this._color[1]=n[1],this._color[2]=n[2],this._color[3]=this._alpha}},RedColorMaterial.DEFINE_OBJECT_ALPHA={min:0,max:1,callback:function(e){this._color[3]=this._alpha=e}},Object.defineProperty(RedColorMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedColorMaterial","alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA),Object.freeze(RedColorMaterial)}(),function(){var e,t,r,n=["useFlatMode"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
// normal 계산
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
// 쉐도우 계산
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
// flat노말
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
// 라이트
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
uniform float u_shininess;
uniform float u_specularPower;
uniform vec4 u_color;
vec3 N;
vec4 texelColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
vec4 finalColor;
void main(void) {
texelColor = u_color;
N = normalize(vVertexNormal);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
finalColor.a = texelColor.a;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var i={callback:function(){this._searchProgram("RedColorPhongMaterialProgram",n)}};(RedColorPhongMaterial=function(i,a,o){if(!(this instanceof RedColorPhongMaterial))return new RedColorPhongMaterial(i,a,o);i instanceof RedGL||RedGLUtil.throwFunc("RedColorPhongMaterial : RedGL Instance만 허용.","입력값 : "+i),this.makeProgramList(this,i,"RedColorPhongMaterialProgram",e,t,n),this._color=new Float32Array(4),this.shininess=16,this.specularPower=1,this.alpha=null==o?1:o,this.useFlatMode=!1,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.defineProperty(RedColorPhongMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedColorPhongMaterial","alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA),RedDefinePropertyInfo.definePrototype("RedColorPhongMaterial","shininess","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongMaterial","specularPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongMaterial","useFlatMode","boolean",i),Object.freeze(RedColorPhongMaterial)}(),function(){var e,t,r,n=["normalTexture","specularTexture","displacementTexture","emissiveTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
// normal 계산
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
// 최종 포지션 계산
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
// 쉐도우 계산
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
// flat노말
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
// 라이트
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform vec4 u_color;
vec4 texelColor;
vec4 emissiveColor;
vec4 finalColor;
vec3 N;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
void main(void) {
texelColor = u_color;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture# specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var i={callback:function(){this._searchProgram("RedColorPhongTextureMaterialProgram",n)}};(RedColorPhongTextureMaterial=function(i,a,o,s,d,f,u){if(!(this instanceof RedColorPhongTextureMaterial))return new RedColorPhongTextureMaterial(i,a,o,s,d,f,u);i instanceof RedGL||RedGLUtil.throwFunc("RedColorPhongTextureMaterial : RedGL Instance만 허용.","입력값 : "+i),this.makeProgramList(this,i,"RedColorPhongTextureMaterialProgram",e,t,n),this._color=new Float32Array(4),this.normalTexture=s,this.specularTexture=d,this.displacementTexture=f,this.emissiveTexture=u,this.normalPower=1,this.shininess=16,this.specularPower=1,this.emissiveFactor=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=null==o?1:o,this.color=a||"#ff0000",this.usePreMultiply=!1,this.useFlatMode=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.defineProperty(RedColorPhongTextureMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","normalTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","specularTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","displacementTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","emissiveTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","normalPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","shininess","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","specularPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","emissiveFactor","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","displacementPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","displacementFlowSpeedX","number"),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","displacementFlowSpeedY","number"),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","useFlatMode","boolean",i),RedDefinePropertyInfo.definePrototype("RedColorPhongTextureMaterial","usePreMultiply","boolean",i),Object.freeze(RedColorPhongTextureMaterial)}(),function(){var e,t,r,n=["diffuseTexture","normalTexture","specularTexture","displacementTexture","emissiveTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
// normal 계산
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
// 최종 포지션 계산
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
// 쉐도우 계산
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
// flat노말
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
// 라이트
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform float u_reflectionPower;
uniform float u_alpha;
uniform bool u_useFlatMode;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec3 N;
float specularTextureValue;
vec4 finalColor;
void main(void) {
texelColor = vec4(0.0,0.0,0.0,0.0);
//#REDGL_DEFINE#diffuseTexture# texelColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#diffuseTexture# //#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
//#REDGL_DEFINE#diffuseTexture# if(texelColor.a ==0.0) discard;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
vec3 R = reflect( vVertexPosition.xyz - uCameraPosition, N);
reflectionColor = textureCube(u_environmentTexture, R);
texelColor = mix(texelColor, reflectionColor ,u_reflectionPower);
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture#  specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a * u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedEnvironmentMaterial=function(i,a,o,s,d,f,u){if(!(this instanceof RedEnvironmentMaterial))return new RedEnvironmentMaterial(i,a,o,s,d,f,u);i instanceof RedGL||RedGLUtil.throwFunc("RedEnvironmentMaterial : RedGL Instance만 허용.",i),o instanceof RedBitmapCubeTexture||RedGLUtil.throwFunc("RedEnvironmentMaterial : environmentTexture - RedBitmapCubeTexture Instance만 허용."),this.makeProgramList(this,i,"RedEnvironmentMaterialProgram",e,t,n),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.specularTexture=d,this.displacementTexture=f,this.emissiveTexture=u,this.normalPower=1,this.shininess=8,this.specularPower=1,this.emissiveFactor=1,this.reflectionPower=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=1,this.useFlatMode=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var i={callback:function(){this._searchProgram("RedEnvironmentMaterialProgram",n)}};RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","diffuseTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","environmentTexture","samplerCube",{essential:!0,callback:i.callback}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","normalTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","specularTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","displacementTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","emissiveTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","normalPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","shininess","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","specularPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","emissiveFactor","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","reflectionPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","displacementPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","displacementFlowSpeedX","number"),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","displacementFlowSpeedY","number"),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","useFlatMode","boolean",i),RedDefinePropertyInfo.definePrototype("RedEnvironmentMaterial","usePreMultiply","boolean",i),Object.freeze(RedEnvironmentMaterial)}(),function(){var e,t,r,n=["usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedBitmapMaterial=function(i,a){if(!(this instanceof RedBitmapMaterial))return new RedBitmapMaterial(i,a);i instanceof RedGL||RedGLUtil.throwFunc("RedBitmapMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedBitmapMaterialProgram",e,t,n),this.diffuseTexture=a,this.alpha=1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var i={callback:function(){this._searchProgram("RedBitmapMaterialProgram",n)}};RedDefinePropertyInfo.definePrototype("RedBitmapMaterial","diffuseTexture","sampler2D",{essential:!0}),RedDefinePropertyInfo.definePrototype("RedBitmapMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedBitmapMaterial","usePreMultiply","boolean",i),Object.freeze(RedBitmapMaterial)}(),function(){var e,t,r,n=["diffuseTexture","usePreMultiply"];e=function(){
/* @preserve
const mat4 cOrtho = mat4(
0.5, 0.0, 0.0, 0.0,
0.0, 0.5, 0.0, 0.0,
0.0, 0.0, 0.5, 0.0,
0.0, 0.0, 0.0, 1.0
);
void main(void) {
if(uOrthographicYn){
gl_Position = uPMatrix * uCameraMatrix * cOrtho * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
vVertexColor = aVertexColor;
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
uniform float u_cutOff;
uniform float u_alpha;
void main(void) {
vec4 finalColor = vVertexColor;
//#REDGL_DEFINE#diffuseTexture# finalColor = texture2D(u_diffuseTexture, gl_PointCoord.xy);
//#REDGL_DEFINE#diffuseTexture# //#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
//#REDGL_DEFINE#diffuseTexture# finalColor.rgb += vVertexColor.rgb * vVertexColor.a;
//#REDGL_DEFINE#diffuseTexture# finalColor.a *= vVertexColor.a;
finalColor.a *= u_alpha;
//#REDGL_DEFINE#diffuseTexture# if(finalColor.a < u_cutOff) discard;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var i={callback:function(){this._searchProgram("particleProgram",n)}};(RedParticleMaterial=function(i,a){if(!(this instanceof RedParticleMaterial))return new RedParticleMaterial(i,a);i instanceof RedGL||RedGLUtil.throwFunc("RedParticleMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"particleProgram",e,t,n),this.diffuseTexture=a,this.alpha=1,this.cutOff=0,this.usePreMultiply=!0,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedParticleMaterial","diffuseTexture","sampler2D",{callback:function(){this._searchProgram("particleProgram",n)}}),RedDefinePropertyInfo.definePrototype("RedParticleMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedParticleMaterial","cutOff","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedParticleMaterial","usePreMultiply","boolean",i),Object.freeze(RedParticleMaterial)}(),function(){var e,t,r,n=["usePreMultiply"];e=function(){
/* @preserve
void main(void) {
if(uOrthographicYn){
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform sampler2D u_diffuseTexture;
uniform float u_cutOff;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, gl_PointCoord.xy);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a < u_cutOff) discard;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedBitmapPointCloudMaterial=function(i,a){if(!(this instanceof RedBitmapPointCloudMaterial))return new RedBitmapPointCloudMaterial(i,a);i instanceof RedGL||RedGLUtil.throwFunc("RedBitmapPointCloudMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"bitmapPointCloudProgram",e,t,n),this.diffuseTexture=a,this.alpha=1,this.cutOff=.1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var i={callback:function(){this._searchProgram("bitmapPointCloudProgram",n)}};RedDefinePropertyInfo.definePrototype("RedBitmapPointCloudMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedBitmapPointCloudMaterial","cutOff","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedBitmapPointCloudMaterial","diffuseTexture","sampler2D",{essential:!0}),RedDefinePropertyInfo.definePrototype("RedBitmapPointCloudMaterial","usePreMultiply","boolean",i),Object.freeze(RedBitmapPointCloudMaterial)}(),function(){var e,t,r,n=["usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
uniform vec4 u_sheetRect;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
vTexcoord = vec2(
vTexcoord.s * u_sheetRect.x + u_sheetRect.z,
vTexcoord.t * u_sheetRect.y - u_sheetRect.w
);
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a ==0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var i={callback:function(){this._searchProgram("RedSheetMaterialProgram",n)}};(RedSheetMaterial=function(i,a,o,s,d,f){if(!(this instanceof RedSheetMaterial))return new RedSheetMaterial(i,a,o,s,d,f);i instanceof RedGL||RedGLUtil.throwFunc("RedSheetMaterial : RedGL Instance만 허용.",i),o=o||60,s=s||1,d=d||1,f=f||1,this.makeProgramList(this,i,"RedSheetMaterialProgram",e,t,n),this.diffuseTexture=a,this._sheetRect=new Float32Array(4),this.alpha=1,this.usePreMultiply=!1,this._perFrameTime=0,this._nextFrameTime=0,this._playYn=!0,this.segmentW=s,this.segmentH=d,this.totalFrame=f,this.frameRate=o,this.currentIndex=0,this.loop=!0,this._aniMap={},this.__RedSheetMaterialYn=!0,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedSheetMaterial.prototype.addAction=function(e,t){this._aniMap[e]=t},RedSheetMaterial.prototype.setAction=function(e){this.diffuseTexture=this._aniMap[e].texture,this.segmentW=this._aniMap[e].segmentW,this.segmentH=this._aniMap[e].segmentH,this.totalFrame=this._aniMap[e].totalFrame,this.frameRate=this._aniMap[e].frameRate,this.currentIndex=0,this._nextFrameTime=0},RedSheetMaterial.prototype.play=function(){this._playYn=!0},RedSheetMaterial.prototype.stop=function(){this._playYn=!1,this.currentIndex=0},RedSheetMaterial.prototype.pause=function(){this._playYn=!1},RedSheetMaterial.prototype.gotoAndStop=function(e){e>this.totalFrame-1&&(e=this.totalFrame-1),e<0&&(e=0),this._playYn=!1,this.currentIndex=e},RedSheetMaterial.prototype.gotoAndPlay=function(e){e>this.totalFrame-1&&(e=this.totalFrame-1),e<0&&(e=0),this._playYn=!0,this.currentIndex=e,this._nextFrameTime=0},RedDefinePropertyInfo.definePrototype("RedSheetMaterial","diffuseTexture","sampler2D",{essential:!0}),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","totalFrame","number",{min:1}),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","loop","boolean",!0),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","frameRate","number",{min:1,callback:function(){this._perFrameTime=1e3/this._frameRate}}),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","segmentW","number",{min:1}),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","segmentH","number",{min:1}),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedSheetMaterial","usePreMultiply","boolean",i),Object.freeze(RedSheetMaterial)}(),function(){var e,t,r,n=["diffuseTexture","normalTexture","specularTexture","emissiveTexture","displacementTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
// normal 계산
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
// 최종 포지션 계산
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
// 쉐도우 계산
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
// flat노말
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
// 라이트
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
// 텍스쳐
uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform float u_alpha;
vec4 texelColor;
vec4 emissiveColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
vec4 finalColor;
vec3 N;
void main(void) {
texelColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
if(texelColor.a == 0.0) discard;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture# specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a * u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var i={callback:function(){this._searchProgram("RedStandardMaterialProgram",n)}};(RedStandardMaterial=function(i,a,o,s,d,f){if(!(this instanceof RedStandardMaterial))return new RedStandardMaterial(i,a,o,s,d,f);i instanceof RedGL||RedGLUtil.throwFunc("RedStandardMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedStandardMaterialProgram",e,t,n),this.diffuseTexture=a,this.normalTexture=o,this.specularTexture=s,this.emissiveTexture=f,this.displacementTexture=d,this.normalPower=1,this.shininess=16,this.specularPower=1,this.emissiveFactor=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=1,this._UUID=RedGL.makeUUID(),this.usePreMultiply=!1,r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedStandardMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","diffuseTexture","sampler2D",{essential:!0,callback:i.callback}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","normalTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","specularTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","emissiveTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","displacementTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","normalPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","shininess","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","specularPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","emissiveFactor","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","displacementPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","displacementFlowSpeedX","number"),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","displacementFlowSpeedY","number"),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","useFlatMode","boolean",i),RedDefinePropertyInfo.definePrototype("RedStandardMaterial","usePreMultiply","boolean",i),Object.freeze(RedStandardMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_videoTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_videoTexture, vTexcoord);
if(finalColor.a ==0.0) discard;
finalColor.a = u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedVideoMaterial=function(n,i){if(!(this instanceof RedVideoMaterial))return new RedVideoMaterial(n,i);n instanceof RedGL||RedGLUtil.throwFunc("RedVideoMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedVideoMaterialProgram",e,t),this.videoTexture=i,this.alpha=1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedVideoMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedVideoMaterial","videoTexture","samplerVideo",{essential:!0}),Object.freeze(RedVideoMaterial)}(),function(){var e,t,r,n=["diffuseTexture","normalTexture","environmentTexture","occlusionTexture","emissiveTexture","roughnessTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
// UV설정
vTexcoord = aTexcoord;
// normal 계산
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
// 최종 포지션 계산
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
// 쉐도우 계산
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
// flat노말
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
uniform vec4 uBaseColorFactor;
uniform float u_emissiveFactor;
uniform float u_cutOff;
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#occlusionTexture# uniform sampler2D u_occlusionTexture;
//#REDGL_DEFINE#environmentTexture# uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#roughnessTexture# uniform sampler2D u_roughnessTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_specularPower;
uniform float u_metallicFactor;
uniform float u_roughnessFactor;
uniform float u_occlusionPower;
uniform float u_alpha;
vec4 la;
vec4 ld;
vec4 ls;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 roughnessColor;
vec4 occlusionColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec4 finalColor;
vec3 N;
vec3 L;
float lambertTerm;
float specular;
float specularTextureValue;
float distanceLength;
float attenuation;
void main(void) {
la = uAmbientLightColor * uAmbientLightColor.a;
ld = vec4(0.0, 0.0, 0.0, 1.0);
ls = vec4(0.0, 0.0, 0.0, 1.0);
float tMetallicPower = u_metallicFactor;
float tRoughnessPower = u_roughnessFactor;
//#REDGL_DEFINE#roughnessTexture# roughnessColor = texture2D(u_roughnessTexture, vTexcoord);
//#REDGL_DEFINE#roughnessTexture# tMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b
//#REDGL_DEFINE#roughnessTexture# tRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g
// diffuse 색상 산출
texelColor = uBaseColorFactor;
//#REDGL_DEFINE#diffuseTexture# texelColor *= texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
// 컷오프 계산
if(texelColor.a <= u_cutOff) discard;
// 노멀값 계산
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
// 환경맵 계산
vec3 R = reflect( vVertexPosition.xyz-uCameraPosition, N);
//#REDGL_DEFINE#environmentTexture# reflectionColor = textureCube(u_environmentTexture, R);
//#REDGL_DEFINE#environmentTexture# reflectionColor.rgb *= reflectionColor.a;
// 환경맵 합성
//#REDGL_DEFINE#environmentTexture# texelColor.rgb = mix( texelColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.0)*(1.0-tRoughnessPower));
//#REDGL_DEFINE#environmentTexture# texelColor = mix( texelColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);
// 라이팅 계산
float shininess = 128.0 ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue =  1.0 ;
for(int i=0; i<cDIRETIONAL_MAX; i++){
if(i == uDirectionalLightNum) break;
L = normalize(-uDirectionalLightPositionList[i]);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;
specular = pow( max(dot(reflect(L, N), -L), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * u_specularPower * specularTextureValue * uDirectionalLightIntensityList[i]* uDirectionalLightColorList[i].a * (1.0-tRoughnessPower+0.04);
}
}
for(int i=0;i<cPOINT_MAX;i++){
if(i== uPointLightNum) break;
L =  -uPointLightPositionList[i] + vVertexPosition.xyz;
distanceLength = abs(length(L));
if(uPointLightRadiusList[i]> distanceLength){
attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;
L = normalize(L);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;
specular = pow( max(dot(reflect(L, N), -N), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * uPointLightIntensityList[i]  * uPointLightColorList[i].a * (1.0-tRoughnessPower+0.04) ;
}
}
}
finalColor = la * uAmbientIntensity + ld + ls;
finalColor.a = texelColor.a * u_alpha ;
// 그림자 계산
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
// 이미시브합성
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= emissiveColor.a * u_emissiveFactor;
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= u_emissiveFactor;
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb;
// 오클루젼 합성
//#REDGL_DEFINE#occlusionTexture# occlusionColor = texture2D(u_occlusionTexture, vTexcoord);
//#REDGL_DEFINE#occlusionTexture# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * u_occlusionPower);
// 최종결과 산출
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedPBRMaterial=function(i,a,o,s,d,f,u){if(!(this instanceof RedPBRMaterial))return new RedPBRMaterial(i,a,o,s,d,f,u);i instanceof RedGL||RedGLUtil.throwFunc("RedPBRMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedPBRMaterialProgram",e,t,n),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.occlusionTexture=d,this.emissiveTexture=f,this.roughnessTexture=u,this.normalPower=1,this.specularPower=1,this.occlusionPower=1,this.metallicFactor=1,this.roughnessFactor=.1,this.baseColorFactor=[1,1,1,1],this.emissiveFactor=1,this.alpha=1,this.cutOff=0,this.useFlatMode=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var i={callback:function(){this._searchProgram("RedPBRMaterialProgram",n)}};RedDefinePropertyInfo.definePrototype("RedPBRMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","cutOff","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","diffuseTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","environmentTexture","samplerCube",{callback:i.callback}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","normalTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","occlusionTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","emissiveTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","roughnessTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","normalPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","specularPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","metallicFactor","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","emissiveFactor","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","roughnessFactor","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","occlusionPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","useFlatMode","boolean",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial","usePreMultiply","boolean",i),Object.freeze(RedPBRMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vVertexColor = aVertexColor;
if(uOrthographicYn){
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform float u_alpha;
void main(void) {
vec4 finalColor = vVertexColor;
finalColor.a *= u_alpha;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedColorPointCloudMaterial=function(n){if(!(this instanceof RedColorPointCloudMaterial))return new RedColorPointCloudMaterial(n);n instanceof RedGL||RedGLUtil.throwFunc("RedColorPointCloudMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"colorPointCloudProgram",e,t),this.alpha=1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedColorPointCloudMaterial","alpha","number",{min:0,max:1}),Object.freeze(RedColorPointCloudMaterial)}(),function(){var e,t,r,n=["diffuseTexture","normalTexture","environmentTexture","occlusionTexture","emissiveTexture","roughnessTexture","useFlatMode","useMaterialDoubleSide","useVertexTangent","useVertexColor_0","usePreMultiply"];e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#useVertexColor_0# attribute vec4 aVertexColor_0;
//#REDGL_DEFINE#useVertexColor_0# varying vec4 vVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# attribute vec4 aVertexTangent;
//#REDGL_DEFINE#useVertexTangent# varying vec4 vVertexTangent;
void main(void) {
gl_PointSize = uPointSize;
// UV설정
vTexcoord = aTexcoord;
vTexcoord1 = aTexcoord1;
//#REDGL_DEFINE#useVertexColor_0# vVertexColor_0 = aVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# vVertexTangent = aVertexTangent;
// normal 계산
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
// 최종 포지션 계산
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
// 쉐도우 계산
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
// flat노말
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#useVertexColor_0# varying vec4 vVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# varying vec4 vVertexTangent;
uniform vec4 uBaseColorFactor;
uniform vec3 uEmissiveFactor;
uniform float u_cutOff;
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#occlusionTexture# uniform sampler2D u_occlusionTexture;
//#REDGL_DEFINE#environmentTexture# uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#roughnessTexture# uniform sampler2D u_roughnessTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_specularPower;
uniform float u_metallicFactor;
uniform float u_roughnessFactor;
uniform float u_occlusionPower;
uniform float u_alpha;
uniform int u_diffuseTexCoordIndex;
uniform int u_occlusionTexCoordIndex;
uniform int u_emissiveTexCoordIndex;
uniform int u_roughnessTexCoordIndex;
uniform int u_normalTexCoordIndex;
vec4 la;
vec4 ld;
vec4 ls;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 roughnessColor;
vec4 occlusionColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec4 finalColor;
vec3 N;
vec3 L;
float lambertTerm;
float specular;
float specularTextureValue;
float distanceLength;
float attenuation;
vec2 u_diffuseTexCoord ;
vec2 u_occlusionTexCoord;
vec2 u_emissiveTexCoord;
vec2 u_roughnessTexCoord;
vec2 u_normalTexCoord;
void main(void) {
la = uAmbientLightColor * uAmbientLightColor.a;
ld = vec4(0.0, 0.0, 0.0, 1.0);
ls = vec4(0.0, 0.0, 0.0, 1.0);
u_diffuseTexCoord = u_diffuseTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_normalTexCoord = u_normalTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_occlusionTexCoord = u_occlusionTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_emissiveTexCoord = u_emissiveTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_roughnessTexCoord  = u_roughnessTexCoordIndex==0 ? vTexcoord : vTexcoord1;
float tMetallicPower = u_metallicFactor;
float tRoughnessPower = u_roughnessFactor;
//#REDGL_DEFINE#roughnessTexture# roughnessColor = texture2D(u_roughnessTexture, u_roughnessTexCoord);
//#REDGL_DEFINE#roughnessTexture# tMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b
//#REDGL_DEFINE#roughnessTexture# tRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g
// diffuse 색상 산출
texelColor = uBaseColorFactor;
//#REDGL_DEFINE#useVertexColor_0# texelColor *= clamp(vVertexColor_0,0.0,1.0) ;
//#REDGL_DEFINE#diffuseTexture# texelColor *= texture2D(u_diffuseTexture, u_diffuseTexCoord);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#diffuseTexture# texelColor.rgb *= texelColor.a;
// 노멀값 계산
N = normalize(vVertexNormal);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 fdx = dFdx(vVertexPosition.xyz);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 fdy = dFdy(vVertexPosition.xyz);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 faceNormal = normalize(cross(fdx,fdy));
bool backFaceYn = false;
//#REDGL_DEFINE#useMaterialDoubleSide# if (dot (vVertexNormal, faceNormal) < 0.0) { N = -N; backFaceYn = true; };
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, u_normalTexCoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, backFaceYn ?  1.0 - u_normalTexCoord : u_normalTexCoord, vec3(normalColor.r, 1.0- normalColor.g, normalColor.b) );
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 pos_dx = dFdx(vVertexPosition.xyz);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 pos_dy = dFdy(vVertexPosition.xyz);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 tex_dx = dFdx(vec3(u_normalTexCoord, 0.0));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 tex_dy = dFdy(vec3(u_normalTexCoord, 0.0));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 ng = normalize(vVertexNormal);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# t = normalize(t - ng * dot(ng, t));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 b = normalize(cross(ng, t));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# mat3 tbn = mat3(t, b, ng);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# N = normalize(tbn * ((2.0 * normalColor.rgb - 1.0) * vec3(1.0, 1.0 * vVertexTangent.w,1.0)));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# N = backFaceYn ? -N : N;
// 환경맵 계산
vec3 R = reflect( vVertexPosition.xyz-uCameraPosition, N);
//#REDGL_DEFINE#environmentTexture# reflectionColor = textureCube(u_environmentTexture, R);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#environmentTexture# reflectionColor.rgb *= reflectionColor.a;
// 환경맵 합성
//#REDGL_DEFINE#environmentTexture# texelColor.rgb = mix( texelColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.0)*(1.0-tRoughnessPower));
//#REDGL_DEFINE#environmentTexture# texelColor = mix( texelColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);
// 컷오프 계산
if(texelColor.a <= u_cutOff) discard;
// 라이팅 계산
float shininess = 128.0 ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue =  1.0 ;
for(int i=0; i<cDIRETIONAL_MAX; i++){
if(i == uDirectionalLightNum) break;
L = normalize(-uDirectionalLightPositionList[i]);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;
specular = pow( max(dot(reflect(L, N), -L), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * u_specularPower * specularTextureValue * uDirectionalLightIntensityList[i]* uDirectionalLightColorList[i].a * (1.0-tRoughnessPower+0.04);
}
}
for(int i=0;i<cPOINT_MAX;i++){
if(i== uPointLightNum) break;
L =  -uPointLightPositionList[i] + vVertexPosition.xyz;
distanceLength = abs(length(L));
if(uPointLightRadiusList[i]> distanceLength){
attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;
L = normalize(L);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;
specular = pow( max(dot(reflect(L, N), -N), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * uPointLightIntensityList[i]  * uPointLightColorList[i].a * (1.0-tRoughnessPower+0.04) ;
}
}
}
finalColor = la * uAmbientIntensity + ld + ls;
finalColor.a = texelColor.a * u_alpha ;
// 그림자 계산
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
// 이미시브합성
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, u_emissiveTexCoord);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= emissiveColor.a;
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= uEmissiveFactor;
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb;
// 오클루젼 합성
//#REDGL_DEFINE#occlusionTexture# occlusionColor = texture2D(u_occlusionTexture, u_occlusionTexCoord);
//#REDGL_DEFINE#occlusionTexture# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * u_occlusionPower);
// 최종결과 산출
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedPBRMaterial_System=function(i,a,o,s,d,f,u){if(!(this instanceof RedPBRMaterial_System))return new RedPBRMaterial_System(i,a,o,s,d,f,u);i instanceof RedGL||RedGLUtil.throwFunc("RedPBRMaterial_System : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedPBRMaterialSystemProgram",RedGLUtil.getStrFromComment(e.toString()),RedGLUtil.getStrFromComment(t.toString()),n),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.occlusionTexture=d,this.emissiveTexture=f,this.roughnessTexture=u,this.normalPower=1,this.specularPower=1,this.metallicFactor=1,this.roughnessFactor=1,this.diffuseTexCoordIndex=0,this.occlusionTexCoordIndex=0,this.emissiveTexCoordIndex=0,this.roughnessTexCoordIndex=0,this.normalTexCoordIndex=0,this.occlusionPower=1,this.baseColorFactor=null,this.emissiveFactor=null,this.alpha=1,this.cutOff=0,this.useMaterialDoubleSide=!1,this.useVertexColor_0=!1,this.useFlatMode=!1,this.useVertexTangent=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0),this._needSearchProgram=null}).prototype=new RedBaseMaterial;var i={callback:function(){var e=this;cancelAnimationFrame(this._needSearchProgram),this._needSearchProgram=requestAnimationFrame(function(){e._searchProgram("RedPBRMaterialSystemProgram",n),e._needSearchProgram=null})}};RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","cutOff","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","diffuseTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","diffuseTexCoordIndex","number"),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","environmentTexture","samplerCube",{callback:i.callback}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","normalTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","normalTexCoordIndex","number"),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","occlusionTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","occlusionTexCoordIndex","number"),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","emissiveTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","emissiveTexCoordIndex","number"),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","roughnessTexture","sampler2D",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","roughnessTexCoordIndex","number"),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","normalPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","specularPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","metallicFactor","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","roughnessFactor","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","occlusionPower","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","useFlatMode","boolean",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","useMaterialDoubleSide","boolean",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","useVertexColor_0","boolean",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","useVertexTangent","boolean",i),RedDefinePropertyInfo.definePrototype("RedPBRMaterial_System","usePreMultiply","boolean",i),Object.freeze(RedPBRMaterial_System)}(),function(){var e,t,r,n=[];e=function(){
/* @preserve
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
const mat4 c3dScale = mat4(
1.0/1024.0, 0.0, 0.0, 0.0,
0.0, 1.0/1024.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0
);
uniform float u_width;
uniform float u_height;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
// position 계산
mat4 targetMatrix;
if(uOrthographicYn){
targetMatrix = uMMatrix * mat4(
u_width, 0.0, 0.0, 0.0,
0.0, u_height, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0
) ;
gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}else{
targetMatrix = uMMatrix * mat4(
u_width/uResolution.y, 0.0, 0.0, 0.0,
0.0, u_height/uResolution.y, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0
) ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
// 그림자
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
finalColor.a *= u_alpha;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedTextMaterial=function(i,a){if(!(this instanceof RedTextMaterial))return new RedTextMaterial(i,a);i instanceof RedGL||RedGLUtil.throwFunc("RedTextMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedTextMaterialProgram",e,t,n),this.diffuseTexture=a,this.alpha=1,this.width=2,this.height=2,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedTextMaterial","diffuseTexture","sampler2D",{essential:!0}),RedDefinePropertyInfo.definePrototype("RedTextMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedTextMaterial","width","number",{min:2,callback:function(e){this._width=e}}),RedDefinePropertyInfo.definePrototype("RedTextMaterial","height","number",{min:2,callback:function(e){this._height=e}}),Object.freeze(RedTextMaterial)}(),(RedAmbientLight=function(e,t,r){if(!(this instanceof RedAmbientLight))return new RedAmbientLight(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedAmbientLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=1,this.alpha=null==r?.1:r,this.color=t||"#fff",this._UUID=RedGL.makeUUID()}).TYPE="RedAmbientLight",RedAmbientLight.prototype=new RedBaseLight,Object.defineProperty(RedAmbientLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedAmbientLight.TYPE}),Object.freeze(RedAmbientLight),(RedDirectionalLight=function(e,t,r){if(!(this instanceof RedDirectionalLight))return new RedDirectionalLight(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=1,this.alpha=null==r?1:r,this.color=t||"#fff",this.x=0,this.y=-1,this.z=0,this._UUID=RedGL.makeUUID(),this.debug=!1,this._debugObject=RedSprite3D(e,RedBitmapMaterial(e,RedBitmapTexture(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA25pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozQjcyMEREMTUyMDYxMUU4OTRDNTgzQTBBMEY2MkFFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDODA1NTI0RjUyMDYxMUU4QkVBQTg3NjZCN0M1OUI2OCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDODA1NTI0RTUyMDYxMUU4QkVBQTg3NjZCN0M1OUI2OCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cykiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNmFjYmZjZi05YjBkLThlNGItODZiNy1kNWViYWNjZDg4OGMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6M0I3MjBERDE1MjA2MTFFODk0QzU4M0EwQTBGNjJBRTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4vVcpuAAAHNUlEQVR42uxbeWyURRT/tiw9OAJYUekfeBCFNmqlkAgRtURQaTywWIhGSfDAAzmkggcoKopKRQXFKKZqNGmkqGAkGEQFhaQenGrAI3iUpKilaiPSytKt74XfF6evM/vN7n67+xn6kl/Sb3bmvTdvZt68eTMNtbe3O8cyhboM0GWALgN0LKkJpUv2lYQFBFbgYcI7aZF6bcf+ZmXI8L0IlYShhBLCbELPTCiSKQOcTRimfA8nFP/fDTCEMJrQw2bpEVqV71ZLXXpARmHQDDCZ8DnhI8IrFkZoI0SVb/77iEXnX4WMzyAzEAbIJSwk9Mb3RMKMFMzWmYQK/N0bMnODYAB2q42i7B5CkY+dZ153i7JGyM64Af4hVIk13cdjFoQsy1yaAZ6qz6iC7ED4gJWEjaLsRkKpoX53MX1zUaajUvBSaSNkBmoXuI/QonyHCXMIeZq6PxJ+Vb5/I/ykqZcHHmGljGXcG8RtcCfhRVFWpjgulfahEzvQjn1GvaZeBXio9AJhV1ADoUcITaJsmKHuKvxWgr91NFx8N0FG2gOhbpb1WMGbxXRd6SE/lg61wrneRPjdT51tDkOTELe3YvrVWPC9CnH+h4SPlfKLCKMQChco/oEN1UD4krAF7Vy6EO14uay2kH0N4XZCDmFJpwEQhyEvAwxF1OV66MOEd8G4znIkuJNTCNcjhO3jUb+ZsIfwOqLKFks5IzFQlxOyURYhnAvjJXQa7Cu2J2Y8gbCBsJhwskf7SzCizxJGWHTejSFGoM0W8IhFA6HLBuiWLbbbvsn4gJ2GKd8T29NWeGodHx6NdXByWQn6pxLwqDT8XgEd5hiO0zXog5HCHkr8QbiO8AMOHwPF78fDUZWL9cmeep6B527CNsK3hAMKn8HYFYo0HX2S0I8wXyRUag0y6nFwWuBl5bDFSPCiuR/WvItwg6bO+YoB7jR0fjthBXxIg0FWAdbwVIy+SvOwyzytyNTRyzDYnlSlxEYh6hunePCLsV75t82aNrx7PCiiv1h0IurfajC2K+t9ZSd5j7AIv1mnxBLNCXJK61KMEiuxCdvOds0U5o48lGCcsgDt5RIqwUGoFMbfAQMcjDcn6GdSlPfe5aJsKWFWksHaM8gFqDSN8HxC3FKUFM3CulXpa2xPydJi8FJpql+6+2WACwiDNCPX4APvBvBSaRBkBsYAY+AXXOItbo2PZ5Y14Kn6oDF+MA7HyPMVI5I6IrI2XPY9Yb9SfpZoX6c5FSZDTeA5OIZM3jnOgL7t4lDUhiN0i40BLkNkVYjGUc0pqxGxQS1m0QBR5xvHf5I8B0A268eJWL5d6q/RNwSD7EYaba2XAZZrIj5J/bA9rYbFszUj5jdJntnoWHfoMtjCT50iDZCpm6HAkG4GTMMSKFKmjzRaI6wewfdhUSc/BbpKnoehXwS6LMQSaNPo24bQuMrGAGuRkChWHIi6nrjNd0pYGxUOkWlICgwgee5X1nstQvDTYZB20ccInGCr7S7A3vLTOJT7inCFSE7k++gL8sFTypQG2Z+pOOADEYezQxrv4+iPF07uIGQGJhD6hLBXlM3C8TZZKtCcJ/ZCZmAMEMVZX6UzCXN94D0XvFRaodnv02qAXkhHLXL+u/6qRrCh0kybrIzHcXim5jhcjb9LocPVIhS3pmM+IRLPDCiE5TcrnXegQDn+ZuGzNW25I5zcvMXDLxSgzjpD52crHSx3Ot47joNu1U4cL0hsZkAIcfbkGCFyKpOiLj3qdEyK8uXL24a65qRonBkhjvmf42YGQQeQCXpL45QqkcxI1tFG4QiXaPzXBJxd+hvaciL3DudodjuhJXCOofN/I6zky8tVBo/MCvPN7vYEPXYUbcs0nXd/XwUdqqBTp/FGHxLeBf5EGOkSJyLfJIzFqPzs0X49nNV0RJbNFh1vRt3paLveo349dBmLmaieSyLoQ1I+QL0c5UTkGxad4PVZgmjNj8vRMfAbNlkmvhy9DUmdpC9H1ZliO41V59SKkTFtTe4Vdpvh9/NgxFyFt22qrZuWb4LboG3n+dDykkitTfTgG4v3JKfjW6LqOI7abekMhV2ar1Fwq6FuBZzcNkf/jEbX9jixFSZNfl6McP6gTgQn6xCmymQkxxP80us05XDDT2D3iXp5cLpl4qg+0kn0nVAKX4s/Jjp/BNuT7oED5+ZOEKHvqYa8RJXTMTOdB1m+kF8GmIQRdMR63WSoH3E6P5aOGOpuUg4/Lo2GzEAYIAc5xFyxly+L0abdssylZSKGyIXMnCAYIKQJRZ/QHI2TIeb1uCjr74f+fhiApy9fkvyFbw5Plzr+E88C90UIy3rAsX9AZaSwT8q9RviCcJJz9FXZIQu5WWIgvN71Mc8pyC384li+AEmXARwoZKtU1On8WNrm6fshp/Oj7EDsAvHSLhHkbMM5IO0UzpAB+Oj6FPJ4IRxaDmZCka5/nOwyQJcBjm0D/CvAAF/S81D+EWScAAAAAElFTkSuQmCC")))}).TYPE="RedDirectionalLight",RedDirectionalLight.prototype=new RedBaseLight,Object.defineProperty(RedDirectionalLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedDirectionalLight.TYPE}),Object.freeze(RedDirectionalLight),(RedPointLight=function(e,t,r){if(!(this instanceof RedPointLight))return new RedPointLight(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedPointLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=1,this.alpha=null==r?1:r,this.color=t||"#fff",this.x=0,this.y=0,this.z=0,this.radius=1,this.debug=!1,this._debugObject=RedMesh(e,RedSphere(e,1,16,16,16),RedColorMaterial(e)),this._debugObject.drawMode=e.gl.LINE_STRIP,this._UUID=RedGL.makeUUID()}).TYPE="RedPointLight",RedPointLight.prototype=new RedBaseLight,Object.defineProperty(RedPointLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedPointLight.TYPE}),RedDefinePropertyInfo.definePrototype("RedPointLight","radius","number",{min:0}),Object.freeze(RedPointLight),JsonModelLoader=function(e,t,r,n){if(!(this instanceof JsonModelLoader))return new JsonModelLoader(e,t,r,n);var i=new XMLHttpRequest;i.open("GET",r,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){if(4==i.readyState){var r,a,o,s;for(a=[],o=0,s=(r=JSON.parse(i.responseText)).position.length/3;o<s;o++)a.push(r.position[3*o],r.position[3*o+1],r.position[3*o+2]),a.push(r.normal[3*o],r.normal[3*o+1],r.normal[3*o+2]),r.uvs?a.push(r.uvs[2*o],r.uvs[2*o+1]):a.push(0,0);n&&n(RedBuffer(e,t,RedBuffer.ARRAY_BUFFER,new Float32Array(a),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),RedBuffer(e,t,RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(r.index)))}},i.send()},Object.freeze(JsonModelLoader),function(){var e,t;t=function(){},RedMTLLoader=function(r,n,i,a){if(!(this instanceof RedMTLLoader))return new RedMTLLoader(r,n,i,a);var o=this,s=new XMLHttpRequest;s.open("GET",n+i,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.onreadystatechange=function(){if(4==s.readyState){var n;if(o.complete=!0,200==s.status)n=e(o,r,s.responseText),o.parseData=n;else o.parseData=new t;a&&a(o.parseData)}},s.addEventListener("error",function(e){}),s.send(),this.path=n,this.fileName=i,this.complete=!1,this.parseData=null},e=function(e,r,n){var i,a,o,s,d,f,u,l,c,h,R,m,p,_;for(var g in i={},o=/^(newmtl )/,s=/^(Ns )/,d=/^(Ka )/,f=/^(Kd )/,u=/^(Ks )/,l=/^(Ni )/,c=/^(d )/,h=/^(illum )/,R=/^(map_Kd )/,/^(map_Ks )/,m=/^(map_Ns )/,p=/^(map_bump )/,(n=n.replace(/^\#[\s\S]+?\n/g,"")).split("\n").forEach(function(t){var r;o.test(t)?(r=t.replace("newmtl ","").trim(),_={name:r},i[r]=_):d.test(t)?_.Ka=t.replace("Ka ","").split(" "):f.test(t)?_.Kd=t.replace("Kd ","").split(" "):u.test(t)?_.Ks=t.replace("Ks ","").split(" "):s.test(t)?_.Ns=+t.replace("Ns ",""):l.test(t)?_.Ni=+t.replace("Ni ",""):c.test(t)?_.d=+t.replace("d ",""):h.test(t)?(_.illum=+t.replace("illum ",""),_.illum):R.test(t)?_.map_Kd=e.path+t.replace("map_Kd ",""):m.test(t)?_.map_Ns=e.path+t.replace("map_Ns ",""):p.test(t)&&(_.map_bump=e.path+t.replace("map_bump ","").split(" ")[2])}),a=new t,i)a[g]=i[g];return a},Object.freeze(RedMTLLoader)}(),function(){var e,t,r,n,i,a,o,s,d,f,u,l,c,h,R;RedOBJLoader=function(t,r,n,i){if(!(this instanceof RedOBJLoader))return new RedOBJLoader(t,r,n,i);var a=this,o=new XMLHttpRequest;o.open("GET",r+n,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){4==o.readyState&&(a.result=e(a,t,o.responseText),a.modelParsingComplete=!0,a.resultMesh=void 0,i&&(a.mtlLoader?a.mtlLoader.complete&&i(a.result):i(a.result)))},o.send(),this.path=r,this.fileName=n,this.mtlLoader=null,this.modelParsingComplete=!1,this.callback=i,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedOBJLoader_"+RedGL.makeUUID(),this.result=null},r=function(e,t,r){var n,i,a,o;for(n in o={},t){var s,d,f,u,l,c;if((a=t[n]).mesh,a.use&&a.resultInterleave.length)c=a.ableLight,(i=r.parseData[a.materialKey])&&(i.map_Kd?(o[i.map_Kd]?d=o[i.map_Kd]:(d=RedBitmapTexture(e,i.map_Kd),o[i.map_Kd]=d),s=c?RedStandardMaterial(e,d):RedBitmapMaterial(e,d)):i.Kd&&(f=255*i.Kd[0],u=255*i.Kd[1],l=255*i.Kd[2],s=c?RedColorPhongTextureMaterial(e,RedGLUtil.rgb2hex(f,u,l)):a.ableNormal?RedColorPhongMaterial(e,RedGLUtil.rgb2hex(f,u,l)):RedColorMaterial(e,RedGLUtil.rgb2hex(f,u,l))),s&&(i.map_Ns&&(o[i.map_Ns]?d=o[i.map_Ns]:(d=RedBitmapTexture(e,i.map_Ns),o[i.map_Ns]=d),s.specularTexture=d),i.map_bump&&(o[i.map_bump]?d=o[i.map_bump]:(d=RedBitmapTexture(e,i.map_bump),o[i.map_bump]=d),s.normalTexture=d),null!=i.Ns&&(s.shininess=i.Ns),a.mesh.material=s))}},t=function(e,r,n){for(var i in n){var a,o;if((a=n[i]).use){var s,d,f,u=[];a.resultPosition.length&&u.push(RedInterleaveInfo("aVertexPosition",3)),a.resultNormal.length&&u.push(RedInterleaveInfo("aVertexNormal",3)),a.resultUV.length&&u.push(RedInterleaveInfo("aTexcoord",2)),s=RedBuffer(e,i+"_interleave",RedBuffer.ARRAY_BUFFER,new Float32Array(a.resultInterleave.length?a.resultInterleave:a.resultPosition),u),a.index.length&&a.index.length&&(d=RedBuffer(e,i+"_index",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.index))),f=a.resultUV.length&&a.resultNormal.length?RedColorPhongTextureMaterial(e,"#00ff00"):a.resultNormal?RedColorPhongMaterial(e,"#00ff00"):RedColorMaterial(e,"#0000ff"),o=RedMesh(e,RedGeometry(s,d),f),a.ableUV=!!a.resultUV.length,a.ableNormal=!!a.resultNormal.length,a.ableLight=!!(a.ableUV&a.ableNormal)}else o=RedMesh(e);o.name=i,a.mesh=o,r.addChild(o),t(e,o,a.childrenInfo)}},h=/^(mtllib )/,R=/^(usemtl )/,i=/^o /,a=/^g /,o=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,s=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,d=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,f=/f\s+(([\d]{1,}[\s]?){3,})+/,u=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,l=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,c=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,n=function(e,t,n){var m,p,_,g,E,P,y,v,M,T;for(_={position:[],normal:[],uv:[],points:[],normalPoints:[],uvPoints:[]},p={},m={},y=n.length;y--;)if(i.test(n[y])){v=!0;break}return v||(T={name:M="objModel"+RedGL.makeUUID(),groupName:M,index:[],position:[],resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},p[M]=g=T,m[M]=g,E=M),n.forEach(function(n){if(h.test(n))return P=RedMTLLoader(e,t.path,n.split(" ")[1],function(n){t.mtlLoader=n,t.modelParsingComplete&&t.callback&&(r(e,m,P),t.callback(t.result))}),void(t.mtlLoader=P);var y;if(R.test(n))v=n.split(" ").slice(1).join("").trim(),m[E].materialKey=v;else if(a.test(n))v=n.split(" ").slice(1).join("").trim(),p[E].use=!1,M={name:v,groupName:E,materialKey:v.replace(E+"_",""),index:[],position:g.position,resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},m[v]=g=M,p[E].childrenInfo[v]=g;else if(i.test(n)){var v,M;M={name:v=n.split(" ").slice(1).join("").trim(),groupName:v,materialKey:v,index:[],position:[],resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},p[v]=g=M,m[v]=g,E=v}if(o.test(n))y=n.split(" "),_.position.push(+y[1],+y[2],+y[3]),g.position.push(+y[1],+y[2],+y[3]),_.points[_.points.length]=[+y[1],+y[2],+y[3]];else if(s.test(n)){var T;T=n.split(" "),_.normal.push(+T[1],+T[2],+T[3]),_.normalPoints[_.normalPoints.length]=[+T[1],+T[2],+T[3]]}else if(d.test(n)){var x;x=n.split(" "),_.uv.push(+x[1],1-x[2]),_.uvPoints[_.uvPoints.length]=[+x[1],1-x[2]]}else if(c.test(n))(I=n.split(" ").slice(1,4)).forEach(function(e){var t,r,n;n=0,e=e.split("/"),D=+e[0]-1,b=+e[2]-1,t=_.points[D],r=_.normalPoints[b],_.position.length&&(n+=3),_.normal.length&&(n+=3),g.index.push(g.resultInterleave.length/n),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.normal.length&&(g.resultNormal.push(r[0],r[1],r[2]),g.resultInterleave.push(r[0],r[1],r[2]))});else if(l.test(n)){var b;if(4==(I=n.split(" ").slice(1,5)).length){var L=I[3];I[3]=I[0],I[4]=I[2],I[5]=L}I.forEach(function(e){var t,r,n,i;i=0,e=e.split("/"),D=+e[0]-1,w=+e[1]-1,b=+e[2]-1,t=_.points[D],n=_.uvPoints[w],r=_.normalPoints[b],_.position.length&&(i+=3),_.normal.length&&(i+=3),_.uv.length&&(i+=2),g.index.push(g.resultInterleave.length/i),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.normal.length&&(g.resultNormal.push(r[0],r[1],r[2]),g.resultInterleave.push(r[0],r[1],r[2])),_.uv.length&&(g.resultUV.push(n[0],n[1]),g.resultInterleave.push(n[0],n[1]))})}else if(u.test(n)){var I,w;(I=n.split(" ").slice(1,4)).forEach(function(e){var t,r,n;n=0,e=e.split("/"),D=+e[0]-1,w=+e[1]-1,t=_.points[D],r=_.uvPoints[w],_.position.length&&(n+=3),_.uv.length&&(n+=2),g.index.push(g.resultInterleave.length/n),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.uv.length&&(g.resultUV.push(r[0],r[1]),g.resultInterleave.push(r[0],r[1]))})}else if(f.test(n)){var D;D=n.split(" "),g.resultInterleave=g.resultPosition=g.position,g.index.push(+D[1]-1,+D[2]-1,+D[3]-1),g.index.push(+D[1]-1,+D[3]-1,+D[4]-1)}}),{info:m,infoHierarchy:p}},e=function(e,r,i){i=i.replace(/^\#[\s\S]+?\n/g,"");var a=n(r,e,i.split("\n"));return t(r,e.resultMesh,a.infoHierarchy),new function(e){for(var t in e)this[t]=e[t]}({fileName:e.fileName,path:e.path,resultMesh:e.resultMesh,parseRawInfo:a.info,parseInfoHierarchy:a.infoHierarchy,parseInfoMaterial:e.mtlLoader})},Object.freeze(RedOBJLoader)}(),function(){var e,t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p,_,g;Red3DSLoader=function(t,r,n,i){if(!(this instanceof Red3DSLoader))return new Red3DSLoader(t,r,n,i);var a=this,o=new XMLHttpRequest;o.open("GET",r+n,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){4==o.readyState&&200===o.status&&(a.result=e(a,t,o.response),i&&i(a.result))},o.send(),this.redGL=t,this.position=0,this.materials={},this.meshs=[],this.path=r,this.fileName=n,this.callback=i,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRed3DSLoader_"+RedGL.makeUUID(),this.result=null},r=function(e,t){var r={};return r.cur=e.position,r.id=a(e,t),r.size=o(e,t),r.end=r.cur+r.size,r.cur+=6,r},n=function(e,t,n){if(n.cur>=n.end)return 0;e.position=n.cur;try{var i=r(e,t);return n.cur+=i.size,i.id}catch(e){return 0}},i=function(e,t){e.position=t.end},a=function(e,t){var r=t.getUint16(e.position,!0);return e.position+=2,r},o=function(e,t){var r=t.getUint32(e.position,!0);return e.position+=4,r},d=function(e,t){var r=t.getUint8(e.position,!0);return e.position+=1,r},s=function(e,t,r){var n,i,a="";for(n=0;n<r&&(i=d(e,t));n++)a+=String.fromCharCode(i);return a},R=function(e,t){try{var r=t.getFloat32(e.position,!0);return e.position+=4,r}catch(e){}},f=function(e,t){var n,a=r(e,t);return 17===a.id||18===a.id?n=RedGLUtil.rgb2hex(d(e,t),d(e,t),d(e,t)):16!==a.id&&19!==a.id||(n=RedGLUtil.rgb2hex(d(e,t),d(e,t),d(e,t))),i(e,a),n},l=function(e){e.position-=6},u=function(e,t,a){for(var o=r(e,t),d=n(e,t,o),f={};0!==d;){switch(d){case 41728:var u=s(e,t,128);f=RedBitmapTexture(e.redGL,a+u);break;case 41816:f.offset||(f.offset={}),f.offset.x=R(e,t);break;case 41818:f.offset||(f.offset={}),f.offset.y=R(e,t);break;case 41812:f.repeat||(f.repeat={}),f.repeat.x=R(e,t);break;case 41814:f.repeat||(f.repeat={}),f.repeat.y=R(e,t)}d=n(e,t,o)}return i(e,o),f},_=function(e,t,o){for(var c,h=r(e,t),R=n(e,t,h),m={};0!==R;){switch(R){case 40960:m.name=s(e,t,64);break;case 41093:m.wireframe=!0;break;case 41095:d(e,t);break;case 41089:case 41091:break;case 40992:m.color=f(e,t);break;case 41008:case 40976:break;case 41024:var p=a(e,t);m.shininess=p;break;case 41472:l(e),m.diffuseTexture=u(e,t,o);break;case 41520:l(e),m.normalTexture=u(e,t,o);break;case 41488:l(e);break;case 41476:l(e),m.specularTexture=u(e,t,o)}R=n(e,t,h)}m.diffuseTexture?"shininess"in m?((c=RedStandardMaterial(e.redGL,m.diffuseTexture)).normalTexture=m.normalTexture,c.specularTexture=m.specularTexture):c=RedBitmapTexture(e.redGL,m.diffuseTexture):(m.normalTexture||m.specularTexture?c=RedColorPhongTextureMaterial(e.redGL):"shininess"in m?c=RedColorPhongMaterial(e.redGL):RedColorMaterial(e.redGL),c.color=m.color),i(e,h),c.shininess=m.shininess,c.name=m.name,e.materials[m.name]=c},c=function(e,t,i){for(var a=r(e,t),s=n(e,t,a);0!==s;){switch(s){case 15678:o(e,t);break;case 256:var d=R(e,t);e.resultMesh.scaleX=d,e.resultMesh.scaleY=d,e.resultMesh.scaleZ=d;break;case 16384:l(e),m(e,t);break;case 45055:l(e),_(e,t,i)}s=n(e,t,a)}},g=function(e,t){r(e,t);for(var n=s(e,t,64),i=a(e,t),o=[],d=0;d<i;++d)o.push(a(e,t));return{name:n,index:o}},p=function(e,t,n){for(var o=r(e,t),s=a(e,t),d=[],f=0;f<s;++f)d.push(a(e,t),a(e,t),a(e,t)),a(e,t);for(;e.position<o.end;){if(16688===(o=r(e,t)).id){l(e);var u=g(e,t),c=e.materials[u.name];void 0!==c&&(n.material=c,""===c.name&&(c.name=n.name))}i(e,o)}return i(e,o),d},h=function(e,t){for(var o,s,d,f,u,c=r(e,t),h=n(e,t,c),m=[],_=RedMesh(e.redGL);0!==h;){switch(h){case 16656:var g=a(e,t),E=[];for(s=0;s<g;s++)E.push(R(e,t),R(e,t),R(e,t));break;case 16672:l(e),o=p(e,t,_);break;case 16704:var P=a(e,t);for(m=[],s=0;s<P;s++)m.push(R(e,t)),m.push(1-R(e,t));break;case 16736:var y=[];for(s=0;s<12;s++)y[s]=R(e,t);var v=mat4.create();v[0]=y[0],v[1]=y[6],v[2]=y[3],v[3]=y[9],v[4]=y[2],v[5]=y[8],v[6]=y[5],v[7]=y[11],v[8]=y[1],v[9]=y[7],v[10]=y[4],v[11]=y[10],v[12]=0,v[13]=0,v[14]=0,v[15]=1}h=n(e,t,c)}i(e,c);var M=RedGLUtil.calculateNormals(E,o),T=[];for(s=0,d=E.length/3;s<d;s++)T.push(E[3*s+0],E[3*s+1],E[3*s+2]),T.push(M[3*s+0],M[3*s+1],M[3*s+2]),m.length&&T.push(m[2*s+0],m[2*s+1]);var x=[];x.push(RedInterleaveInfo("aVertexPosition",3)),x.push(RedInterleaveInfo("aVertexNormal",3)),m.length&&x.push(RedInterleaveInfo("aTexcoord",2)),f=RedBuffer(e.redGL,"testRed3DS",RedBuffer.ARRAY_BUFFER,new Float32Array(T),x),u=RedBuffer(e.redGL,"testRed3DS",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(o));var b=RedGeometry(f,u);return _.geometry=b,_.name="mesh"+RedGL.makeUUID(),_.matrix=v,_},m=function(e,t){var a=r(e,t),o=s(e,t,64);a.cur=e.position;for(var d,f=n(e,t,a);0!==f;)16640===f&&(l(e),(d=h(e,t)).name=o,e.meshs.push(d)),f=n(e,t,a);i(e,a)},t=function(e,t,i){var a=new DataView(t),o=r(e,a);if(15786===o.id||49725===o.id||19789===o.id)for(var s=n(e,a,o);0!==s;){switch(s){case 2:break;case 15677:l(e),c(e,a,i)}s=n(e,a,o)}},e=function(e,r,n){return t(e,n,e.path),e.meshs.forEach(function(t){e.resultMesh.addChild(t)}),{fileName:e.fileName,path:e.path,resultMesh:e.resultMesh}},Object.freeze(Red3DSLoader)}(),function(){var e,t,r,n,i,a,o;RedDAELoader=function(t,r,n,i){if(!(this instanceof RedDAELoader))return new RedDAELoader(t,r,n,i);var a=this,o=new XMLHttpRequest;o.open("GET",r+n,!0),o.setRequestHeader("Content-Type","application/xml; charset=UTF-8"),o.onreadystatechange=function(){if(4==o.readyState&&200===o.status){var r=new DOMParser;a.result=e(a,t,r.parseFromString(o.responseText,"text/xml")),i&&i(a.result)}},o.send(),this.path=r,this.fileName=n,this.callback=i,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedDAELoader_"+RedGL.makeUUID(),this.result=null},n=function(e){var t,r,n,i,a,o,s=[],d=[],f=[];for(i=(n=e[0].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,a=(n=e[1].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,o=(n=e[2].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,t=0,r=i.length/3;t<r;t++)s.push([i[3*t+0],i[3*t+1],i[3*t+2]]);if(a)for(t=0,r=a.length/3;t<r;t++)d.push([a[3*t+0],a[3*t+1],a[3*t+2]]);if(o)for(t=0,r=o.length/2;t<r;t++)f.push([o[2*t+0],1-o[2*t+1]]);return{pointList:s,normalPointList:d,uvPointList:f}},i=function(e,t,r){var n={};return r.querySelectorAll("library_images image").forEach(function(r){n[r.getAttribute("id")]=RedBitmapTexture(e,t.path+r.querySelector("init_from").textContent)}),n},a=function(e,t){var r={};return e.querySelectorAll("library_effects effect").forEach(function(e){e.querySelector("newparam init_from")&&(r[e.getAttribute("id")]={texture:t[e.querySelector("newparam init_from").textContent]})}),r},o=function(e,t){var r={};return e.querySelectorAll("library_materials material").forEach(function(e){r[e.getAttribute("id")]={effect:t[e.querySelector("instance_effect").getAttribute("url").replace("#","")]}}),r},t=function(e,t,r){var n=i(e,t,r),s=a(r,n);return{textureMap:n,effectMap:s,materialMap:o(r,s)}},r=function(e,r,i){i.querySelectorAll("library_geometries geometry mesh").forEach(function(a){var o,s,d;o=a.querySelectorAll("source"),s=n(o),d=t(r,e,i);var f=a.querySelectorAll("source").length;a.querySelectorAll("polylist").forEach(function(t,n){var i,a,o,u=[],l=t.querySelector("p").textContent.split(" "),c=[],h=[],R=[],m=[];l.forEach(function(e,t){t%f==0?c.push(+e):t%f==1?h.push(+e):t%f==2&&R.push(+e)});var p={};if(c.forEach(function(e,t){u[8*e+0]=s.pointList[e][0],u[8*e+1]=s.pointList[e][1],u[8*e+2]=s.pointList[e][2],p[e]||(p[e]=[]),p[e].push(t),u[8*e+3]=s.normalPointList[h[t]][0],u[8*e+4]=s.normalPointList[h[t]][1],u[8*e+5]=s.normalPointList[h[t]][2],u[8*e+6]=s.uvPointList[R[t]][0],u[8*e+7]=s.uvPointList[R[t]][1],m.push(e)}),i=RedBuffer(r,"daeInterleaveBuffer"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(u),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),a=RedBuffer(r,"daeIndexData"+RedGL.makeUUID(),RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(m)),(o=RedMesh(r)).geometry=RedGeometry(i,a),d.materialMap[t.getAttribute("material")].effect){var _=d.materialMap[t.getAttribute("material")].effect.texture;o.material=RedStandardMaterial(r,_)}else o.material=RedColorPhongMaterial(r);e.resultMesh.addChild(o)})})},e=function(e,t,n){return r(e,t,n),{fileName:e.fileName,path:e.path,resultMesh:e.resultMesh}},Object.freeze(RedDAELoader)}(),function(){var e,t={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},r=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.overrideMimeType("application/octet-stream"),n.responseType="arraybuffer",n.onreadystatechange=function(e){4==n.readyState&&200===n.status?t(n):r(n,e)},n.send()};RedGLTFLoader=function(t,n,i,a,o,s){if(!(this instanceof RedGLTFLoader))return new RedGLTFLoader(t,n,i,a,o,s);var d,f,u,l,c=this;if(i.indexOf(".glb")>-1){var R;R=function(e){var t="";return e.map(function(e){t+=String.fromCharCode(e)}),t},r(n+i,function(r){for(var n=null,i=null,o=null,s=null,d=0,f=0,u=null,l=new DataView(r.response,12),h=(R(new Uint8Array(r.response,0,4)),l.getUint32(4,!0),l.getUint32(8,!0),new DataView(r.response,12));d<h.byteLength;)f=h.getUint32(d,!0),d+=4,u=h.getUint32(d,!0),d+=4,1313821514===u?(i=new Uint8Array(r.response,12+d,f),n=R(i)):5130562===u&&(s=12+d,o=r.response.slice(s,s+f)),d+=f;if(null===n)throw new Error("JSON content not found");var m=JSON.parse(n),p=o;m.images&&m.images.forEach(function(e){if("image/png"===e.mimeType||"image/jpeg"===e.mimeType||"image/gif"===e.mimeType){var t;t=m.bufferViews[e.bufferView].byteOffset||0;var r=p.slice(t,t+m.bufferViews[e.bufferView].byteLength),n=new Blob([new Uint8Array(r)],{type:e.mimeType});e.uri=URL.createObjectURL(n)}}),e(c,t,m,function(){a&&a(c)},p)},function(e,t){})}else d=n+i,f=function(r){e(c,t,JSON.parse(r.response),function(){a&&a(c)})},u=function(e,t){},(l=new XMLHttpRequest).open("GET",d,!0),l.onreadystatechange=function(e){4==l.readyState&&200===l.status?f(l):u(l,e)},l.send();this.redGL=t,this.path=n,this.fileName=i,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedGLTFLoader_"+RedGL.makeUUID(),this.parsingResult={groups:[],materials:[],uris:{buffers:[]},textures:{},cameras:[],animations:[]},this.parsingOption=s,this.environmentTexture=o||null;var m=null;this.stopAnimation=function(){h.indexOf(m)>-1&&h.splice(h.indexOf(m),1)},this.playAnimation=function(e){h.push(m={startTime:performance.now(),targetAnimationData:e})}},RedDefinePropertyInfo.definePrototype("RedGLTFLoader","environmentTexture","samplerCube",{callback:function(e){this.parsingResult.materials.forEach(function(t){"environmentTexture"in t&&(t.environmentTexture=e)})}});var n,i,a,o,s,d,f,u,l,c,h=[];RedGLTFLoader.animationLooper=function(e){h.forEach(function(t){o=null,s=null,d=null,f=null,(c=t.targetAnimationData).forEach(function(r,h){n=(e-t.startTime)%(1e3*c.maxTime)/1e3;var R,m,p=r.target;m=r.time.length-1,R=0,i=r.time[m],a=r.time[R];for(var _=r.time.length,g=0;g<_;g++){var E=r.time[g],P=g;if(E<n&&(m=P,i=r.time[m],null==r.time[m+1]?(R=0,a=r.time[R]):(R=m+1,a=r.time[R])),0==P&&n<r.time[g]){m=_-1,i=r.time[m],R=P,a=r.time[R],n=E;break}if(P==_-1&&n>E){m=0,i=r.time[m],R=_-1,a=r.time[R],n=E;break}}if("CUBICSPLINE"!=r.interpolation){if("NaN"==(G="STEP"==r.interpolation?0:(n-i)/(a-i)).toString()&&(G=0),"rotation"==r.key&&(W=[r.data[4*R],r.data[4*R+1],r.data[4*R+2],r.data[4*R+3]],s=W,W=[r.data[4*m],r.data[4*m+1],r.data[4*m+2],r.data[4*m+3]],o=W),"translation"==r.key&&(f=[r.data[3*R],r.data[3*R+1],r.data[3*R+2]],d=[r.data[3*m],r.data[3*m+1],r.data[3*m+2]]),"scale"==r.key&&(l=[r.data[3*R],r.data[3*R+1],r.data[3*R+2]],u=[r.data[3*m],r.data[3*m+1],r.data[3*m+2]]),p){if("translation"==r.key&&(p.x=d[0]+G*(f[0]-d[0]),p.y=d[1]+G*(f[1]-d[1]),p.z=d[2]+G*(f[2]-d[2])),"rotation"==r.key){K=[],quat.normalize(o,o),quat.normalize(s,s);var y,v,M,T,x,b=o[0],L=o[1],I=o[2],w=o[3],D=s[0],U=s[1],B=s[2],S=s[3];(v=b*D+L*U+I*B+w*S)<0&&(v=-v,D=-D,U=-U,B=-B,S=-S),1-v>glMatrix.EPSILON?(y=Math.acos(v),M=Math.sin(y),T=Math.sin((1-G)*y)/M,x=Math.sin(G*y)/M):(T=1-G,x=G),K[0]=T*b+x*D,K[1]=T*L+x*U,K[2]=T*I+x*B,K[3]=T*w+x*S,Q=[],$=[0,0,0],RedGLUtil.quaternionToRotationMat4(K,Q),RedGLUtil.mat4ToEuler(Q,$),$[0]=-180*$[0]/Math.PI,$[1]=-180*$[1]/Math.PI,$[2]=-180*$[2]/Math.PI,p.rotationX=$[0],p.rotationY=$[1],p.rotationZ=$[2]}"scale"==r.key&&(p.scaleX=u[0]+G*(l[0]-u[0]),p.scaleY=u[1]+G*(l[1]-u[1]),p.scaleZ=u[2]+G*(l[2]-u[2])),"weights"==r.key&&r.targets.forEach(function(e){for(var t,n,i,a,o,s,d,f=e.geometry.interleaveBuffer.data,u=e._morphInfo.origin,l=e.geometry.interleaveBuffer.stride,c=0,h=f.length/l,p=e._morphInfo.list.length,_=r.data,g=e._morphInfo.list;c<h;c++){t=u[d=c*l],n=u[d],i=u[d+1],a=u[d+1],o=u[d+2],s=u[d+2];for(var E,P,y,v=p;v--;)E=_[m*p+v],P=_[R*p+v],t+=E*(y=g[v].interleaveData)[d],n+=P*y[d],i+=E*y[d+1],a+=P*y[d+1],o+=E*y[d+2],s+=P*y[d+2];f[d]=t+G*(n-t),f[d+1]=i+G*(a-i),f[d+2]=o+G*(s-o)}e.geometry.interleaveBuffer.upload(f)})}}else{G=(n-i)/(a-i);var G=a-i;"NaN"==G.toString()&&(G=0);var A=(n-i)/G;"NaN"==A.toString()&&(A=0);var F=A*A,C=F*A,O=-2*C+3*F,N=C-F,k=1-O,Y=N-F+A;if(p){var X,j,z,V;if("translation"==r.key){f=[r.data[9*m+3],r.data[9*m+4],r.data[9*m+5]],d=[r.data[9*R+3],r.data[9*R+4],r.data[9*R+5]];var Z=[r.data[9*m+6],r.data[9*m+7],r.data[9*m+8]],H=[r.data[9*R+0],r.data[9*R+1],r.data[9*R+2]];X=d[0],m!=_-1&&(j=Z[0]*G,z=f[0],V=H[0]*G,p.x=k*X+Y*j+O*z+N*V,X=d[1],j=Z[1]*G,z=f[1],V=H[1]*G,p.y=k*X+Y*j+O*z+N*V,X=d[2],j=Z[2]*G,z=f[2],V=H[2]*G,p.z=k*X+Y*j+O*z+N*V)}if("rotation"==r.key){var W=[r.data[12*R+4],r.data[12*R+5],r.data[12*R+6],r.data[12*R+7]];s=W;var W=[r.data[12*m+4],r.data[12*m+5],r.data[12*m+6],r.data[12*m+7]];o=W;var q=[r.data[12*m+8],r.data[12*m+9],r.data[12*m+10],r.data[12*m+11]],J=[r.data[12*R+0],r.data[12*R+1],r.data[12*R+2],r.data[12*R+3]];quat.normalize(o,o),quat.normalize(s,s),quat.normalize(q,q),quat.normalize(J,J);var K=[];if(m!=_-1){X=o[0],j=q[0]*G,z=s[0],V=J[0]*G,K[0]=k*X+Y*j+O*z+N*V,X=o[1],j=q[1]*G,z=s[1],V=J[1]*G,K[1]=k*X+Y*j+O*z+N*V,X=o[2],j=q[2]*G,z=s[2],V=J[2]*G,K[2]=k*X+Y*j+O*z+N*V,X=o[3],j=q[3]*G,z=s[3],V=J[3]*G,K[3]=k*X+Y*j+O*z+N*V;var Q=[],$=[0,0,0];RedGLUtil.quaternionToRotationMat4(K,Q),RedGLUtil.mat4ToEuler(Q,$),$[0]=-180*$[0]/Math.PI,$[1]=-180*$[1]/Math.PI,$[2]=-180*$[2]/Math.PI,p.rotationX=$[0],p.rotationY=$[1],p.rotationZ=$[2]}}if("scale"==r.key){l=[r.data[9*m+3],r.data[9*m+4],r.data[9*m+5]],u=[r.data[9*R+3],r.data[9*R+4],r.data[9*R+5]];var ee=[r.data[9*m+6],r.data[9*m+7],r.data[9*m+8]],te=[r.data[9*R+0],r.data[9*R+1],r.data[9*R+2]];X=u[0],m!=_-1&&(j=ee[0]*G,z=l[0],V=te[0]*G,p.scaleX=k*X+Y*j+O*z+N*V,X=u[1],j=ee[1]*G,z=l[1],V=te[1]*G,p.scaleY=k*X+Y*j+O*z+N*V,X=u[2],j=ee[2]*G,z=l[2],V=te[2]*G,p.scaleZ=k*X+Y*j+O*z+N*V)}"weights"==r.key&&r.targets.forEach(function(e){for(var t,n,i,a,o,s,d,f=e.geometry.interleaveBuffer.data,u=e._morphInfo.origin,l=e.geometry.interleaveBuffer.stride,c=0,h=f.length/l,p=e._morphInfo.list.length,_=r.data,g=e._morphInfo.list;c<h;c++){t=u[d=c*l],n=u[d],i=u[d+1],a=u[d+1],o=u[d+2],s=u[d+2];for(var E,P,y,v=p;v--;)v%3==1&&(E=_[m*p+v],P=_[R*p+v],t+=E*(y=g[v].interleaveData)[d],n+=P*y[d],i+=E*y[d+1],a+=P*y[d+1],o+=E*y[d+2],s+=P*y[d+2]);f[d]=t+G*(n-t),f[d+1]=i+G*(a-i),f[d+2]=o+G*(s-o)}e.geometry.interleaveBuffer.upload(f)})}}})})},e=function(){var e,n,i,a,o,s,d,f,u,l,c,h,R,m;e=function(e){void 0===e.asset&&RedGLUtil.throwFunc("RedGLTFLoader - asset은 반드시 정의되어야함"),e.asset.version[0]<2&&RedGLUtil.throwFunc("RedGLTFLoader - asset의 버전은 2.0이상이어야함")},i=function(e,t,n){var i=0,a=0,o=[];t.buffers.forEach(function(e,t){e._redURIkey="buffers",e._redURIIndex=t,o.push(e)}),o.forEach(function(t){if(i++,t.uri instanceof ArrayBuffer)a++,e.parsingResult.uris[t._redURIkey][t._redURIIndex]=new DataView(t.uri),a==i&&n&&n();else{var o="data:"==t.uri.substr(0,5)?t.uri:e.path+t.uri;r(o,function(r){a++,e.parsingResult.uris[t._redURIkey][t._redURIIndex]=new DataView(r.response),a==i&&n&&n()},function(e,t){})}})},n=function(e,t,r){i(e,t,r)},f=function(e,t){t.cameras&&t.cameras.forEach(function(t){var r=RedCamera();"orthographic"==t.type?r.orthographicYn=!0:(r.fov=180*t.perspective.yfov/Math.PI,r.farClipping=t.perspective.zfar,r.nearClipping=t.perspective.znear),e.parsingResult.cameras.push(r)})},a=function(e,t,r){var n,i,a,o;a=t.scenes[0].nodes,n=0,i=a.length;var s=function(){o=a[n],d(e,t,o,t.nodes[o],e.resultMesh),++n==i?r&&r():requestAnimationFrame(s)};requestAnimationFrame(s)},c=mat4.create(),h=[0,0,0],R=[],m=[],u=function(e,t){"matrix"in t&&(l=t.matrix,RedGLUtil.mat4ToEuler(l,h),e.rotationX=-180*h[0]/Math.PI,e.rotationY=-180*h[1]/Math.PI,e.rotationZ=-180*h[2]/Math.PI,e.x=l[12],e.y=l[13],e.z=l[14],mat4.getScaling(m,l),e.scaleX=m[0],e.scaleY=m[1],e.scaleZ=m[2]),"rotation"in t&&(R=t.rotation,RedGLUtil.quaternionToRotationMat4(R,c),RedGLUtil.mat4ToEuler(c,h),e.rotationX=-180*h[0]/Math.PI,e.rotationY=-180*h[1]/Math.PI,e.rotationZ=-180*h[2]/Math.PI),"translation"in t&&(e.x=t.translation[0],e.y=t.translation[1],e.z=t.translation[2]),"scale"in t&&(e.scaleX=t.scale[0],e.scaleY=t.scale[1],e.scaleZ=t.scale[2])};var p=function(e,t,r,n){if(i=r[n].RedMesh){var i=r[n].RedMesh;t.joints.push(i),i.geometry=RedSphere(e.redGL,.05,3,3,3),i.material=RedColorMaterial(e.redGL),i.drawMode=e.redGL.gl.LINE_LOOP,i.depthTestFunc=e.redGL.gl.NEVER}else requestAnimationFrame(function(){p(e,t,r,n)})},_=function(e,t,r,n){var i={joints:[],inverseBindMatrices:[]},a=t.nodes;r.joints.forEach(function(t){p(e,i,a,t)}),r.skeleton&&(i.skeleton=t.nodes[r.skeleton].RedMesh);var o,s=r.inverseBindMatrices,d=new v(e,t,s),f=d.componentType_BYTES_PER_ELEMENT,u=d.bufferViewByteStride,l=d.bufferURIDataView,c=d.getMethod,h=d.accessor.type,R=d.accessor.count,m=0,_=u/f,g=d.startIndex;switch(h){case"MAT4":if(u)for(o=g+R*(u/f);g<o;g++)m%_<16&&i.inverseBindMatrices.push(l[c](g*f,!0)),m++;else for(o=g+16*R;g<o;g++)i.inverseBindMatrices.push(l[c](g*f,!0)),m++}i.inverseBindMatrices=new Float32Array(i.inverseBindMatrices),n.skinInfo=i};d=function(e,t,r,n,i){if("mesh"in n){var a=n.mesh;o(e,t,t.meshes[a]).forEach(function(r){n.RedMesh=r,i.addChild(r),u(r,n),"children"in n&&n.children.forEach(function(n){d(e,t,n,t.nodes[n],r)}),"skin"in n&&requestAnimationFrame(function(){_(e,t,t.skins[n.skin],r)})})}else{var s;if(e.parsingResult.groups[r]?(s=e.parsingResult.groups[r],n.RedMesh=s):(s=RedMesh(e.redGL),i.addChild(s),n.RedMesh=s,e.parsingResult.groups[r]=s,e.parsingResult.groups[r].name=n.name),u(s,n),"camera"in n){e.parsingResult.cameras[n.camera]._parentMesh=i,e.parsingResult.cameras[n.camera]._targetMesh=s;var f=RedMesh(e.redGL);s.addChild(f),e.parsingResult.cameras[n.camera]._cameraMesh=f}"children"in n&&n.children.forEach(function(r){d(e,t,r,t.nodes[r],s)}),"skin"in n&&requestAnimationFrame(function(){_(e,t,t.skins[n.skin],s)})}};var g,E,P,y=function(e,r,n,i,a,o,s,d,f,u){if(n.sparse){var l=[],c=[],h=[];!function(){var a,o,s,d,f,u=n.sparse,R=u.values,m=i.bufferViews[R.bufferView],p=m.buffer;i.buffers[p].uri&&(a=e.parsingResult.uris.buffers[p]),(d=t[n.componentType])==Float32Array&&(f="getFloat32"),d==Uint32Array&&(f="getUint32"),d==Uint16Array&&(f="getUint16"),d==Int16Array&&(f="getInt16"),d==Uint8Array&&(f="getUint8"),d==Int8Array&&(f="getInt8");var _=n.byteOffset||0;switch(o=((m.byteOffset||0)+_)/d.BYTES_PER_ELEMENT,n.type){case"VEC3":for(s=o+d.BYTES_PER_ELEMENT*u.count/d.BYTES_PER_ELEMENT*3;o<s;o++)"NORMAL"==r?c.push(a[f](o*d.BYTES_PER_ELEMENT,!0)):"POSITION"==r&&l.push(a[f](o*d.BYTES_PER_ELEMENT,!0));break;case"VEC2":for(s=o+d.BYTES_PER_ELEMENT*u.count/d.BYTES_PER_ELEMENT*2;o<s;o++)"TEXCOORD_0"==r&&h.push(a[f](o*d.BYTES_PER_ELEMENT,!0))}}();var R,m,p,_,g,E=n.sparse,P=E.indices,y=i.bufferViews[P.bufferView],v=y.buffer;i.buffers[v].uri&&(R=e.parsingResult.uris.buffers[v]),(_=t[P.componentType])==Uint16Array?g="getUint16":_==Uint8Array&&(g="getUint8");var M=P.byteOffset||0;p=(m=((y.byteOffset||0)+M)/_.BYTES_PER_ELEMENT)+_.BYTES_PER_ELEMENT*E.count/_.BYTES_PER_ELEMENT;for(var T=0;m<p;m++){var x=R[g](m*_.BYTES_PER_ELEMENT,!0);a[3*x]=l[3*T],a[3*x+1]=l[3*T+1],a[3*x+2]=l[3*T+2],T++}}},v=function(e,r,n){switch(this.accessor=r.accessors[n],this.bufferView=r.bufferViews[this.accessor.bufferView],this.bufferIndex=this.bufferView.buffer,this.buffer=r.buffers[this.bufferIndex],this.bufferURIDataView=null,this.buffer.uri&&(this.bufferURIDataView=e.parsingResult.uris.buffers[this.bufferIndex]),this.componentType=t[this.accessor.componentType],this.componentType_BYTES_PER_ELEMENT=this.componentType.BYTES_PER_ELEMENT,this.componentType){case Float32Array:this.getMethod="getFloat32";break;case Uint32Array:this.getMethod="getUint32";break;case Uint16Array:this.getMethod="getUint16";break;case Int16Array:this.getMethod="getInt16";break;case Uint8Array:this.getMethod="getUint8";break;case Int8Array:this.getMethod="getInt8";break;default:RedGLUtil.throwFunc("파싱할수없는 타입",this.componentType)}this.accessorBufferOffset=this.accessor.byteOffset||0,this.bufferViewOffset=this.bufferView.byteOffset||0,this.bufferViewByteStride=this.bufferView.byteStride||0,this.startIndex=(this.bufferViewOffset+this.accessorBufferOffset)/this.componentType_BYTES_PER_ELEMENT},M=function(e,t,r,n,i,a,o,s,d,f,u,l){var c,h=n.componentType_BYTES_PER_ELEMENT,R=n.bufferViewByteStride,m=n.bufferURIDataView,p=n.getMethod,_=n.accessor.type,g=n.accessor.count,E=0,P=R/h,y=n.startIndex;switch(_){case"VEC4":if(R)for(c=y+g*(R/h);y<c;y++)E%P<4&&("WEIGHTS_0"==r?d.push(m[p](y*h,!0)):"JOINTS_0"==r?f.push(m[p](y*h,!0)):"COLOR_0"==r?u.push(m[p](y*h,!0)):"TANGENT"==r&&l.push(m[p](y*h,!0))),E++;else for(c=y+4*g;y<c;y++)"WEIGHTS_0"==r?d.push(m[p](y*h,!0)):"JOINTS_0"==r?f.push(m[p](y*h,!0)):"COLOR_0"==r?u.push(m[p](y*h,!0)):"TANGENT"==r&&l.push(m[p](y*h,!0)),E++;break;case"VEC3":if(R)for(c=y+g*(R/h);y<c;y++)E%P<3&&("NORMAL"==r?s.push(m[p](y*h,!0)):"POSITION"==r?i.push(m[p](y*h,!0)):"COLOR_0"==r&&(u.push(m[p](y*h,!0)),E%P==2&&u.push(1))),E++;else for(c=y+3*g;y<c;y++)"NORMAL"==r?s.push(m[p](y*h,!0)):"POSITION"==r?i.push(m[p](y*h,!0)):"COLOR_0"==r&&(u.push(m[p](y*h,!0)),E%3==2&&u.push(1)),E++;break;case"VEC2":if(R)for(c=y+g*(R/h);y<c;y++)E%P<2&&("TEXCOORD_0"==r?a.push(m[p](y*h,!0)):"TEXCOORD_1"==r?o.push(m[p](y*h,!0)):RedGLUtil.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r)),E++;else for(c=y+2*g;y<c;y++)"TEXCOORD_0"==r?a.push(m[p](y*h,!0)):"TEXCOORD_1"==r?o.push(m[p](y*h,!0)):RedGLUtil.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r),E++}},T=function(e,t,r,n){var i=[];r.targets&&r.targets.forEach(function(r){var n={vertices:[],verticesColor_0:[],normals:[],uvs:[],uvs1:[],jointWeights:[],joints:[],tangents:[]};for(var a in i.push(n),r){var o=n.vertices,s=n.verticesColor_0,d=n.normals,f=n.uvs,u=n.uvs1,l=n.jointWeights,c=n.joints,h=n.tangents,R=r[a],m=new v(e,t,R);M(0,0,a,m,o,f,u,d,l,c,s,h),m.accessor.sparse&&y(e,a,m.accessor,t,o)}}),this.list=i,i.weights=n||[],this.origin=null},x=(g=function(e,t,r){return t.images[r].uri.indexOf("blob:http")>-1?t.images[r].uri:(t.images[r].uri.indexOf(";base64,")>-1?"":e.path)+t.images[r].uri},E=function(e,t,r){var n={};if(t.samplers){var i=t.samplers[r];"magFilter"in i&&(n.mag=i.magFilter),"minFilter"in i&&(n.min=i.minFilter),"wrapS"in i&&(n.wrap_s=i.wrapS),"wrapT"in i&&(n.wrap_t=i.wrapT)}return n.string=JSON.stringify(n),n},function(e,t,r){var n,i,a=!1,o=.5;if("material"in r){var s,d,f,u,l,c=r.material,h=t.materials[c];if("doubleSided"in h&&(a=!!h.doubleSided),"alphaMode"in h&&(i=h.alphaMode),"alphaCutoff"in h&&(o=h.alphaCutoff),"baseColorTexture"in h.pbrMetallicRoughness){var R=h.pbrMetallicRoughness.baseColorTexture.index,m=t.textures[R],p=m.source,_=g(e,t,p),P=m.sampler,y=_+(G=E(0,t,P)).string;s=e.parsingResult.textures[y]?e.parsingResult.textures[y]:e.parsingResult.textures[y]=RedBitmapTexture(e.redGL,_,G)}if("metallicRoughnessTexture"in h.pbrMetallicRoughness){var v=h.pbrMetallicRoughness.metallicRoughnessTexture.index,M=t.textures[v],T=M.source;_=g(e,t,T),P=M.sampler,y=_+(G=E(0,t,P)).string,f=e.parsingResult.textures[y]?e.parsingResult.textures[y]:e.parsingResult.textures[y]=RedBitmapTexture(e.redGL,_,G)}var x=h.normalTexture;if(null!=x){x=x.index;var b=t.textures[x],L=b.source;_=g(e,t,L),P=b.sampler,y=_+(G=E(0,t,P)).string,d=e.parsingResult.textures[y]?e.parsingResult.textures[y]:e.parsingResult.textures[y]=RedBitmapTexture(e.redGL,_,G)}var I=h.emissiveTexture;if(null!=I){I=I.index;var w=t.textures[I],D=w.source;_=g(e,t,D),P=w.sampler,y=_+(G=E(0,t,P)).string,u=e.parsingResult.textures[y]?e.parsingResult.textures[y]:e.parsingResult.textures[y]=RedBitmapTexture(e.redGL,_,G)}var U,B,S=h.occlusionTexture;if(null!=S){S=S.index;var G,A=t.textures[S],F=A.source;_=g(e,t,F),P=A.sampler,y=_+(G=E(0,t,P)).string,l=e.parsingResult.textures[y]?e.parsingResult.textures[y]:e.parsingResult.textures[y]=RedBitmapTexture(e.redGL,_,G)}"metallicFactor"in h.pbrMetallicRoughness&&(U=h.pbrMetallicRoughness.metallicFactor),"roughnessFactor"in h.pbrMetallicRoughness&&(B=h.pbrMetallicRoughness.roughnessFactor);var C=e.environmentTexture;n=RedPBRMaterial_System(e.redGL,s,C,d,l,u,f,null),O=h.pbrMetallicRoughness&&h.pbrMetallicRoughness.baseColorFactor?h.pbrMetallicRoughness.baseColorFactor:[1,1,1,1],n.baseColorFactor=O,h.pbrMetallicRoughness&&(n.metallicFactor=null!=U?U:1,n.roughnessFactor=null!=B?B:1),n.emissiveFactor=null!=h.emissiveFactor?h.emissiveFactor:[1,1,1],h.pbrMetallicRoughness&&(h.pbrMetallicRoughness.metallicRoughnessTexture&&(n.roughnessTexCoordIndex=h.pbrMetallicRoughness.metallicRoughnessTexture.texCoord||0),h.pbrMetallicRoughness.baseColorTexture&&(n.diffuseTexCoordIndex=h.pbrMetallicRoughness.baseColorTexture.texCoord||0)),h.occlusionTexture&&(n.occlusionTexCoordIndex=h.occlusionTexture.texCoord||0,n.occlusionPower=h.occlusionTexture.strength||1),h.emissiveTexture&&(n.emissiveTexCoordIndex=h.emissiveTexture.texCoord||0),h.normalTexture&&(n.normalTexCoordIndex=h.normalTexture.texCoord||0)}else{var O=[Math.random(),Math.random(),Math.random(),1];(n=RedPBRMaterial_System(e.redGL)).baseColorFactor=O}return[n,a,i,o]}),b=function(e,t,r,n,i,a,o,s,d){for(var f=0,u=t.length/3,l=0;f<u;f++)t.length&&(e[l++]=t[3*f+0],e[l++]=t[3*f+1],e[l++]=t[3*f+2]),r.length?(e[l++]=r[4*f+0],e[l++]=r[4*f+1],e[l++]=r[4*f+2],e[l++]=r[4*f+3]):(e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=0),n.length&&(e[l++]=n[3*f+0],e[l++]=n[3*f+1],e[l++]=n[3*f+2]),i.length||i.push(0,0),i.length&&(e[l++]=i[2*f+0],e[l++]=i[2*f+1]),a.length?(e[l++]=a[2*f+0],e[l++]=a[2*f+1]):i.length&&(e[l++]=i[2*f+0],e[l++]=i[2*f+1]),o.length&&(e[l++]=o[4*f+0],e[l++]=o[4*f+1],e[l++]=o[4*f+2],e[l++]=o[4*f+3]),s.length&&(e[l++]=s[4*f+0],e[l++]=s[4*f+1],e[l++]=s[4*f+2],e[l++]=s[4*f+3]),d.length?(e[l++]=d[4*f+0],e[l++]=d[4*f+1],e[l++]=d[4*f+2],e[l++]=d[4*f+3]):(e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=0)};return o=function(e,t,r){var n,i,a,o;r.name&&(n=r.name);var s=[];return r.primitives.forEach(function(d,f){var u,l,c,h,R=[],m=[],p=[],_=[],g=[],E=[],P=[],L=[],I=[];if(d.attributes)for(var w in d.attributes){var D=d.attributes[w],U=new v(e,t,D);M(0,0,w,U,m,_,g,E,P,L,p,I),U.accessor.sparse&&y(e,w,U.accessor,t,m)}if("indices"in d){D=d.indices;!function(e,t,r,n,i){var a,o=n.componentType_BYTES_PER_ELEMENT,s=n.bufferURIDataView,d=n.getMethod,f=n.accessor.type,u=n.accessor.count,l=n.startIndex;switch(f){case"SCALAR":for(a=l+u;l<a;l++)i.push(s[d](l*o,!0))}}(0,0,0,U=new v(e,t,D),R)}if(l=x(e,t,d),i=l[1],a=l[2],o=l[3],(l=l[0])instanceof RedPBRMaterial_System&&e.parsingResult.materials.push(l),"mode"in d)switch(d.mode){case 0:c=e.redGL.gl.POINTS;break;case 1:c=e.redGL.gl.LINES;break;case 2:c=e.redGL.gl.LINE_LOOP;break;case 3:c=e.redGL.gl.LINE_STRIP;break;case 4:c=e.redGL.gl.TRIANGLES;break;case 5:c=e.redGL.gl.TRIANGLE_STRIP;break;case 6:c=e.redGL.gl.TRIANGLE_FAN}h=E.length?E:RedGLUtil.calculateNormals(m,R);var B,S=[];b(S,m,p,h,_,g,P,L,I);var G=[];if(m.length&&G.push(RedInterleaveInfo("aVertexPosition",3)),G.push(RedInterleaveInfo("aVertexColor_0",4)),h.length&&G.push(RedInterleaveInfo("aVertexNormal",3)),_.length&&G.push(RedInterleaveInfo("aTexcoord",2)),g.length?G.push(RedInterleaveInfo("aTexcoord1",2)):_.length&&G.push(RedInterleaveInfo("aTexcoord1",2)),P.length&&G.push(RedInterleaveInfo("aVertexWeight",4)),L.length&&G.push(RedInterleaveInfo("aVertexJoint",4)),G.push(RedInterleaveInfo("aVertexTangent",4)),B=RedGeometry(RedBuffer(e.redGL,"testGLTF_interleaveBuffer_"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(S),G),R.length?RedBuffer(e.redGL,"testGLTF_indexBuffer_"+RedGL.makeUUID(),RedBuffer.ELEMENT_ARRAY_BUFFER,e.redGL.gl.glExtension.OES_element_index_uint?new Uint32Array(R):new Uint16Array(R)):null),l||RedGLUtil.throwFunc("재질을 파싱할수없는경우 ",d),u=RedMesh(e.redGL,B,l),n&&(u.name=n,e.parsingOption))for(var A in e.parsingOption)n.toLowerCase().indexOf(A)>-1&&e.parsingOption[A](u);switch(u.drawMode=c||e.redGL.gl.TRIANGLES,i&&(u.useCullFace=!1,l.useMaterialDoubleSide=!0),a){case"BLEND":u.useTransparentSort=!0;break;case"MASK":u.useBlendMode=!1,l.cutOff=o;break;default:u.useBlendMode=!1,l._cutOff=-.1}p.length&&(l.useVertexColor_0=!0),I.length&&(l.useVertexTangent=!0);var F=new T(e,t,d,r.weights);F.list.forEach(function(e){var t;t=e.normals.length?e.normals:RedGLUtil.calculateNormals(e.vertices,R);var r=[];b(r,e.vertices,e.verticesColor_0,t,e.uvs,e.uvs1,e.jointWeights,e.joints,e.tangents),e.interleaveData=r}),u._morphInfo=F,u._morphInfo.origin=new Float32Array(S);var C=u.geometry.interleaveBuffer.data,O=0;G.forEach(function(e){O+=e.size});u._morphInfo.list.forEach(function(e,t){for(var r=0,n=C.length/O,i=null==u._morphInfo.list.weights[t]?.5:u._morphInfo.list.weights[t];r<n;r++)C[r*O+0]+=e.vertices[3*r+0]*i,C[r*O+1]+=e.vertices[3*r+1]*i,C[r*O+2]+=e.vertices[3*r+2]*i}),u.geometry.interleaveBuffer.upload(C),u._morphInfo.origin=new Float32Array(C),d.RedMesh=u,s.push(u)}),s},P=function(e,t,r){var n,i=[],a=new v(e,t,r),o=a.componentType_BYTES_PER_ELEMENT,s=a.bufferURIDataView,d=a.getMethod,f=a.accessor.type,u=a.accessor.count,l=a.startIndex;switch(f){case"SCALAR":for(n=l+1*u;l<n;l++)i.push(s[d](l*o,!0));break;case"VEC4":for(n=l+4*u;l<n;l++)i.push(s[d](l*o,!0));break;case"VEC3":for(n=l+3*u;l<n;l++)i.push(s[d](l*o,!0))}return i},s=function(e,t){var r=t.nodes,n=t.meshes;t.accessors,t.animations||(t.animations=[]),t.animations.forEach(function(i,a){var o=i.samplers,s=[];s.minTime=1e7,s.maxTime=-1,s.name=i.name,e.parsingResult.animations.push(s),i.channels.forEach(function(i,a){var d,f,u,l,c,h=[];if(d=o[i.sampler],f=i.target,"mesh"in(l=r[f.node]))u=l.RedMesh,n[l.mesh].primitives.forEach(function(t){h.push(t.RedMesh),t.RedMesh.geometry.drawMode=e.redGL.gl.DYNAMIC_DRAW});else{if(!e.parsingResult.groups[f.node])return;u=e.parsingResult.groups[f.node]}"scale"!=f.path&&"rotation"!=f.path&&"translation"!=f.path&&"weights"!=f.path||s.push(c={key:f.path,time:P(e,t,d.input),data:P(e,t,d.output),interpolation:d.interpolation,target:u,targets:h}),c&&(s.minTime>c.time[0]&&(s.minTime=c.time[0]),s.maxTime<c.time[c.time.length-1]&&(s.maxTime=c.time[c.time.length-1]))})}),e.parsingResult.animations.length&&e.parsingResult.animations.forEach(function(t){e.playAnimation(t)})},function(t,r,i,o,d){e(i),d?(i.buffers[0].uri=d,n(t,i,function(){f(t,i),a(t,i,function(){s(t,i),o&&o()})})):n(t,i,function(){f(t,i),a(t,i,function(){s(t,i),o&&o()})})}}(),Object.freeze(RedGLTFLoader)}(),(RedAxis=function(e){if(!(this instanceof RedAxis))return new RedAxis(e);var t,r,n,i,a,o,s;e instanceof RedGL||RedGLUtil.throwFunc("RedAxis : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),n=RedBox(e),i=RedCylinder(e,0,.5),a=RedColorMaterial(e,"#ff0000"),o=RedColorMaterial(e,"#00ff00"),s=RedColorMaterial(e,"#0000ff"),t=RedMesh(e,i,a),(r=RedMesh(e,n,a)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleX=5,t.x=5,t.rotationZ=90,r.x=2.5,this.children.push(r),this.children.push(t),t=RedMesh(e,i,o),(r=RedMesh(e,n,o)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleY=5,t.y=5,r.y=2.5,this.children.push(r),this.children.push(t),t=RedMesh(e,i,s),(r=RedMesh(e,n,s)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleZ=5,t.z=5,t.rotationX=-90,r.z=2.5,this.children.push(r),this.children.push(t),this.children.push(RedMesh(e,RedSphere(e,.25,16,16,16),RedColorMaterial(e,"#ff00ff"))),this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,Object.freeze(RedAxis),function(){var e,t,r,n,i,a;(RedGrid=function(e,t,r,n,i){if(!(this instanceof RedGrid))return new RedGrid(e,t,r,n,i);var a;e instanceof RedGL||RedGLUtil.throwFunc("RedGrid : RedGL Instance만 허용.",e),a=e.gl,RedBaseObject3D.build.call(this,a),this._redGL=e,this.size=t||100,this.divisions=r||100,this.color1=n||"#cccccc",this.color2=i||"#666666",this.geometry=this._makeGridGeometry(),this.material=RedGridMaterial(e),this.drawMode=a.LINES,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedGrid.prototype._makeGridGeometry=function(){if(this.color2){var o=[];for(e=this._divisions/2,t=this._size/this._divisions,r=this._size/2,n=0,i=-r;n<=this._divisions;n++,i+=t)a=n===e?RedGLUtil.hexToRGB_ZeroToOne(this.color1):RedGLUtil.hexToRGB_ZeroToOne(this.color2),o.push(-r,0,i,a[0],a[1],a[2],1,r,0,i,a[0],a[1],a[2],1,i,0,-r,a[0],a[1],a[2],1,i,0,r,a[0],a[1],a[2],1);return RedGeometry(RedBuffer(this._redGL,"gridInterleaveBuffer_"+this._size+"_"+this._divisions+"_"+this.color1+"_"+this.color2,RedBuffer.ARRAY_BUFFER,new Float32Array(o),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexColor",4)]))}},RedGrid.prototype._update=function(){this.geometry=this._makeGridGeometry()},RedDefinePropertyInfo.definePrototype("RedGrid","size","number",{min:1,callback:function(){this._update()}}),RedDefinePropertyInfo.definePrototype("RedGrid","divisions","number",{min:1,callback:function(){this._update()}}),Object.defineProperty(RedGrid.prototype,"color1",{get:function(){return this._color1},set:function(e){return RedGLUtil.regHex(e)||RedGLUtil.throwFunc("RedGrid : color1 hex 형식만 허용.",e),this._color1=e,this._update(),this._color1}}),Object.defineProperty(RedGrid.prototype,"color2",{get:function(){return this._color2},set:function(e){return RedGLUtil.regHex(e)||RedGLUtil.throwFunc("RedGrid : color2 hex 형식만 허용.",e),this._color2=e,this._update(),this._color2}}),Object.defineProperty(RedGrid.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedGridMaterial||RedGLUtil.throwFunc("RedGrid : RedGridMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedGrid)}(),(RedMesh=function(e,t,r){if(!(this instanceof RedMesh))return new RedMesh(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedMesh : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=t,this.material=r,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedDefinePropertyInfo.definePrototype("RedMesh","perspectiveScale","boolean",!1),RedDefinePropertyInfo.definePrototype("RedMesh","sprite3DYn","boolean",!1),Object.freeze(RedMesh),(RedLine=function(e,t){if(!(this instanceof RedLine))return new RedLine(e,t);var r;e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),(t=t||RedColorMaterial(e))instanceof RedColorMaterial||RedGLUtil.throwFunc("RedLine : RedColorMaterial Instance만 허용."),r=e.gl,RedBaseObject3D.build.call(this,r),this._interleaveData=[],this._indexData=[],this._UUID=RedGL.makeUUID(),this._interleaveBuffer=RedBuffer(e,"RedLine_InterleaveBuffer_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(this._interleaveData),[RedInterleaveInfo("aVertexPosition",3)]),this.geometry=RedGeometry(this._interleaveBuffer),this.material=t,this.drawMode=r.LINE_STRIP}).prototype=new RedBaseContainer,RedLine.prototype.addPoint=function(e,t,r){"number"==typeof e||RedGLUtil.throwFunc("RedLine : addPoint - x값은 숫자만 허용","입력값 : "+e),"number"==typeof t||RedGLUtil.throwFunc("RedLine : addPoint - y값은 숫자만 허용","입력값 : "+t),"number"==typeof r||RedGLUtil.throwFunc("RedLine : addPoint - z값은 숫자만 허용","입력값 : "+r),this._interleaveData.push(e,t,r),this._upload()},RedLine.prototype.removeAllPoint=function(){this._interleaveData.length=0,this._upload()},RedLine.prototype._upload=function(){this._interleaveBuffer.upload(new Float32Array(this._interleaveData))},Object.defineProperty(RedLine.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedLine : geometry - 임의로 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedLine.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorMaterial||RedGLUtil.throwFunc("RedLine : RedColorMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedLine),(RedSkyBox=function(e,t){if(!(this instanceof RedSkyBox))return new RedSkyBox(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedSkyBox : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=RedBox(e),this.material=RedSkyBoxMaterial(e,RedBitmapCubeTexture(e,t)),this.cullFace=e.gl.FRONT,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseObject3D,Object.defineProperty(RedSkyBox.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedSkyBox : geometry - 임의로 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedSkyBox.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedSkyBoxMaterial||RedGLUtil.throwFunc("RedSkyBox : RedSkyBoxMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedSkyBox),(RedSprite3D=function(e,t){if(!(this instanceof RedSprite3D))return new RedSprite3D(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedSprite3D : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=RedPlane(e,1,1,0),this.material=t,this.perspectiveScale=!0,this.sprite3DYn=!0,this.useCullFace=!1,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedDefinePropertyInfo.definePrototype("RedSprite3D","perspectiveScale","boolean",!0),RedDefinePropertyInfo.definePrototype("RedSprite3D","sprite3DYn","boolean",!0),Object.defineProperty(RedSprite3D.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorMaterial||e instanceof RedBitmapMaterial||e instanceof RedSheetMaterial||e instanceof RedVideoMaterial||RedGLUtil.throwFunc("RedSprite3D : RedColorMaterial or RedBitmapMaterial or RedSheetMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedSprite3D),(RedPointCloud=function(){}).prototype=new RedBaseContainer,RedPointCloud.prototype.update=function(e){this._geometry.interleaveBuffer.upload(new Float32Array(e))},Object.defineProperty(RedPointCloud.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedPointCloud : geometry - 임의 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.freeze(RedPointCloud),(RedParticleUnit=function(e){this.startTime=null,this.age=0,this.lifeTime=2==e.length?Math.random()*(e[1]-e[0])+e[0]:e[0],this.initLifeTime=this.lifeTime,this._gravitySum=0}).prototype.addRule=function(e,t){this[e]={startCenter:null,start:2==t.start.length?Math.random()*(t.start[1]-t.start[0])+t.start[0]:t.start,end:2==t.end.length?Math.random()*(t.end[1]-t.end[0])+t.end[0]:t.end,ease:t.ease},this[e].gap=this[e].end-this[e].start},Object.freeze(RedParticleUnit),(RedColorPointCloud=function(e,t,r){if(!(this instanceof RedColorPointCloud))return new RedColorPointCloud(e,t,r);var n;t instanceof Array||RedGLUtil.throwFunc("RedLine : interleaveData - Array Instance만 허용.","입력값 :",e),e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),n=e.gl,RedBaseObject3D.build.call(this,n),this._UUID=RedGL.makeUUID(),this.geometry=RedGeometry(RedBuffer(e,"RedColorPointCloud_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(t),r,e.gl.DYNAMIC_DRAW)),this._material=RedColorPointCloudMaterial(e),this.drawMode=n.POINTS,this.useDepthMask=!1}).prototype=new RedPointCloud,Object.defineProperty(RedColorPointCloud.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorPointCloudMaterial||RedGLUtil.throwFunc("RedColorPointCloud : material - RedColorPointCloudMaterial Instance 만 허용."),this._material=e}}),Object.freeze(RedColorPointCloud),(RedBitmapPointCloud=function(e,t,r,n){if(!(this instanceof RedBitmapPointCloud))return new RedBitmapPointCloud(e,t,r,n);var i;t instanceof Array||RedGLUtil.throwFunc("RedLine : interleaveData - Array Instance만 허용.","입력값 :",e),e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),i=e.gl,RedBaseObject3D.build.call(this,i),this._UUID=RedGL.makeUUID(),this.geometry=RedGeometry(RedBuffer(e,"RedBitmapPointCloud_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(t),r,e.gl.DYNAMIC_DRAW)),this.material=n,this.drawMode=i.POINTS,this.useDepthMask=!1}).prototype=new RedPointCloud,Object.defineProperty(RedBitmapPointCloud.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedBitmapPointCloudMaterial||RedGLUtil.throwFunc("RedBitmapPointCloud : material - RedBitmapPointCloudMaterial Instance만 허용."),this._material=e}}),Object.freeze(RedBitmapPointCloud),(RedParticleEmitter=function(e,t,r){if(!(this instanceof RedParticleEmitter))return new RedParticleEmitter(e,t,r);RedBaseObject3D.build.call(this,e.gl),this.list=[],this._interleaveData=[],this.info=t,this.geometry=RedGeometry(RedBuffer(e,"RedParticleEmitter_Buffer"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(this._interleaveData),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aPointSize",1),RedInterleaveInfo("aVertexColor",4)],e.gl.DYNAMIC_DRAW)),this._material=RedParticleMaterial(e,r),this.drawMode=e.gl.POINTS,this.blendSrc=e.gl.SRC_ALPHA,this.blendDst=e.gl.ONE,this.useDepthMask=!1,this._UUID=RedGL.makeUUID()}).TINT_RANDOM="random",RedParticleEmitter.QuintIn=1,RedParticleEmitter.QuintOut=2,RedParticleEmitter.QuintInOut=3,RedParticleEmitter.BackIn=4,RedParticleEmitter.BackOut=5,RedParticleEmitter.BackInOut=6,RedParticleEmitter.CircIn=7,RedParticleEmitter.CircOut=8,RedParticleEmitter.CircInOut=9,RedParticleEmitter.CubicIn=10,RedParticleEmitter.CubicOut=11,RedParticleEmitter.CubicInOut=12,RedParticleEmitter.ExpoIn=13,RedParticleEmitter.ExpoOut=14,RedParticleEmitter.ExpoInOut=15,RedParticleEmitter.QuadIn=16,RedParticleEmitter.QuadOut=17,RedParticleEmitter.QuadInOut=18,RedParticleEmitter.QuartIn=19,RedParticleEmitter.QuartOut=20,RedParticleEmitter.QuartInOut=21,RedParticleEmitter.SineIn=22,RedParticleEmitter.SineOut=23,RedParticleEmitter.SineInOut=24,RedParticleEmitter.ElasticIn=25,RedParticleEmitter.ElasticOut=26,RedParticleEmitter.ElasticInOut=27,RedParticleEmitter.prototype=new RedBaseObject3D,RedParticleEmitter.prototype.reset=function(){this.list.length=0,this._interleaveData.length=0},RedParticleEmitter.prototype.update=function(e){var t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p,_,g,E,P;if(e+=2e3,t=Math.pow,r=Math.sin,n=Math.cos,i=Math.sqrt,s=.5*(a=Math.PI),o=2*a,d=this.list.length,R=(h=this.info).particle,d<h.max)for((f=h.emitCount)+d>h.max&&(f=h.max-d);f--;)m=this.list[d+f]=new RedParticleUnit(h.lifeTime),this._interleaveData.push(this.x,this.y,this.z),this._interleaveData.push(0),h.tint==RedParticleEmitter.TINT_RANDOM?this._interleaveData.push(Math.random(),Math.random(),Math.random(),1):this._interleaveData.push(h.tint[0],h.tint[1],h.tint[2],1),h.particle&&(R.movementX&&m.addRule("movementX",R.movementX),R.movementY&&m.addRule("movementY",R.movementY),R.movementZ&&m.addRule("movementZ",R.movementZ),R.scale&&m.addRule("scale",R.scale),R.alpha&&m.addRule("alpha",R.alpha));for(d=this.list.length,_="movementX,movementY,movementZ,scale,alpha".split(",");d--;)if((u=this.list[d]).startTime||(u.startTime=e,u.age=0),u.age=e-u.startTime,c=8*d,(l=u.age/u.lifeTime)<1)for(P=l,u.startCenter||(u.startCenter=[this.x,this.y,this.z]),f=_.length;f--;)P=l,(p=u[g=_[f]].ease)&&(1==p?P*=P*P*P*P:2==p?P=(P-=1)*P*P*P*P+1:3==p?P=(P*=2)<1?P*P*P*P*P*.5:.5*((P-=2)*P*P*P*P+2):4==p?P=P*P*(1.70158*P+P-1.70158):5==p?P=(P-=1)*P*(1.70158*P+P+1.70158)+1:6==p?P=(P*=2)<1?.5*P*P*(1.70158*P+P-1.70158):.5*(P-=2)*P*(1.70158*P+P+1.70158)+1:7==p?P=-1*(i(1-P*P)-1):8==p?P=i(1-(P-=1)*P):9==p?P=(P*=2)<1?-.5*(i(1-P*P)-1):.5*i(1-(P-=2)*P)+.5:10==p?P*=P*P:11==p?P=(P-=1)*P*P+1:12==p?P=(P*=2)<1?P*P*P*.5:.5*((P-=2)*P*P+2):13==p?P=0==P?0:t(2,10*(P-1)):14==p?P=1==P?1:1-t(2,-10*P):15==p?P=(P*=2)<1?0==P?0:.5*t(2,10*(P-1)):2==P?1:-.5*t(2,-10*(P-1))+1:16==p?P*=P:17==p?P*=2-P:18==p?P=(P*=2)<1?P*P*.5:.5*((2-(P-=1))*P+1):19==p?P*=P*P*P:20==p?P=1-(P-=1)*P*P*P:21==p?P=(P*=2)<1?P*P*P*P*.5:1-(P-=2)*P*P*P*.5:22==p?P=1-n(P*s):23==p?P=r(P*s):24==p?P=.5*(1-n(P*a)):25==p?P=0===P?0:1===P?1:-1*t(2,10*(P-=1))*r((P-.075)*o/.3):26==p?P=0===P?0:1===P?1:t(2,-10*P)*r((P-.075)*o/.3)+1:27==p&&(0===P||1===P||(P*=2),P=P<1?-.5*t(2,10*(P-=1))*r((P-.075)*o/.3):.5*t(2,-10*(P-=1))*r((P-.075)*o/.3)+1)),"movementX"==g&&(E=0),"movementY"==g&&(E=1),"movementZ"==g&&(E=2),"scale"==g&&(E=3),"alpha"==g&&(E=7),this._interleaveData[c+E]=E<3?u.startCenter[E]+u[g].start+u[g].gap*P:u[g].start+u[g].gap*P,h.gravity&&(u._gravitySum-=h.gravity),this._interleaveData[c+1]+=u._gravitySum;else this._interleaveData[c+0]=u.startCenter[0]=this.x,this._interleaveData[c+1]=u.startCenter[1]=this.y,this._interleaveData[c+2]=u.startCenter[2]=this.z,this._interleaveData[c+3]=u.scale.start,h.tint==RedParticleEmitter.TINT_RANDOM?(this._interleaveData[c+4]=Math.random(),this._interleaveData[c+5]=Math.random(),this._interleaveData[c+6]=Math.random()):(this._interleaveData[c+4]=h.tint[0],this._interleaveData[c+5]=h.tint[1],this._interleaveData[c+6]=h.tint[2]),this._interleaveData[c+7]=0,u._gravitySum=0,u.startTime=null,u.age=-1;this._geometry.interleaveBuffer.upload(new Float32Array(this._interleaveData))},RedDefinePropertyInfo.definePrototype("RedParticleEmitter","diffuseTexture","sampler2D",{callback:function(e){this.material.diffuseTexture=e}}),Object.freeze(RedParticleEmitter),function(){var e,t,r;r=function(e,r,n,i,a,o,s,d,f,u,l,c){var h,R,m=d/l,p=f/c,_=d/2,g=f/2,E=u/2,P=l+1,y=c+1,v=0,M=[];for(R=0;R<y;R++){var T=R*p-g;for(h=0;h<P;h++){var x=h*m-_;M[n]=x*o,M[i]=T*s,M[a]=E,e.push(M.x,M.y,M.z),M[n]=0,M[i]=0,M[a]=u>0?1:-1,e.push(M.x,M.y,M.z),e.push(h/l,R/c),v+=1}}for(R=0;R<c;R++)for(h=0;h<l;h++){var b=t+h+P*R,L=t+h+P*(R+1),I=t+(h+1)+P*(R+1),w=t+(h+1)+P*R;r.push(b,L,w,L,I,w),6}t+=v},e=function(e,n,i,a,o,s,d,f){var u=[],l=[];return t=0,r(u,l,"z","y","x",-1,-1,o,a,i,f,d),r(u,l,"z","y","x",1,-1,o,a,-i,f,d),r(u,l,"x","z","y",1,1,i,o,a,s,f),r(u,l,"x","z","y",1,-1,i,o,-a,s,f),r(u,l,"x","y","z",1,-1,i,a,o,s,d),r(u,l,"x","y","z",-1,-1,i,a,-o,s,d),{interleaveData:u,indexData:l,type:n,interleaveBuffer:RedBuffer(e,n+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(u),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,n+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(l))}},(RedBox=function(t,r,n,i,a,o,s){return this instanceof RedBox?(t instanceof RedGL||RedGLUtil.throwFunc("RedBox : RedGL Instance만 허용.",t),d="RedBox_"+(r=r||1)+"_"+(n=n||1)+"_"+(i=i||1)+"_"+(a=a||1)+"_"+(o=o||1)+"_"+(s=s||1),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[d]?t._datas.Primitives[d]:(t._datas.Primitives[d]=this,f=e(t,d,r,n,i,a,o,s),this.interleaveBuffer=f.interleaveBuffer,this.indexBuffer=f.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,void(this._UUID=RedGL.makeUUID()))):new RedBox(t,r,n,i,a,o,s);var d,f}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedBox)}(),function(){var e,t;e=function(e,r,n,i,a,o,s,d,f,u){var l=[],c=[],h=0,R=[],m=a/2;return t=function(e){var t,r,a,s=[],d=[],R=!0===e?n:i,p=!0===e?1:-1;for(r=h,t=1;t<=o;t++)l.push(0,m*p,0),l.push(0,p,0),l.push(.5,.5),h++;for(a=h,t=0;t<=o;t++){var _=t/o*u+f,g=Math.cos(_),E=Math.sin(_);d[0]=R*E,d[1]=m*p,d[2]=R*g,l.push(d[0],d[1],d[2]),l.push(0,p,0),s[0]=.5*g+.5,s[1]=.5*E*p+.5,l.push(s[0],1-s[1]),h++}for(t=0;t<o;t++){var P=r+t,y=a+t;!0===e?c.push(y,y+1,P):c.push(y+1,y,P),3}},function(){var e,t,r=[],d=[],p=(i-n)/a;for(t=0;t<=s;t++){var _=[],g=t/s,E=g*(i-n)+n;for(e=0;e<=o;e++){var P=e/o,y=P*u+f,v=Math.sin(y),M=Math.cos(y);d[0]=E*v,d[1]=-g*a+m,d[2]=E*M,l.push(d[0],d[1],d[2]),r[0]=v,r[1]=p,r[2]=M,vec3.normalize(r,r),l.push(r[0],r[1],r[2]),l.push(P,g),_.push(h++)}R.push(_)}for(e=0;e<o;e++)for(t=0;t<s;t++){var T=R[t][e],x=R[t+1][e],b=R[t+1][e+1],L=R[t][e+1];c.push(T,x,L),c.push(x,b,L),6}}(),!1===d&&(n>0&&t(!0),i>0&&t(!1)),{interleaveData:l,indexData:c,type:r,interleaveBuffer:RedBuffer(e,r+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(l),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,r+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(c))}},(RedCylinder=function(t,r,n,i,a,o,s,d,f){return this instanceof RedCylinder?(t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),u="RedCylinder_"+(r=void 0!==r?r:1)+"_"+(n=void 0!==n?n:1)+"_"+(i=void 0!==i?i:1)+"_"+(a=Math.floor(a)||8)+"_"+(o=Math.floor(o)||1)+"_"+(s=void 0!==s&&s)+"_"+(d=void 0!==d?d:0)+"_"+(f=void 0!==f?f:2*Math.PI),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[u]?t._datas.Primitives[u]:(t._datas.Primitives[u]=this,l=e(t,u,r,n,i,a,o,s,d,f),this.interleaveBuffer=l.interleaveBuffer,this.indexBuffer=l.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,void(this._UUID=RedGL.makeUUID()))):new RedCylinder(t,r,n,i,a,o,s,d,f);var u,l}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedCylinder)}(),function(){var e,t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p;e=function(e,_,g,E,P,y,v){t=g/2,r=E/2,n=Math.floor(P)||1,i=Math.floor(y)||1,a=n+1,o=i+1,s=g/n,d=E/i;var M=[],T=[];for(u=0;u<o;u++)for(c=u*d-r,f=0;f<a;f++)l=f*s-t,M.push(l,-c,0,0,0,1,f/n,v?1-u/i:u/i);for(u=0;u<i;u++)for(f=0;f<n;f++)h=f+a*u,R=f+a*(u+1),m=f+1+a*(u+1),p=f+1+a*u,T.push(h,R,p,R,m,p);return{interleaveData:M,indexData:T,type:_,interleaveBuffer:RedBuffer(e,_+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(M),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,_+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint32Array(T))}},(RedPlane=function(t,r,n,i,a,o){return this instanceof RedPlane?(t instanceof RedGL||RedGLUtil.throwFunc("RedPlane : RedGL Instance만 허용.",t),s="RedPlane_"+(r=r||1)+"_"+(n=n||1)+"_"+(i=i||1)+"_"+(a=a||1)+"_"+o,t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[s]?t._datas.Primitives[s]:(t._datas.Primitives[s]=this,d=e(t,s,r,n,i,a,o),this.interleaveBuffer=d.interleaveBuffer,this.indexBuffer=d.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,void(this._UUID=RedGL.makeUUID()))):new RedPlane(t,r,n,i,a,o);var s,d}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedPlane)}(),function(){var e,t,r,n,i,a,o,s,d,f,u,l;f=[],u=new Float32Array([0,0,0]),l=new Float32Array([0,0,0]),e=function(e,c,h,R,m,p,_,g,E){t=g+E,i=0,f.length=0,u[0]=0,u[1]=0,u[2]=0,l[0]=0,l[1]=0,l[2]=0;var P=[],y=[];for(n=0;n<=m;n++){var v=[],M=n/m;for(r=0;r<=R;r++){var T=r/R;u.x=-h*Math.cos(p+T*_)*Math.sin(g+M*E),u.y=h*Math.cos(g+M*E),u.z=h*Math.sin(p+T*_)*Math.sin(g+M*E),P.push(u.x,u.y,u.z),l[0]=u.x,l[1]=u.y,l[2]=u.z,vec3.normalize(l,l),P.push(l[0],l[1],l[2]),P.push(T,M),v.push(i++)}f.push(v)}for(n=0;n<m;n++)for(r=0;r<R;r++)a=f[n][r+1],o=f[n][r],s=f[n+1][r],d=f[n+1][r+1],(0!==n||g>0)&&y.push(a,o,d),(n!==m-1||t<Math.PI)&&y.push(o,s,d);return{interleaveData:P,indexData:y,type:c,interleaveBuffer:RedBuffer(e,c+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(P),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,c+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(y))}},(RedSphere=function(t,r,n,i,a,o,s,d){return this instanceof RedSphere?(t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),f="RedSphere_"+(r=r||1)+"_"+(n=Math.max(3,Math.floor(n)||8))+"_"+(i=Math.max(2,Math.floor(i)||6))+"_"+(a=void 0!==a?a:0)+"_"+(o=void 0!==o?o:2*Math.PI)+"_"+(s=void 0!==s?s:0)+"_"+(d=void 0!==d?d:Math.PI),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[f]?t._datas.Primitives[f]:(t._datas.Primitives[f]=this,u=e(t,f,r,n,i,a,o,s,d),this.interleaveBuffer=u.interleaveBuffer,this.indexBuffer=u.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,void(this._UUID=RedGL.makeUUID()))):new RedSphere(t,r,n,i,a,o,s,d);var f,u}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedSphere)}(),function(){var e,t,r,n,i,a,o,s,d,f,u;r=2,e=function(e,t,r,n){if(i=e.createProgram(),e.attachShader(i,r.webglShader),e.attachShader(i,n.webglShader),r.parseData.uniform)for(s in a=r.parseData.uniform.map,o=n.parseData.uniform.map,a)o[s]&&RedGLUtil.throwFunc("vertexShader와 fragmentShader에 중복된 유니폼 선언이 존재함.","중복선언 : "+s);if(r.parseData.const)for(s in a=r.parseData.const.map,o=n.parseData.const.map,a)o[s]&&RedGLUtil.throwFunc("vertexShader와 fragmentShader에 중복된 상수 선언이 존재함.","중복선언 : "+s);return e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||RedGLUtil.throwFunc("RedProgram : 프로그램을 초기화 할 수 없습니다.",e.getProgramInfoLog(i)),i.key=t,i.vShaderKey=r.key,i.vShaderOriginSource=r.originSource,i.fShaderKey=n.key,i.fShaderOriginKey=r.originSource,i},u={},d=function(){},f=function(){},t=function(e,t,i){var a,o,s,l;performance.now();if(i.parseData.attribute)for(a=(s=i.parseData.attribute.list).length;a--;)o=s[a],(p=new d)._UUID=RedGL.makeUUID(),p.location=t.getAttribLocation(e.webglProgram,o.name),-1==p.location?(p.msg="쉐이더 main 함수에서 사용되고 있지 않음",p.use=!1):p.use=!0,p.attributeType=o.attributeType,p.name=o.name,p.enabled=!1,l=e.attributeLocation.length,-1!=p.location&&(e.attributeLocation[l]=p),e.attributeLocation[p.name]=p;if(i.parseData.uniform)for(a=(s=i.parseData.uniform.list).length;a--;){var c,h,R,m,p;switch(o=s[a],(p=new f)._UUID=RedGL.makeUUID(),p.uniformType=o.uniformType,c=o.arrayNum,R=1e5,o.uniformType){case"sampler2D":h="sampler2D",R=0,m="uniform1i",p.samplerIndex=r,++r==n&&(r=2);break;case"samplerCube":h="samplerCube",R=1,m="uniform1i",p.samplerIndex=r,++r==n&&(r=2);break;case"float":h="float",R=c?12:11,m=c?"uniform1fv":"uniform1f";break;case"int":h="int",R=c?12:11,m=c?"uniform1iv":"uniform1i";break;case"bool":h="bool",R=c?12:11,m=c?"uniform1iv":"uniform1i";break;case"vec4":h="vec",R=12,m="uniform4fv";break;case"vec3":h="vec",R=12,m="uniform3fv";break;case"vec2":h="vec",R=12,m="uniform2fv";break;case"ivec4":h="vec",R=12,m="uniform4iv";break;case"ivec3":h="vec",R=12,m="uniform3iv";break;case"ivec2":h="vec",R=12,m="uniform2iv";break;case"bvec4":h="vec",R=12,m="uniform4iv";break;case"bvec3":h="vec",R=12,m="uniform3iv";break;case"bvec2":h="vec",R=12,m="uniform2iv";break;case"mat4":h="mat",R=13,m="uniformMatrix4fv";break;case"mat3":h="mat",R=13,m="uniformMatrix3fv";break;case"mat2":h="mat",R=13,m="uniformMatrix2fv"}p.location=t.getUniformLocation(e.webglProgram,o.name),p.renderType=h,p.renderMethod=m,p.renderTypeIndex=R,p.name=o.name,u[o.name]||(u[o.name]=o.name.charAt(1).toLowerCase()+o.name.substr(2)),p.materialPropertyName=u[o.name],p.arrayNum=o.arrayNum,p.location?p.use=!0:(p.msg="쉐이더 main 함수에서 사용되고 있지 않음",p.use=!1),o.systemUniformYn?(l=e.systemUniformLocation.length,p.use&&(e.systemUniformLocation[l]=p),e.systemUniformLocation[o.name]=p):(l=e.uniformLocation.length,p.use&&(e.uniformLocation[l]=p),e.uniformLocation[o.name]=p)}performance.now()},(RedProgram=function(r,i,a,o){var s,d,f;return this instanceof RedProgram?(r instanceof RedGL||RedGLUtil.throwFunc("RedProgram : RedGL Instance만 허용.","입력값 : "+r),"string"==typeof i||RedGLUtil.throwFunc("RedProgram : key - 문자열만 허용.","입력값 : "+i),s=r.gl,r._datas.RedProgram||(r._datas.RedProgram={},r._datas.RedProgramList=[]),RedProgram.hasKey(r,i)?r._datas.RedProgram[i]:(d=a?RedShader(r,i+"_VS",RedShader.VERTEX,a):null,f=o?RedShader(r,i+"_FS",RedShader.FRAGMENT,o):null,d&&f?r._datas.RedProgram[i]=this:RedGLUtil.throwFunc("RedProgram : 신규 생성시 vertexShader, fragmentShader 모두 입력해야함."),r._datas.RedProgramList.push(this),this.key=i,this.webglProgram=e(s,i,d,f),this.attributeLocation=[],this.uniformLocation=[],this.systemUniformLocation=[],s.useProgram(this.webglProgram),n=r.detect.texture.MAX_COMBINED_TEXTURE_IMAGE_UNITS,t(this,s,d),t(this,s,f),void(this._UUID=RedGL.makeUUID()))):new RedProgram(r,i,a,o)}).prototype={},RedProgram.hasKey=function(e,t){return e instanceof RedGL||RedGLUtil.throwFunc("RedProgram : RedGL Instance만 허용.","입력값 : "+e),e._datas.RedProgram||(e._datas.RedProgram={},e._datas.RedProgramList=[]),!!e._datas.RedProgram[t]},RedProgram.makeProgram=function(e,t,r,n,i){var a;t.indexOf("_")>-1&&RedGLUtil.throwFunc("RedProgram : 프로그램이름에 _ 는 허용하지 않음.","입력값 : "+t),r="string"==typeof r?r:RedGLUtil.getStrFromComment(r.toString()),n="string"==typeof n?n:RedGLUtil.getStrFromComment(n.toString());var o=!1,s=!1,d=!1,f=!1;for(var u in RedSystemShaderCode.vertexShareFunc)a=new RegExp("//#REDGL_DEFINE#vertexShareFunc#"+u+"#","gi"),r=r.replace(a,RedSystemShaderCode.vertexShareFunc[u]);for(var u in RedSystemShaderCode.fragmentShareFunc)a=new RegExp("//#REDGL_DEFINE#fragmentShareFunc#"+u+"#","gi"),n=n.replace(a,RedSystemShaderCode.fragmentShareFunc[u]);if(i){i.sort(),t+="_"+i.join("_");for(var l=i.length;l--;)"fog"==i[l]&&(o=!0),"sprite3D"==i[l]&&(s=!0),"directionalShadow"==i[l]&&(d=!0),"skin"==i[l]&&(f=!0),"fog"!=i[l]&&"sprite3D"!=i[l]&&"directionalShadow"!=i[l]&&"skin"!=i[l]&&(a=new RegExp("//#REDGL_DEFINE#"+i[l]+"#","gi"),r=r.replace(a,""),n=n.replace(a,""))}return a=new RegExp("//#REDGL_DEFINE#fog#"+(o?"true":"false")+"#","gi"),r=r.replace(a,""),n=n.replace(a,""),a=new RegExp("//#REDGL_DEFINE#sprite3D#"+(s?"true":"false")+"#","gi"),r=r.replace(a,""),n=n.replace(a,""),a=new RegExp("//#REDGL_DEFINE#directionalShadow#"+(d?"true":"false")+"#","gi"),r=r.replace(a,""),n=n.replace(a,""),a=new RegExp("//#REDGL_DEFINE#skin#"+(f?"true":"false")+"#","gi"),r=r.replace(a,""),n=n.replace(a,""),RedProgram(e,t,r,n,i)},Object.freeze(RedProgram)}(),(RedSystemShaderCode={}).init=function(e){var t,r,n=e.detect;r=parseInt(Math.floor(Math.min((n.vertexShader.MAX_VERTEX_UNIFORM_VECTORS-64)/8,128))),t=parseInt(Math.floor(Math.min((n.fragmentShader.MAX_FRAGMENT_UNIFORM_VECTORS-64)/4,128))),(RedSystemShaderCode={vertexShareDeclare:["attribute vec3 aVertexPosition","attribute vec3 aVertexNormal","attribute vec4 aVertexColor","attribute vec4 aVertexWeight","attribute vec4 aVertexJoint","varying vec4 vVertexPosition","varying vec3 vVertexNormal","varying vec4 vVertexColor","attribute float aPointSize","uniform float uPointSize","attribute vec2 aTexcoord","attribute vec2 aTexcoord1","varying vec2 vTexcoord","varying vec2 vTexcoord1","uniform bool uOrthographicYn","uniform float uTime","varying float vTime","uniform vec2 uResolution","varying vec2 vResolution","uniform mat4 uMMatrix","uniform mat4 uNMatrix","uniform mat4 uPMatrix","uniform mat4 uCameraMatrix","uniform bool u_PerspectiveScale","uniform mat4 uDirectionalShadowLightMatrix","varying highp vec4 vShadowPos","const mat4 cTexUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0)","uniform mat4 uJointMatrix["+r+"]","uniform mat4 uInverseBindMatrixForJoint["+r+"]","uniform mat4 uGlobalTransformOfNodeThatTheMeshIsAttachedTo"],fragmentShareDeclare:["varying vec4 vVertexPosition","varying vec3 vVertexNormal","varying vec4 vVertexColor","varying vec2 vTexcoord","varying vec2 vTexcoord1","varying float vTime","varying vec2 vResolution","uniform vec3 uCameraPosition","uniform float u_FogDistance","uniform float u_FogDensity","uniform vec4 uFogColor","const int cDIRETIONAL_MAX = 3","uniform vec3 uDirectionalLightPositionList[3]","uniform vec4 uDirectionalLightColorList[3]","uniform float uDirectionalLightIntensityList[3]","uniform int uDirectionalLightNum","const int cPOINT_MAX = "+t,"uniform vec3 uPointLightPositionList["+t+"]","uniform vec4 uPointLightColorList["+t+"]","uniform float uPointLightRadiusList["+t+"]","uniform float uPointLightIntensityList["+t+"]","uniform int uPointLightNum","uniform vec4 uAmbientLightColor","uniform float uAmbientIntensity","uniform sampler2D uDirectionalShadowTexture","varying highp vec4 vShadowPos"],systemUniform:{},vertexShareFunc:{getSkinMatrix:["//#REDGL_DEFINE#skin#true#  mat4 getSkinMatrix(){","//#REDGL_DEFINE#skin#true#      mat4 skinMat =","//#REDGL_DEFINE#skin#true#      aVertexWeight.x * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.x) ] * uInverseBindMatrixForJoint[int(aVertexJoint.x)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.y * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.y) ] * uInverseBindMatrixForJoint[int(aVertexJoint.y)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.z * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.z) ] * uInverseBindMatrixForJoint[int(aVertexJoint.z)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.w * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.w) ] * uInverseBindMatrixForJoint[int(aVertexJoint.w)];","//#REDGL_DEFINE#skin#true#      return skinMat;","//#REDGL_DEFINE#skin#true#  }"].join("\n"),getSprite3DMatrix:["mat4 getSprite3DMatrix(mat4 cameraMTX, mat4 mvMatrix){","   mat4 cacheScale = mat4(","      mvMatrix[0][0], 0.0, 0.0, 0.0,","       0.0, mvMatrix[1][1], 0.0, 0.0,","      0.0, 0.0, 1.0, mvMatrix[2][2],","      0.0, 0.0, 0.0, 1.0","   );","   mat4 tMTX = cameraMTX * mvMatrix;","   tMTX[0][0] = 1.0, tMTX[0][1] = 0.0, tMTX[0][2] = 0.0,","   tMTX[1][0] = 0.0, tMTX[1][1] = 1.0, tMTX[1][2] = 0.0,","   tMTX[2][0] = 0.0, tMTX[2][1] = 0.0, tMTX[2][2] = 1.0;","   return tMTX * cacheScale;","}"].join("\n")},fragmentShareFunc:{getFlatNormal:["vec3 getFlatNormal(vec3 vertexPosition){","   vec3 dx = dFdx(vVertexPosition.xyz);","   vec3 dy = dFdy(vVertexPosition.xyz);","   return normalize(cross(normalize(dx), normalize(dy)));","}"].join("\n"),getDirectionalLightColor:["vec4 getDirectionalLightColor(      vec4 texelColor,      vec3 N,      float shininess,      vec4 specularLightColor,      float specularTextureValue,      float specularPower) {","   vec3 L;","   float specular;","   float lambertTerm;","   vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);","   vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);","   for(int i=0; i<cDIRETIONAL_MAX; i++){","      if(i == uDirectionalLightNum) break;","      L = normalize(-uDirectionalLightPositionList[i]);","      lambertTerm = dot(N,-L);","      if(lambertTerm > 0.0){","         ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i];","         specular = pow( max(dot(reflect(L, N), -L), 0.0), shininess) * specularPower * specularTextureValue;","         ls +=  specularLightColor * specular * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;","      }","   }","   return ld + ls;","}"].join("\n"),getPointLightColor:["vec4 getPointLightColor(      vec4 texelColor,      vec3 N,      float shininess,      vec4 specularLightColor,      float specularTextureValue,      float specularPower) {","   vec3 L;","   float specular;","   float lambertTerm;","   vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);","   vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);","   float distanceLength;","   float attenuation;","   for(int i=0;i<cPOINT_MAX;i++){","      if(i== uPointLightNum) break;","      L =  -uPointLightPositionList[i] + vVertexPosition.xyz;","      distanceLength = abs(length(L));","      if(uPointLightRadiusList[i]> distanceLength){","          attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;","          L = normalize(L);","          lambertTerm = dot(N,-L);","          if(lambertTerm > 0.0){","             ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;","             specular = pow( max(dot( reflect(L, N), -N), 0.0), shininess) * specularPower * specularTextureValue;","             ls +=  specularLightColor * specular  * uPointLightIntensityList[i]  * uPointLightColorList[i].a ;","          }","      }","   }","   return ld + ls;","}"].join("\n"),fogFactor:["float fogFactor(float perspectiveFar, float density){","   float flog_cord = gl_FragCoord.z / gl_FragCoord.w / perspectiveFar;","   float fog = flog_cord * density;","   if(1.0 - fog < 0.0) discard;","   return clamp(1.0 - fog, 0.0,  1.0);","}"].join("\n"),fog:["vec4 fog(float fogFactor, vec4 fogColor, vec4 currentColor) {","   return mix(fogColor, currentColor, fogFactor);","}"].join("\n"),decodeFloatShadow:["float decodeFloatShadow (vec4 color) {","   const vec4 cBitShift = vec4(","       1.0 / (256.0 * 256.0 * 256.0),","       1.0 / (256.0 * 256.0),","       1.0 / 256.0,","       1.0","   );","   return dot(color, cBitShift);","}"].join("\n"),getShadowColor:["float getShadowColor ( vec4 shadowPos, vec2 resolution, sampler2D directionalShadowTexture ) {","   vec3 fragmentDepth = shadowPos.xyz;","   fragmentDepth.z -= 0.007; // cShadowAcneRemover","   float amountInLight = 0.0;","   for (int x = -1; x <= 1; x++) {","       for (int y = -1; y <= 1; y++) {","           vec2 tUV = fragmentDepth.xy + vec2( float(x)/resolution.x, float(y)/resolution.y );","           if(tUV.x<0.0) return 1.0;","           if(tUV.x>1.0) return 1.0;","           if(tUV.y<0.0) return 1.0;","           if(tUV.y>1.0) return 1.0;","           float texelDepth = decodeFloatShadow( texture2D(directionalShadowTexture, tUV) );","           if (fragmentDepth.z < texelDepth ) amountInLight += 1.0;","      }","   }","   amountInLight /= 9.0;","   amountInLight =  amountInLight;","   return amountInLight;","}"].join("\n"),cotangent_frame:["mat3 cotangent_frame(vec3 N, vec3 p, vec2 uv)","{","   vec3 dp1 = dFdx( p );","   vec3 dp2 = dFdy( p );","   vec2 duv1 = dFdx( uv );","   vec2 duv2 = dFdy( uv );","   ","   vec3 dp2perp = cross( dp2, N );","   vec3 dp1perp = cross( N, dp1 );","   vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;","   vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;","   ","   float invmax = inversesqrt( max( dot(T,T), dot(B,B) ) );","   return mat3( T * invmax, B * invmax, N );","}"].join("\n"),perturb_normal:["vec3 perturb_normal( vec3 N, vec3 V, vec2 texcoord, vec3 normalColor )","   {","   ","   vec3 map = normalColor;","   map =  map * 255./127. - 128./127.;","   map.xy *= u_normalPower;","   mat3 TBN = cotangent_frame(N, V, texcoord);","   return normalize(TBN * map);","}"].join("\n")}}).MAX_DIRECTIONAL_LIGHT=3,RedSystemShaderCode.MAX_POINT_LIGHT=t,RedSystemShaderCode.MAX_JOINT=r,[RedSystemShaderCode.vertexShareDeclare,RedSystemShaderCode.fragmentShareDeclare].forEach(function(e){e.forEach(function(e){"uniform"==(e=e.split(" "))[0]&&(RedSystemShaderCode.systemUniform[e[2]]=1)})});var i=[],a={bool:4,float:4,int:4,uint:4,sampler2D:4,samplerCube:4,vec2:4,vec3:4,vec4:4,mat2:4,mat3:8,mat4:16};RedSystemShaderCode.vertexShareDeclare.forEach(function(e){var t;"uniform"==(e=e.split(" "))[0]&&(t={value:e,type:e[1],num:e[2].indexOf("[")>-1?+e[2].split("[")[1].replace("]","")*a[e[1]]:a[e[1]]},i.push(t))}),i=[],RedSystemShaderCode.fragmentShareDeclare.forEach(function(e){var t;"uniform"==(e=e.split(" "))[0]&&(t={value:e,type:e[1],num:e[2].indexOf("[")>-1?+e[2].split("[")[1].replace("]","")*a[e[1]]:a[e[1]]},i.push(t))}),Object.freeze(RedSystemShaderCode)},function(){var e,t,r,n,i,a,o,s,d,f;e=function(e,t,r){switch(r){case RedShader.VERTEX:return(i=e.createShader(e.VERTEX_SHADER))||(e.isContextLost()?RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - WebGL 컨텍스트가 손실"):RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - GPU메모리가 부족일 가능성이 큼")),i.key=t,i.type=r,i;case RedShader.FRAGMENT:return(i=e.createShader(e.FRAGMENT_SHADER))||(e.isContextLost()?RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - WebGL 컨텍스트가 손실"):RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - GPU메모리가 부족일 가능성이 큼")),i.key=t,i.type=r,i;default:RedGLUtil.throwFunc("RedShader : 쉐이더 타입을 확인하세요. RedShader.VERTEX or RedShader.FRAGMENT 만 허용")}},t=function(e,t,r,n){e.shaderSource(r,n.lastSource),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||RedGLUtil.throwFunc("RedShader : 쉐이더 컴파일에 실패하였습니다.\n",e.getShaderInfoLog(r))},n=function(e,t){var r;switch(e){case RedShader.VERTEX:r=RedSystemShaderCode.vertexShareDeclare.concat();break;case RedShader.FRAGMENT:r=RedSystemShaderCode.fragmentShareDeclare.concat();break;default:RedGLUtil.throwFunc("RedShader : 쉐이더 타입을 확인하세요. RedShader.VERTEX or RedShader.FRAGMENT 만 허용")}for(a=t.length;a--;)o=(o=t[a]).replace(";",""),-1==r.indexOf(o)?r.push(o):RedGLUtil.throwFunc("RedShader : ","\n1. 중복 선언 이거나","\n2. RedSystemShaderCode에 정의된 선언\n","입력값 : "+o);return r},r=function(e,t){return t=(t=t.replace(/\s+$/,"")).replace(/  /g,"").trim(),s={etc:""},d=t.match(/attribute[\s\S]+?\;|uniform[\s\S]+?\;|varying[\s\S]+?\;|const[\s\S]+?\;|precision[\s\S]+?\;/g),(d=n(e,d=d||[])).sort(),d.forEach(function(e){var r,n,i,a,o,d,f,u,l;if(e=e.trim(),t=t.replace(e+";",""),("highp"==(r=e.split(" "))[1]||"mediump"==r[1]||"lowp"==r[1])&&(l=r[1],r.splice(1,1),r.push(l),u=l),r[2])switch(n=r[0],a=r[1],i=r[2].replace(";","").split("["),d=(d=e.split("="))[1]?d[1].trim().replace(";",""):null,o=i.length>1?+i[1].split("]")[0]:0,i=i[0],n){case"precision":break;case"attribute":"a"!=i.charAt(0)&&RedGLUtil.throwFunc("RedShader : attribute의 첫글자는 a로 시작해야합니다.",i,r),i.charAt(1)!=i.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : attribute의 두번째 글자는 대문자 시작해야합니다.",i,r);break;case"uniform":"u"!=i.charAt(0)&&RedGLUtil.throwFunc("RedShader : uniform의 첫글자는 u로 시작해야합니다.",i,r),i.charAt(1)!=i.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : uniform의 두번째 글자는 대문자 시작해야합니다.",i,r);break;case"varying":"v"!=i.charAt(0)&&RedGLUtil.throwFunc("RedShader : varying의 첫글자는 v로 시작해야합니다.",i,r),i.charAt(1)!=i.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : varying의 두번째 글자는 대문자 시작해야합니다.",i,r);break;case"const":"c"!=i.charAt(0)&&RedGLUtil.throwFunc("RedShader : const의 첫글자는 c로 시작해야합니다.",i,r),i.charAt(1)!=i.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : const의 두번째 글자는 대문자 시작해야합니다.",i,r);break;default:RedGLUtil.throwFunc("RedShader : 체크되지 못하는값인데 뭐냐",i,r)}else RedGLUtil.throwFunc("RedShader : 체크되지 못하는값인데 뭐냐",r);s[n]||(s[n]={},s[n].list=[],s[n].map={},s[n].source=""),f={name:i,arrayNum:o,value:d,precision:u,systemUniformYn:!!RedSystemShaderCode.systemUniform[o?i+"["+o+"]":i]},"uniform"==n&&(f.uniformType=a),"attribute"==n&&(f.attributeType=a),"varying"==n&&(f.varyingType=a),s[n].list.push(f),s[n].map[i]=e,s[n].source+=e+";\n"}),t=(t+="\n").trim(),s.etc=t+"\n",f=e==RedShader.FRAGMENT?"#extension GL_OES_standard_derivatives : enable\n":"",s.precision&&(f+=s.precision.source+"\n//const\n"),s.const&&(f+=s.const.source+"\n//attribute\n"),s.attribute&&(f+=s.attribute.source+"\n//uniform\n"),s.uniform&&(f+=s.uniform.source+"\n//varying\n"),s.varying&&(f+=s.varying.source+"\n//etc\n"),s.etc&&(f+=s.etc),s.lastSource=f,e!=RedShader.FRAGMENT||s.precision||RedGLUtil.throwFunc("RedShader : FRAGMENT Shader는 precision를 반드시 선언해야함"),s},(RedShader=function(n,i,a,o){var s;if(!(this instanceof RedShader))return new RedShader(n,i,a,o);if(n instanceof RedGL||RedGLUtil.throwFunc("RedShader : RedGL Instance만 허용.","입력값 : "+n),"string"==typeof i||RedGLUtil.throwFunc("RedShader : key - 문자열만 허용.","입력값 : "+i),a!=RedShader.VERTEX&&a!=RedShader.FRAGMENT&&RedGLUtil.throwFunc("RedShader : type - RedShader.VERTEX or RedShader.FRAGMENT 만 허용.","입력값 : "+a),n._datas.RedShader||(n._datas.RedShader={},n._datas.RedShader[RedShader.VERTEX]={},n._datas.RedShader[RedShader.FRAGMENT]={}),o)"string"==typeof o||RedGLUtil.throwFunc("RedShader : source - 문자열만 허용."),RedShader.hasKey(n,i,a)?RedGLUtil.throwFunc("RedShader : key - 이미 정의된 키로 생성을 시도.","\n키 :",i,"\n타입 :"+a):n._datas.RedShader[a][i]=this;else{if(RedShader.hasKey(n,i,a))return n._datas.RedShader[a][i];RedGLUtil.throwFunc("RedShader : "+a+" 타입에 존재하지 않는 key를 검색하려고합니다.","입력값 : "+i)}s=n.gl,this.webglShader=e(s,i,a),this.parseData=r(a,o),this.originSource=o,t(s,0,this.webglShader,this.parseData),this.key=i,this.type=a,this._UUID=RedGL.makeUUID(),Object.freeze(this)}).hasKey=function(e,t,r){return!!e._datas.RedShader[r][t]},RedShader.FRAGMENT="fragmentShader",RedShader.VERTEX="vertexShader",Object.freeze(RedShader)}(),function(){var e,t,r,n=[];e=function(t){for(var r,i=n.length;i--;)(r=n[i]).worldRender(r._redGL,t),r._callback&&r._callback(t);requestAnimationFrame(e)},requestAnimationFrame(e),(RedRenderer=function(){if(!(this instanceof RedRenderer))return new RedRenderer;this.world=null,this._tickKey=null,this._callback=null,this._UUID=RedGL.makeUUID(),this.renderInfo={},this.cacheState=[],this.cacheInfo={cacheUniformInfo:[],cacheAttrInfo:[],cacheSamplerIndex:[],cacheTexture:[],cacheSystemUniformInfo:[]},this.renderDebuger=RedRenderDebuger(),this.worldRect=[],this._glInitialized=!1}).prototype={start:function(e,t){e instanceof RedGL||RedGLUtil.throwFunc("RedGL Instance만 허용"),e.world instanceof RedWorld||RedGLUtil.throwFunc("RedWorld Instance만 허용");this.stop(),this.world=e.world,this._redGL=e,this._callback=t,n.push(this)},setDebugButton:function(){var e,t=this;window.document&&(document.body.appendChild(e=document.createElement("button")),e.style.cssText="position:fixed;left:10px;top:10px;background:rgb(91, 82, 170);color:#fff;z-index:10001;border:0;outline:none;cursor:pointer;padding:8px;font-size:11px;border-radius:5px",e.innerHTML="debugRenderInfo - "+RedGL_VERSION.version,e.addEventListener("click",function(){t.renderDebuger.visible=!t.renderDebuger.visible}))},render:function(e,t){e instanceof RedGL||RedGLUtil.throwFunc("RedGL Instance만 허용"),t=t||0,this.world=e.world,this.worldRender(e,t)},stop:function(){-1==(t=n.indexOf(this))||n.splice(t,1)}};var i,a,o,s,d,f,u,l,c,h,R,m=[];RedRenderer.prototype.worldRender=(f=[],o=function(e){for(u=e.length;u--;)"number"==typeof e[u]?e[u]=e[u]:e[u]=u<2?i[u+2]*parseFloat(e[u])/100:i[u]*parseFloat(e[u])/100;return e},s=function(e,t,n){r=RedSystemUniformUpdater.update(e,this,t,n,r,f)},d=function(e){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.SCISSOR_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.disable(e.DITHER),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1)},function(e,t){var r,n,u,l,c,h,R,p,_;for(r=e.gl,a=this,window.RedGLTFLoader&&RedGLTFLoader.animationLooper(t),(i=a.worldRect)[0]=0,i[1]=0,i[2]=r.drawingBufferWidth,i[3]=r.drawingBufferHeight,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.scissor(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),m.length=0,a._glInitialized||(d(r),a._glInitialized=!0),a.renderInfo={},a.cacheInfo.cacheAttrInfo.length=0,e.gl.activeTexture(e.gl.TEXTURE0),e.gl.bindTexture(e.gl.TEXTURE_2D,e._datas.emptyTexture["2d"].webglTexture),e.gl.activeTexture(e.gl.TEXTURE0+1),e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,e._datas.emptyTexture["3d"].webglTexture),h=0,R=a.world._viewList.length;h<R;h++)(_=(p=a.world._viewList[h])._viewRect)[0]=p._x,_[1]=p._y,_[2]=p._width,_[3]=p._height,c=p.camera,n=p.scene,o(_),a.renderInfo[p.key]||(a.renderInfo[p.key]={}),(u=a.renderInfo[p.key]).orthographicYn=c instanceof RedBaseController?c.camera.orthographicYn:c.orthographicYn,u.x=p._x,u.y=p._y,u.width=p._width,u.height=p._height,u.viewRectX=_[0],u.viewRectY=_[1],u.viewRectWidth=_[2],u.viewRectHeight=_[3],u.key=p.key,u.call=0,u.triangleNum=0,u.viewRenderTime=0,u.postEffectRenderTime=0,r.viewport(_[0],i[3]-_[3]-_[1],_[2],_[3]),r.scissor(_[0],i[3]-_[3]-_[1],_[2],_[3]),n._useBackgroundColor?(n._useFog?r.clearColor(n._fogR,n._fogG,n._fogB,1):r.clearColor(n._r,n._g,n._b,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):(r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),c instanceof RedBaseController&&(c.update(),c=c.camera),c.autoUpdateMatrix&&c.update(),l=c.perspectiveMTX,mat4.identity(l),c.orthographicYn?(mat4.ortho(l,-.5,.5,-.5,.5,-c.farClipping,c.farClipping),mat4.translate(l,l,[-.5,.5,0]),mat4.scale(l,l,[1/_[2]*e.renderScale*window.devicePixelRatio,-1/_[3]*e.renderScale*window.devicePixelRatio,1]),mat4.identity(c.matrix),r.disable(r.CULL_FACE),a.cacheState.useCullFace=!1):(mat4.perspective(l,c.fov*Math.PI/180,_[2]/_[3],c.nearClipping,c.farClipping),r.enable(r.CULL_FACE),a.cacheState.useCullFace=!0),!a.cacheState.useDepthMask&&r.depthMask(a.cacheState.useDepthMask=!0),n.mouseManager&&(s.apply(a,[e,t,p]),n.mouseManager.render(e,a,p,t,u)),n.shadowManager._directionalShadow&&(s.apply(a,[e,t,p]),r.disable(r.BLEND),r.blendFunc(r.ONE,r.ONE),a.cacheState.useBlendMode=!0,a.cacheState.blendSrc=r.ONE,a.cacheState.blendDst=r.ONE,n.shadowManager.render(e,a,p,t,u),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),a.cacheState.useBlendMode=!0,a.cacheState.blendSrc=r.SRC_ALPHA,a.cacheState.blendDst=r.ONE_MINUS_SRC_ALPHA),p.postEffectManager.postEffectList.length&&(p.postEffectManager.bind(r),r.viewport(0,0,p.postEffectManager.frameBuffer.width,p.postEffectManager.frameBuffer.height),r.scissor(0,0,p.postEffectManager.frameBuffer.width,p.postEffectManager.frameBuffer.height)),s.apply(a,[e,t,p]),n.skyBox&&(n.skyBox.x=c.x,n.skyBox.y=c.y,n.skyBox.z=c.z,n.skyBox.scaleX=n.skyBox.scaleY=n.skyBox.scaleZ=.6*c.farClipping,a.sceneRender(e,n,c,c.orthographicYn,[n.skyBox],t,u)),n.grid&&a.sceneRender(e,n,c,c.orthographicYn,[n.grid],t,u),a.sceneRender(e,n,c,c.orthographicYn,n.children,t,u),m.length&&a.sceneRender(e,n,c,c.orthographicYn,m,t,u,null,!0),n.axis&&a.sceneRender(e,n,c,c.orthographicYn,n.axis.children,t,u),f.length&&a.sceneRender(e,n,c,c.orthographicYn,f,t,u),u.viewRenderTime=performance.now(),p.postEffectManager.postEffectList.length&&p.postEffectManager.render(e,r,a,p,t,u),u.postEffectRenderTime=performance.now()-u.viewRenderTime,u.viewRenderTime-=t;this.renderDebuger.visible&&this.renderDebuger.update(e,a.renderInfo)}),RedRenderer.prototype.sceneRender=(l=function(e,t,n,i,a,o,s,d,f,u,p,_){var g,E,P,y,v,M,T,x,b,L,I,w,D,U,B,S,G,A,F,C,O,N,k,Y,X,j,z,V,Z,H,W,q,J,K,Q,$,ee,te,re,ne,ie,ae,oe,se,de,fe,ue,le,ce,he,Re,me,pe,_e,ge,Ee,Pe,ye,ve,Me,Te,xe,be,Le,Ie,we,De,Ue,Be,Se,Ge,Ae,Fe,Ce,Oe,Ne,ke,Ye,Xe,je,ze,Ve,Ze,He,We,qe,Je,Ke,Qe,$e,et,tt,rt,nt,it,at,ot,st,dt,ft,ut,lt,ct,ht,Rt,mt,pt,_t,gt,Et,Pt,yt,vt,Mt,Tt,xt,bt,Lt=e.gl,It=d.cacheAttrInfo,wt=d.cacheUniformInfo,Dt=d.cacheSamplerIndex,Ut=d.cacheTexture,Bt=a?-1:1;P=Math.PI/180,mt=3.141592653589793,pt=6.283185307179586,_t=1.27323954,gt=.405284735,Et=1.5707963267948966,g=n.length;var St=n.length-1;for(H=t._useFog;g--;){if(s.call++,N=(y=n[St-g]).matrix,k=y.normalMatrix,v=y._geometry,j=y._sprite3DYn,Z=y.skinInfo,y.useLOD)for(var Gt in Pt=i.x-y.x,yt=i.y-y.y,vt=i.z-y.z,Mt=Math.abs(Math.sqrt(Pt*Pt+yt*yt+vt*vt)),T=y._lodLevels)(z=T[Gt]).distance<Mt&&(y._geometry=z.geometry,y._material=z.material);if(v){if(V=(M=p||y._material)._RedDirectionalShadowYn,M._RedMouseEventMaterialYn&&(M.color=y._mouseColorID),M.__RedSheetMaterialYn){if(M._nextFrameTime||(M._nextFrameTime=M._perFrameTime+o),M._playYn&&M._nextFrameTime<o){var At=parseInt((o-M._nextFrameTime)/M._perFrameTime);At=At||1,M._nextFrameTime=M._perFrameTime+o,M.currentIndex+=At,M.currentIndex>=M.totalFrame&&(M._loop?(M._playYn=!0,M.currentIndex=0):(M._playYn=!1,M.currentIndex=M.totalFrame-1))}M._sheetRect[0]=1/M._segmentW,M._sheetRect[1]=1/M._segmentH,M._sheetRect[2]=M.currentIndex%M._segmentW/M._segmentW,M._sheetRect[3]=Math.floor(M.currentIndex/M._segmentH)/M._segmentH}for(Tt=t.shadowManager._directionalShadow,(W=M.program)._prepareProgramYn&&(W=M.program=W._makePrepareProgram()),q=null,J=null,bt=W.key,(xt=M._programList)&&(Tt?q=H&&j?"directionalShadow_fog_sprite3D":H&&Z?"directionalShadow_fog_skin":Z?"directionalShadow_skin":j?"directionalShadow_sprite3D":H?"directionalShadow_fog":"directionalShadow":H&&j?q="fog_sprite3D":H&&Z?q="fog_skin":Z?q="skin":j?q="sprite3D":H&&(q="fog")),q&&((J=xt[q][bt])._prepareProgramYn&&(J=xt[q][bt]=J._makePrepareProgram()),W=J),r!=W._UUID&&Lt.useProgram(W.webglProgram),r=W._UUID,x=W.attributeLocation,w=W.uniformLocation,D=W.systemUniformLocation,G=v.interleaveBuffer,A=v.indexBuffer,Y=G._UUID,E=x.length,L=G.interleaveDefineInfoList,h!=Y&&Lt.bindBuffer(Lt.ARRAY_BUFFER,G.webglBuffer),h=Y;E--;)I=L[(b=x[E]).name],S=b.location,I&&It[S]!=I._UUID&&(!b.enabled&&Lt.enableVertexAttribArray(S),b.enabled=1,Lt.vertexAttribPointer(S,I.size,G.glArrayType,I.normalize,G.stride_BYTES_PER_ELEMENT,I.offset_BYTES_PER_ELEMENT),It[S]=I._UUID);for(E=w.length;E--;)B=(U=w[E]).location,Y=U._UUID,O=U.renderTypeIndex,C=U.renderType,F=M[U.materialPropertyName],"sampler2D"==C||"samplerCube"==C?(X=U.samplerIndex,F?Ut[X]!=F._UUID&&(R!=X&&Lt.activeTexture(Lt.TEXTURE0+(R=X)),F._videoDom?(Lt.bindTexture(Lt.TEXTURE_2D,F.webglTexture),F._videoDom.loaded&&Lt.texImage2D(Lt.TEXTURE_2D,0,Lt.RGBA,Lt.RGBA,Lt.UNSIGNED_BYTE,F._videoDom),Ut=[]):Lt.bindTexture("sampler2D"==C?Lt.TEXTURE_2D:Lt.TEXTURE_CUBE_MAP,F.webglTexture),Dt[Y]!=X&&Lt.uniform1i(B,Dt[Y]=X),Ut[X]=F._UUID):"sampler2D"==C?0!=Ut[X]&&(0!=Dt[Y]&&Lt.uniform1i(B,Dt[Y]=0),Ut[X]=0,R=0):1!=Ut[X]&&(1!=Dt[Y]&&Lt.uniform1i(B,Dt[Y]=1),Ut[X]=1,R=1)):(null==F&&RedGLUtil.throwFunc("RedRenderer : Material에 ",U.materialPropertyName,"이 정의 되지않았습니다."),O<13?wt[Y]!=F&&Lt[U.renderMethod](B,(wt[Y]=12==O?null:F,F)):13==O?Lt[U.renderMethod](B,!1,F):RedGLUtil.throwFunc("RedRenderer : 처리할수없는 타입입니다.","tRenderType -",C))}if(y.autoUpdateMatrix&&(N[0]=1,N[1]=0,N[2]=0,N[3]=0,N[4]=0,N[5]=1,N[6]=0,N[7]=0,N[8]=0,N[9]=0,N[10]=1,N[11]=0,N[12]=0,N[13]=0,N[14]=0,N[15]=1,K=N,Fe=y.x,Ce=y.y,Oe=y.z,K[12]=K[0]*Fe+K[4]*Ce+K[8]*Oe+K[12],K[13]=K[1]*Fe+K[5]*Ce+K[9]*Oe+K[13],K[14]=K[2]*Fe+K[6]*Ce+K[10]*Oe+K[14],K[15]=K[3]*Fe+K[7]*Ce+K[11]*Oe+K[15],j?ie=ae=oe=0:(ie=y.rotationX*P,ae=y.rotationY*P,oe=y.rotationZ*P),(Rt=ie%pt)<-mt?Rt+=pt:Rt>mt&&(Rt-=pt),Q=(Rt=Rt<0?_t*Rt+gt*Rt*Rt:_t*Rt-gt*Rt*Rt)<0?.225*(Rt*-Rt-Rt)+Rt:.225*(Rt*Rt-Rt)+Rt,(Rt=(ie+Et)%pt)<-mt?Rt+=pt:Rt>mt&&(Rt-=pt),te=(Rt=Rt<0?_t*Rt+gt*Rt*Rt:_t*Rt-gt*Rt*Rt)<0?.225*(Rt*-Rt-Rt)+Rt:.225*(Rt*Rt-Rt)+Rt,(Rt=ae%pt)<-mt?Rt+=pt:Rt>mt&&(Rt-=pt),$=(Rt=Rt<0?_t*Rt+gt*Rt*Rt:_t*Rt-gt*Rt*Rt)<0?.225*(Rt*-Rt-Rt)+Rt:.225*(Rt*Rt-Rt)+Rt,(Rt=(ae+Et)%pt)<-mt?Rt+=pt:Rt>mt&&(Rt-=pt),re=(Rt=Rt<0?_t*Rt+gt*Rt*Rt:_t*Rt-gt*Rt*Rt)<0?.225*(Rt*-Rt-Rt)+Rt:.225*(Rt*Rt-Rt)+Rt,(Rt=oe%pt)<-mt?Rt+=pt:Rt>mt&&(Rt-=pt),ee=(Rt=Rt<0?_t*Rt+gt*Rt*Rt:_t*Rt-gt*Rt*Rt)<0?.225*(Rt*-Rt-Rt)+Rt:.225*(Rt*Rt-Rt)+Rt,(Rt=(oe+Et)%pt)<-mt?Rt+=pt:Rt>mt&&(Rt-=pt),ne=(Rt=Rt<0?_t*Rt+gt*Rt*Rt:_t*Rt-gt*Rt*Rt)<0?.225*(Rt*-Rt-Rt)+Rt:.225*(Rt*Rt-Rt)+Rt,se=K[0],de=K[1],fe=K[2],le=K[4],ce=K[5],he=K[6],me=K[8],pe=K[9],_e=K[10],Le=re*ne,Ie=Q*$*ne-te*ee,we=te*$*ne+Q*ee,De=re*ee,Ue=Q*$*ee+te*ne,Be=te*$*ee-Q*ne,Se=-$,Ge=Q*re,Ae=te*re,K[0]=se*Le+le*Ie+me*we,K[1]=de*Le+ce*Ie+pe*we,K[2]=fe*Le+he*Ie+_e*we,K[4]=se*De+le*Ue+me*Be,K[5]=de*De+ce*Ue+pe*Be,K[6]=fe*De+he*Ue+_e*Be,K[8]=se*Se+le*Ge+me*Ae,K[9]=de*Se+ce*Ge+pe*Ae,K[10]=fe*Se+he*Ge+_e*Ae,Fe=y.scaleX,Ce=y.scaleY*Bt,Oe=y.scaleZ,K[0]=K[0]*Fe,K[1]=K[1]*Fe,K[2]=K[2]*Fe,K[3]=K[3]*Fe,K[4]=K[4]*Ce,K[5]=K[5]*Ce,K[6]=K[6]*Ce,K[7]=K[7]*Ce,K[8]=K[8]*Oe,K[9]=K[9]*Oe,K[10]=K[10]*Oe,K[11]=K[11]*Oe,K[12]=K[12],K[13]=K[13],K[14]=K[14],K[15]=K[15],y.localMatrix[0]=K[0],y.localMatrix[1]=K[1],y.localMatrix[2]=K[2],y.localMatrix[3]=K[3],y.localMatrix[4]=K[4],y.localMatrix[5]=K[5],y.localMatrix[6]=K[6],y.localMatrix[7]=K[7],y.localMatrix[8]=K[8],y.localMatrix[9]=K[9],y.localMatrix[10]=K[10],y.localMatrix[11]=K[11],y.localMatrix[12]=K[12],y.localMatrix[13]=K[13],y.localMatrix[14]=K[14],y.localMatrix[15]=K[15],u&&(se=u[0],de=u[1],fe=u[2],ue=u[3],le=u[4],ce=u[5],he=u[6],Re=u[7],me=u[8],pe=u[9],_e=u[10],ge=u[11],Ee=u[12],Pe=u[13],ye=u[14],ve=u[15],Me=N[0],Te=N[1],xe=N[2],be=N[3],N[0]=Me*se+Te*le+xe*me+be*Ee,N[1]=Me*de+Te*ce+xe*pe+be*Pe,N[2]=Me*fe+Te*he+xe*_e+be*ye,N[3]=Me*ue+Te*Re+xe*ge+be*ve,Me=N[4],Te=N[5],xe=N[6],be=N[7],N[4]=Me*se+Te*le+xe*me+be*Ee,N[5]=Me*de+Te*ce+xe*pe+be*Pe,N[6]=Me*fe+Te*he+xe*_e+be*ye,N[7]=Me*ue+Te*Re+xe*ge+be*ve,Me=N[8],Te=N[9],xe=N[10],be=N[11],N[8]=Me*se+Te*le+xe*me+be*Ee,N[9]=Me*de+Te*ce+xe*pe+be*Pe,N[10]=Me*fe+Te*he+xe*_e+be*ye,N[11]=Me*ue+Te*Re+xe*ge+be*ve,Me=N[12],Te=N[13],xe=N[14],be=N[15],N[12]=Me*se+Te*le+xe*me+be*Ee,N[13]=Me*de+Te*ce+xe*pe+be*Pe,N[14]=Me*fe+Te*he+xe*_e+be*ye,N[15]=Me*ue+Te*Re+xe*ge+be*ve)),v&&Lt.uniformMatrix4fv(D.uMMatrix.location,!1,N),Z){var Ft=[],Ct=Z.joints,Ot=0,Nt=Ct.length,kt=[y.matrix[0],y.matrix[1],y.matrix[2],y.matrix[3],y.matrix[4],y.matrix[5],y.matrix[6],y.matrix[7],y.matrix[8],y.matrix[9],y.matrix[10],y.matrix[11],y.matrix[12],y.matrix[13],y.matrix[14],y.matrix[15]],Yt=kt,Xt=kt[0],jt=kt[1],zt=kt[2],Vt=kt[3],Zt=kt[4],Ht=kt[5],Wt=kt[6],qt=kt[7],Jt=kt[8],Kt=kt[9],Qt=kt[10],$t=kt[11],er=kt[12],tr=kt[13],rr=kt[14],nr=kt[15],ir=Kt*rr*qt-tr*Qt*qt+tr*Wt*$t-Ht*rr*$t-Kt*Wt*nr+Ht*Qt*nr,ar=er*Qt*qt-Jt*rr*qt-er*Wt*$t+Zt*rr*$t+Jt*Wt*nr-Zt*Qt*nr,or=Jt*tr*qt-er*Kt*qt+er*Ht*$t-Zt*tr*$t-Jt*Ht*nr+Zt*Kt*nr,sr=er*Kt*Wt-Jt*tr*Wt-er*Ht*Qt+Zt*tr*Qt+Jt*Ht*rr-Zt*Kt*rr,dr=Xt*ir+jt*ar+zt*or+Vt*sr;if(0===dr)return mat4.identity(kt);var fr=1/dr;for(Yt[0]=ir*fr,Yt[1]=(tr*Qt*Vt-Kt*rr*Vt-tr*zt*$t+jt*rr*$t+Kt*zt*nr-jt*Qt*nr)*fr,Yt[2]=(Ht*rr*Vt-tr*Wt*Vt+tr*zt*qt-jt*rr*qt-Ht*zt*nr+jt*Wt*nr)*fr,Yt[3]=(Kt*Wt*Vt-Ht*Qt*Vt-Kt*zt*qt+jt*Qt*qt+Ht*zt*$t-jt*Wt*$t)*fr,Yt[4]=ar*fr,Yt[5]=(Jt*rr*Vt-er*Qt*Vt+er*zt*$t-Xt*rr*$t-Jt*zt*nr+Xt*Qt*nr)*fr,Yt[6]=(er*Wt*Vt-Zt*rr*Vt-er*zt*qt+Xt*rr*qt+Zt*zt*nr-Xt*Wt*nr)*fr,Yt[7]=(Zt*Qt*Vt-Jt*Wt*Vt+Jt*zt*qt-Xt*Qt*qt-Zt*zt*$t+Xt*Wt*$t)*fr,Yt[8]=or*fr,Yt[9]=(er*Kt*Vt-Jt*tr*Vt-er*jt*$t+Xt*tr*$t+Jt*jt*nr-Xt*Kt*nr)*fr,Yt[10]=(Zt*tr*Vt-er*Ht*Vt+er*jt*qt-Xt*tr*qt-Zt*jt*nr+Xt*Ht*nr)*fr,Yt[11]=(Jt*Ht*Vt-Zt*Kt*Vt-Jt*jt*qt+Xt*Kt*qt+Zt*jt*$t-Xt*Ht*$t)*fr,Yt[12]=sr*fr,Yt[13]=(Jt*tr*zt-er*Kt*zt+er*jt*Qt-Xt*tr*Qt-Jt*jt*rr+Xt*Kt*rr)*fr,Yt[14]=(er*Ht*zt-Zt*tr*zt-er*jt*Wt+Xt*tr*Wt+Zt*jt*rr-Xt*Ht*rr)*fr,Yt[15]=(Zt*Kt*zt-Jt*Ht*zt+Jt*jt*Wt-Xt*Kt*Wt-Zt*jt*Qt+Xt*Ht*Qt)*fr;Ot<Nt;Ot++)Ft[16*Ot+0]=Ct[Ot].matrix[0],Ft[16*Ot+1]=Ct[Ot].matrix[1],Ft[16*Ot+2]=Ct[Ot].matrix[2],Ft[16*Ot+3]=Ct[Ot].matrix[3],Ft[16*Ot+4]=Ct[Ot].matrix[4],Ft[16*Ot+5]=Ct[Ot].matrix[5],Ft[16*Ot+6]=Ct[Ot].matrix[6],Ft[16*Ot+7]=Ct[Ot].matrix[7],Ft[16*Ot+8]=Ct[Ot].matrix[8],Ft[16*Ot+9]=Ct[Ot].matrix[9],Ft[16*Ot+10]=Ct[Ot].matrix[10],Ft[16*Ot+11]=Ct[Ot].matrix[11],Ft[16*Ot+12]=Ct[Ot].matrix[12],Ft[16*Ot+13]=Ct[Ot].matrix[13],Ft[16*Ot+14]=Ct[Ot].matrix[14],Ft[16*Ot+15]=Ct[Ot].matrix[15];Lt.uniformMatrix4fv(D.uGlobalTransformOfNodeThatTheMeshIsAttachedTo.location,!1,kt),Lt.uniformMatrix4fv(D.uJointMatrix.location,!1,Ft),Lt.uniformMatrix4fv(D.uInverseBindMatrixForJoint.location,!1,Z.inverseBindMatrices)}if(v&&D&&D.uNMatrix.location&&(Ne=N[0],ke=N[1],Ye=N[2],Xe=N[3],je=N[4],ze=N[5],Ve=N[6],Ze=N[7],He=N[8],We=N[9],qe=N[10],Je=N[11],Qe=N[12],$e=N[13],et=N[14],ht=1/(ht=(Ke=Ne*ze-ke*je)*(ct=qe*(tt=N[15])-Je*et)-(rt=Ne*Ve-Ye*je)*(lt=We*tt-Je*$e)+(nt=Ne*Ze-Xe*je)*(ut=We*et-qe*$e)+(it=ke*Ve-Ye*ze)*(ft=He*tt-Je*Qe)-(at=ke*Ze-Xe*ze)*(dt=He*et-qe*Qe)+(ot=Ye*Ze-Xe*Ve)*(st=He*$e-We*Qe)),k[0]=(ze*ct-Ve*lt+Ze*ut)*ht,k[1]=(-ke*ct+Ye*lt-Xe*ut)*ht,k[2]=($e*ot-et*at+tt*it)*ht,k[3]=(-We*ot+qe*at-Je*it)*ht,k[4]=(-je*ct+Ve*ft-Ze*dt)*ht,k[5]=(Ne*ct-Ye*ft+Xe*dt)*ht,k[6]=(-Qe*ot+et*nt-tt*rt)*ht,k[7]=(He*ot-qe*nt+Je*rt)*ht,k[8]=(je*lt-ze*ft+Ze*st)*ht,k[9]=(-Ne*lt+ke*ft-Xe*st)*ht,k[10]=(Qe*at-$e*nt+tt*Ke)*ht,k[11]=(-He*at+We*nt-Je*Ke)*ht,k[12]=(-je*ut+ze*dt-Ve*st)*ht,k[13]=(Ne*ut-ke*dt+Ye*st)*ht,k[14]=(-Qe*it+$e*rt-et*Ke)*ht,k[15]=(He*it-We*rt+qe*Ke)*ht,de=k[1],fe=k[2],ue=k[3],he=k[6],Re=k[7],ge=k[11],k[1]=k[4],k[2]=k[8],k[3]=k[12],k[4]=de,k[6]=k[9],k[7]=k[13],k[8]=fe,k[9]=he,k[11]=k[14],k[12]=ue,k[13]=Re,k[14]=ge,Lt.uniformMatrix4fv(D.uNMatrix.location,!1,k)),v){if(f.useCullFace!=y.useCullFace&&((f.useCullFace=y.useCullFace)?Lt.enable(Lt.CULL_FACE):Lt.disable(Lt.CULL_FACE)),f.useCullFace&&f.cullFace!=y.cullFace&&Lt.cullFace(f.cullFace=y.cullFace),f.useDepthMask!=y.useDepthMask&&Lt.depthMask(f.useDepthMask=y.useDepthMask),f.useDepthTest!=y.useDepthTest&&((f.useDepthTest=y.useDepthTest)?Lt.enable(Lt.DEPTH_TEST):Lt.disable(Lt.DEPTH_TEST)),f.useDepthTest&&f.depthTestFunc!=y.depthTestFunc&&Lt.depthFunc(f.depthTestFunc=y.depthTestFunc),D.uPointSize.use&&f.pointSize!=y.pointSize&&Lt.uniform1f(D.uPointSize.location,f.pointSize=y.pointSize),D.u_PerspectiveScale.location&&(Y=D.u_PerspectiveScale._UUID,F=y._perspectiveScale,wt[Y]!=F&&(Lt[D.u_PerspectiveScale.renderMethod](D.u_PerspectiveScale.location,F),wt[Y]=F)),V||(f.useBlendMode!=y.useBlendMode&&((f.useBlendMode=y.useBlendMode)?Lt.enable(Lt.BLEND):Lt.disable(Lt.BLEND)),f.blendSrc==y.blendSrc&&f.blendDst==y.blendDst||(Lt.blendFunc(y.blendSrc,y.blendDst),f.blendSrc=y.blendSrc,f.blendDst=y.blendDst)),_)y.autoUpdateMatrix=y._renderAutoUpdateMatrix;else if(y.useTransparentSort){m.push(y),y._renderAutoUpdateMatrix=y.autoUpdateMatrix,y.autoUpdateMatrix=!1;continue}A?(c!=A._UUID&&Lt.bindBuffer(Lt.ELEMENT_ARRAY_BUFFER,A.webglBuffer),Lt.drawElements(y.drawMode,A.pointNum,A.glArrayType,0),c=A._UUID,s.triangleNum+=A.triangleNum):(Lt.drawArrays(y.drawMode,0,G.pointNum),s.triangleNum+=G.triangleNum)}y.children.length&&l(e,t,y.children,i,a,o,s,d,f,N,p,_)}},function(e,t,r,n,i,a,o,s,d){this.cacheInfo.cacheTexture.length=0,c=null,h=null,R=null,l(e,t,i,r,n,a,o,this.cacheInfo,this.cacheState,void 0,s,d)}),Object.freeze(RedRenderer)}(),(RedRenderDebuger=function(){if(!(this instanceof RedRenderDebuger))return new RedRenderDebuger;if(window.HTMLCanvasElement&&!this.renderResult){this.renderResult=document.createElement("div"),this._contentBox=document.createElement("div"),this._etcBox=document.createElement("div"),this.renderResult.appendChild(this._contentBox),this.renderResult.appendChild(this._etcBox),this.renderResult.style.cssText="position:absolute;bottom:0px;left:0px;color:#fff;font:11px Lucida Grande,sans-serif;font-size:11px;background:rgba(0,0,0,0.75);padding:3px;width:300px",this._etcBox.style.cssText="position:relative;color:#fff;font:11px Lucida Grande,sans-serif;font-size:11px;padding:3px;margin-top:10px;";var e=document.createElement("a");e.style.padding="5px",e.style.borderRadius="2px",e.style.background="rgba(91, 82, 170,0.8)",e.style.color="#fff",e.style.textDecoration="none",e.style.display="block",e.setAttribute("href","https://redcamel.github.io/RedGL2/redDoc/index.html"),e.innerHTML="API document",this._etcBox.appendChild(e),(e=document.createElement("a")).style.padding="5px",e.style.borderRadius="2px",e.style.background="rgba(91, 82, 170,0.8)",e.style.color="#fff",e.style.textDecoration="none",e.style.display="block",e.style.marginTop="2px",e.setAttribute("href","https://github.com/redcamel/RedGL2"),e.innerHTML="GITHUB",this._etcBox.appendChild(e)}this._visible=!1}).prototype={update:function(e,t){if(window.HTMLCanvasElement){this._contentBox.innerHTML="";var r="",n=0,i=0;for(var a in t)r+='<div style="padding:5px"><div><b style="color:rgb(242, 169, 113)">RedView : key - '+t[a].key+'</b></div> orthographicYn - <b style="color:rgb(191, 82, 170)">'+t[a].orthographicYn+'</b> <br>call - <b style="color:rgb(191, 82, 170)">'+t[a].call+'</b> <br>triangleNum - <b style="color:rgb(191, 82, 170)">'+t[a].triangleNum+'</b> <br> width - <b style="color:rgb(191, 82, 170)">'+t[a].width+'</b> / height - <b style="color:rgb(191, 82, 170)">'+t[a].height+'</b> <br> viewRectWidth - <b style="color:rgb(191, 82, 170)">'+t[a].viewRectWidth+'</b> / viewRectHeight - <b style="color:rgb(191, 82, 170)">'+t[a].viewRectHeight+'</b> <br> x - <b style="color:rgb(191, 82, 170)">'+t[a].x+'</b> / y - <b style="color:rgb(191, 82, 170)">'+t[a].y+'</b><div>renderTime</div><div style="padding:5px 7px 7px 7px;background:rgba(0,0,0, 0.5);"><div>viewRenderTime - <b style="color:rgb(191, 82, 170)">'+t[a].viewRenderTime.toFixed(2)+'ms</b></div><div>baseRenderTime - <b style="color:rgb(191, 82, 170)">'+(t[a].viewRenderTime-t[a].postEffectRenderTime).toFixed(2)+'ms</b></div><div>postEffectRenderTime - <b style="color:rgb(191, 82, 170)">'+t[a].postEffectRenderTime.toFixed(2)+"ms</b></div></div></div>",n+=t[a].viewRenderTime,i+=t[a].postEffectRenderTime;r+='<div style="padding:0px 5px">',r+='<div>renderScale : <span style="padding:3px;background:#000">'+e.renderScale+"</span></div>",r+='<div>totalRenderTime : <span style="padding:3px;background:#000">'+n.toFixed(2)+"ms</span></div>",r+='<div>baseRenderTime : <span style="padding:3px;background:#000">'+(n-i).toFixed(2)+"ms</span></div>",r+='<div>postEffectRenderTime : <span style="padding:3px;background:#000">'+i.toFixed(2)+"ms</span></div>",r+="</div>",this._contentBox.innerHTML=r}}},Object.defineProperty(RedRenderDebuger.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,window.HTMLCanvasElement&&(this._visible?document.body.appendChild(this.renderResult):this.renderResult.parentNode&&document.body.removeChild(this.renderResult))}}),Object.freeze(RedRenderDebuger),function(){var e,t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p,_,g,E,P,y,v,M,T,x,b,L,I,w,D,U,B,S,G,A,F,C,O;RedSystemUniformUpdater={update:(O=0,E=new Float32Array(3),function(N,k,Y,X,j,z){for(null!=N&&(v=null),v||(A=RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT,F=RedSystemShaderCode.MAX_POINT_LIGHT,v={uTime:{cacheData:null,data:0},uResolution:{cacheData:null,data:new Float32Array([0,0])},u_FogDensity:{cacheData:null,data:0},uFogColor:{cacheData:null,data:new Float32Array([0,0,0,0])},u_FogDistance:{cacheData:null,data:0},uCameraMatrix:{cacheData:null,data:null},uCameraPosition:{cacheData:null,data:new Float32Array([0,0,0])},uPMatrix:{cacheData:null,data:null},uOrthographicYn:{cacheData:null,data:!1},uAmbientLightColor:{cacheData:null,data:new Float32Array([0,0,0,0])},uAmbientIntensity:{cacheData:null,data:1},uDirectionalLightPositionList:{cacheData:null,data:[]},uDirectionalLightColorList:{cacheData:null,data:[]},uDirectionalLightIntensityList:{cacheData:null,data:[]},uDirectionalLightNum:{cacheData:null,data:0},uPointLightPositionList:{cacheData:null,data:[]},uPointLightColorList:{cacheData:null,data:[]},uPointLightIntensityList:{cacheData:null,data:[]},uPointLightRadiusList:{cacheData:null,data:[]},uPointLightNum:{cacheData:null,data:0}},L=new Float32Array(3),T=new Float32Array(16),b=new Float32Array(16),d=new Float32Array(3*A),f=new Float32Array(4*A),u=new Float32Array(A),l=new Float32Array(3*F),c=new Float32Array(4*F),h=new Float32Array(F),R=new Float32Array(F)),e=N.gl,U=X.scene,B=(B=X.camera)instanceof RedBaseController?B.camera:B,S=X._viewRect,D=k.cacheInfo.cacheSystemUniformInfo,w=null,M={},z.length=0,G=O!=N._datas.RedProgramList.length,O=0,(C=v.uTime).cacheData!=Y&&(M.uTime=C.data=Y,C.cacheData=Y),s=JSON.stringify(S),((C=v.uResolution).cacheData!=s||G)&&(C.data[0]=S[2],C.data[1]=S[3],M.uResolution=C.data,C.cacheData=s),s=U._fogDensity,((C=v.u_FogDensity).cacheData!=s||G)&&(M.u_FogDensity=C.data=s,C.cacheData=s),s=U._fogR+"_"+U._fogG+"_"+U._fogB+"_1",((C=v.uFogColor).cacheData!=s||G)&&(C.data[0]=U._fogR,C.data[1]=U._fogG,C.data[2]=U._fogB,C.data[3]=1,M.uFogColor=C.data,C.cacheData=s),s=U._fogDistance,((C=v.u_FogDistance).cacheData!=s||G)&&(M.u_FogDistance=C.data=s,C.cacheData=s),s=JSON.stringify(B.matrix),((C=v.uCameraMatrix).cacheData!=s||G)&&(M.uCameraMatrix=C.data=B.matrix,C.cacheData=s),s=B.camera?[B.camera.x,B.camera.y,B.camera.z]:[B.x,B.y,B.z],(C.cacheData!=s.join(",")||G)&&(C=v.uCameraPosition,M.uCameraPosition=C.data=s,C.cacheData=s.join(",")),s=JSON.stringify(B.orthographicYn),((C=v.uOrthographicYn).cacheData!=s||G)&&(M.uOrthographicYn=C.data=B.orthographicYn,C.cacheData=s),s=JSON.stringify(B.perspectiveMTX),((C=v.uPMatrix).cacheData!=s||G)&&(M.uPMatrix=C.data=B.perspectiveMTX,C.cacheData=s),(_=U._lightInfo[RedAmbientLight.TYPE])&&(s=JSON.stringify(_._lightColor),((C=v.uAmbientLightColor).cacheData!=s||G)&&(M.uAmbientLightColor=C.data=[_._lightColor[0],_._lightColor[1],_._lightColor[2],_._lightColor[3]],C.cacheData=s,M.uAmbientLightColor[0]*=M.uAmbientLightColor[3],M.uAmbientLightColor[1]*=M.uAmbientLightColor[3],M.uAmbientLightColor[2]*=M.uAmbientLightColor[3]),s=_._intensity,((C=v.uAmbientIntensity).cacheData!=s||G)&&(M.uAmbientIntensity=C.data=_._intensity,C.cacheData=s)),m=U._lightInfo[RedDirectionalLight.TYPE],P=m.length;P--;)_=m[P],E[0]=_.x,E[1]=_.y,E[2]=_.z,_.debug&&((g=_._debugObject).x=E[0],g.y=E[1],g.z=E[2],g._material._color=_._lightColor,z.push(g)),vec3.normalize(E,E),d[0+3*P]=E[0],d[1+3*P]=E[1],d[2+3*P]=E[2],f[0+4*P]=_._lightColor[0]*_._lightColor[3],f[1+4*P]=_._lightColor[1]*_._lightColor[3],f[2+4*P]=_._lightColor[2]*_._lightColor[3],f[3+4*P]=_._lightColor[3],u[P]=_._intensity;for(s=JSON.stringify(d),((C=v.uDirectionalLightPositionList).cacheData!=s||G)&&(M.uDirectionalLightPositionList=C.data=d,C.cacheData=s),s=JSON.stringify(f),((C=v.uDirectionalLightColorList).cacheData!=s||G)&&(M.uDirectionalLightColorList=C.data=f,C.cacheData=s),s=JSON.stringify(u),((C=v.uDirectionalLightIntensityList).cacheData!=s||G)&&(M.uDirectionalLightIntensityList=C.data=u,C.cacheData=s),s=m.length,((C=v.uDirectionalLightNum).cacheData!=s||G)&&(M.uDirectionalLightNum=C.data=s,C.cacheData=s),m=U._lightInfo[RedPointLight.TYPE],P=m.length;P--;)_=m[P],E[0]=_.x,E[1]=_.y,E[2]=_.z,_.debug&&((g=_._debugObject).x=E[0],g.y=E[1],g.z=E[2],g.scaleX=g.scaleY=g.scaleZ=_._radius,g._material._color=_._lightColor,z.push(g)),l[0+3*P]=E[0],l[1+3*P]=E[1],l[2+3*P]=E[2],c[0+4*P]=_._lightColor[0]*_._lightColor[3],c[1+4*P]=_._lightColor[1]*_._lightColor[3],c[2+4*P]=_._lightColor[2]*_._lightColor[3],c[3+4*P]=_._lightColor[3],h[P]=_._intensity,R[P]=_._radius;for(s=JSON.stringify(l),((C=v.uPointLightPositionList).cacheData!=s||G)&&(M.uPointLightPositionList=C.data=l,C.cacheData=s),s=JSON.stringify(c),((C=v.uPointLightColorList).cacheData!=s||G)&&(M.uPointLightColorList=C.data=c,C.cacheData=s),s=JSON.stringify(h),((C=v.uPointLightIntensityList).cacheData!=s||G)&&(M.uPointLightIntensityList=C.data=h,C.cacheData=s),s=JSON.stringify(R),((C=v.uPointLightRadiusList).cacheData!=s||G)&&(M.uPointLightRadiusList=C.data=R,C.cacheData=s),s=m.length,((C=v.uPointLightNum).cacheData!=s||G)&&(M.uPointLightNum=C.data=s,C.cacheData=s),U.shadowManager._directionalShadow&&(T[1]=T[2]=T[3]=T[4]=T[6]=T[7]=T[8]=T[9]=T[11]=T[12]=T[13]=T[14]=0,T[0]=T[5]=T[10]=T[15]=1,x=U.shadowManager._directionalShadow.size,p=U.shadowManager._directionalShadow._light,mat4.ortho(b,-x,x,-x,x,-x,x),L[0]=0,L[1]=0,L[2]=0,p&&(L[0]=p.x,L[1]=p.y,L[2]=p.z,vec3.normalize(L,L),mat4.lookAt(T,L,[0,0,0],[0,1,0]),mat4.multiply(T,b,T))),P=N._datas.RedProgramList.length;P--;)for(y in O++,t=N._datas.RedProgramList[P],e.useProgram(t.webglProgram),j=t._UUID,r=t.systemUniformLocation,n=r.uDirectionalShadowLightMatrix,i=n.location,a=n._UUID,i&&U.shadowManager._directionalShadow&&(p=U.shadowManager._directionalShadow._light)&&(s=JSON.stringify(T),D[a]!=s&&(e.uniformMatrix4fv(i,!1,T),D[a]=s)),(n=r.uDirectionalShadowTexture)&&(i=n.location)&&(a=n._UUID,o=U.shadowManager._directionalShadow?U.shadowManager.directionalShadow.frameBuffer.texture:N._datas.emptyTexture["2d"],(I=n.samplerIndex)!=w&&(e.activeTexture(e.TEXTURE0+I),e.bindTexture(e.TEXTURE_2D,o.webglTexture),e[n.renderMethod](i,I)),w=I),M)n=r[y],(i=n.location)&&(a=n._UUID,o=M[y],"mat"==n.renderType?e[n.renderMethod](i,!1,o):e[n.renderMethod](i,o),D[a]=null);return j})},Object.freeze(RedSystemUniformUpdater)}(),function(){var e;e={},(RedView=function(t,r,n,i){if(e[t]){if(!n&&!i)return e[t];RedGLUtil.throwFunc("RedView : "+t,"는 이미 생성된 RedView key입니다.","입력값 : "+t)}if(r instanceof RedGL||RedGLUtil.throwFunc("RedScene : RedGL Instance만 허용.",r),!(this instanceof RedView))return new RedView(t,r,n,i);"string"==typeof t||RedGLUtil.throwFunc("RedView : key : 문자열만 허용","입력값 : "+t),n||i||RedGLUtil.throwFunc("RedView : 존재하지 않는 key입니다.","입력값 : "+t),!n||n instanceof RedScene||RedGLUtil.throwFunc("RedView : RedScene Instance만 허용","입력값 : "+n),i?!i||i instanceof RedCamera||i instanceof RedBaseController||RedGLUtil.throwFunc("RedView : RedCamera or XXController Instance만 허용"):RedGLUtil.throwFunc("RedView : RedCamera or XXController Instance만 허용","입력값 : "+i),this.key=t,this.scene=n,this.postEffectManager=RedPostEffectManager(r),this.camera=i,this._width="100%",this._height="100%",this._x=0,this._y=0,this._viewRect=[0,0,0,0],e[t]=this}).prototype={setSize:function(e,t){null==e&&RedGLUtil.throwFunc("RedView setSize : width가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedView setSize : height가 입력되지 않았습니다."),"number"==typeof e?this._width=e<0?0:e:e.indexOf("%")>-1&&+e.replace("%","")>=0?this._width=e:RedGLUtil.throwFunc("RedView setSize : width는 0이상의 숫자나 %만 허용.",e),"number"==typeof t?this._height=t<0?0:t:t.indexOf("%")>-1&&+t.replace("%","")>=0?this._height=t:RedGLUtil.throwFunc("RedView setSize : height는 0이상의 숫자나 %만 허용.",t)},setLocation:function(e,t){null==e&&RedGLUtil.throwFunc("RedView setLocation : x가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedView setLocation : y가 입력되지 않았습니다."),"number"==typeof e?this._x=e<0?0:e:e.indexOf("%")>-1&&+e.replace("%","")>=0?this._x=e:RedGLUtil.throwFunc("RedView setLocation : x는 0이상의 숫자나 %만 허용.",e),"number"==typeof t?this._y=t<0?0:t:t.indexOf("%")>-1&&+t.replace("%","")>=0?this._y=t:RedGLUtil.throwFunc("RedView setLocation : y는 0이상의 숫자나 %만 허용.",t)}},Object.freeze(RedView)}(),function(){var e,t;(RedWorld=function(){if(!(this instanceof RedWorld))return new RedWorld;this._viewList=[],this._viewMap={},this._UUID=RedGL.makeUUID()}).prototype={addView:function(e){e instanceof RedView||RedGLUtil.throwFunc("RedWorld :addView Instance만 허용함.","입력값 : "+e),this._viewMap[e.key]=e,this._viewList.push(e)},getView:function(e){return"string"==typeof e||RedGLUtil.throwFunc("RedWorld :getView 문자열만 허용함.","입력값 : "+e),this._viewMap[e]},delView:function(r){"string"==typeof r||RedGLUtil.throwFunc("RedWorld :delView 문자열만 허용함.","입력값 : "+r),(e=this._viewMap[r])&&(t=this._viewList.indexOf(e),this._viewList.splice(t,1),delete this._viewMap[r])},hasView:function(e){return"string"==typeof e||RedGLUtil.throwFunc("RedWorld :hasView 문자열만 허용함.","입력값 : "+e),!!this._viewMap[e]},getViewList:function(){return this._viewList.concat()}},Object.freeze(RedWorld)}(),function(){RedScene=function(e,t){if(!(this instanceof RedScene))return new RedScene(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedScene : RedGL Instance만 허용.",e),this.backgroundColor=t||"#000000",this.useBackgroundColor=!0,this.useFog=!1,this.fogDensity=.5,this.fogDistance=25,this.fogColor="#ffffff",this.children=[],this.shadowManager=RedShadowManager(e),this.mouseManager=RedMouseEventManager(e),this._lightInfo={RedAmbientLight:null,RedDirectionalLight:[],RedPointLight:[]},this._UUID=RedGL.makeUUID()};var e,t,r={addLight:function(e){switch(e.TYPE){case RedAmbientLight.TYPE:this._lightInfo[e.TYPE]=e;break;case RedDirectionalLight.TYPE:this._lightInfo[e.TYPE].length==RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT&&RedGLUtil.throwFunc("RedScene : RedDirectionalLight "+RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT+"개 까지 허용."),this._lightInfo[e.TYPE].push(e);break;case RedPointLight.TYPE:this._lightInfo[e.TYPE].length==RedSystemShaderCode.MAX_POINT_LIGHT&&RedGLUtil.throwFunc("RedScene : RedPointLight "+RedSystemShaderCode.MAX_POINT_LIGHT+"개 까지 허용."),this._lightInfo[e.TYPE].push(e);break;default:RedGLUtil.throwFunc("RedScene : RedBaseLight 인스턴스만 가능")}},removeLight:function(t){switch(t.TYPE){case RedAmbientLight.TYPE:this._lightInfo[t.TYPE]==t&&(this._lightInfo[t.TYPE]=null);break;case RedDirectionalLight.TYPE:case RedPointLight.TYPE:(e=this._lightInfo[t.TYPE].indexOf(t))>-1&&this._lightInfo[t.TYPE].splice(e,1);break;default:RedGLUtil.throwFunc("RedScene : RedBaseLight 인스턴스만 가능")}}};for(var n in RedScene.prototype=new RedBaseContainer,r)RedScene.prototype[n]=r[n];RedDefinePropertyInfo.definePrototype("RedScene","backgroundColor","hex",{callback:function(){t=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._backgroundColor),this._r=t[0],this._g=t[1],this._b=t[2]}}),RedDefinePropertyInfo.definePrototype("RedScene","useBackgroundColor","boolean",!0),RedDefinePropertyInfo.definePrototype("RedScene","useFog","boolean",!0),RedDefinePropertyInfo.definePrototype("RedScene","fogDensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedScene","fogDistance","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedScene","fogColor","hex",{callback:function(){var e;return function(){e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._fogColor),this._fogR=e[0],this._fogG=e[1],this._fogB=e[2]}}()}),Object.defineProperty(RedScene.prototype,"skyBox",{get:function(){return this._skyBoxMesh},set:function(e){return!e||e instanceof RedSkyBox||RedGLUtil.throwFunc("RedScene : RedSkyBox Instance만 허용."),this._skyBoxMesh=e,this._skyBoxMesh}}),Object.defineProperty(RedScene.prototype,"grid",{get:function(){return this._gridMesh},set:function(e){return!e||e instanceof RedGrid||RedGLUtil.throwFunc("RedScene : RedGrid Instance만 허용."),this._gridMesh=e,this._gridMesh}}),Object.defineProperty(RedScene.prototype,"axis",{get:function(){return this._axisMesh},set:function(e){return!e||e instanceof RedAxis||RedGLUtil.throwFunc("RedScene : RedAxis Instance만 허용."),this._axisMesh=e,this._axisMesh}}),Object.freeze(RedScene)}(),function(){var e,t;(RedCamera=function(){if(!(this instanceof RedCamera))return new RedCamera;this.x=this.y=this.z=0,this.targetX=this.targetY=this.targetZ=0,this.fov=60,this.nearClipping=.1,this.farClipping=1e5,this.orthographicYn=!1,this.matrix=mat4.create(),this.perspectiveMTX=mat4.create(),this.autoUpdateMatrix=!0,this._UUID=RedGL.makeUUID()}).prototype.update=function(){this.lookAt(this.targetX,this.targetY,this.targetZ)},RedCamera.prototype.lookAt=(e=new Float32Array([0,1,0]),t=[],function(r,n,i){t[0]=this.targetX=r,t[1]=this.targetY=n,t[2]=this.targetZ=i,mat4.identity(this.matrix),mat4.lookAt(this.matrix,[this.x,this.y,this.z],t,e)}),Object.freeze(RedCamera)}(),(RedBasicController=function(e){if(!(this instanceof RedBasicController))return new RedBasicController(e);this.keyBuffer={},this.keyNameMapper={moveForward:"w",moveBack:"s",moveLeft:"a",moveRight:"d",moveUp:"t",moveDown:"g",turnLeft:"q",turnRight:"e",turnUp:"r",turnDown:"f"},this.speed=1,this.delay=.1,this.speedRotation=1,this.delayRotation=.1,this.maxAcceleration=3,this.camera=RedCamera(),this._desirePosition=[0,0,0],this._desirePan=0,this._desireTilt=0,this._targetObject=RedMesh(e),function(t){var r,n,i,a,o,s,d,f,u,l,c,h;l=RedGLDetect.BROWSER_INFO.move,c=RedGLDetect.BROWSER_INFO.up,h=RedGLDetect.BROWSER_INFO.down,s=0,d=0,f=0,u=0,r=function(e){t.keyBuffer[e.key]=1},n=function(e){t.keyBuffer[e.key]=0},i=function(t){RedGLDetect.BROWSER_INFO.isMobile?(t=t.targetTouches[0],s=t.clientX,d=t.clientY):(s=t.x,d=t.y),e._canvas.addEventListener(l,a),window.addEventListener(c,o)},a=function(e){RedGLDetect.BROWSER_INFO.isMobile?(e=e.targetTouches[0],f=e.clientX-s,u=e.clientY-d,s=e.clientX,d=e.clientY):(f=e.x-s,u=e.y-d,s=e.x,d=e.y),t._desirePan-=f*t._speedRotation*.1,t._desireTilt-=u*t._speedRotation*.1},o=function(){e._canvas.removeEventListener(l,a),window.removeEventListener(c,o)},window.addEventListener("keydown",r),window.addEventListener("keyup",n),e._canvas.addEventListener(h,i)}(this)}).prototype=new RedBaseController,RedDefinePropertyInfo.definePrototype("RedBasicController","speed","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedBasicController","delay","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedBasicController","speedRotation","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedBasicController","delayRotation","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedBasicController","maxAcceleration","number",{min:0}),Object.defineProperty(RedBasicController.prototype,"x",{get:function(){return this._targetObject.x},set:function(e){this._targetObject.x=e,this._desirePosition[0]=e}}),Object.defineProperty(RedBasicController.prototype,"y",{get:function(){return this._targetObject.y},set:function(e){this._targetObject.y=e,this._desirePosition[1]=e}}),Object.defineProperty(RedBasicController.prototype,"z",{get:function(){return this._targetObject.z},set:function(e){this._targetObject.z=e,this._desirePosition[2]=e}}),Object.defineProperty(RedBasicController.prototype,"tilt",{get:function(){return this._desireTilt},set:function(e){this._targetObject.rotationX=e,this._desireTilt=e}}),Object.defineProperty(RedBasicController.prototype,"pan",{get:function(){return this._desirePan},set:function(e){this._targetObject.rotationY=e,this._desirePan=e}}),RedBasicController.prototype.update=function(){var e,t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p,_;return new Float32Array([0,1,0]),l=mat4.create(),f=mat4.create(),u=mat4.create(),c=vec3.create(),R=0,function(){e=0,t=0,n=!1,i=!1,a=this._speed,o=this._speedRotation,s=this._delay,d=this._delayRotation,h=this.camera,_=this._desirePosition,m=this.keyBuffer,p=this.keyNameMapper,c[0]=0,c[1]=0,c[2]=0,m[p.turnLeft]&&(i=!0,e=o),m[p.turnRight]&&(i=!0,e=-o),m[p.turnUp]&&(i=!0,t=o),m[p.turnDown]&&(i=!0,t=-o),m[p.moveForward]&&(n=!0,c[2]=-R*a),m[p.moveBack]&&(n=!0,c[2]=R*a),m[p.moveLeft]&&(n=!0,c[0]=-R*a),m[p.moveRight]&&(n=!0,c[0]=R*a),m[p.moveUp]&&(n=!0,c[1]=R*a),m[p.moveDown]&&(n=!0,c[1]=-R*a),i||n?(R+=.1)>this._maxAcceleration&&(R=this._maxAcceleration):(R+=-.1)<0&&(R=0),r=this._targetObject,i&&(this._desirePan+=e,this._desireTilt+=t),r.rotationY+=(this._desirePan-r.rotationY)*d,r.rotationX+=(this._desireTilt-r.rotationX)*d,(n||i)&&(f=r.matrix,mat4.identity(l),mat4.rotateY(l,l,r.rotationY*Math.PI/180),mat4.rotateX(l,l,r.rotationX*Math.PI/180),mat4.translate(l,l,c),mat4.identity(f),mat4.translate(f,f,[r.x,r.y,r.z]),mat4.multiply(f,f,l),_[0]=f[12],_[1]=f[13],_[2]=f[14]),r.x+=(_[0]-r.x)*s,r.y+=(_[1]-r.y)*s,r.z+=(_[2]-r.z)*s,r.rotationY+=(this._desirePan-r.rotationY)*d,r.rotationX+=(this._desireTilt-r.rotationX)*d,f=r.matrix,mat4.identity(f),mat4.translate(f,f,[r.x,r.y,r.z]),mat4.rotateY(f,f,r.rotationY*Math.PI/180),mat4.rotateX(f,f,r.rotationX*Math.PI/180),u=mat4.clone(f),mat4.translate(u,u,[0,0,.01]),h.x=u[12],h.y=u[13],h.z=u[14],h.lookAt(r.x,r.y,r.z)}}(),Object.freeze(RedBasicController),function(){var e,t,r,n;(RedObitController=function(e){if(!(this instanceof RedObitController))return new RedObitController(e);this.centerX=0,this.centerY=0,this.centerZ=0,this.distance=15,this.speedDistance=2,this.delayDistance=.1,this.speedRotation=3,this.delayRotation=.1,this.tilt=0,this.minTilt=-90,this.maxTilt=90,this.pan=0,this.camera=RedCamera(),this._currentPan=0,this._currentTilt=0,this._currentDistance=0,function(t){var r,n,i,a,o,s,d,f,u,l,c;u=RedGLDetect.BROWSER_INFO.move,l=RedGLDetect.BROWSER_INFO.up,c=RedGLDetect.BROWSER_INFO.down,o=0,s=0,d=0,f=0,r=function(t){RedGLDetect.BROWSER_INFO.isMobile?(t=t.targetTouches[0],o=t.clientX,s=t.clientY):(o=t.x,s=t.y),e._canvas.addEventListener(u,n),window.addEventListener(l,i)},n=function(e){RedGLDetect.BROWSER_INFO.isMobile?(e=e.targetTouches[0],d=e.clientX-o,f=e.clientY-s,o=e.clientX,s=e.clientY):(d=e.x-o,f=e.y-s,o=e.x,s=e.y),t._pan-=d*t._speedRotation*.1,t._tilt-=f*t._speedRotation*.1},i=function(){e._canvas.removeEventListener(u,n),window.removeEventListener(l,i)},a=function(e){t.distance+=e.deltaY/100*t._speedDistance},e._canvas.addEventListener(c,r),e._canvas.addEventListener("wheel",a)}(this)}).prototype=new RedBaseController,RedDefinePropertyInfo.definePrototype("RedObitController","centerX","number"),RedDefinePropertyInfo.definePrototype("RedObitController","centerY","number"),RedDefinePropertyInfo.definePrototype("RedObitController","centerZ","number"),RedDefinePropertyInfo.definePrototype("RedObitController","distance","number",{min:1}),RedDefinePropertyInfo.definePrototype("RedObitController","speedDistance","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedObitController","delayDistance","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedObitController","speedRotation","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedObitController","delayRotation","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedObitController","pan","number"),RedDefinePropertyInfo.definePrototype("RedObitController","tilt","number"),RedDefinePropertyInfo.definePrototype("RedObitController","maxTilt","number",{min:-90,max:90}),RedDefinePropertyInfo.definePrototype("RedObitController","minTilt","number",{min:-90,max:90}),RedObitController.prototype.update=(n=Math.PI/180,function(){this._tilt<this._minTilt&&(this._tilt=this._minTilt),this._tilt>this._maxTilt&&(this._tilt=this._maxTilt),e=this._delayRotation,t=this.camera,r=t.matrix,this._currentPan+=(this._pan-this._currentPan)*e,this._currentTilt+=(this._tilt-this._currentTilt)*e,this._currentDistance+=(this._distance-this._currentDistance)*this._delayDistance,mat4.identity(r),mat4.translate(r,r,[this._centerX,this._centerY,this._centerZ]),mat4.rotateY(r,r,this._currentPan*n),mat4.rotateX(r,r,this._currentTilt*n),mat4.translate(r,r,[0,0,this._currentDistance]),t.x=r[12],t.y=r[13],t.z=r[14],t.lookAt(this._centerX,this._centerY,this._centerZ)}),Object.freeze(RedObitController)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vVertexColor = aVertexColor;
gl_Position = uPMatrix * uCameraMatrix* uMMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
void main(void) {
vec4 finalColor = vVertexColor;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedGridMaterial=function(n){if(!(this instanceof RedGridMaterial))return new RedGridMaterial(n);this.makeProgramList(this,n,"RedGridMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedGridMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
varying vec3 vReflectionCubeCoord;
void main(void) {
vReflectionCubeCoord = (uMMatrix *vec4(aVertexPosition, 0.0)).xyz;
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
// 안개
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform samplerCube u_skyBoxTexture;
varying vec3 vReflectionCubeCoord;
void main(void) {
vec4 finalColor = textureCube(u_skyBoxTexture, vReflectionCubeCoord);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedSkyBoxMaterial=function(n,i){if(!(this instanceof RedSkyBoxMaterial))return new RedSkyBoxMaterial(n,i);n instanceof RedGL||RedGLUtil.throwFunc("RedSkyBoxMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedSkyBoxMaterialProgram",e,t),this.skyBoxTexture=i,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","skyBoxTexture","samplerCube",{essential:!0}),Object.freeze(RedSkyBoxMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = getSprite3DMatrix(uDirectionalShadowLightMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
vec4 encodeFloat (float depth) {
const vec4 cBitShift = vec4(
256.0 * 256.0 * 256.0,
256.0 * 256.0,
256.0,
1.0
);
const vec4 cBitMask = vec4(
0.0,
1.0 / 256.0,
1.0 / 256.0,
1.0 / 256.0
);
vec4 comp = fract(depth * cBitShift);
comp -= comp.xxyz * cBitMask;
return comp;
}
void main(void) {
vec4 finalColor = encodeFloat(gl_FragCoord.z);
// if(finalColor.a < 0.5) finalColor = vec4(0.0, 0.0, 0.0, 1.0);
gl_FragColor = finalColor;
}
*/},(RedDirectionalShadowMaterial=function(n){if(!(this instanceof RedDirectionalShadowMaterial))return new RedDirectionalShadowMaterial(n);n instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalShadowMaterial : RedGL Instance만 허용.",n),this._RedDirectionalShadowYn=!0,this.makeProgramList(this,n,"RedDirectionalShadowMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedDirectionalShadowMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
gl_FragColor = texture2D(u_diffuseTexture, vTexcoord);
}
*/},(RedPostEffectMaterial=function(n,i){if(!(this instanceof RedPostEffectMaterial))return new RedPostEffectMaterial(n,i);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffectMaterial : RedGL Instance만 허용.",n),this.diffuseTexture=i,this.program=RedProgram.makeProgram(n,"RedPostEffectMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedPostEffectMaterial","diffuseTexture","sampler2D",{essential:!0}),Object.freeze(RedPostEffectMaterial)}(),function(){var e;(RedDirectionalShadow=function(e,t){if(!(this instanceof RedDirectionalShadow))return new RedDirectionalShadow(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalShadow : RedGL Instance만 허용.",e),this._directionalShadowMaterial=RedDirectionalShadowMaterial(e),this.frameBuffer=RedFrameBuffer(e),this.light=t,this.width=2048,this.height=2048,this.size=20,this._UUID=RedGL.makeUUID(),this._castingList=[]}).prototype.addCasting=function(e){e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addCasting","RedBaseObject3D Instance만 가능","입력값 : "+e),this._castingList.push(e)},RedDirectionalShadow.prototype.removeCasting=function(t){-1==(e=this._castingList.indexOf(t))?RedGLUtil.throwFunc("removeCasting","존재하지 않는 대상을 삭제하려고 함"):this._castingList.splice(e,1)},Object.defineProperty(RedDirectionalShadow.prototype,"light",{get:function(){return this._light},set:function(e){e&&e instanceof RedDirectionalLight||RedGLUtil.throwFunc("RedDirectionalShadow - light : RedDirectionalLight Instance만 허용.",e),this._light=e}}),RedDefinePropertyInfo.definePrototype("RedDirectionalShadow","width","number",{min:1}),RedDefinePropertyInfo.definePrototype("RedDirectionalShadow","height","number",{min:1}),RedDefinePropertyInfo.definePrototype("RedDirectionalShadow","size","number",{min:1}),Object.freeze(RedDirectionalShadow)}(),function(){var e,t,r,n,i,a;(RedShadowManager=function(e){if(!(this instanceof RedShadowManager))return new RedShadowManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedShadowManager : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID()}).prototype={render:function(o,s,d,f,u){(n=this._directionalShadow)&&(e=o.gl,r=s.worldRect,t=d._viewRect,i=n.width,a=n.height,n.frameBuffer.width=i,n.frameBuffer.height=a,n.frameBuffer.bind(o.gl),e.viewport(0,0,i,a),e.scissor(0,0,i,a),e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),s.sceneRender(o,d.scene,d.camera,d.camera.orthographicYn,n._castingList,f,u,n._directionalShadowMaterial),n.frameBuffer.unbind(o.gl),e.viewport(t[0],r[3]-t[3]-t[1],t[2],t[3]),e.scissor(t[0],r[3]-t[3]-t[1],t[2],t[3]))}},Object.defineProperty(RedShadowManager.prototype,"directionalShadow",{get:function(){return this._directionalShadow},set:function(e){!e||e instanceof RedDirectionalShadow||RedGLUtil.throwFunc("RedShadowManager - directionalShadow : RedDirectionalShadow Instance만 허용.",e),this._directionalShadow=e}}),Object.freeze(RedShadowManager)}(),function(){var e,t,r,n;t=function(t,r,n){var i;i=t._svg.querySelector("td").style,t["_"+r]=n,Object.defineProperty(t,r,{get:function(){return t["_"+r]},set:function(n){t["_"+r]=n,i[r]="number"==typeof n?n+="px":n,e(t)}}),t[r]=n},e=function(e){e._height=+e._height,e._svg.setAttribute("width",e._width),e._svg.setAttribute("height",e._height),e._svg.querySelector("foreignObject").setAttribute("height",e._height),e._svg.querySelector("table").style.height=e._height+"px",e._img.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e._svg.outerHTML)},(RedText=function(e,r,n){if(!(this instanceof RedText))return new RedText(e,r,n);e instanceof RedGL||RedGLUtil.throwFunc("RedText : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl);var i=this;this._cvs=null,this._ctx=null,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this._svg.style="position:absolute;top:0px;left:0px;text-align:center;z-index:10",this._svg.innerHTML='<foreignObject  width="100%" style="position:absolute;top:0;left:0">   <table xmlns="http://www.w3.org/1999/xhtml" style="border-collapse: collapse;position:table;top:0;left:0;width:100%;table-layout:fixed">       <tr xmlns="http://www.w3.org/1999/xhtml">       <td xmlns="http://www.w3.org/1999/xhtml"  > </td>       </tr>   </table></foreignObject>',this.geometry=RedPlane(e,1,1),this.material=RedTextMaterial(e,RedBitmapTexture(e,this._cvs)),this.blendSrc=e.gl.ONE,this.blendDst=e.gl.ONE_MINUS_SRC_ALPHA,this.useCullFace=!1,this.perspectiveScale=!0,this.sprite3DYn=!1,this._img=new Image,n=n||256,(r=r||256)>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),n>e.detect.texture.MAX_TEXTURE_SIZE&&(n=e.detect.texture.MAX_TEXTURE_SIZE),this.width=r,this.height=n,t(this,"padding",0),t(this,"background",""),t(this,"color","#000"),t(this,"fontFamily","Arial"),t(this,"fontSize",16),t(this,"fontWeight","normal"),t(this,"fontStyle","normal"),t(this,"lineHeight",24),t(this,"letterSpacing",0),t(this,"wordBreak","break-all"),t(this,"verticalAlign","middle"),t(this,"textAlign","center"),this._img.onload=function(){var t,r;(t=i._width)%2==0&&(t+=1),(r=i._height)%2==0&&(r+=1),i._cvs=window.OffscreenCanvas?new OffscreenCanvas(t,r):document.createElement("canvas"),i._ctx=i._cvs.getContext("2d"),i._cvs.width=t,i._cvs.height=r,i._ctx.clearRect(0,0,t,r),i._ctx.drawImage(i._img,0,0,t,r),i.material.width=t,i.material.height=r,i.material.diffuseTexture.src=i._cvs,i.material.diffuseTexture.option={min:e.gl.LINEAR,mag:e.gl.LINEAR,wrap_s:e.gl.CLAMP_TO_EDGE,wrap_t:e.gl.CLAMP_TO_EDGE}},this.useTransparentSort=!0,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseObject3D,RedDefinePropertyInfo.definePrototype("RedText","perspectiveScale","boolean",!0),RedDefinePropertyInfo.definePrototype("RedText","sprite3DYn","boolean",!0),RedDefinePropertyInfo.definePrototype("RedText","width","number",{min:2,callback:function(t){this._width=t,this.material.width=t,e(this)}}),RedDefinePropertyInfo.definePrototype("RedText","height","number",{min:2,callback:function(t){this._height=t,this.material.height=t,e(this)}}),Object.defineProperty(RedText.prototype,"text",{get:function(){return this._text},set:function(t){r=this._svg,n=r.querySelector("foreignObject td"),this._text=t.replace(/\<br\>/gi,"<div/>");var i=this,a=this._text.match(/<img .*?>/g),o=[],s=this._text,d=(a=a||[]).length,f=0;a.forEach(function(t){var r=t.match(/src\s*=\s*(\'|\").*?(\'|\")/g)[0];r=r.replace(/src\s*=\s*(\'|\")/g,"").replace(/(\'|\")/g,"");var a=document.createElement("div");a.innerHTML=t;var u=a.querySelector("img");u.onload=function(){var t=document.createElement("canvas");t.width=u.style.width?+u.style.width:u.width,t.height=u.style.height?+u.style.height:u.height;var r=t.getContext("2d");r.scale(t.width/u.naturalWidth,t.height/u.naturalHeight),r.drawImage(u,0,0),l.result='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink" width="'+u.width+'" height="'+u.height+'" display="inline" style="vertical-align: middle;display: inline-block"><image xlink:href="'+t.toDataURL("image/png")+'" height="'+u.height+'px" width="'+u.width+'px" /></svg>',++f==d&&(o.forEach(function(e){s=s.replace(e.source,e.result)}),n.innerHTML=s,e(i)),u.onload=null};var l={source:t,sourceSrc:r,result:""};o.push(l)}),0==a.length&&(n.innerHTML=s,e(this))}}),Object.freeze(RedText)}(),function(){var e,t,r,n,i,a,o;(RedMouseEventManager=function(e){if(!(this instanceof RedMouseEventManager))return new RedMouseEventManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedMouseEventManager : RedGL Instance만 허용.",e),this.frameBuffer=RedFrameBuffer(e),this._mouseEventMaterial=RedMouseEventMaterial(e),this._mouseEventListObject={},this._mouseEventList=[],this._prevInfo=null,this._UUID=RedGL.makeUUID()}).prototype={add:function(e,t,r){var n=e._mouseColorID;this._mouseEventListObject[n]||(this._mouseEventListObject[n]={target:e},this._mouseEventList.push(e)),this._mouseEventListObject[n][t]=r},remove:function(e,t){var r=this._mouseEventList.indexOf(e);r>-1&&(this._mouseEventList.splice(r,1),delete this._mouseEventListObject[e._mouseColorID])},render:(i=new Uint8Array(4),a=1,o=[],function(s,d,f,u,l){if(this._mouseEventList.length){a=s.renderScale,e=s.gl,d.worldRect,t=f._viewRect,r=t[2],n=t[3],this.frameBuffer.width=r,this.frameBuffer.height=n,this.frameBuffer.bind(s.gl),d.sceneRender(s,f.scene,f.camera,f.camera.orthographicYn,this._mouseEventList,u,l,this._mouseEventMaterial),e.readPixels(s._mouseEventInfo.x*a,t[3]-s._mouseEventInfo.y*a,1,1,e.RGBA,e.UNSIGNED_BYTE,i);var c,h=this._mouseEventListObject[i.toString()];h?(s._mouseEventInfo.type==RedGLDetect.BROWSER_INFO.down&&(c="down")&&h[c]&&h[c].call(h.target,{target:h.target,type:c}),s._mouseEventInfo.type==RedGLDetect.BROWSER_INFO.up&&(c="up")&&h[c]&&h[c].call(h.target,{target:h.target,type:c}),this._prevInfo&&this._prevInfo!=h&&(c="out")&&this._prevInfo[c]&&this._prevInfo[c].call(this._prevInfo.target,{target:this._prevInfo.target,type:c}),this._prevInfo!=h&&(c="over")&&h[c]&&h[c].call(h.target,{target:h.target,type:c}),this._prevInfo=h):(c="out",this._prevInfo&&this._prevInfo[c]&&o.push({info:this._prevInfo,type:c}),this._prevInfo=null),function(){if(o.length){var e=o.pop();e.info[e.type].call(e.info.target,{target:e.info.target,type:e.info.type})}}(),s._mouseEventInfo={type:null,x:0,y:0},this._prevInfo?document.body.style.cursor="pointer":document.body.style.cursor="default",this.frameBuffer.unbind(s.gl)}})},Object.freeze(RedMouseEventManager)}(),function(){var e,t,r;e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
// position 계산
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform vec4 uColor;
void main(void) {
gl_FragColor = uColor / 255.0;
}
*/},(RedMouseEventMaterial=function(n){if(!(this instanceof RedMouseEventMaterial))return new RedMouseEventMaterial(n);n instanceof RedGL||RedGLUtil.throwFunc("RedMouseEventMaterial : RedGL Instance만 허용.",n),this._RedMouseEventMaterialYn=!0,this.color=null,this.makeProgramList(this,n,"RedMouseEventMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedMouseEventMaterial)}(),function(){var e,t,r,n,i,a,o,s,d,f,u,l,c,h,R,m,p,_,g,E,P,y,v,M,T,x,b,L;(RedPostEffectManager=function(e){if(!(this instanceof RedPostEffectManager))return new RedPostEffectManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedPostEffectManager : RedGL Instance만 허용.",e),Object.defineProperty(this,"frameBuffer",{value:RedFrameBuffer(e)}),Object.defineProperty(this,"finalMaterial",{value:RedPostEffectMaterial(e,this.frameBuffer.texture)}),Object.defineProperty(this,"postEffectList",{value:[]}),Object.defineProperty(this,"children",{value:[RedMesh(e,RedPlane(e,1,1,1,1,!0),this.finalMaterial)]}),this._UUID=RedGL.makeUUID()}).prototype={addEffect:function(e){e instanceof RedBasePostEffect||RedGLUtil.throwFunc("RedPostEffectManager : addEffect - RedBasePostEffect Instance만 허용.","입력값 : "+e),this.postEffectList.push(e)},removeEffect:function(e){-1!=(L=this.postEffectList.indexOf(e))&&this.postEffectList.splice(L,1)},removeAllEffect:function(){this.postEffectList.length=0},bind:function(e){this.frameBuffer.bind(e)},unbind:function(e){this.frameBuffer.unbind(e)},render:(p=mat4.create(),m=new Float32Array(2),d=function(t,r,n,i,a){e._material=n,u=e._material.program,t.useProgram(u.webglProgram),c=u.systemUniformLocation,(l=c.uPMatrix)&&(h=l.location,R=l._UUID,h&&(mat4.ortho(p,-.5,.5,-.5,.5,-r.farClipping,r.farClipping),mat4.scale(p,p,[1,-1,1]),_=JSON.stringify(p),f[R]!=_&&(t.uniformMatrix4fv(h,!1,p),f[R]=_))),(l=c.uResolution)&&(h=l.location,R=l._UUID,h&&(m[0]=i,m[1]=a,_=JSON.stringify(m),f[R]!=_&&(t.uniform2fv(h,m),f[R]=_)))},n=function(e,t,r,n){g=r.frameBuffer.width=n[2],E=r.frameBuffer.height=n[3],i==g&&a==E||(e.viewport(0,0,g,E),e.scissor(0,0,g,E)),d(e,t,r,g,E),i=g,a=E},s=function(e,t,d,f,u,l,c){var h,R,m,p,_,g,E,P,y,v;if(m=e.gl,y=f.scene,v=f._viewRect,t._process&&t._process.length)for(h=r,p=0,_=t._process.length;p<_;p++)s(e,t._process[p],d,f,u,l,c);if((R=t._subFrameBufferList)&&R.length)for(g=0,E=R.length;g<E;g++)if((P=R[g]).frameBuffer.width=v[2],P.frameBuffer.height=v[3],P.frameBuffer.bind(m),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),u.sceneRender(e,y,o,o.orthographicYn,y.children,l,c,P.renderMaterial,!0,!0),P.frameBuffer.unbind(m),i=P.frameBuffer.width,a=P.frameBuffer.height,P._process&&P._process.length)for(p=0,_=P._process.length;p<_;p++)s(e,P._process[p],d,y,u,l,c);t.frameBuffer&&(n(m,o,t,v),t.bind(m),t.updateTexture(r,h),u.sceneRender(e,y,o,!0,d,l,c,null,!0,!0),t.unbind(m),r=t.frameBuffer.texture)},y=[],function(n,u,l,c,h,R){for(P=this,i=null,a=null,T=c.scene,o=c.camera instanceof RedBaseController?c.camera.camera:c.camera,x=c._viewRect,b=l.worldRect,f=l.cacheInfo.cacheSystemUniformInfo,P.unbind(u),e=P.children[0],r=t=P.frameBuffer.texture,P.frameBuffer.width=x[2],P.frameBuffer.height=x[3],y.length=0,v=0,M=P.postEffectList.length;v<M;v++)y[v]=P.postEffectList[v];for(P.antialiasing&&y.push(P.antialiasing),v=0,M=y.length;v<M;v++)s(n,y[v],P.children,c,l,h,R);r!=t&&(P.finalMaterial.diffuseTexture=r,u.viewport(x[0],b[3]-x[3]-x[1],x[2],x[3]),u.scissor(x[0],b[3]-x[3]-x[1],x[2],x[3]),d(u,o,P.finalMaterial,x[2],x[3],!0),l.sceneRender(n,T,o,!0,P.children,h,R,null,!0)),P.finalMaterial.diffuseTexture=P.frameBuffer.texture})},Object.defineProperty(RedPostEffectManager.prototype,"antialiasing",{get:function(){return this._antialiasing},set:function(e){e&&(e instanceof RedPostEffect_FXAA||RedGLUtil.throwFunc("RedPostEffectManager : antialiasing - RedPostEffect_FXAA Instance만 허용.","입력값 : "+e)),this._antialiasing=e}}),Object.freeze(RedPostEffectManager)}(),(RedBasePostEffect=function(){}).prototype=new RedBaseMaterial,RedBasePostEffect.prototype.bind=RedPostEffectManager.prototype.bind,RedBasePostEffect.prototype.unbind=RedPostEffectManager.prototype.unbind,RedBasePostEffect.prototype.updateTexture=function(){RedGLUtil.throwFunc("RedBasePostEffect - updateTexture : 반드시 재정의해야함")},RedBasePostEffect.prototype._process=[],RedBasePostEffect.prototype._subFrameBufferList=[],Object.freeze(RedBasePostEffect),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform float u_exposure;
uniform float u_bloomStrength;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
vec4 thresholdColor = finalColor;
vec4 blurColor = texture2D(u_blurTexture, vTexcoord);
finalColor.rgb = (finalColor.rgb  + blurColor.rgb * u_bloomStrength) * u_exposure;
gl_FragColor = finalColor ;
}
*/},(RedPostEffect_Bloom=function(n){if(!(this instanceof RedPostEffect_Bloom))return new RedPostEffect_Bloom(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Bloom : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.blurTexture=null,this.exposure=1,this.bloomStrength=1.2,this._process=[RedPostEffect_BloomThreshold(n),RedPostEffect_BlurX(n),RedPostEffect_BlurY(n)],this.blur=20,this.threshold=75,this.program=RedProgram.makeProgram(n,"RedPostEffectBloomProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Bloom.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Bloom","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Bloom","blurTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Bloom","exposure","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Bloom","bloomStrength","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Bloom","threshold","number",{min:0,callback:function(e){this._process[0].threshold=e,this._threshold=this._process[0].threshold}}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Bloom","blur","number",{min:0,callback:function(e){this._process[1].size=e,this._process[2].size=e}}),Object.freeze(RedPostEffect_Bloom)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision highp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b < u_threshold_value)  finalColor.r = finalColor.g = finalColor.b = 0.0;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_BloomThreshold=function(n){if(!(this instanceof RedPostEffect_BloomThreshold))return new RedPostEffect_BloomThreshold(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BloomThreshold : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.threshold=128,this.program=RedProgram.makeProgram(n,"RedPostEffectBloomThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BloomThreshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_BloomThreshold","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_BloomThreshold","threshold","number",{min:0,max:255,callback:function(e){this._threshold_value=e/255}}),Object.freeze(RedPostEffect_BloomThreshold)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec2 px = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-7.0*px.x, -7.0*px.y))*0.0044299121055113265;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-6.0*px.x, -6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-5.0*px.x, -5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-4.0*px.x, -4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-3.0*px.x, -3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-2.0*px.x, -2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-1.0*px.x, -1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, vTexcoord                             )*0.159576912161;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 1.0*px.x,  1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 2.0*px.x,  2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 3.0*px.x,  3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 4.0*px.x,  4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 5.0*px.x,  5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 6.0*px.x,  6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 7.0*px.x,  7.0*px.y))*0.0044299121055113265;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Blur=function(n){if(!(this instanceof RedPostEffect_Blur))return new RedPostEffect_Blur(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Blur : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.program=RedProgram.makeProgram(n,"RedPostEffectBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Blur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Blur","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Blur)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(u_size/vResolution.x,0.0);
for (float t = -10.0; t <= 10.0; t++) {
float percent = (t + offset - 0.5) / 10.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =  finalColor ;
}
*/},(RedPostEffect_BlurX=function(n){if(!(this instanceof RedPostEffect_BlurX))return new RedPostEffect_BlurX(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BlurX : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(n,"RedPostEffectBlurXProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BlurX.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_BlurX","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_BlurX","size","number",{min:0}),Object.freeze(RedPostEffect_BlurX)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(0.0, u_size/vResolution.y);
for (float t = -10.0; t <= 10.0; t++) {
float percent = (t + offset - 0.5) / 10.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =   finalColor ;
}
*/},(RedPostEffect_BlurY=function(n){if(!(this instanceof RedPostEffect_BlurY))return new RedPostEffect_BlurY(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BlurY : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(n,"RedPostEffectBlurYProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BlurY.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_BlurY","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_BlurY","size","number",{min:0}),Object.freeze(RedPostEffect_BlurY)}(),(RedPostEffect_GaussianBlur=function(e){if(!(this instanceof RedPostEffect_GaussianBlur))return new RedPostEffect_GaussianBlur(e);e instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_GaussianBlur : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID(),this._process=[RedPostEffect_BlurX(e),RedPostEffect_BlurY(e)],this.radius=1}).prototype=new RedBasePostEffect,RedPostEffect_GaussianBlur.prototype.updateTexture=function(){},RedDefinePropertyInfo.definePrototype("RedPostEffect_GaussianBlur","radius","number",{min:.1,max:255,callback:function(e){this._process[0].size=e,this._process[1].size=e}}),Object.freeze(RedPostEffect_GaussianBlur),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_amount_value;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main(void) {
vec4 finalColor = vec4(0.0);
vec2 center = vec2(u_centerX+0.5,-u_centerY+0.5);
vec2 toCenter = center - vTexcoord ;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
float total = 0.0;
for (float t = 0.0; t <= 30.0; t++) {
float percent = (t + offset) / 30.0;
float weight = 3.0 * (percent - percent * percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + toCenter * percent * u_amount_value );
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
gl_FragColor = finalColor / total;
gl_FragColor.rgb /= gl_FragColor.a + 0.00001;
}
*/},(RedPostEffect_ZoomBlur=function(n){if(!(this instanceof RedPostEffect_ZoomBlur))return new RedPostEffect_ZoomBlur(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_ZoomBlur : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.amount=38,this.program=RedProgram.makeProgram(n,"RedPostEffectZoomBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_ZoomBlur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_ZoomBlur","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_ZoomBlur","centerX","number"),RedDefinePropertyInfo.definePrototype("RedPostEffect_ZoomBlur","centerY","number"),RedDefinePropertyInfo.definePrototype("RedPostEffect_ZoomBlur","amount","number",{min:1,max:100,callback:function(e){this._amount_value=e/100}}),Object.freeze(RedPostEffect_ZoomBlur)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_brightness_value;
uniform float u_contrast_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
if (u_contrast_value > 0.0) finalColor.rgb = (finalColor.rgb - 0.5) / (1.0 - u_contrast_value) + 0.5;
else finalColor.rgb = (finalColor.rgb - 0.5) * (1.0 + u_contrast_value) + 0.5;
finalColor.rgb += u_brightness_value;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_BrightnessContrast=function(n){if(!(this instanceof RedPostEffect_BrightnessContrast))return new RedPostEffect_BrightnessContrast(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BrightnessContrast : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.brightness=0,this.contrast=0,this.program=RedProgram.makeProgram(n,"RedPostEffectBrightnessContrastProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BrightnessContrast.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_BrightnessContrast","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_BrightnessContrast","brightness","number",{min:-150,max:150,callback:function(e){this._brightness_value=e/255}}),RedDefinePropertyInfo.definePrototype("RedPostEffect_BrightnessContrast","contrast","number",{min:-50,max:100,callback:function(e){this._contrast_value=e/255}}),Object.freeze(RedPostEffect_BrightnessContrast)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision highp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
float v;
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b >= u_threshold_value) v = 1.0;
else v = 0.0;
finalColor.r = finalColor.g = finalColor.b = v;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Threshold=function(n){if(!(this instanceof RedPostEffect_Threshold))return new RedPostEffect_Threshold(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Threshold : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.threshold=128,this.program=RedProgram.makeProgram(n,"RedPostEffectThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Threshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Threshold","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Threshold","threshold","number",{min:1,max:255,callback:function(e){this._threshold_value=e/255}}),Object.freeze(RedPostEffect_Threshold)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
finalColor.r = 1.0 - finalColor.r;
finalColor.g = 1.0 - finalColor.g;
finalColor.b = 1.0 - finalColor.b;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Invert=function(n){if(!(this instanceof RedPostEffect_Invert))return new RedPostEffect_Invert(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Invert : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.program=RedProgram.makeProgram(n,"RedPostEffectInvertProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Invert.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Invert","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Invert)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
highp float gray = (finalColor.r  + finalColor.g + finalColor.b)/3.0;
gl_FragColor = vec4( gray, gray, gray, 1.0);
}
*/},(RedPostEffect_Gray=function(n){if(!(this instanceof RedPostEffect_Gray))return new RedPostEffect_Gray(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Gray : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.program=RedProgram.makeProgram(n,"RedPostEffectGrayProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Gray.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Gray","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Gray)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_hue_value;
uniform float u_saturation_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
float angle = u_hue_value * 3.1415926535897932384626433832795;
float s = sin(angle), c = cos(angle);
vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
float len = length(finalColor.rgb);
finalColor.rgb = vec3(
dot(finalColor.rgb, weights.xyz),
dot(finalColor.rgb, weights.zxy),
dot(finalColor.rgb, weights.yzx)
);
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
if (u_saturation_value > 0.0) finalColor.rgb += (average - finalColor.rgb) * (1.0 - 1.0 / (1.001 - u_saturation_value));
else finalColor.rgb += (average - finalColor.rgb) * (-u_saturation_value);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_HueSaturation=function(n){if(!(this instanceof RedPostEffect_HueSaturation))return new RedPostEffect_HueSaturation(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_HueSaturation : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.hue=0,this.saturation=0,this.program=RedProgram.makeProgram(n,"RedPostEffectHueSaturationProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_HueSaturation.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_HueSaturation","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_HueSaturation","hue","number",{min:-180,max:180,callback:function(e){this._hue_value=e/180}}),RedDefinePropertyInfo.definePrototype("RedPostEffect_HueSaturation","saturation","number",{min:-100,max:100,callback:function(e){this._saturation_value=e/100}}),Object.freeze(RedPostEffect_HueSaturation)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_angle;
uniform float u_radius;
uniform bool u_grayMode;
float pattern(float angle) {
angle = angle * 3.141592653589793/180.0;
float s = sin(angle), c = cos(angle);
vec2 tex = vTexcoord;
tex.x -= u_centerX + 0.5;
tex.y -= u_centerY + 0.5;
vec2 point = vec2(
c * tex.x - s * tex.y,
s * tex.x + c * tex.y
) * vResolution / u_radius;
return (sin(point.x) * sin(point.y)) * 4.0;
}
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
if(u_grayMode) {
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern(u_angle)), finalColor.a);
}else{
vec3 cmy = 1.0 - finalColor.rgb;
float k = min(cmy.x, min(cmy.y, cmy.z));
cmy = (cmy - k) / (1.0 - k);
cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(u_angle + 0.26179), pattern(u_angle + 1.30899), pattern(u_angle)), 0.0, 1.0);
k = clamp(k * 10.0 - 5.0 + pattern(u_angle + 0.78539), 0.0, 1.0);
gl_FragColor = vec4(1.0 - cmy - k, finalColor.a);
}
}
*/},(RedPostEffect_HalfTone=function(n){if(!(this instanceof RedPostEffect_HalfTone))return new RedPostEffect_HalfTone(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_HalfTone : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.angle=0,this.radius=2,this.grayMode=!1,this.program=RedProgram.makeProgram(n,"RedPostEffectHalfToneProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_HalfTone.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_HalfTone","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_HalfTone","centerX","number"),RedDefinePropertyInfo.definePrototype("RedPostEffect_HalfTone","centerY","number"),RedDefinePropertyInfo.definePrototype("RedPostEffect_HalfTone","angle","number"),RedDefinePropertyInfo.definePrototype("RedPostEffect_HalfTone","grayMode","boolean"),RedDefinePropertyInfo.definePrototype("RedPostEffect_HalfTone","radius","number",{min:0}),Object.freeze(RedPostEffect_HalfTone)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_width;
uniform float u_height;
void main(void) {
vec4 finalColor;
float dx = 1.0/vResolution.x * u_width;
float dy = 1.0/vResolution.y * u_height;
vec2 coord = vec2(
dx * (floor(vTexcoord.x / dx) + 0.5),
dy * (floor(vTexcoord.y / dy) + 0.5)
);
finalColor = texture2D(u_diffuseTexture, coord);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Pixelize=function(n){if(!(this instanceof RedPostEffect_Pixelize))return new RedPostEffect_Pixelize(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Pixelize : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.width=5,this.height=5,this.program=RedProgram.makeProgram(n,"RedPostEffectPixelizeProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Pixelize.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Pixelize","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Pixelize","width","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Pixelize","height","number",{min:0}),Object.freeze(RedPostEffect_Pixelize)}(),function(){var e,t,r,n,i;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform mat3 u_kernel;
uniform float uKernelWeight;
void main(void) {
vec2 perPX = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0, -1.0)) * u_kernel[0][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0, -1.0)) * u_kernel[0][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0, -1.0)) * u_kernel[0][2] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0,  0.0)) * u_kernel[1][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0,  0.0)) * u_kernel[1][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0,  0.0)) * u_kernel[1][2] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0,  1.0)) * u_kernel[2][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0,  1.0)) * u_kernel[2][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0,  1.0)) * u_kernel[2][2] ;
highp float weight;
weight = uKernelWeight;
if (0.01 > weight) {
weight = 1.0;
}
gl_FragColor = vec4((finalColor / uKernelWeight).rgb, 1.0);
}
*/},(RedPostEffect_Convolution=function(n,i){if(!(this instanceof RedPostEffect_Convolution))return new RedPostEffect_Convolution(n,i);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Convolution : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.kernel=i,this.program=RedProgram.makeProgram(n,"RedPostEffectConvolutionProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Convolution.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Convolution","diffuseTexture","sampler2D"),Object.defineProperty(RedPostEffect_Convolution.prototype,"kernel",{get:function(){return this._kernel||(this._kernel=RedPostEffect_Convolution.NORMAL),this._kernel},set:function(e){this._kernel=e}}),Object.defineProperty(RedPostEffect_Convolution.prototype,"kernelWeight",{get:function(){for(i in n=0,this.kernel)n+=this.kernel[i];return n}}),RedPostEffect_Convolution.NORMAL=[0,0,0,0,1,0,0,0,0],RedPostEffect_Convolution.SHARPEN=[0,-1,0,-1,5,-1,0,-1,0],RedPostEffect_Convolution.BLUR=[1,1,1,1,1,1,1,1,1],RedPostEffect_Convolution.EDGE=[0,1,0,1,-4,1,0,1,0],RedPostEffect_Convolution.EMBOSS=[-2,-1,0,-1,1,1,0,1,2],Object.freeze(RedPostEffect_Convolution)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform sampler2D u_depthTexture;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
vec4 blurColor = texture2D(u_blurTexture, vTexcoord);
vec4 depthColor = texture2D(u_depthTexture, vTexcoord);
finalColor.rgb *= (depthColor.r);
blurColor.rgb *= (1.0-depthColor.r);
gl_FragColor =  (finalColor + blurColor) ;
}
*/},(RedPostEffect_DoF=function(n){if(!(this instanceof RedPostEffect_DoF))return new RedPostEffect_DoF(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_DoF : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.blurTexture=null,this.depthTexture=null,this._subFrameBufferList=[{frameBuffer:RedFrameBuffer(n),renderMaterial:RedPostEffect_DoF_DepthMaterial(n),process:[]}],this._process=[RedPostEffect_BlurX(n),RedPostEffect_BlurY(n)],this.focusLength=15,this.blur=10,this.program=RedProgram.makeProgram(n,"RedPostEffectDoFProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_DoF.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e,this.depthTexture=this._subFrameBufferList[0].frameBuffer.texture},RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF","blurTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF","depthTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF","blur","number",{min:0,callback:function(e){this._process[0].size=e,this._process[1].size=e}}),Object.defineProperty(RedPostEffect_DoF.prototype,"focusLength",{get:function(){return this._subFrameBufferList[0].renderMaterial.focusLength},set:function(e){this._subFrameBufferList[0].renderMaterial.focusLength=e}}),Object.freeze(RedPostEffect_DoF)}(),function(){var e,t,r;e=function(){
/* @preserve
// 스키닝
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
// Sprite3D
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2(targetMatrix[0][0],targetMatrix[1][1] * uResolution.x/uResolution.y);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform float u_focusLength;
void main(void) {
float depth = 1.0 - gl_FragCoord.z / gl_FragCoord.w / u_focusLength;
gl_FragColor = vec4(depth, depth, depth, 1.0);
}
*/},(RedPostEffect_DoF_DepthMaterial=function(n){if(!(this instanceof RedPostEffect_DoF_DepthMaterial))return new RedPostEffect_DoF_DepthMaterial(n);this.focusLength=15,this.makeProgramList(this,n,"RedPostEffectDoFdepthProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF_DepthMaterial","focusLength","number",{min:0}),Object.freeze(RedPostEffect_DoF_DepthMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vTime = uTime;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform bool u_grayMode;
uniform sampler2D u_diffuseTexture;
uniform float u_noiseIntensity; // noise effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineIntensity; // scanlines effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineCount; // scanlines effect count value (0 = no effect, 4096 = full effect)
void main() {
// sample the source
vec4 diffuseColor = texture2D( u_diffuseTexture, vTexcoord );
// make some noise
float x = vTexcoord.x * vTexcoord.y * vTime;
x = mod( x, 13.0 ) * mod( x, 123.0 );
float dx = mod( x, 0.01 );
// add noise
vec3 finalColor = diffuseColor.rgb + diffuseColor.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );
// get us a sine and cosine
vec2 sc = vec2( sin( vTexcoord.y * u_scanlineCount ), cos( vTexcoord.y * u_scanlineCount ) );
// add scanlines
finalColor += diffuseColor.rgb * vec3( sc.x, sc.y, sc.x ) * u_scanlineIntensity;
// interpolate between source and result by intensity
finalColor = diffuseColor.rgb + clamp( u_noiseIntensity, 0.0, 1.0 ) * ( finalColor - diffuseColor.rgb );
// convert to grayscale if desired
if( u_grayMode ) finalColor = vec3( finalColor.r * 0.3 + finalColor.g * 0.59 + finalColor.b * 0.11 );
gl_FragColor =  vec4( finalColor, diffuseColor.a );
}
*/},(RedPostEffect_Film=function(n){if(!(this instanceof RedPostEffect_Film))return new RedPostEffect_Film(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Film : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.grayMode=!1,this.scanlineIntensity=.5,this.noiseIntensity=.5,this.scanlineCount=2048,this.program=RedProgram.makeProgram(n,"RedPostEffectFilmProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Film.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Film","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Film","grayMode","boolean"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Film","scanlineIntensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Film","noiseIntensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Film","scanlineCount","number",{min:0}),Object.freeze(RedPostEffect_Film)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
uniform float u_intensity;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
float dist = distance(vTexcoord, vec2(0.5, 0.5));
finalColor.rgb *= smoothstep(0.8, u_size * 0.799, dist * (u_intensity + u_size));
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Vignetting=function(n){if(!(this instanceof RedPostEffect_Vignetting))return new RedPostEffect_Vignetting(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Vignetting : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.size=.1,this.intensity=.85,this.program=RedProgram.makeProgram(n,"RedPostEffectVignettingProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Vignetting.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Vignetting","diffuseTexture","sampler2D"),RedDefinePropertyInfo.definePrototype("RedPostEffect_Vignetting","intensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedPostEffect_Vignetting","size","number",{min:0}),Object.freeze(RedPostEffect_Vignetting)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
const float cFXAA_REDUCE_MIN = 1.0/ 128.0;
const float cFXAA_REDUCE_MUL = 1.0 / 8.0;
const float cFXAA_SPAN_MAX = 8.0;
void main() {
vec4 finalColor;
vec2 inverseVP = vec2(1.0 / vResolution.x, 1.0 / vResolution.y);
vec2 fragCoord = gl_FragCoord.xy;
vec3 rgbNW = texture2D(u_diffuseTexture, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
vec3 rgbNE = texture2D(u_diffuseTexture, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
vec3 rgbSW = texture2D(u_diffuseTexture, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
vec3 rgbSE = texture2D(u_diffuseTexture, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
vec3 rgbM  = texture2D(u_diffuseTexture, fragCoord  * inverseVP).xyz;
vec3 luma = vec3(0.299, 0.587, 0.114);
float lumaNW = dot(rgbNW, luma);
float lumaNE = dot(rgbNE, luma);
float lumaSW = dot(rgbSW, luma);
float lumaSE = dot(rgbSE, luma);
float lumaM  = dot(rgbM,  luma);
float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
vec2 dir;
dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * cFXAA_REDUCE_MUL), cFXAA_REDUCE_MIN);
float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
dir = min(
vec2(cFXAA_SPAN_MAX, cFXAA_SPAN_MAX),
max( vec2(-cFXAA_SPAN_MAX, -cFXAA_SPAN_MAX), dir * rcpDirMin)
) * inverseVP;
vec3 rgbA = 0.5 * (
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz
);
vec3 rgbB = rgbA * 0.5 + 0.25 * (
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * -0.5).xyz +
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * 0.5).xyz
);
float lumaB = dot(rgbB, luma);
if ((lumaB < lumaMin) || (lumaB > lumaMax)) finalColor = vec4(rgbA, 1.0);
else finalColor = vec4(rgbB, 1.0);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_FXAA=function(n){if(!(this instanceof RedPostEffect_FXAA))return new RedPostEffect_FXAA(n);n instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_FXAA : RedGL Instance만 허용.",n),this.frameBuffer=RedFrameBuffer(n),this.diffuseTexture=null,this.program=RedProgram.makeProgram(n,"RedPostEffectFXAAProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_FXAA.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_FXAA","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_FXAA)}(),function(){var e,t,r,n,i,a;(RedGLOffScreen=function(e,t,r,n,i){if(!(this instanceof RedGLOffScreen))return new RedGLOffScreen(e,t,r,n,i);RedGLDetect.getBrowserInfo();var a=this;a.htmlCanvas=e,a.redGLSrc=n,fetch(i).then(function(e){e.text().then(function(e){a.hostCode="\ncanvas.tagName = 'CANVAS';\nreturn RedGL(canvas, function (v) {\nvar _host_ = "+e+";\n_host_.call(this);\n\n});",a.setSize(t,r)})}).catch(function(e){})}).prototype.updatePostMessage=function(e){if(!e)throw"RedGLOffScreen.prototype['updatePostMessage'] - run을 정의해야합니다."+e;if(!e.name)throw"RedGLOffScreen.prototype['updatePostMessage'] - run객체의 name을 정의해야합니다."+e.name;this.worker.postMessage({state:"update",run:e})},RedGLOffScreen.prototype._init=function(r,n,i){var a=this;this.worker&&this.worker.terminate();var o=this.htmlCanvas.parentNode,s=r.cloneNode(!0);o.replaceChild(s,this.htmlCanvas),this.htmlCanvas=s;var d="x,y,clientX,clientY,pageX,pageY,screenX,screenY,layerX,layerY,detail,shiftKey,altKey,ctrlKey,movementX,movementY,button,type,which,deltaX,deltaY,deltaZ,timeStamp,targetTouches".split(","),f="shiftKey,altKey,ctrlKey,key,keyCode,location,code,charCode,detail,timeStamp,which,type".split(","),u=[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up],l="keydown,keyup,keypress".split(",");u.forEach(function(e){a.htmlCanvas.addEventListener(e,function(e){var t={};d.forEach(function(r){if("targetTouches"==r&&e[r]){for(var n=[],i=e[r].length;i--;){var a=e[r][i];n.push({clientX:a.clientX,clientY:a.clientY,force:a.force,identifier:a.identifier,pageX:a.pageX,pageY:a.pageY,radiusX:a.radiusX,radiusY:a.radiusY,rotationAngle:a.rotationAngle,screenX:a.screenX,screenY:a.screenY})}t[r]=n}else t[r]=e[r]}),a.worker.postMessage({state:e.type,event:t})})}),l.forEach(function(e){window.addEventListener(e,function(e){var t={};f.forEach(function(r){t[r]=e[r]}),a.worker.postMessage({state:e.type,event:t})})}),this.offScreenCanvas=this.htmlCanvas.transferControlToOffscreen(),this.offScreenCanvas.width=n,this.offScreenCanvas.height=i,this.worker=null,t=new Blob([e],{type:"application/javascript"}),this.worker=new Worker(URL.createObjectURL(t));var c=document.location.pathname.split("/");c[c.length-1].indexOf(".")>-1&&c.pop();var h=this.redGLSrc.split("/");h.forEach(function(e,t){".."===e&&(c.pop(),h[t]=""),"."===e&&(h[t]="")}),this.worker.postMessage({canvas:this.offScreenCanvas,state:"init",redGLSrc:document.location.origin+c.join("/")+"/"+h.join("/"),hostCode:this.hostCode.toString()},[this.offScreenCanvas])},RedGLOffScreen.prototype.setSize=(i=0,a=0,function(e,t,o){void 0===e&&RedGLUtil.throwFunc("RedGL setSize : width가 입력되지 않았습니다."),void 0===t&&RedGLUtil.throwFunc("RedGL setSize : height가 입력되지 않았습니다."),r=this._width=e,n=this._height=t,"number"!=typeof r&&(r.indexOf("%")>-1?r=(document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)*parseFloat(r)/100:RedGLUtil.throwFunc("RedGL setSize : width는 0이상의 숫자나 %만 허용.",r)),"number"!=typeof n&&(n.indexOf("%")>-1?n=window.innerHeight*parseFloat(n)/100:RedGLUtil.throwFunc("RedGL setSize : height는 0이상의 숫자나 %만 허용.",n)),window.devicePixelRatio,this._canvas,(i!==r||a!==n||o)&&(i=r,a=n),r=parseInt(r),n=parseInt(n),this._init(this.htmlCanvas,r,n)}),e=(e=function(){var e,t;this.window=this,onmessage=function(r){switch(r.data.state){case"init":e||(importScripts(r.data.redGLSrc),e=new Function("canvas",r.data.hostCode)),t=new e(r.data.canvas);break;case"update":var n=r.data.run.args;t.userInterface[r.data.run.name]["array"==typeof n?"apply":"call"](t,r.data.run.args);break;case RedGLDetect.BROWSER_INFO.move:var i=new Event(RedGLDetect.BROWSER_INFO.move),a=r.data.event;for(var o in a)i[o]=a[o];t._canvas.dispatchEvent(i);break;case RedGLDetect.BROWSER_INFO.down:for(var o in i=new Event(RedGLDetect.BROWSER_INFO.down),a=r.data.event)i[o]=a[o];t._canvas.dispatchEvent(i);break;case RedGLDetect.BROWSER_INFO.up:for(var o in i=new Event(RedGLDetect.BROWSER_INFO.up),a=r.data.event)i[o]=a[o];this.window.dispatchEvent(i);break;case"wheel":for(var o in i=new Event("wheel"),a=r.data.event)i[o]=a[o];t._canvas.dispatchEvent(i);break;case"keydown":for(var o in i=new Event("keydown"),a=r.data.event)i[o]=a[o];this.window.dispatchEvent(i);break;case"keyup":for(var o in i=new Event("keyup"),a=r.data.event)i[o]=a[o];this.window.dispatchEvent(i);break;case"keypress":for(var o in i=new Event("keypress"),a=r.data.event)i[o]=a[o];this.window.dispatchEvent(i)}}}).toString().replace(/^function ?. ?\) ?\{|\}\;?$/g,"")}();var RedGL_VERSION={version:"RedGL Release. last update( 2019-03-07 11:55:51)"};
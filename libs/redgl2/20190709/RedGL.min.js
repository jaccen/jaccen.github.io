/*
 *   RedGL - MIT License
 *   Copyright (c) 2018 - 2019 By RedCamel( webseon@gmail.com )
 *   https://github.com/redcamel/RedGL2/blob/dev/LICENSE
 *   Last modification time of this file - 2019.7.9 12:29:10
 *
 */

var RedDefinePropertyInfo,RedGLDetect,RedGLUtil,RedGL,RedBoxSelection,RedBaseController,RedImageLoader,RedBaseTexture,RedBaseObject3D,RedBaseContainer,RedBaseLight,RedFrameBuffer,RedBuffer,RedGeometry,RedInterleaveInfo,RedBaseMaterial,RedTextureOptionChecker,RedBitmapTexture,RedVideoTexture,RedDDSTexture,RedBitmapCubeTexture,RedColorMaterial,RedColorPhongMaterial,RedColorPhongTextureMaterial,RedEnvironmentMaterial,RedBitmapMaterial,RedParticleMaterial,RedBitmapPointCloudMaterial,RedSheetMaterial,RedStandardMaterial,RedVideoMaterial,RedPBRMaterial,RedColorPointCloudMaterial,RedPBRMaterial_System,RedTextMaterial,RedAmbientLight,RedDirectionalLight,RedPointLight,RedMTLLoader,RedOBJLoader,Red3DSLoader,RedDAELoader,RedGLTFLoader,RedLinePoint,RedLathe,RedAxis,RedGrid,RedMesh,RedLine,RedLatheMesh,RedSkyBox,RedSprite3D,RedTransformController,RedPointCloud,RedParticleUnit,RedColorPointCloud,RedBitmapPointCloud,RedParticleEmitter,RedBox,RedCylinder,RedPlane,RedSphere,RedProgram,RedSystemShaderCode,RedShader,RedRenderer,RedRenderDebuger,RedSystemUniformUpdater,RedView,RedWorld,RedScene,RedCamera,RedBasicController,RedObitController,RedGridMaterial,RedSkyBoxMaterial,RedDirectionalShadowMaterial,RedPostEffectMaterial,RedDirectionalShadow,RedShadowManager,RedText,RedMouseEventManager,RedMouseEventMaterial,RedPostEffectManager,RedBasePostEffect,RedPostEffect_Bloom,RedPostEffect_BloomThreshold,RedPostEffect_Blur,RedPostEffect_BlurX,RedPostEffect_BlurY,RedPostEffect_GaussianBlur,RedPostEffect_ZoomBlur,RedPostEffect_BrightnessContrast,RedPostEffect_Threshold,RedPostEffect_Invert,RedPostEffect_Gray,RedPostEffect_HueSaturation,RedPostEffect_HalfTone,RedPostEffect_Pixelize,RedPostEffect_Convolution,RedPostEffect_DoF,RedPostEffect_DoF_DepthMaterial,RedPostEffect_Film,RedPostEffect_Vignetting,RedPostEffect_FXAA,RedGLOffScreen;!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=function(e){t.ARRAY_TYPE=e},t.toRadian=function(e){return e*n},t.equals=function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))};var i=t.EPSILON=1e-6,n=(t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,t.RANDOM=Math.random,Math.PI/180)},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=t[6],c=t[7],l=t[8],f=r[0],h=r[1],R=r[2],m=r[3],p=r[4],_=r[5],g=r[6],v=r[7],E=r[8];return e[0]=f*i+h*o+R*u,e[1]=f*n+h*s+R*c,e[2]=f*a+h*d+R*l,e[3]=m*i+p*o+_*u,e[4]=m*n+p*s+_*c,e[5]=m*a+p*d+_*l,e[6]=g*i+v*o+E*u,e[7]=g*n+v*s+E*c,e[8]=g*a+v*d+E*l,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){var t=new a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,i,n,o,s,d,u){var c=new a.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=o,c[6]=s,c[7]=d,c[8]=u,c},t.set=function(e,t,r,i,n,a,o,s,d,u){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=d,e[8]=u,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],u=t[7],c=t[8],l=c*o-s*u,f=-c*a+s*d,h=u*a-o*d,R=r*l+i*f+n*h;return R?(R=1/R,e[0]=l*R,e[1]=(-c*i+n*u)*R,e[2]=(s*i-n*o)*R,e[3]=f*R,e[4]=(c*r-n*d)*R,e[5]=(-s*r+n*a)*R,e[6]=h*R,e[7]=(-u*r+i*d)*R,e[8]=(o*r-i*a)*R,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],u=t[7],c=t[8];return e[0]=o*c-s*u,e[1]=n*u-i*c,e[2]=i*s-n*o,e[3]=s*d-a*c,e[4]=r*c-n*d,e[5]=n*a-r*s,e[6]=a*u-o*d,e[7]=i*d-r*u,e[8]=r*o-i*a,e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],d=e[7],u=e[8];return t*(u*a-o*d)+r*(-u*n+o*s)+i*(d*n-a*s)},t.multiply=i,t.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=t[6],c=t[7],l=t[8],f=r[0],h=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=d,e[6]=f*i+h*o+u,e[7]=f*n+h*s+c,e[8]=f*a+h*d+l,e},t.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=t[6],c=t[7],l=t[8],f=Math.sin(r),h=Math.cos(r);return e[0]=h*i+f*o,e[1]=h*n+f*s,e[2]=h*a+f*d,e[3]=h*o-f*i,e[4]=h*s-f*n,e[5]=h*d-f*a,e[6]=u,e[7]=c,e[8]=l,e},t.scale=function(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,d=n+n,u=r*o,c=i*o,l=i*s,f=n*o,h=n*s,R=n*d,m=a*o,p=a*s,_=a*d;return e[0]=1-l-R,e[3]=c-_,e[6]=f+p,e[1]=c+_,e[4]=1-u-R,e[7]=h-m,e[2]=f-p,e[5]=h+m,e[8]=1-u-l,e},t.normalFromMat4=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15],g=r*s-i*o,v=r*d-n*o,E=r*u-a*o,M=i*d-n*s,b=i*u-a*s,L=n*u-a*d,P=c*m-l*R,T=c*p-f*R,y=c*_-h*R,x=l*p-f*m,w=l*_-h*m,I=f*_-h*p,U=g*I-v*w+E*x+M*y-b*T+L*P;return U?(U=1/U,e[0]=(s*I-d*w+u*x)*U,e[1]=(d*y-o*I-u*T)*U,e[2]=(o*w-s*y+u*P)*U,e[3]=(n*w-i*I-a*x)*U,e[4]=(r*I-n*y+a*T)*U,e[5]=(i*y-r*w-a*P)*U,e[6]=(m*L-p*b+_*M)*U,e[7]=(p*E-R*L-_*v)*U,e[8]=(R*b-m*E+_*g)*U,e):null},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=n,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],d=e[5],u=e[6],c=e[7],l=e[8],f=t[0],h=t[1],R=t[2],m=t[3],p=t[4],_=t[5],g=t[6],v=t[7],E=t[8];return Math.abs(r-f)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-h)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-R)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(o-m)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-p)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(d-_)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(u-g)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-v)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-E)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(){var e=new R.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function n(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function a(e,t,r){var i=new R.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function d(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function u(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function c(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function l(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function f(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new R.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=n,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=o,t.multiply=s,t.divide=d,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},t.distance=u,t.squaredDistance=c,t.squaredLength=l,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=f,t.dot=h,t.cross=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],d=r[2];return e[0]=n*d-a*s,e[1]=a*o-i*d,e[2]=i*s-n*o,e},t.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e},t.hermite=function(e,t,r,i,n,a){var o=a*a,s=o*(2*a-3)+1,d=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*d+i[0]*u+n[0]*c,e[1]=t[1]*s+r[1]*d+i[1]*u+n[1]*c,e[2]=t[2]*s+r[2]*d+i[2]*u+n[2]*c,e},t.bezier=function(e,t,r,i,n,a){var o=1-a,s=o*o,d=a*a,u=s*o,c=3*a*s,l=3*d*o,f=d*a;return e[0]=t[0]*u+r[0]*c+i[0]*l+n[0]*f,e[1]=t[1]*u+r[1]*c+i[1]*l+n[1]*f,e[2]=t[2]*u+r[2]*c+i[2]*l+n[2]*f,e},t.random=function(e,t){t=t||1;var r=2*R.RANDOM()*Math.PI,i=2*R.RANDOM()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e},t.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,e},t.transformMat3=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],d=r[2],u=r[3],c=u*i+s*a-d*n,l=u*n+d*i-o*a,f=u*a+o*n-s*i,h=-o*i-s*n-d*a;return e[0]=c*u+h*-o+l*-d-f*-s,e[1]=l*u+h*-s+f*-o-c*-d,e[2]=f*u+h*-d+c*-s-l*-o,e},t.rotateX=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){var r=a(e[0],e[1],e[2]),i=a(t[0],t[1],t[2]);f(r,r),f(i,i);var n=h(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=R.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=R.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=R.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))};var R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=o,t.mul=s,t.div=d,t.dist=u,t.sqrDist=c,t.len=n,t.sqrLen=l,t.forEach=function(){var e=i();return function(t,r,i,n,a,o){var s,d=void 0;for(r||(r=3),i||(i=0),s=n?Math.min(n*r+i,t.length):t.length,d=i;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],a(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2];return t}}()},function(e,t,r){"use strict";function i(){var e=new h.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function s(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function d(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+a*a)}function u(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function c(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function l(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function f(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=a*o),e}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new h.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,i){var n=new h.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=n,t.multiply=a,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=s,t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},t.distance=d,t.squaredDistance=u,t.length=c,t.squaredLength=l,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=f,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e[3]=s+i*(r[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=h.RANDOM(),e[1]=h.RANDOM(),e[2]=h.RANDOM(),e[3]=h.RANDOM(),f(e,e),s(e,e,t),e},t.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,e},t.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],d=r[2],u=r[3],c=u*i+s*a-d*n,l=u*n+d*i-o*a,f=u*a+o*n-s*i,h=-o*i-s*n-d*a;return e[0]=c*u+h*-o+l*-d-f*-s,e[1]=l*u+h*-s+f*-o-c*-d,e[2]=f*u+h*-d+c*-s-l*-o,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=t[0],s=t[1],d=t[2],u=t[3];return Math.abs(r-o)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-d)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-u)<=h.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))};var h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=n,t.mul=a,t.div=o,t.dist=d,t.sqrDist=u,t.len=c,t.sqrLen=l,t.forEach=function(){var e=i();return function(t,r,i,n,a,o){var s,d=void 0;for(r||(r=4),i||(i=0),s=n?Math.min(n*r+i,t.length):t.length,d=i;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],a(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}()},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=t.vec3=t.vec2=t.quat=t.mat4=t.mat3=t.mat2d=t.mat2=t.glMatrix=void 0;var n=i(r(0)),a=i(r(5)),o=i(r(6)),s=i(r(1)),d=i(r(7)),u=i(r(8)),c=i(r(9)),l=i(r(2)),f=i(r(3));t.glMatrix=n,t.mat2=a,t.mat2d=o,t.mat3=s,t.mat4=d,t.quat=u,t.vec2=c,t.vec3=l,t.vec4=f},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],d=r[1],u=r[2],c=r[3];return e[0]=i*s+a*d,e[1]=n*s+o*d,e[2]=i*u+a*c,e[3]=n*u+o*c,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,i){var n=new a.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},t.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},t.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(o=1/o,e[0]=a*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},t.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=i,t.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d+a*s,e[1]=n*d+o*s,e[2]=i*-s+a*d,e[3]=n*-s+o*d,e},t.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],d=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*d,e[3]=o*d,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=n,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=t[0],d=t[1],u=t[2],c=t[3];return Math.abs(r-s)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-d)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-u)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-c)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=r[0],c=r[1],l=r[2],f=r[3],h=r[4],R=r[5];return e[0]=i*u+a*c,e[1]=n*u+o*c,e[2]=i*l+a*f,e[3]=n*l+o*f,e[4]=i*h+a*R+s,e[5]=n*h+o*R+d,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){var t=new a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,i,n,o){var s=new a.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=o,s},t.set=function(e,t,r,i,n,a,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=r*a-i*n;return d?(d=1/d,e[0]=a*d,e[1]=-i*d,e[2]=-n*d,e[3]=r*d,e[4]=(n*s-a*o)*d,e[5]=(i*o-r*s)*d,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=i,t.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*u,e[1]=n*c+o*u,e[2]=i*-u+a*c,e[3]=n*-u+o*c,e[4]=s,e[5]=d,e},t.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=r[0],c=r[1];return e[0]=i*u,e[1]=n*u,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=d,e},t.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=r[0],c=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=i*u+a*c+s,e[5]=n*u+o*c+d,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=n,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],d=e[5],u=t[0],c=t[1],l=t[2],f=t[3],h=t[4],R=t[5];return Math.abs(r-u)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-l)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-f)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-h)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(d-R)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],R=t[11],m=t[12],p=t[13],_=t[14],g=t[15],v=r[0],E=r[1],M=r[2],b=r[3];return e[0]=v*i+E*s+M*l+b*m,e[1]=v*n+E*d+M*f+b*p,e[2]=v*a+E*u+M*h+b*_,e[3]=v*o+E*c+M*R+b*g,v=r[4],E=r[5],M=r[6],b=r[7],e[4]=v*i+E*s+M*l+b*m,e[5]=v*n+E*d+M*f+b*p,e[6]=v*a+E*u+M*h+b*_,e[7]=v*o+E*c+M*R+b*g,v=r[8],E=r[9],M=r[10],b=r[11],e[8]=v*i+E*s+M*l+b*m,e[9]=v*n+E*d+M*f+b*p,e[10]=v*a+E*u+M*h+b*_,e[11]=v*o+E*c+M*R+b*g,v=r[12],E=r[13],M=r[14],b=r[15],e[12]=v*i+E*s+M*l+b*m,e[13]=v*n+E*d+M*f+b*p,e[14]=v*a+E*u+M*h+b*_,e[15]=v*o+E*c+M*R+b*g,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,i,n,o,s,d,u,c,l,f,h,R,m,p){var _=new a.ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=i,_[4]=n,_[5]=o,_[6]=s,_[7]=d,_[8]=u,_[9]=c,_[10]=l,_[11]=f,_[12]=h,_[13]=R,_[14]=m,_[15]=p,_},t.set=function(e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=d,e[8]=u,e[9]=c,e[10]=l,e[11]=f,e[12]=h,e[13]=R,e[14]=m,e[15]=p,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15],g=r*s-i*o,v=r*d-n*o,E=r*u-a*o,M=i*d-n*s,b=i*u-a*s,L=n*u-a*d,P=c*m-l*R,T=c*p-f*R,y=c*_-h*R,x=l*p-f*m,w=l*_-h*m,I=f*_-h*p,U=g*I-v*w+E*x+M*y-b*T+L*P;return U?(U=1/U,e[0]=(s*I-d*w+u*x)*U,e[1]=(n*w-i*I-a*x)*U,e[2]=(m*L-p*b+_*M)*U,e[3]=(f*b-l*L-h*M)*U,e[4]=(d*y-o*I-u*T)*U,e[5]=(r*I-n*y+a*T)*U,e[6]=(p*E-R*L-_*v)*U,e[7]=(c*L-f*E+h*v)*U,e[8]=(o*w-s*y+u*P)*U,e[9]=(i*y-r*w-a*P)*U,e[10]=(R*b-m*E+_*g)*U,e[11]=(l*E-c*b-h*g)*U,e[12]=(s*T-o*x-d*P)*U,e[13]=(r*x-i*T+n*P)*U,e[14]=(m*v-R*M-p*g)*U,e[15]=(c*M-l*v+f*g)*U,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15];return e[0]=s*(f*_-h*p)-l*(d*_-u*p)+m*(d*h-u*f),e[1]=-(i*(f*_-h*p)-l*(n*_-a*p)+m*(n*h-a*f)),e[2]=i*(d*_-u*p)-s*(n*_-a*p)+m*(n*u-a*d),e[3]=-(i*(d*h-u*f)-s*(n*h-a*f)+l*(n*u-a*d)),e[4]=-(o*(f*_-h*p)-c*(d*_-u*p)+R*(d*h-u*f)),e[5]=r*(f*_-h*p)-c*(n*_-a*p)+R*(n*h-a*f),e[6]=-(r*(d*_-u*p)-o*(n*_-a*p)+R*(n*u-a*d)),e[7]=r*(d*h-u*f)-o*(n*h-a*f)+c*(n*u-a*d),e[8]=o*(l*_-h*m)-c*(s*_-u*m)+R*(s*h-u*l),e[9]=-(r*(l*_-h*m)-c*(i*_-a*m)+R*(i*h-a*l)),e[10]=r*(s*_-u*m)-o*(i*_-a*m)+R*(i*u-a*s),e[11]=-(r*(s*h-u*l)-o*(i*h-a*l)+c*(i*u-a*s)),e[12]=-(o*(l*p-f*m)-c*(s*p-d*m)+R*(s*f-d*l)),e[13]=r*(l*p-f*m)-c*(i*p-n*m)+R*(i*f-n*l),e[14]=-(r*(s*p-d*m)-o*(i*p-n*m)+R*(i*d-n*s)),e[15]=r*(s*f-d*l)-o*(i*f-n*l)+c*(i*d-n*s),e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],d=e[7],u=e[8],c=e[9],l=e[10],f=e[11],h=e[12],R=e[13],m=e[14],p=e[15];return(t*o-r*a)*(l*p-f*m)-(t*s-i*a)*(c*p-f*R)+(t*d-n*a)*(c*m-l*R)+(r*s-i*o)*(u*p-f*h)-(r*d-n*o)*(u*m-l*h)+(i*d-n*s)*(u*R-c*h)},t.multiply=i,t.translate=function(e,t,r){var i=r[0],n=r[1],a=r[2],o=void 0,s=void 0,d=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,R=void 0,m=void 0,p=void 0,_=void 0;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(o=t[0],s=t[1],d=t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7],R=t[8],m=t[9],p=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=d,e[3]=u,e[4]=c,e[5]=l,e[6]=f,e[7]=h,e[8]=R,e[9]=m,e[10]=p,e[11]=_,e[12]=o*i+c*n+R*a+t[12],e[13]=s*i+l*n+m*a+t[13],e[14]=d*i+f*n+p*a+t[14],e[15]=u*i+h*n+_*a+t[15]),e},t.scale=function(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,i){var n=i[0],o=i[1],s=i[2],d=Math.sqrt(n*n+o*o+s*s),u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,R=void 0,m=void 0,p=void 0,_=void 0,g=void 0,v=void 0,E=void 0,M=void 0,b=void 0,L=void 0,P=void 0,T=void 0,y=void 0,x=void 0,w=void 0,I=void 0,U=void 0,D=void 0,B=void 0;return Math.abs(d)<a.EPSILON?null:(n*=d=1/d,o*=d,s*=d,u=Math.sin(r),l=1-(c=Math.cos(r)),f=t[0],h=t[1],R=t[2],m=t[3],p=t[4],_=t[5],g=t[6],v=t[7],E=t[8],M=t[9],b=t[10],L=t[11],P=n*n*l+c,T=o*n*l+s*u,y=s*n*l-o*u,x=n*o*l-s*u,w=o*o*l+c,I=s*o*l+n*u,U=n*s*l+o*u,D=o*s*l-n*u,B=s*s*l+c,e[0]=f*P+p*T+E*y,e[1]=h*P+_*T+M*y,e[2]=R*P+g*T+b*y,e[3]=m*P+v*T+L*y,e[4]=f*x+p*w+E*I,e[5]=h*x+_*w+M*I,e[6]=R*x+g*w+b*I,e[7]=m*x+v*w+L*I,e[8]=f*U+p*D+E*B,e[9]=h*U+_*D+M*B,e[10]=R*U+g*D+b*B,e[11]=m*U+v*D+L*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],o=t[5],s=t[6],d=t[7],u=t[8],c=t[9],l=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+u*i,e[5]=o*n+c*i,e[6]=s*n+l*i,e[7]=d*n+f*i,e[8]=u*n-a*i,e[9]=c*n-o*i,e[10]=l*n-s*i,e[11]=f*n-d*i,e},t.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],d=t[3],u=t[8],c=t[9],l=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-u*i,e[1]=o*n-c*i,e[2]=s*n-l*i,e[3]=d*n-f*i,e[8]=a*i+u*n,e[9]=o*i+c*n,e[10]=s*i+l*n,e[11]=d*i+f*n,e},t.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],d=t[3],u=t[4],c=t[5],l=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+u*i,e[1]=o*n+c*i,e[2]=s*n+l*i,e[3]=d*n+f*i,e[4]=u*n-a*i,e[5]=c*n-o*i,e[6]=l*n-s*i,e[7]=f*n-d*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){var i=r[0],n=r[1],o=r[2],s=Math.sqrt(i*i+n*n+o*o),d=void 0,u=void 0,c=void 0;return Math.abs(s)<a.EPSILON?null:(i*=s=1/s,n*=s,o*=s,d=Math.sin(t),c=1-(u=Math.cos(t)),e[0]=i*i*c+u,e[1]=n*i*c+o*d,e[2]=o*i*c-n*d,e[3]=0,e[4]=i*n*c-o*d,e[5]=n*n*c+u,e[6]=o*n*c+i*d,e[7]=0,e[8]=i*o*c+n*d,e[9]=n*o*c-i*d,e[10]=o*o*c+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=i+i,d=n+n,u=a+a,c=i*s,l=i*d,f=i*u,h=n*d,R=n*u,m=a*u,p=o*s,_=o*d,g=o*u;return e[0]=1-(h+m),e[1]=l+g,e[2]=f-_,e[3]=0,e[4]=l-g,e[5]=1-(c+m),e[6]=R+p,e[7]=0,e[8]=f+_,e[9]=R-p,e[10]=1-(c+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],o=t[5],s=t[6],d=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(d*d+u*u+c*c),e},t.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},t.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3],d=n+n,u=a+a,c=o+o,l=n*d,f=n*u,h=n*c,R=a*u,m=a*c,p=o*c,_=s*d,g=s*u,v=s*c,E=i[0],M=i[1],b=i[2];return e[0]=(1-(R+p))*E,e[1]=(f+v)*E,e[2]=(h-g)*E,e[3]=0,e[4]=(f-v)*M,e[5]=(1-(l+p))*M,e[6]=(m+_)*M,e[7]=0,e[8]=(h+g)*b,e[9]=(m-_)*b,e[10]=(1-(l+R))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var a=t[0],o=t[1],s=t[2],d=t[3],u=a+a,c=o+o,l=s+s,f=a*u,h=a*c,R=a*l,m=o*c,p=o*l,_=s*l,g=d*u,v=d*c,E=d*l,M=i[0],b=i[1],L=i[2],P=n[0],T=n[1],y=n[2];return e[0]=(1-(m+_))*M,e[1]=(h+E)*M,e[2]=(R-v)*M,e[3]=0,e[4]=(h-E)*b,e[5]=(1-(f+_))*b,e[6]=(p+g)*b,e[7]=0,e[8]=(R+v)*L,e[9]=(p-g)*L,e[10]=(1-(f+m))*L,e[11]=0,e[12]=r[0]+P-(e[0]*P+e[4]*T+e[8]*y),e[13]=r[1]+T-(e[1]*P+e[5]*T+e[9]*y),e[14]=r[2]+y-(e[2]*P+e[6]*T+e[10]*y),e[15]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,d=n+n,u=r*o,c=i*o,l=i*s,f=n*o,h=n*s,R=n*d,m=a*o,p=a*s,_=a*d;return e[0]=1-l-R,e[1]=c+_,e[2]=f-p,e[3]=0,e[4]=c-_,e[5]=1-u-R,e[6]=h+m,e[7]=0,e[8]=f+p,e[9]=h-m,e[10]=1-u-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,i,n,a,o){var s=1/(r-t),d=1/(n-i),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*d,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*d,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e},t.perspective=function(e,t,r,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*o,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),d=2/(o+s),u=2/(n+a);return e[0]=d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-s)*d*.5,e[9]=(n-a)*u*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},t.ortho=function(e,t,r,i,n,a,o){var s=1/(t-r),d=1/(i-n),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*d,e[14]=(o+a)*u,e[15]=1,e},t.lookAt=function(e,t,r,i){var n=void 0,o=void 0,s=void 0,d=void 0,u=void 0,c=void 0,l=void 0,f=void 0,h=void 0,R=void 0,m=t[0],p=t[1],_=t[2],g=i[0],v=i[1],E=i[2],M=r[0],b=r[1],L=r[2];return Math.abs(m-M)<a.EPSILON&&Math.abs(p-b)<a.EPSILON&&Math.abs(_-L)<a.EPSILON?mat4.identity(e):(l=m-M,f=p-b,h=_-L,n=v*(h*=R=1/Math.sqrt(l*l+f*f+h*h))-E*(f*=R),o=E*(l*=R)-g*h,s=g*f-v*l,(R=Math.sqrt(n*n+o*o+s*s))?(n*=R=1/R,o*=R,s*=R):(n=0,o=0,s=0),d=f*s-h*o,u=h*n-l*s,c=l*o-f*n,(R=Math.sqrt(d*d+u*u+c*c))?(d*=R=1/R,u*=R,c*=R):(d=0,u=0,c=0),e[0]=n,e[1]=d,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=f,e[7]=0,e[8]=s,e[9]=c,e[10]=h,e[11]=0,e[12]=-(n*m+o*p+s*_),e[13]=-(d*m+u*p+c*_),e[14]=-(l*m+f*p+h*_),e[15]=1,e)},t.targetTo=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=i[0],d=i[1],u=i[2],c=n-r[0],l=a-r[1],f=o-r[2],h=c*c+l*l+f*f;h>0&&(c*=h=1/Math.sqrt(h),l*=h,f*=h);var R=d*f-u*l,m=u*c-s*f,p=s*l-d*c;return e[0]=R,e[1]=m,e[2]=p,e[3]=0,e[4]=l*p-f*m,e[5]=f*R-c*p,e[6]=c*m-l*R,e[7]=0,e[8]=c,e[9]=l,e[10]=f,e[11]=0,e[12]=n,e[13]=a,e[14]=o,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=n,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],d=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],R=e[11],m=e[12],p=e[13],_=e[14],g=e[15],v=t[0],E=t[1],M=t[2],b=t[3],L=t[4],P=t[5],T=t[6],y=t[7],x=t[8],w=t[9],I=t[10],U=t[11],D=t[12],B=t[13],G=t[14],S=t[15];return Math.abs(r-v)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-E)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(n-M)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(o-b)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-L)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(d-P)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(u-T)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-y)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(l-x)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(f-w)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(h-I)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(R-U)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(U))&&Math.abs(m-D)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(p-B)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(_-G)<=a.EPSILON*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(g-S)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(S))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new u.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function o(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],d=r[1],u=r[2],c=r[3];return e[0]=i*c+o*s+n*u-a*d,e[1]=n*c+o*d+a*s-i*u,e[2]=a*c+o*u+i*d-n*s,e[3]=o*c-i*s-n*d-a*u,e}function s(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3],d=r[0],u=r[1],c=r[2],l=r[3],f=void 0,h=void 0,R=void 0,m=void 0,p=void 0;return(h=n*d+a*u+o*c+s*l)<0&&(h=-h,d=-d,u=-u,c=-c,l=-l),1-h>1e-6?(f=Math.acos(h),R=Math.sin(f),m=Math.sin((1-i)*f)/R,p=Math.sin(i*f)/R):(m=1-i,p=i),e[0]=m*n+p*d,e[1]=m*a+p*u,e[2]=m*o+p*c,e[3]=m*s+p*l,e}function d(e,t){var r=t[0]+t[4]+t[8],i=void 0;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*a+o]-t[3*o+a])*i,e[a]=(t[3*a+n]+t[3*n+a])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=n,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=a,t.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=o,t.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d+o*s,e[1]=n*d+a*s,e[2]=a*d-n*s,e[3]=o*d-i*s,e},t.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d-a*s,e[1]=n*d+o*s,e[2]=a*d+i*s,e[3]=o*d-n*s,e},t.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d+n*s,e[1]=n*d-i*s,e[2]=a*d+o*s,e[3]=o*d-a*s,e},t.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},t.slerp=s,t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-n*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=d,t.fromEuler=function(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),d=Math.cos(r),u=Math.sin(i),c=Math.cos(i);return e[0]=a*d*c-o*s*u,e[1]=o*s*c+a*d*u,e[2]=o*d*u-a*s*c,e[3]=o*d*c+a*s*u,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var u=i(r(0)),c=i(r(1)),l=i(r(2)),f=i(r(3)),h=(t.clone=f.clone,t.fromValues=f.fromValues,t.copy=f.copy,t.set=f.set,t.add=f.add,t.mul=o,t.scale=f.scale,t.dot=f.dot,t.lerp=f.lerp,t.length=f.length),R=(t.len=h,t.squaredLength=f.squaredLength),m=(t.sqrLen=R,t.normalize=f.normalize);t.exactEquals=f.exactEquals,t.equals=f.equals,t.rotationTo=function(){var e=l.create(),t=l.fromValues(1,0,0),r=l.fromValues(0,1,0);return function(i,n,o){var s=l.dot(n,o);return s<-.999999?(l.cross(e,t,n),l.len(e)<1e-6&&l.cross(e,r,n),l.normalize(e,e),a(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(l.cross(e,n,o),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,m(i,i))}}(),t.sqlerp=function(){var e=n(),t=n();return function(r,i,n,a,o,d){return s(e,i,o,d),s(t,n,a,d),s(r,e,t,2*d*(1-d)),r}}(),t.setAxes=function(){var e=c.create();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],m(t,d(t,e))}}()},function(e,t,r){"use strict";function i(){var e=new l.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function s(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function d(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function u(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function c(e){var t=e[0],r=e[1];return t*t+r*r}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.sqrDist=t.dist=t.div=t.mul=t.sub=t.len=void 0,t.create=i,t.clone=function(e){var t=new l.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){var r=new l.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=n,t.multiply=a,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},t.distance=s,t.squaredDistance=d,t.length=u,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},t.lerp=function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*l.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},t.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},t.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},t.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))};var l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.len=u,t.sub=n,t.mul=a,t.div=o,t.dist=s,t.sqrDist=d,t.sqrLen=c,t.forEach=function(){var e=i();return function(t,r,i,n,a,o){var s,d=void 0;for(r||(r=2),i||(i=0),s=n?Math.min(n*r+i,t.length):t.length,d=i;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],a(e,e,o),t[d]=e[0],t[d+1]=e[1];return t}}()}])}),function(){var e;e=function(e,t,r,i,n){var a,o;e.hasOwnProperty(r)&&RedGLUtil.throwFunc(t+" - "+r+" : 이미 정의된 속성"),n=n||{};var s=function(){return this["_"+r]};switch(i){case"hex":a={get:s,set:function(e){"string"==typeof e||RedGLUtil.throwFunc(t+" - "+r+" hex 형식만 허용함.","입력값 : "+e),RedGLUtil.regHex(e)||RedGLUtil.throwFunc(t+" - "+r+" : hex 형식만 허용함.","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"boolean":a={get:s,set:function(e){"boolean"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : boolean만 허용함.","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"number":var d=n.hasOwnProperty("min"),u=n.hasOwnProperty("max"),c=n.min,l=n.max;a={get:s,set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : 숫자만 허용함.","입력값 : "+e),d&&e<c&&(e=c),u&&e>l&&(e=l),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"uint":d=n.hasOwnProperty("min"),u=n.hasOwnProperty("max"),c=n.min,l=n.max;d&&c<0&&RedGLUtil.throwFunc(t+" - "+r+" : min옵션은 0보다 커야 함.","입력값 : "+c),u&&l<0&&RedGLUtil.throwFunc(t+" - "+r+" : max옵션은 0보다 커야 함.","입력값 : "+l),d&&u&&l<=c&&RedGLUtil.throwFunc(t+" - "+r+" : max옵션은 min옵션보다 커야 함.","min 입력값 : "+c,"max 입력값 : "+l),a={get:function(){return this["_"+r]},set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : uint만 허용함.","입력값 : "+e),d&&e<c&&(e=c),u&&e>l&&(e=l),e>=0&&Math.floor(e)==e||RedGLUtil.throwFunc(t+" - "+r+" : uint만 허용함(소수점은 허용하지 않음).","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"int":d=n.hasOwnProperty("min"),u=n.hasOwnProperty("max"),c=n.min,l=n.max;d&&u&&l<=c&&RedGLUtil.throwFunc(t+" - "+r+" : max옵션은 min옵션보다 커야 함.","min 입력값 : "+c,"max 입력값 : "+l),a={get:s,set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : int만 허용함.","입력값 : "+e),d&&e<c&&(e=c),u&&e>l&&(e=l),Math.floor(e)!=e&&RedGLUtil.throwFunc(t+" - "+r+" : int만 허용함(소수점은 허용하지 않음).","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"sampler2D":o="RedBaseTexture";break;case"samplerCube":o="RedBitmapCubeTexture";break;case"samplerVideo":o="RedVideoTexture";break;default:RedGLUtil.throwFunc(r+" - type : "+i+" / "+r+" : 정의할수없는 타입입니다.")}if(o){var f=window[o];a=n.essential?{get:s,set:function(e){f==RedBitmapCubeTexture?e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e):!(e instanceof RedBitmapCubeTexture)&&e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this)}}:{get:s,set:function(e){e&&(f==RedBitmapCubeTexture?e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e):!(e instanceof RedBitmapCubeTexture)&&e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e)),this["_"+r]=e,n.callback&&n.callback.call(this)}}}e["_"+r]=null,Object.defineProperty(e,r,a)},(RedDefinePropertyInfo={}).definePrototype=function(t,r,i,n){e(window[t].prototype,t,r,i,n)},RedDefinePropertyInfo.definePrototypes=function(t){for(var r,i=arguments.length;i-- >1;)r=arguments[i],e(window[t].prototype,t,r[0],r[1],r[2])},Object.freeze(RedDefinePropertyInfo)}(),(RedGLDetect=function(e){if(!(this instanceof RedGLDetect))return new RedGLDetect(e);var t,r,i,n,a,o=this,s=e.gl;for(i in t={basic:["VENDOR","VERSION","SHADING_LANGUAGE_VERSION","RENDERER"],frameBuffer:["MAX_RENDERBUFFER_SIZE","MAX_VIEWPORT_DIMS","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],vertexShader:["MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_VERTEX_UNIFORM_VECTORS"],fragmentShader:["MAX_FRAGMENT_UNIFORM_VECTORS"],texture:["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS"]})for(r=(a=t[i]).length,this[i]={};r--;)this[i][n=a[r]]=s.getParameter(s[n]);this.BROWSER_INFO=RedGLDetect.getBrowserInfo(),"ie"==this.BROWSER_INFO.browser&&(console.table=console.log),requestAnimationFrame(function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=10,t.height=20,r.fillStyle="red",r.fillRect(0,0,10,10),r.fillStyle="blue",r.fillRect(0,10,10,10),t.style.cssText="position:fixed;top:0px;left:0px";var i=RedBitmapTexture(e,t),n=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i.webglTexture,0);var a=new Uint8Array(4);s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,a),s.bindFramebuffer(s.FRAMEBUFFER,null),o.ableCanvasSourceFlipYonTexture=255===a[0],o.BROWSER_INFO.ableCanvasSourceFlipYonTexture=255===a[0]})}).BROWSER_INFO={},RedGLDetect.getBrowserInfo=function(){var e,t,r,i,n,a=RedGLDetect.BROWSER_INFO,o=window.navigator,s=o.userAgent.toLowerCase(),d=o.platform.toLowerCase(),u=o.appVersion.toLowerCase(),c="pc",l=0,f=function(){return s.indexOf("whale")<0?0:(t=parseFloat(/whale\/([\d]+)/.exec(s)[1]),e="whale")},h=function(){if(!(s.indexOf(n="chrome")<0&&s.indexOf(n="crios")<0))return e="chrome",t=parseFloat(("chrome"===n?/chrome\/([\d]+)/:/crios\/([\d]+)/).exec(s)[1])},R=function(){return s.indexOf("firefox")<0?0:(e="firefox",t=parseFloat(/firefox\/([\d]+)/.exec(s)[1]))},m=function(){return s.indexOf("safari")<0?0:(e="safari",t=parseFloat(/safari\/([\d]+)/.exec(s)[1]))},p=function(){var r;return s.indexOf(r="opera")<0&&s.indexOf(r="opr")<0?0:(e="opera",t="opera"===r?parseFloat(/version\/([\d]+)/.exec(s)[1]):parseFloat(/opr\/([\d]+)/.exec(s)[1]))},_=function(){return s.indexOf("naver")<0?0:e="naver"};if(a||(a={}),s.indexOf("android")>-1)e=r="android",c=-1===s.indexOf("mobile")?(e+="Tablet","tablet"):"mobile",i=(n=/android ([\d.]+)/.exec(s))?(n=n[1].split("."),parseFloat(n[0]+"."+n[1])):0,l=1,f()||_()||p()||h()||R()||(t=n=/safari\/([\d.]+)/.exec(s)?parseFloat(n[1]):0);else if(s.indexOf(n="ipad")>-1||s.indexOf(n="iphone")>-1)c="ipad"===n?"tablet":"mobile",e=r=n,i=(n=/os ([\d_]+)/.exec(s))?(n=n[1].split("_"),parseFloat(n[0]+"."+n[1])):0,l=1,f()||_()||p()||h()||R()||(t=(n=/mobile\/([\S]+)/.exec(s))?parseFloat(n[1]):0);else if(d.indexOf("win")>-1){for(n in g={5.1:"xp","6.0":"vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"})if(s.indexOf("windows nt "+n)>-1){i=g[n];break}r="win",(s.indexOf("edge")>-1?(s.indexOf("iemobile")>-1&&(r="winMobile"),e="edge",t=/edge\/([\d]+)/.exec(s)[1]):s.indexOf("msie")<0&&s.indexOf("trident")<0?void 0:(s.indexOf("iemobile")>-1&&(r="winMobile"),e="ie",t=s.indexOf("msie 7")>-1&&s.indexOf("trident")>-1?-1:s.indexOf("msie")<0?11:parseFloat(/msie ([\d]+)/.exec(s)[1])))||f()||p()||h()||R()||m()}else d.indexOf("mac")>-1?(r="mac",n=/os x ([\d._]+)/.exec(s)[1].replace("_",".").split("."),i=parseFloat(n[0]+"."+n[1]),f()||p()||h()||R()||m()):(r=u.indexOf("x11")>-1?"unix":u.indexOf("linux")>-1?"linux":0,f()||h()||R());for(n in g={device:c,isMobile:l,browser:e,browserVer:t,os:r,osVer:i,down:l?"touchstart":"mousedown",move:l?"touchmove":"mousemove",up:l?"touchend":"mouseup",click:"click",over:"mouseover",out:"mouseout"})g.hasOwnProperty(n)&&(a[n]=g[n]);if(window.OffscreenCanvas){var g=new window.OffscreenCanvas(2,2);try{g.getContext("2d")}catch(e){window.OffscreenCanvas=null}}return a},Object.freeze(RedGLDetect),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h;RedGLUtil={throwFunc:function(){throw"RedGL Error : "+Array.prototype.slice.call(arguments).join(" ")},isUint:function(e,t){return"number"==typeof e&&e>=0||RedGLUtil.throwFunc(t,"입력값 : "+e),Math.floor(e)===e||RedGLUtil.throwFunc(t,"입력값 : "+e),!0},hexToRGB_ZeroToOne:function(e){var t,r;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return r=[],3===(t=e.substring(1).split("")).length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),t="0x"+t.join(""),r[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,r;RedGLUtil.throwFunc("RedGLUtil.hexToRGB_ZeroToOne : 잘못된 hex값입니다.",e)},rgb2hex:function(e,t,r){return"#"+(16777216+(r|t<<8|e<<16)).toString(16).slice(1)},regHex:(h=/^#(?:[0-9a-fA-F]{3}){1,2}$/,function(e){return h.test(e)}),getStrFromComment:function(e){if("string"!=typeof e&&RedGLUtil.throwFunc("getStrFromComment : 해석할 값은 문자열만 가능",e),f=e.replace("@preserve","").toString().trim().match(/(\/\*)[\s\S]+(\*\/)/g))return f[0].replace(/\/\*|\*\//g,"").trim();RedGLUtil.throwFunc("getStrFromComment : 해석할 불가능한 값",e)},isPowerOf2:function(e){return 0==(e&e-1)},nextHighestPowerOfTwo:function(e){for(--e,l=1;l<32;l<<=1)e|=e>>l;return e+1},makePowerOf2Source:function(e,t,r){if(c=r,RedGLUtil.isPowerOf2(t.width)&&RedGLUtil.isPowerOf2(t.height))return t;d=RedGLUtil.nextHighestPowerOfTwo(t.width),u=RedGLUtil.nextHighestPowerOfTwo(t.height),d>c&&(d=c),u>c&&(u=c);var i=window.OffscreenCanvas?new OffscreenCanvas(d,u):document.createElement("canvas"),n=i.getContext("2d");return window.OffscreenCanvas||(i.width=d,i.height=u),n.drawImage(t,0,0,d,u),window.OffscreenCanvas?i.transferToImageBitmap():i},calculateNormals:function(e,t){var r,i,n=[];for(r=0;r<e.length;r+=3)n[r+0]=0,n[r+1]=0,n[r+2]=0;for(r=0;r<t.length;r+=3){var a,o,s,d,u=[],c=[],l=[];for(a=3*t[r],o=3*t[r+1],s=3*t[r+2],u[0]=e[s+0]-e[o+0],u[1]=e[s+1]-e[o+1],u[2]=e[s+2]-e[o+2],c[0]=e[a+0]-e[o+0],c[1]=e[a+1]-e[o+1],c[2]=e[a+2]-e[o+2],l[0]=u[1]*c[2]-u[2]*c[1],l[1]=u[2]*c[0]-u[0]*c[2],l[2]=u[0]*c[1]-u[1]*c[0],i=0;i<3;i++)n[(d=3*t[r+i])+0]=n[d+0]+l[0],n[d+1]=n[d+1]+l[1],n[d+2]=n[d+2]+l[2]}for(r=0;r<e.length;r+=3){var f=[];f[0]=n[r+0],f[1]=n[r+1],f[2]=n[r+2];var h=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);0===h&&(h=1),f[0]=f[0]/h,f[1]=f[1]/h,f[2]=f[2]/h,n[r+0]=f[0],n[r+1]=f[1],n[r+2]=f[2]}return n},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},quaternionToRotationMat4:function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,s=i+i,d=n+n,u=r*o,c=r*s,l=r*d,f=i*s,h=i*d,R=n*d,m=a*o,p=a*s,_=a*d;return t[0]=1-(f+R),t[4]=c-_,t[8]=l+p,t[1]=c+_,t[5]=1-(u+R),t[9]=h-m,t[2]=l-p,t[6]=h+m,t[10]=1-(u+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},quaternionToRotation:function(e,t){var r=[],i=e[0],n=e[1],a=e[2],o=e[3],s=i+i,d=n+n,u=a+a,c=i*s,l=i*d,f=i*u,h=n*d,R=n*u,m=a*u,p=o*s,_=o*d,g=o*u;r[0]=1-(h+m),r[4]=l-g,r[8]=f+_,r[1]=l+g,r[5]=1-(c+m),r[9]=R-p,r[2]=f-_,r[6]=R+p,r[10]=1-(c+h),r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1;var v=[0,0,0];t=t||"XYZ";var E=r[0],M=r[4],b=r[8],L=r[1],P=r[5],T=r[9],y=r[2],x=r[6],w=r[10];return"XYZ"===t?(v[1]=Math.asin(RedGLUtil.clamp(b,-1,1)),Math.abs(b)<.99999?(v[0]=Math.atan2(-T,w),v[2]=Math.atan2(-M,E)):(v[0]=Math.atan2(x,P),v[2]=0)):"YXZ"===t?(v[0]=Math.asin(-RedGLUtil.clamp(T,-1,1)),Math.abs(T)<.99999?(v[1]=Math.atan2(b,w),v[2]=Math.atan2(L,P)):(v[1]=Math.atan2(-y,E),v[2]=0)):"ZXY"===t?(v[0]=Math.asin(RedGLUtil.clamp(x,-1,1)),Math.abs(x)<.99999?(v[1]=Math.atan2(-y,w),v[2]=Math.atan2(-M,P)):(v[1]=0,v[2]=Math.atan2(L,E))):"ZYX"===t?(v[1]=Math.asin(-RedGLUtil.clamp(y,-1,1)),Math.abs(y)<.99999?(v[0]=Math.atan2(x,w),v[2]=Math.atan2(L,E)):(v[0]=0,v[2]=Math.atan2(-M,P))):"YZX"===t?(v[2]=Math.asin(RedGLUtil.clamp(L,-1,1)),Math.abs(L)<.99999?(v[0]=Math.atan2(-T,P),v[1]=Math.atan2(-y,E)):(v[0]=0,v[1]=Math.atan2(b,w))):"XZY"===t&&(v[2]=Math.asin(-RedGLUtil.clamp(M,-1,1)),Math.abs(M)<.99999?(v[0]=Math.atan2(x,P),v[1]=Math.atan2(b,E)):(v[0]=Math.atan2(-T,w),v[1]=0)),v},mat4ToEuler:function(e,t,r){t=t||[0,0,0],r=r||"XYZ";var i=e[0],n=e[4],a=e[8],o=e[1],s=e[5],d=e[9],u=e[2],c=e[6],l=e[10];return"XYZ"===r?(t[1]=Math.asin(RedGLUtil.clamp(a,-1,1)),Math.abs(a)<.99999?(t[0]=Math.atan2(-d,l),t[2]=Math.atan2(-n,i)):(t[0]=Math.atan2(c,s),t[2]=0)):"YXZ"===r?(t[0]=Math.asin(-RedGLUtil.clamp(d,-1,1)),Math.abs(d)<.99999?(t[1]=Math.atan2(a,l),t[2]=Math.atan2(o,s)):(t[1]=Math.atan2(-u,i),t[2]=0)):"ZXY"===r?(t[0]=Math.asin(RedGLUtil.clamp(c,-1,1)),Math.abs(c)<.99999?(t[1]=Math.atan2(-u,l),t[2]=Math.atan2(-n,s)):(t[1]=0,t[2]=Math.atan2(o,i))):"ZYX"===r?(t[1]=Math.asin(-RedGLUtil.clamp(u,-1,1)),Math.abs(u)<.99999?(t[0]=Math.atan2(c,l),t[2]=Math.atan2(o,i)):(t[0]=0,t[2]=Math.atan2(-n,s))):"YZX"===r?(t[2]=Math.asin(RedGLUtil.clamp(o,-1,1)),Math.abs(o)<.99999?(t[0]=Math.atan2(-d,s),t[1]=Math.atan2(-u,i)):(t[0]=0,t[1]=Math.atan2(a,l))):"XZY"===r&&(t[2]=Math.asin(-RedGLUtil.clamp(n,-1,1)),Math.abs(n)<.99999?(t[0]=Math.atan2(c,s),t[1]=Math.atan2(a,i)):(t[0]=Math.atan2(-d,l),t[1]=0)),t},screenToWorld:(a=[0,0,0],o=mat4.create(),s=mat4.create(),function(d,u){return e=2*d[0]/d[2]-1,t=-2*d[1]/d[3]+1,u=u.camera?u.camera:u,mat4.multiply(s,u.perspectiveMTX,u.matrix),n=mat4.clone(s),mat4.invert(n,n),a=[e,t,1],mat4.identity(o),mat4.translate(o,o,a),mat4.multiply(n,n,o),a[0]=n[12],a[1]=n[13],a[2]=n[14],0!==(r=s[12]*e+s[13]*t+s[15])&&(i=1/r,a[0]/=i,a[1]/=i,a[2]/=i,a[0]=a[0]+u.x,a[1]=a[1]+u.y,a[2]=a[2]+u.z),a})},Object.freeze(RedGLUtil)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f=[];window.addEventListener("resize",function(){f.forEach(function(e){e.setSize(e._width,e._height)})}),a={alpha:!1,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1},c=["OES_element_index_uint","OES_standard_derivatives","EXT_texture_filter_anisotropic","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info"],i="webkit-3d,moz-webgl,3d,experimental-webgl,webgl".split(","),n=[],e=function(e,t,r){if(u=JSON.parse(JSON.stringify(a)),t)for(d in t)u[d]=t[d];for(r?(n.length=0,n.push(r)):n=i.concat(),d=n.length;d--;)if(o=e.getContext(s=n[d],u))return o.glExtension={},c.forEach(function(e){o.glExtension[e]=o.getExtension(e),o.glExtension[e]&&"WEBGL_debug_renderer_info"===e&&(o.vendor=o.getParameter(o.glExtension[e].UNMASKED_VENDOR_WEBGL),o.renderer=o.getParameter(o.glExtension[e].UNMASKED_RENDERER_WEBGL))}),o.version=s,o;return null},t=function(e,t){var r,i,n,a;for(r=e.detect.texture.MAX_COMBINED_TEXTURE_IMAGE_UNITS,a=RedBaseTexture.EMPTY_BASE64,i=RedBitmapTexture(e,a),n=RedBitmapCubeTexture(e,[a,a,a,a,a,a]),e._datas.emptyTexture={"2d":i,"3d":n};r--;)1===r?(t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_CUBE_MAP,n.webglTexture)):(t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,i.webglTexture))},(RedGL=function(i,n,a,o){return this instanceof RedGL?("CANVAS"===i.tagName||RedGLUtil.throwFunc("RedGL : Canvas Element만 허용"),d=this,this._datas={},this._width="100%",this._height="100%",this._renderScale=1,this._viewRect=[0,0,0,0],this._canvas=i,this.gl=s=e(i,a,o),s?(this.detect=RedGLDetect(this),this._UUID=RedGL.makeUUID(),this.setSize=(p=new Uint32Array(2),_=new Uint32Array(2),l=0,h=0,function(e,t,r){void 0===e&&RedGLUtil.throwFunc("RedGL setSize : width가 입력되지 않았습니다."),void 0===t&&RedGLUtil.throwFunc("RedGL setSize : height가 입력되지 않았습니다."),u=this._width=e,c=this._height=t,window.HTMLCanvasElement?("number"!=typeof u&&(u.indexOf("%")>-1?u=(document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)*parseFloat(u)/100:RedGLUtil.throwFunc("RedGL setSize : width는 0이상의 숫자나 %만 허용.","입력값 :",u)),"number"!=typeof c&&(c.indexOf("%")>-1?c=window.innerHeight*parseFloat(c)/100:RedGLUtil.throwFunc("RedGL setSize : height는 0이상의 숫자나 %만 허용.","입력값 :",c)),R=window.devicePixelRatio||1,m=this._canvas,(l!=u||h!=c||r)&&(m.width=u*R*this._renderScale,m.height=c*R*this._renderScale,m.style.width=u+"px",m.style.height=c+"px",l=u,h=c),this._viewRect[2]=l,this._viewRect[3]=h):(u=this._width=e,c=this._height=t,p[0]=u*this._renderScale,_[0]=c*this._renderScale,this._viewRect[2]=u,this._viewRect[3]=c)}),RedSystemShaderCode.init&&RedSystemShaderCode.init(d),t(d,s),f.push(d),void requestAnimationFrame(function(){r||(RedPBRMaterial_System(d),RedStandardMaterial(d,d._datas.emptyTexture["2d"]),RedEnvironmentMaterial(d,null,d._datas.emptyTexture["3d"])),d._mouseEventInfo=[],[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up].forEach(function(e){var t,r;"ie"===RedGLDetect.BROWSER_INFO.browser&&11===RedGLDetect.BROWSER_INFO.browserVer?(t="offsetX",r="offsetY"):(t="layerX",r="layerY"),d._canvas.addEventListener(e,function(e){e.preventDefault(),RedGLDetect.BROWSER_INFO.isMobile?e.changedTouches[0]&&(d._mouseEventInfo.push({type:e.type,x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY,nativeEvent:e}),d._mouseX=e.changedTouches[0].clientX,d._mouseY=e.changedTouches[0].clientY):(d._mouseEventInfo.push({type:e.type,x:e[t],y:e[r],nativeEvent:e}),d._mouseX=e[t],d._mouseY=e[r])},!1)}),d.setSize(d._width,d._height),n&&n.call(d,!0)})):n?n.call(d,!1):void 0):new RedGL(i,n,a,o);var s,d,u,c,l,h,R,m,p,_}).makeUUID=(l=0,function(){return l++}),RedGL.prototype={},RedDefinePropertyInfo.definePrototype("RedGL","renderScale","number",{min:.1,max:1,callback:function(){this.setSize(this._width,this._height,!0)}}),RedGL.setDoNotPrepareProgram=function(){r=!0},Object.freeze(RedGL)}(),function(){var e,t,r,i,n,a={x:0,y:0},o={x:0,y:0},s=[];n=function(n,d){return RedGLDetect.BROWSER_INFO.isMobile?n.changedTouches?(o.x=n.changedTouches[0].clientX,o.y=n.changedTouches[0].clientY):(o.x=a.x,o.y=a.y):(o.x=n.clientX,o.y=n.clientY),t=o.x-a.x,r=o.y-a.y,s=[a.x,a.y,t,r],t<0&&(s[2]=Math.abs(t),s[0]+=t),r<0&&(s[3]=Math.abs(r),s[1]+=r),e.style.left=s[0]+"px",e.style.top=s[1]+"px",e.style.width=s[2]+"px",e.style.height=s[3]+"px",i(d.scene,d,s)},i=function(e,t,r,n){return n||(n={selectList:[],unSelectList:[]}),e.children.forEach(function(e){var a=e.getScreenPoint(t);r[0]<=a[0]&&r[1]<=a[1]&&r[0]+r[2]>=a[0]&&r[1]+r[3]>=a[1]?n.selectList.push(e):n.unSelectList.push(e),i(e,t,r,n)}),n},RedBoxSelection=function(t,r,i){return this instanceof RedBoxSelection?(t instanceof RedGL||RedGLUtil.throwFunc("RedBoxSelection : RedGL Instance만 허용.",t),r instanceof RedView||RedGLUtil.throwFunc("RedBoxSelection : RedView Instance만 허용.",r),t._datas.RedBoxSelection?this:(t._datas.RedBoxSelection=this,void[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up].forEach(function(s){var d;d=function(e){var t=n(e,r);i&&i(t)},t._canvas.addEventListener(s,function(t){t.type===RedGLDetect.BROWSER_INFO.down&&(o.x=a.x=RedGLDetect.BROWSER_INFO.isMobile?t.changedTouches[0].clientX:t.clientX,o.y=a.y=RedGLDetect.BROWSER_INFO.isMobile?t.changedTouches[0].clientY:t.clientY,e||((e=document.createElement("div")).style.cssText="position:fixed;border:1px dashed red;z-index:0"),e.style.left="0px",e.style.top="0px",e.style.width="0px",e.style.height="0px",document.body.appendChild(e),r.camera&&r.camera.camera&&(r.camera.needUpdate=!1),d({}),window.addEventListener(RedGLDetect.BROWSER_INFO.move,d),window.addEventListener(RedGLDetect.BROWSER_INFO.isMobile?"touchend":"click",function(){r.camera.camera&&(r.camera.needUpdate=!0),e.parentNode&&document.body.removeChild(e),window.removeEventListener(RedGLDetect.BROWSER_INFO.move,d)}))})}))):new RedBoxSelection(t,r,i)}}(),(RedBaseController=function(){if(!(this instanceof RedBaseController))return new RedBaseController}).prototype={update:function(){RedGLUtil.throwFunc("RedBaseController : update - 재정의 해서 써라")}},Object.freeze(RedBaseController),function(){var e=function(e,t){return createImageBitmap(e,t||{imageOrientation:"none"})};RedImageLoader=function(t,r,i,n){var a,o,s,d,u=this;if(!(this instanceof RedImageLoader))return new RedImageLoader(t,r,i,n);("string"!=typeof t&&RedGLUtil.throwFunc("RedImageLoader : src는 문자열 만 허용.","입력값 : "+t),u._src=t,u._onLoad=r,u._onError=i,window&&window.document)?(d=function(e){e.removeEventListener("error",s),e.removeEventListener("load",o)},s=function(e){d(this),u._onError&&u._onError(e)},o=function(e){d(this),u.source=a,u._onLoad&&u._onLoad(e)},(a=new Image).crossOrigin="anonymous",a.src=t,a.addEventListener("error",s),a.addEventListener("load",o)):2===t.split(",").length&&"data:"===t.substr(0,5)?e(function(e,t){t=t||"";for(var r=atob(e),i=r.length,n=Math.ceil(i/1024),a=new Array(n),o=0;o<n;++o){for(var s=1024*o,d=Math.min(s+1024,i),u=new Array(d-s),c=s,l=0;c<d;++l,++c)u[l]=r[c].charCodeAt(0);a[o]=new Uint8Array(u)}return new Blob(a,{type:t})}(t.split(",")[1],"image/png"),n||{}).then(function(e){e.src=t,u.source=e,u._onLoad&&(u._onLoad(e),u._onLoad=void 0,u._onError=void 0)}):function(t,r,i,n){var a=this,o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="blob",o.onreadystatechange=function(){4===o.readyState&&(200===o.status?e(o.response,n||{imageOrientation:"none"}).then(function(e){e.src=t,a.source=e,a._onLoad&&(a._onLoad(o),a._onLoad=void 0,a._onError=void 0)}).catch(function(){a._onError&&(a._onError(o),a._onLoad=void 0,a._onError=void 0)}):a._onError&&(a._onError(o),a._onLoad=void 0,a._onError=void 0))},o.send()}.apply(u,[u._src,r,i,n])},Object.freeze(RedImageLoader)}(),function(){var e;(RedBaseTexture=function(){}).EMPTY_BASE64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIFdpbmRvd3MiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzMxRDhBQzRFNUZFMTFFN0IxMDVGNEEzQjQ0RjAwRDIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzMxRDhBQzVFNUZFMTFFN0IxMDVGNEEzQjQ0RjAwRDIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3MzFEOEFDMkU1RkUxMUU3QjEwNUY0QTNCNDRGMDBEMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3MzFEOEFDM0U1RkUxMUU3QjEwNUY0QTNCNDRGMDBEMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuojYFUAAAAQSURBVHjaYvj//z8DQIABAAj8Av7bok0WAAAAAElFTkSuQmCC",RedImageLoader(RedBaseTexture.EMPTY_BASE64),RedBaseTexture.prototype={setEmptyTexture:(e=new Uint8Array([0,0,0,0]),function(t,r){this instanceof RedBitmapCubeTexture?(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,r),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_CUBE_MAP,null)):(t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8Array([128,64,0,192])),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.generateMipmap(t.TEXTURE_2D),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_2D,null))}),_load:function(){RedGLUtil.throwFunc("RedBaseTexture - _load : 반드시 재정의해야함")},src:function(){RedGLUtil.throwFunc("RedBaseTexture - src : 반드시 재정의해야함")},dispose:function(){this.webglTexture&&this._src!=RedBaseTexture.EMPTY_BASE64&&(this.webglTexture.gl.deleteTexture(this.webglTexture),this.webglTexture=null)}},Object.defineProperty(RedBaseTexture.prototype,"callback",{get:function(){return this._callback},set:function(e){e&&"function"!=typeof e&&RedGLUtil.throwFunc("RedBaseTexture : callback은 함수만 허용.","입력값 :",e),this._callback=e}}),Object.freeze(RedBaseTexture)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h;(RedBaseObject3D=function(){if(!(this instanceof RedBaseObject3D))return new RedBaseObject3D}).build=function(e){this.name="object3D_"+(RedGL.makeUUID()+1),this.useTransparentSort=!1,this.useCullFace=!0,this.cullFace=e.BACK,this.useDepthMask=!0,this.useDepthTest=!0,this.depthTestFunc=e.LEQUAL,this.useBlendMode=!0,this.blendSrc=e.SRC_ALPHA,this.blendDst=e.ONE_MINUS_SRC_ALPHA,this.drawMode=e.TRIANGLES,this.pointSize=1,this.x=this.y=this.z=0,this.rotationX=this.rotationY=this.rotationZ=0,this.scaleX=this.scaleY=this.scaleZ=1,this.pivotX=0,this.pivotY=0,this.pivotZ=0,this.autoUpdateMatrix=!0,this._renderAutoUpdateMatrix=!0,this.matrix=mat4.create(),this.localMatrix=mat4.create(),this.normalMatrix=mat4.create(),this.children=[],this.useLOD=!1,this._lodLevels=[],this._mouseColorMaterial=null,this._mouseColorID=new Float32Array([parseInt(255*Math.random()),parseInt(255*Math.random()),parseInt(255*Math.random()),255])},RedBaseObject3D.prototype={addLOD:function(e,t,r,i){for(r||i||RedGLUtil.throwFunc("RedBaseObject3D - addLOD : geometry, material 둘중하나는 반드시 입력되어야함"),RedGLUtil.isUint(e)||RedGLUtil.throwFunc("RedBaseObject3D - addLOD : level은 uint만 허용함"),e>4&&RedGLUtil.throwFunc("RedBaseObject3D - addLOD : level은 0~4 level 까지 허용함"),a={level:e,distance:t,geometry:r||this.geometry,material:i||this.material},s=this._lodLevels.length,o=!0;s--;)this._lodLevels[s].level==e&&(this._lodLevels[s]=a,o=!1);o&&this._lodLevels.push(a)},removeLOD:function(e){RedGLUtil.isUint(e)||RedGLUtil.throwFunc("RedBaseObject3D - removeLOD : level : uint만 허용함");for(var t=this._lodLevels.length;t--;)if(this._lodLevels[t].level==e){this._lodLevels.splice(t,1);break}},localToWorld:(n=mat4.create(),function(e,t,r){return"number"==typeof e||RedGLUtil.throwFunc("RedBaseObject3D - localToWorld : x - number만 허용함","입력값 : ",e),"number"==typeof t||RedGLUtil.throwFunc("RedBaseObject3D - localToWorld : y - number만 허용함","입력값 : ",t),"number"==typeof r||RedGLUtil.throwFunc("RedBaseObject3D - localToWorld : z - number만 허용함","입력값 : ",r),e=e||0,t=t||0,r=r||0,mat4.identity(n),mat4.translate(n,n,[e,t,r]),mat4.multiply(n,this.matrix,n),[n[12],n[13],n[14]]}),worldToLocal:function(){var e,t;return e=mat4.create(),t=mat4.create(),function(r,i,n){return"number"==typeof r||RedGLUtil.throwFunc("RedBaseObject3D - worldToLocal : x - number만 허용함","입력값 : ",r),"number"==typeof i||RedGLUtil.throwFunc("RedBaseObject3D - worldToLocal : y - number만 허용함","입력값 : ",i),"number"==typeof n||RedGLUtil.throwFunc("RedBaseObject3D - worldToLocal : z - number만 허용함","입력값 : ",n),r=r||0,i=i||0,n=n||0,mat4.translate(e,e,[r,i,n]),mat4.multiply(t,e,this.matrix),[t[0]*r+t[1]*i+t[2]*n+t[3],t[4]*r+t[5]*i+t[6]*n+t[7],t[8]*r+t[9]*i+t[10]*n+t[11]]}}(),getScreenPoint:(i=mat4.create(),r={x:0,y:0,z:0,w:0},function(n){return mat4.identity(i),n instanceof RedView||RedGLUtil.throwFunc("RedBaseObject3D - getScreenPoint : redView - RedView Instance 만 허용함","입력값 : ",n),e=n.camera,t=n._viewRect,e instanceof RedBaseController&&(e=e.camera),mat4.multiply(i,e.perspectiveMTX,e.matrix),mat4.multiply(i,i,this.matrix),r.x=i[12],r.y=i[13],r.z=i[14],r.w=i[15],r.x=.5*r.x/r.w+.5,r.y=.5*r.y/r.w+.5,[(t[0]+r.x*t[2])/window.devicePixelRatio,(t[1]+(1-r.y)*t[3])/window.devicePixelRatio]}),disposeAll:function(){this.disposeAllTexture(),this.disposeAllBuffer()},disposeAllTexture:function(){this.material&&this.material.disposeAllTexture()},disposeTexture:function(e){this.material&&this.material.disposeTexture(e)},disposeAllBuffer:function(){this.geometry&&this.geometry.disposeAllBuffer()},disposeBuffer:function(e){this.geometry&&this.geometry.disposeBuffer(e)}},c=function(e){var t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p,_=e.matrix,g=e.geometry.interleaveBuffer.stride;for(t=r=i=n=a=o=0,c=e.geometry.interleaveBuffer.data,l=0,f=e.geometry.interleaveBuffer.pointNum;l<f;l++)d=1+(s=l*g),u=s+2,t=(h=_[0]*c[s]+_[4]*c[d]+_[8]*c[u])<t?h:t,n=h>n?h:n,r=(R=_[1]*c[s]+_[5]*c[d]+_[9]*c[u])<r?R:r,a=R>a?R:a,i=(m=_[2]*c[s]+_[6]*c[d]+_[10]*c[u])<i?m:i,o=m>o?m:o;return(p=[n-t,a-r,o-i]).minX=t,p.maxX=n,p.minY=r,p.maxY=a,p.minZ=i,p.maxZ=o,p},d=function(e){var t=c(e),r=mat4.create();return mat4.translate(r,r,e.localToWorld(0,0,0)),mat4.scale(r,r,t),{worldMatrix:r,volume:t}},u=function(e){var t=e.geometry.volume,r=mat4.create();return mat4.translate(r,r,e.localToWorld(0,0,0)),mat4.rotateX(r,r,-e.rotationX*Math.PI/180),mat4.rotateY(r,r,-e.rotationY*Math.PI/180),mat4.rotateZ(r,r,-e.rotationZ*Math.PI/180),mat4.scale(r,r,t),mat4.scale(r,r,[e.scaleX,e.scaleY,e.scaleZ]),{worldMatrix:r,volume:c(e)}},RedBaseObject3D.prototype.volumeCalculateAABB=function(){return this.volumeInfo=d(this)},RedBaseObject3D.prototype.volumeCalculateOBB=function(){return this.volumeInfo=u(this)},RedBaseObject3D.prototype.lookAt=(l=new Float32Array([0,1,0]),f=[],h=[],function(e,t,r){f[0]=e,f[1]=t,f[2]=r,mat4.identity(this.matrix),mat4.targetTo(this.matrix,[this.x,this.y,this.z],f,l),h=RedGLUtil.mat4ToEuler(this.matrix,[]),this.rotationX=180*-h[0]/Math.PI,this.rotationY=180*-h[1]/Math.PI,this.rotationZ=180*-h[2]/Math.PI}),Object.defineProperty(RedBaseObject3D.prototype,"geometry",{get:function(){return this._geometry},set:function(e){!e||e instanceof RedGeometry||RedGLUtil.throwFunc("geometry : RedGeometry Instance만 허용.","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedBaseObject3D.prototype,"material",{get:function(){return this._material},set:function(e){!e||e instanceof RedBaseMaterial||RedGLUtil.throwFunc("material : RedBaseMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedBaseObject3D)}(),function(){var e,t;(e=(RedBaseContainer=function(){if(!(this instanceof RedBaseContainer))return new RedBaseContainer;this.children=[]}).prototype=new RedBaseObject3D).addChild=function(e){e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addChild","RedBaseObject3D Instance만 가능","입력값 : "+e),this.children.indexOf(e)>-1&&this.removeChild(e),this.children.push(e)},e.addChildAt=function(e,t){RedGLUtil.isUint(t,"addChildAt : index는 uint만 입력가능"),e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addChildAt","RedBaseObject3D Instance만 가능","입력값 : "+e),this.children.indexOf(e)>-1&&this.removeChild(e),this.children.length<t&&(t=this.children.length),null!=t?this.children.splice(t,0,e):this.children.push(e)},e.removeChild=function(e){-1==(t=this.children.indexOf(e))?RedGLUtil.throwFunc("removeChild","존재하지 않는 RedMesh를 삭제하려고 함"):this.children.splice(t,1)},e.removeChildAt=function(e){RedGLUtil.isUint(e,"removeChildAt : index는 uint만 입력가능"),this.children[e]?this.children.splice(e,1):RedGLUtil.throwFunc("removeChildAt","index 해당인덱스에 위치한 자식이 없음.","입력값 : "+e)},e.removeChildAll=function(){this.children.length=0},e.getChildAt=function(e){return RedGLUtil.isUint(e,"getChildAt : index는 uint만 입력가능"),this.children[e]},e.getChildIndex=function(e){return this.children.indexOf(e)},e.numChildren=function(){return this.children.length},e.sortGeometry=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortGeometry&&this.children[t].sortGeometry(e);this.children.sort(function(e,t){if(e._geometry&&t._geometry){if((e=e._geometry.interleaveBuffer._UUID)<(t=t._geometry.interleaveBuffer._UUID))return-1;if(e>t)return 1}return 0})},e.sortMaterial=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortMaterial&&this.children[t].sortMaterial(e);this.children.sort(function(e,t){if(e._geometry&&t._geometry){if((e=e._material.program._UUID)<(t=t._material.program._UUID))return-1;if(e>t)return 1}return 0})},e.sortGeometryAndMaterial=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortGeometryAndMaterial&&this.children[t].sortGeometryAndMaterial(e);this.children.sort(function(e,t){if(e._geometry&&t._geometry){if((e=e._geometry.interleaveBuffer._UUID)==(t=t._geometry.interleaveBuffer._UUID)){var r=e._material.program._UUID,i=t._material.program._UUID;return r<i?-1:r>i?1:0}if(e<t)return-1;if(e>t)return 1}return 0})},Object.freeze(RedBaseContainer)}(),function(){var e;(RedBaseLight=function(){if(!(this instanceof RedBaseLight))return new RedBaseLight}).prototype={},RedDefinePropertyInfo.definePrototypes("RedBaseLight",["intensity","number",{min:0}],["alpha","number",{min:0,max:1,callback:function(e){this._lightColor[3]=this._alpha=e}}],["color","hex",{callback:function(){e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._color),this._lightColor[0]=e[0],this._lightColor[1]=e[1],this._lightColor[2]=e[2],this._lightColor[3]=this._alpha}}]),Object.freeze(RedBaseLight)}(),(RedFrameBuffer=function(e,t,r){if(!(this instanceof RedFrameBuffer))return new RedFrameBuffer(e,t,r);var i;e instanceof RedGL||RedGLUtil.throwFunc("RedFrameBuffer : RedGL Instance만 허용.",e),t&&("number"==typeof t||RedGLUtil.throwFunc("RedFrameBuffer : width - 숫자만 허용","입력값 : ",t)),r&&("number"==typeof r||RedGLUtil.throwFunc("RedFrameBuffer : height - 숫자만 허용","입력값 : ",r)),i=e.gl,r=r||1080,(t=t||1920)>e.detect.texture.MAX_TEXTURE_SIZE&&(t=e.detect.texture.MAX_TEXTURE_SIZE),r>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),this.redGL=e,this.width=t,this.height=r,this.webglFrameBuffer=i.createFramebuffer(),this.webglRenderBuffer=i.createRenderbuffer(),this.texture=RedBitmapTexture(e),this._UUID=RedGL.makeUUID(),i.bindFramebuffer(i.FRAMEBUFFER,this.webglFrameBuffer),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.webglTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindRenderbuffer(i.RENDERBUFFER,this.webglRenderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,this.width,this.height),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture.webglTexture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.webglRenderBuffer),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}).prototype={bind:function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.webglFrameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture.webglTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindRenderbuffer(e.RENDERBUFFER,this.webglRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.webglTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.webglRenderBuffer)},unbind:function(e){e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}},RedDefinePropertyInfo.definePrototypes("RedFrameBuffer",["width","number",{min:2}],["height","number",{min:2}]),Object.freeze(RedFrameBuffer),function(){var e,t,r;e=function(e,t,r){switch(t){case RedBuffer.ARRAY_BUFFER:if(r instanceof Float32Array)return e.FLOAT;if(r instanceof Float64Array)return e.FLOAT;RedGLUtil.throwFunc("RedBuffer : 올바른 TypedArray(RedBuffer.ARRAY_BUFFER)형식을 사용해야합니다.","입력값 : "+r);break;case RedBuffer.ELEMENT_ARRAY_BUFFER:if(r instanceof Int8Array)return e.BYTE;if(r instanceof Int16Array)return e.SHORT;if(r instanceof Int32Array)return e.INT;if(r instanceof Uint8Array)return e.UNSIGNED_BYTE;if(r instanceof Uint16Array)return e.UNSIGNED_SHORT;if(r instanceof Uint32Array)return e.UNSIGNED_INT;RedGLUtil.throwFunc("RedBuffer : 올바른 TypedArray(RedBuffer.ELEMENT_ARRAY_BUFFER)형식을 사용해야합니다.","입력값 : "+r);break;default:RedGLUtil.throwFunc("RedBuffer : bufferType - 지원하지 않는 버퍼타입입니다. ","입력값 : "+t)}},t=function(e,t){switch(t){case RedBuffer.ARRAY_BUFFER:return e.ARRAY_BUFFER;case RedBuffer.ELEMENT_ARRAY_BUFFER:return e.ELEMENT_ARRAY_BUFFER;default:RedGLUtil.throwFunc("RedBuffer : bufferType - 지원하지 않는 버퍼타입입니다. ")}},r=function(e,t,r,i){var n,a,o,s,d;switch(r instanceof Float32Array?d=Float32Array.BYTES_PER_ELEMENT:r instanceof Float64Array&&(d=Float64Array.BYTES_PER_ELEMENT),n=0,t){case RedBuffer.ARRAY_BUFFER:if(e.interleaveDefineInfoList=i,i){for(i.length||RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList의 정보는 1개이상의 RedInterleaveInfo Instance로 구성되어야함.",i),a=0,o=i.length;a<o;a++)(s=i[a])instanceof RedInterleaveInfo||RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList의 정보는 RedInterleaveInfo Instance로만 구성되어야함.",i),s.offset=o<2?0:n,s.offset_BYTES_PER_ELEMENT=o<2?0:n*d,n+=s.size,s._UUID=RedGL.makeUUID(),i[s.attributeKey]=s;o<2?(e.stride=0,e.stride_BYTES_PER_ELEMENT=0,e.pointNum=r.length/3):(e.stride=n,e.stride_BYTES_PER_ELEMENT=n*d,e.pointNum=r.length/n),e.pointNum!==parseInt(e.pointNum)&&RedGLUtil.throwFunc("RedBuffer : ARRAY_BUFFER의 pointNum이 정수로 떨어지지 않음. 데이터구성과 interleaveDefineInfoList 구성 확인 필요")}else RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList는 반드시 정의 되어야함.");break;case RedBuffer.ELEMENT_ARRAY_BUFFER:e.pointNum=r.length}},(RedBuffer=function(i,n,a,o,s,d){if(!(this instanceof RedBuffer))return new RedBuffer(i,n,a,o,s,d);i instanceof RedGL||RedGLUtil.throwFunc("RedBuffer : RedGL Instance만 허용.",i),"string"==typeof n||RedGLUtil.throwFunc("RedBuffer : key - 문자열만 허용.","입력값 : "+n),a||RedGLUtil.throwFunc("RedBuffer : bufferType : 미입력, 반드시 입력해야함."),a===RedBuffer.ARRAY_BUFFER||a===RedBuffer.ELEMENT_ARRAY_BUFFER||RedGLUtil.throwFunc("RedBuffer : bufferType - RedBuffer.ARRAY_BUFFER or RedBuffer.ELEMENT_ARRAY_BUFFER 만 허용함.","입력값 : "+a);var u=i.gl;if(i._datas.RedBuffer||(i._datas.RedBuffer={},i._datas.RedBuffer[RedBuffer.ARRAY_BUFFER]={},i._datas.RedBuffer[RedBuffer.ELEMENT_ARRAY_BUFFER]={}),i._datas.RedBuffer[a][n])return i._datas.RedBuffer[a][n];i._datas.RedBuffer[a][n]=this,a!==RedBuffer.ARRAY_BUFFER||s||RedGLUtil.throwFunc("RedBuffer : 신규생성시 interleaveDefineInfoList를 반드시 정의해야합니다.","입력값 : "+s),this.key=n,this.data=o,this.bufferType=a,this.glBufferType=t(u,this.bufferType),this.glArrayType=e(u,this.bufferType,this.data),this.drawMode=d||u.STATIC_DRAW,r(this,this.bufferType,this.data,s),this.webglBuffer=u.createBuffer(),this.webglBuffer.gl=u,this.webglBuffer.redGL=i,this._UUID=RedGL.makeUUID(),this.upload=function(t){this.glArrayType===e(u,a,t)?(this.data=t,u.bindBuffer(this.glBufferType,this.webglBuffer),u.bufferData(this.glBufferType,this.data,this.drawMode),r(this,this.bufferType,this.data,this.interleaveDefineInfoList),this.bufferType===RedBuffer.ARRAY_BUFFER&&(this.triangleNum=this.data.length/(this.stride?this.stride:3)),this.bufferType===RedBuffer.ELEMENT_ARRAY_BUFFER&&(this.triangleNum=this.pointNum/3)):RedGLUtil.throwFunc("RedBuffer : upload - data형식이 기존 형식과 다름",t)},this.upload(this.data)}).prototype.dispose=function(){this.webglBuffer&&!this.isPrimitiveBuffer&&(this.webglBuffer.gl.deleteBuffer(this.webglBuffer),delete this.webglBuffer.redGL._datas.RedBuffer[this.bufferType][this.key],this.webglBuffer=null)},RedBuffer.ARRAY_BUFFER="arrayBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER="elementArrayBuffer",Object.freeze(RedBuffer)}(),function(){var e,t;(RedGeometry=function(e,t){if(!(this instanceof RedGeometry))return new RedGeometry(e,t);this._UUID=RedGL.makeUUID(),e instanceof RedBuffer||RedGLUtil.throwFunc("RedGeometry : interleaveBuffer - RedBuffer Instance만 허용.",e),e.bufferType===RedBuffer.ARRAY_BUFFER||RedGLUtil.throwFunc("RedGeometry : interleaveBuffer - RedBuffer.ARRAY_BUFFER 타입만 허용.",e),t&&(e||RedGLUtil.throwFunc("RedGeometry : indexBuffer는 반드시 interleaveBuffer와 쌍으로 입력되어야함.",t),t instanceof RedBuffer||RedGLUtil.throwFunc("RedGeometry : indexBuffer - RedBuffer Instance만 허용.",t),t.bufferType===RedBuffer.ELEMENT_ARRAY_BUFFER||RedGLUtil.throwFunc("RedGeometry : indexBuffer - RedBuffer.ELEMENT_ARRAY_BUFFER 타입만 허용.",t)),this.interleaveBuffer=e,this.indexBuffer=t,this._volume=null}).prototype={disposeAllBuffer:function(){for(e in this)t=this[e],this&&t instanceof RedBuffer&&t.dispose()},disposeBuffer:function(e){this&&this[e]instanceof RedBuffer&&this[e].dispose()},volumeCalculate:function(){var e,t,r,i,n,a,o,s,d,u,c,l,f=this.interleaveBuffer.stride;for(e=t=r=i=n=a=0,u=this.interleaveBuffer.data,c=0,l=this.interleaveBuffer.pointNum;c<l;c++)s=(o=c*f)+1,d=o+2,e=u[o]<e?u[o]:e,i=u[o]>i?u[o]:i,t=u[s]<t?u[s]:t,n=u[s]>n?u[s]:n,r=u[d]<r?u[d]:r,a=u[d]>a?u[d]:a;return this._volume=[i-e,n-t,a-r],this._volume.minX=e,this._volume.maxX=i,this._volume.minY=t,this._volume.maxY=n,this._volume.minZ=r,this._volume.maxZ=a,this._volume}},Object.defineProperty(RedGeometry.prototype,"volume",{get:function(){return this._volume||this.volumeCalculate(),this._volume}}),Object.freeze(RedGeometry)}(),RedInterleaveInfo=function(e,t,r){if(!(this instanceof RedInterleaveInfo))return new RedInterleaveInfo(e,t,r);"string"==typeof e||RedGLUtil.throwFunc("RedInterleaveInfo : attributeKey - 문자열만 허용",e),"a"===e.charAt(0)||RedGLUtil.throwFunc("RedInterleaveInfo : attributeKey 첫글자는 a로 시작해야합니다.",e),e.charAt(1)===e.charAt(1).toUpperCase()||RedInterleaveInfo.throwFunc("RedInterleaveInfo : attributeKey 두번째 글자는 대문자 시작해야합니다.",e),"number"==typeof t||RedGLUtil.throwFunc("RedInterleaveInfo : size - 숫자만 허용",t),this.attributeKey=e,this.size=t,this.normalize=void 0!==r,this.offset=null},Object.freeze(RedInterleaveInfo),function(){var e,t,r,i,n,a,o,s;(RedBaseMaterial=function(){}).prototype={makeProgramList:(s=["fog","sprite3D","skin","directionalShadow"],s.sort(),a=function(e,t,r,i,s,d,u){e.basic[t]||(e.basic[t]=new n(r,e,t,i,s)),d.forEach(function(c,l){d.sort(),u.sort();var f=d.join("_");e[f]||(e[f]={}),e[f][t]||(e[f][t]=new n(r,e,t,i,s,d));var h=d.concat();h.splice(l,1),o(e,f,t,r,i,s,d,u),a(e,t,r,i,s,h,u)})},o=function(e,t,r,i,a,o,s,d){function u(e,t){var r,i,n,a,o;if(t>e.length||t<=0)return[];if(t===e.length)return[e];if(1===t){for(n=[],r=0;r<e.length;r++)n.push([e[r]]);return n}for(n=[],r=0;r<e.length-t+1;r++)for(a=e.slice(r,r+1),o=u(e.slice(r+1),t-1),i=0;i<o.length;i++)n.push(a.concat(o[i]));return n}(function(e){var t,r,i,n;for(i=[],t=1;t<=e.length;t++)for(n=u(e,t),r=0;r<n.length;r++)i.push(n[r]);return i})(d=d||[]).forEach(function(d){var u=d.join("_");e.basic[r+"_"+u]||(e.basic[r+"_"+u]=new n(i,e,r,a,o,null,d)),e[t][r+"_"+u]||(e[t][r+"_"+u]=new n(i,e,r,a,o,s,d))})},n=function(e,t,r,i,n,a,o){0,o=o||[],this.optionList=o.concat(a||[]),this.systemKey=(a||["basic"]).join("_"),this.searchKey=r+(o.length?"_"+o.join("_"):""),this.key=r+(this.optionList.length?"_"+this.optionList.join("_"):""),this._prepareProgramYn=!0,this._makePrepareProgram=function(){return t[this.systemKey][this.searchKey]=RedProgram.makeProgram(e,r,i,n,this.optionList)}},function(e,t,r,i,n,o){o||(o=[]),t._datas.RedProgramGroup||(t._datas.RedProgramGroup={}),t._datas.RedProgramGroup[r]?e._programList=t._datas.RedProgramGroup[r]:(e._programList={basic:{}},a(e._programList,r,t,i,n,s,o),e._programList.basic[r]=RedProgram.makeProgram(t,r,i,n),t._datas.RedProgramGroup[r]=e._programList),e.program=e._programList.basic[r]}),_searchProgram:function(e,n){if(i=[],n)for(t=n.length;t--;)this[r=n[t]]&&i.push(r);i.length?(i.sort(),i=e+"_"+i.join("_")):i=e,this.program=this._programList.basic[i]},checkUniformAndProperty:function(){var e,t,r;return function(){for(this.program._prepareProgramYn&&(this.program=this.program._makePrepareProgram()),t=this.program.uniformLocation,e=t.length;e--;)r=t[e],!r.location||r.materialPropertyName in this||RedGLUtil.throwFunc(this.program.key+"- ",r.materialPropertyName,"속성이 정의 되지않았습니다.")}}(),disposeAllTexture:function(){for(e in this)this[e]instanceof RedBaseTexture&&this[e].dispose()},disposeTexture:function(e){this[e]instanceof RedBaseTexture&&this[e].dispose()}},Object.freeze(RedBaseMaterial)}(),RedTextureOptionChecker={check:function(e,t,r){var i;t&&((i=t.min)&&i!=r.LINEAR&&i!=r.NEAREST&&i!=r.NEAREST_MIPMAP_NEAREST&&i!=r.LINEAR_MIPMAP_NEAREST&&i!=r.NEAREST_MIPMAP_LINEAR&&i!=r.LINEAR_MIPMAP_LINEAR&&RedGLUtil.throwFunc(e+": min 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i),(i=t.mag)&&i!=r.LINEAR&&i!=r.NEAREST&&RedGLUtil.throwFunc(e+" : mag 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i),(i=t.wrap_s)&&i!=r.REPEAT&&i!=r.CLAMP_TO_EDGE&&i!=r.MIRRORED_REPEAT&&RedGLUtil.throwFunc(e+" : wrap_s 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i),(i=t.wrap_t)&&i!=r.REPEAT&&i!=r.CLAMP_TO_EDGE&&i!=r.MIRRORED_REPEAT&&RedGLUtil.throwFunc(e+" : wrap_t 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i))}},Object.freeze(RedTextureOptionChecker),function(){var e,t,r;t=function(e,t,r,i){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.min?i.min:e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i.mag?i.mag:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i.wrap_s?i.wrap_s:e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i.wrap_t?i.wrap_t:e.REPEAT),e.glExtension.EXT_texture_filter_anisotropic&&i.anisotropic&&e.texParameterf(e.TEXTURE_2D,e.glExtension.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.anisotropic);try{e.generateMipmap(e.TEXTURE_2D)}catch(e){}e.bindTexture(e.TEXTURE_2D,null)},e=function(e,i,n,a,o,s){if(o||(o={}),window.OffscreenCanvas&&a instanceof OffscreenCanvas||window.HTMLCanvasElement&&a instanceof HTMLCanvasElement){var d=RedGLUtil.makePowerOf2Source(e,a,r);t(e,n,d,o),s&&s.call(i,!0)}else RedImageLoader(a,function(){var a=RedGLUtil.makePowerOf2Source(e,this.source,r);t(e,n,a,o),s&&s.call(i,!0)},function(){s&&s.call(i,!1)})},(RedBitmapTexture=function(t,i,n,a){var o;if(!(this instanceof RedBitmapTexture))return new RedBitmapTexture(t,i,n,a);t instanceof RedGL||RedGLUtil.throwFunc("RedBitmapTexture : RedGL Instance만 허용.",t),a&&"function"==typeof a||!a||RedGLUtil.throwFunc("RedBitmapTexture : callback Function만 허용.",a),o=t.gl,r=t.detect.texture.MAX_TEXTURE_SIZE,n=n||{};var s=i+JSON.stringify(n);if("string"==typeof i&&(t._datas.textures||(t._datas.textures={}),t._datas.textures[s]))return a&&setTimeout(function(){a.call(this,!0)},1),t._datas.textures[s];this.webglTexture=o.createTexture(),this.webglTexture.gl=o,this._load=function(t){RedTextureOptionChecker.check("RedBitmapTexture",n,o),t&&this.setEmptyTexture(o,this.webglTexture),this._src&&e(o,this,this.webglTexture,this._src,this._option,this._callback)},this._option=n,this.callback=a,this.src=i,this._UUID=RedGL.makeUUID(),t._datas.textures[s]=this}).prototype=new RedBaseTexture,Object.defineProperty(RedBitmapTexture.prototype,"src",{get:function(){return this._src},set:function(e){if(window.OffscreenCanvas)return this._src=e,void this._load(!0);!e||"string"==typeof e||window.HTMLCanvasElement&&e instanceof HTMLCanvasElement||RedGLUtil.throwFunc("RedBitmapTexture : src는 문자열 or Canvas Element만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),Object.defineProperty(RedBitmapTexture.prototype,"option",{get:function(){return this._option},set:function(e){this._option=e,this._load(!1)}}),Object.freeze(RedBitmapTexture)}(),function(){var e,t;t=function(e,t,r){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null)},e=function(e,r,i,n,a){var o,s,d,u;d=function(e){e.removeEventListener("error",o),e.removeEventListener("canplaythrough",s)},o=function(){d(this),a&&a.call(r,!1)},s=function(){d(this),this.play(),r._videoDom.loaded=!0,t(e,i,this),a&&a.call(r,!0)},n instanceof HTMLVideoElement?u=n:(u=document.createElement("video")).src=n,u.loop=!0,u.muted=!0,u.setAttribute("autoplay",""),u.style.cssText="position:absolute;top:0px;left:0px;z-index:200",r._videoDom=u,r._videoDom.loaded=!1,u.addEventListener("error",o),u.addEventListener("canplaythrough",s)},(RedVideoTexture=function(t,r,i){var n;if(!(this instanceof RedVideoTexture))return new RedVideoTexture(t,r,i);t instanceof RedGL||RedGLUtil.throwFunc("RedVideoTexture : RedGL Instance만 허용.",t),n=t.gl,this.webglTexture=n.createTexture(),this.webglTexture.gl=n,this._UUID=RedGL.makeUUID(),this._load=function(t){t&&this.setEmptyTexture(n,this.webglTexture),this._src&&e(n,this,this.webglTexture,this._src,this._callback)},this.callback=i,this.src=r}).prototype=new RedBaseTexture,Object.defineProperty(RedVideoTexture.prototype,"src",{get:function(){return this._src},set:function(e){!e||"string"==typeof e||e instanceof HTMLVideoElement||RedGLUtil.throwFunc("RedVideoTexture : src는 문자열 or HTMLVideoElement만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),Object.freeze(RedVideoTexture)}(),(RedDDSTexture=function(e,t,r,i){var n;if(!(this instanceof RedDDSTexture))return new RedDDSTexture(e,t,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedDDSTexture : RedGL Instance만 허용.",e),(n=e.gl).glExtension.WEBGL_compressed_texture_s3tc||RedGLUtil.throwFunc("RedDDSTexture : WEBGL_compressed_texture_s3tc확장을 지원하지않는 하드웨어입니다."),this.webglTexture=n.createTexture(),this.webglTexture.gl=n,this._load=function(e){RedTextureOptionChecker.check("RedDDSTexture",r,n),e&&this.setEmptyTexture(n,this.webglTexture),this._src&&this.loadDDSTexture(n,n.glExtension.WEBGL_compressed_texture_s3tc,this._src,this._callback)},this.callback=i,this.src=t,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseTexture,Object.defineProperty(RedDDSTexture.prototype,"src",{get:function(){return this._src},set:function(e){e&&"string"!=typeof e&&RedGLUtil.throwFunc("RedDDSTexture : src는 문자열만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),function(e){"use strict";function t(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r=t("DXT1"),i=t("DXT3"),n=t("DXT5"),a=e.uploadDDSLevels=function(e,t,a,o){var s,d,u,c,l,f,h,R,m,p=new Int32Array(a,0,31);if(542327876!=p[0])return 0;if(4&!p[20])return 0;switch(p[21]){case r:s=8,d=t.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case i:s=16,d=t.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case n:s=16,d=t.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}for(R=1,131072&p[2]&&!1!==o&&(R=Math.max(1,p[7])),u=p[4],c=p[3],f=p[1]+4,m=0;m<R;++m)l=Math.max(4,u)/4*Math.max(4,c)/4*s,h=new Uint8Array(a,f,l),e.compressedTexImage2D(e.TEXTURE_2D,m,d,u,c,0,h),f+=l,u*=.5,c*=.5;return R};e.loadDDSTexture=function(e,t,r,i,n){var o=this.webglTexture,s=new XMLHttpRequest;return s.open("GET",r,!0),s.responseType="arraybuffer",i||(i={}),s.onload=function(){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,o);var r=a(e,t,this.response);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.min?i.min:r>1?e.LINEAR_MIPMAP_NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i.mag?i.mag:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),n&&n(!0)},s.onerror=function(){n&&n(!1)},s.send(null),o}}(RedDDSTexture.prototype),Object.freeze(RedDDSTexture),function(){var e;e=function(e,t,r,i,n,a){var o,s,d,u,c,l=[];for(n=n||{},o=function(){0===c&&a&&a.call(t,!1),c++},s=function(){if(6==++u){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,n.min?n.min:e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,n.mag?n.mag:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,n.wrap_s?n.wrap_s:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,n.wrap_t?n.wrap_t:e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[0].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[1].source),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[2].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[3].source),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[4].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l[5].source),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0);try{e.generateMipmap(e.TEXTURE_CUBE_MAP)}catch(e){}e.bindTexture(e.TEXTURE_CUBE_MAP,null),0===c&&a&&a.call(t,!0)}},d=6,u=0,c=0;d--;)l[d]=RedImageLoader(i[d],s,o,{})},(RedBitmapCubeTexture=function(t,r,i,n){var a;if(!(this instanceof RedBitmapCubeTexture))return new RedBitmapCubeTexture(t,r,i,n);t instanceof RedGL||RedGLUtil.throwFunc("RedBitmapCubeTexture : RedGL Instance만 허용.","입력값 : "+t),n&&"function"==typeof n||!n||RedGLUtil.throwFunc("RedBitmapCubeTexture : callback Function만 허용.",n),a=t.gl,i=i||{};var o=r.toString()+JSON.stringify(i);if(r instanceof Array&&(t._datas.textures||(t._datas.textures={}),t._datas.textures[o]))return n&&setTimeout(function(){n.call(this,!0)},1),t._datas.textures[o];this.webglTexture=a.createTexture(),this.webglTexture.gl=a,this._UUID=RedGL.makeUUID(),this._load=function(t){RedTextureOptionChecker.check("RedBitmapCubeTexture",i,a),t&&this.setEmptyTexture(a,this.webglTexture),this._srcList&&e(a,this,this.webglTexture,this._srcList,this._option,this._callback)},this._option=i,this.callback=n,this.srcList=r,t._datas.textures[o]=this}).prototype=new RedBaseTexture,Object.defineProperty(RedBitmapCubeTexture.prototype,"srcList",{get:function(){return this._srcList},set:function(e){e instanceof Array||RedGLUtil.throwFunc("RedBitmapCubeTexture : srcList는 배열만 허용.","입력값 : "+e),6===e.length||RedGLUtil.throwFunc("RedBitmapCubeTexture : srcList 길이는 6이어야함","입력값 : "+e),this._srcList=e,this._load(!0)}}),Object.defineProperty(RedBitmapCubeTexture.prototype,"option",{get:function(){return this._option},set:function(e){this._option=e,this._load(!1)}}),Object.freeze(RedBitmapCubeTexture)}(),function(){var e,t,r,i,n=[];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform vec4 u_color;
void main(void) {
vec4 finalColor = u_color;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedColorMaterial=function(i,a,o){if(!(this instanceof RedColorMaterial))return new RedColorMaterial(i,a,o);i instanceof RedGL||RedGLUtil.throwFunc("RedColorMaterial : RedGL Instance만 허용.","입력값 : "+i),this.makeProgramList(this,i,"RedColorMaterialProgram",e,t,n),this._color=new Float32Array(4),this.alpha=null==o?1:o,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedColorMaterial.DEFINE_OBJECT_COLOR={get:function(){return this._colorHex},set:function(e){this._colorHex=e||"#ff2211",i=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._colorHex),this._color[0]=i[0],this._color[1]=i[1],this._color[2]=i[2],this._color[3]=this._alpha}},RedColorMaterial.DEFINE_OBJECT_ALPHA={min:0,max:1,callback:function(e){this._color[3]=this._alpha=e}},Object.defineProperty(RedColorMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedColorMaterial","alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA),Object.freeze(RedColorMaterial)}(),function(){var e,t,r,i=["useFlatMode"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
uniform float u_shininess;
uniform float u_specularPower;
uniform vec4 u_color;
vec3 N;
vec4 texelColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
vec4 finalColor;
void main(void) {
texelColor = u_color;
N = normalize(vVertexNormal);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
finalColor.a = texelColor.a;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedColorPhongMaterialProgram",i)}};(RedColorPhongMaterial=function(n,a,o){if(!(this instanceof RedColorPhongMaterial))return new RedColorPhongMaterial(n,a,o);n instanceof RedGL||RedGLUtil.throwFunc("RedColorPhongMaterial : RedGL Instance만 허용.","입력값 : "+n),this.makeProgramList(this,n,"RedColorPhongMaterialProgram",e,t,i),this._color=new Float32Array(4),this.shininess=16,this.specularPower=1,this.alpha=null==o?1:o,this.useFlatMode=!1,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.defineProperty(RedColorPhongMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototypes("RedColorPhongMaterial",["alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA],["shininess","number",{min:0}],["specularPower","number",{min:0}],["useFlatMode","boolean",n]),Object.freeze(RedColorPhongMaterial)}(),function(){var e,t,r,i=["normalTexture","specularTexture","displacementTexture","emissiveTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform vec4 u_color;
vec4 texelColor;
vec4 emissiveColor;
vec4 finalColor;
vec3 N;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
void main(void) {
texelColor = u_color;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture# specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedColorPhongTextureMaterialProgram",i)}};(RedColorPhongTextureMaterial=function(n,a,o,s,d,u,c){if(!(this instanceof RedColorPhongTextureMaterial))return new RedColorPhongTextureMaterial(n,a,o,s,d,u,c);n instanceof RedGL||RedGLUtil.throwFunc("RedColorPhongTextureMaterial : RedGL Instance만 허용.","입력값 : "+n),this.makeProgramList(this,n,"RedColorPhongTextureMaterialProgram",e,t,i),this._color=new Float32Array(4),this.normalTexture=s,this.specularTexture=d,this.displacementTexture=u,this.emissiveTexture=c,this.normalPower=1,this.shininess=16,this.specularPower=1,this.emissiveFactor=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=null==o?1:o,this.color=a||"#ff0000",this.usePreMultiply=!1,this.useFlatMode=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.defineProperty(RedColorPhongTextureMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototypes("RedColorPhongTextureMaterial",["alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA],["normalTexture","sampler2D",n],["specularTexture","sampler2D",n],["displacementTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["normalPower","number",{min:0}],["shininess","number",{min:0}],["specularPower","number",{min:0}],["emissiveFactor","number",{min:0}],["displacementPower","number",{min:0}],["displacementFlowSpeedX","number"],["displacementFlowSpeedY","number"],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedColorPhongTextureMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","specularTexture","displacementTexture","emissiveTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform float u_reflectionPower;
uniform float u_alpha;
uniform bool u_useFlatMode;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec3 N;
float specularTextureValue;
vec4 finalColor;
void main(void) {
texelColor = vec4(0.0,0.0,0.0,0.0);
//#REDGL_DEFINE#diffuseTexture# texelColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#diffuseTexture# //#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
//#REDGL_DEFINE#diffuseTexture# if(texelColor.a ==0.0) discard;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
vec3 R = reflect( vVertexPosition.xyz - uCameraPosition, N);
reflectionColor = textureCube(u_environmentTexture, R);
texelColor = mix(texelColor, reflectionColor ,u_reflectionPower);
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture#  specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a * u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedEnvironmentMaterial=function(n,a,o,s,d,u,c){if(!(this instanceof RedEnvironmentMaterial))return new RedEnvironmentMaterial(n,a,o,s,d,u,c);n instanceof RedGL||RedGLUtil.throwFunc("RedEnvironmentMaterial : RedGL Instance만 허용.",n),o instanceof RedBitmapCubeTexture||RedGLUtil.throwFunc("RedEnvironmentMaterial : environmentTexture - RedBitmapCubeTexture Instance만 허용."),this.makeProgramList(this,n,"RedEnvironmentMaterialProgram",e,t,i),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.specularTexture=d,this.displacementTexture=u,this.emissiveTexture=c,this.normalPower=1,this.shininess=8,this.specularPower=1,this.emissiveFactor=1,this.reflectionPower=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=1,this.useFlatMode=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("RedEnvironmentMaterialProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedEnvironmentMaterial",["alpha","number",{min:0,max:1}],["diffuseTexture","sampler2D",n],["environmentTexture","samplerCube",{essential:!0,callback:n.callback}],["normalTexture","sampler2D",n],["specularTexture","sampler2D",n],["displacementTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["normalPower","number",{min:0}],["shininess","number",{min:0}],["specularPower","number",{min:0}],["emissiveFactor","number",{min:0}],["reflectionPower","number",{min:0}],["displacementPower","number",{min:0}],["displacementFlowSpeedX","number"],["displacementFlowSpeedY","number"],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedEnvironmentMaterial)}(),function(){var e,t,r,i=["usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedBitmapMaterial=function(n,a){if(!(this instanceof RedBitmapMaterial))return new RedBitmapMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedBitmapMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedBitmapMaterialProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("RedBitmapMaterialProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedBitmapMaterial",["diffuseTexture","sampler2D",{essential:!0}],["alpha","number",{min:0,max:1}],["usePreMultiply","boolean",n]),Object.freeze(RedBitmapMaterial)}(),function(){var e,t,r,i=["diffuseTexture","usePreMultiply"];e=function(){
/* @preserve
const mat4 cMode2D = mat4(
0.5, 0.0, 0.0, 0.0,
0.0, 0.5, 0.0, 0.0,
0.0, 0.0, 0.5, 0.0,
0.0, 0.0, 0.0, 1.0
);
void main(void) {
if(uMode2DYn){
gl_Position = uPMatrix * uCameraMatrix * cMode2D * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
vVertexColor = aVertexColor;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
uniform float u_cutOff;
uniform float u_alpha;
void main(void) {
vec4 finalColor = vVertexColor;
//#REDGL_DEFINE#diffuseTexture# finalColor = texture2D(u_diffuseTexture, gl_PointCoord.xy);
//#REDGL_DEFINE#diffuseTexture# //#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
//#REDGL_DEFINE#diffuseTexture# finalColor.rgb += vVertexColor.rgb * vVertexColor.a;
//#REDGL_DEFINE#diffuseTexture# finalColor.a *= vVertexColor.a;
finalColor.a *= u_alpha;
//#REDGL_DEFINE#diffuseTexture# if(finalColor.a < u_cutOff) discard;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("particleProgram",i)}};(RedParticleMaterial=function(n,a){if(!(this instanceof RedParticleMaterial))return new RedParticleMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedParticleMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"particleProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.cutOff=0,this.usePreMultiply=!0,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedParticleMaterial",["diffuseTexture","sampler2D",{callback:function(){this._searchProgram("particleProgram",i)}}],["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["usePreMultiply","boolean",n]),Object.freeze(RedParticleMaterial)}(),function(){var e,t,r,i=["usePreMultiply"];e=function(){
/* @preserve
void main(void) {
if(uMode2DYn){
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform sampler2D u_diffuseTexture;
uniform float u_cutOff;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, gl_PointCoord.xy);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a < u_cutOff) discard;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedBitmapPointCloudMaterial=function(n,a){if(!(this instanceof RedBitmapPointCloudMaterial))return new RedBitmapPointCloudMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedBitmapPointCloudMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"bitmapPointCloudProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.cutOff=.1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("bitmapPointCloudProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedBitmapPointCloudMaterial",["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["diffuseTexture","sampler2D",{essential:!0}],["usePreMultiply","boolean",n]),Object.freeze(RedBitmapPointCloudMaterial)}(),function(){var e,t,r,i=["usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
uniform vec4 u_sheetRect;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
vTexcoord = vec2(
vTexcoord.s * u_sheetRect.x + u_sheetRect.z,
vTexcoord.t * u_sheetRect.y - u_sheetRect.w
);
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a ==0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedSheetMaterialProgram",i)}};(RedSheetMaterial=function(n,a,o,s,d,u){if(!(this instanceof RedSheetMaterial))return new RedSheetMaterial(n,a,o,s,d,u);n instanceof RedGL||RedGLUtil.throwFunc("RedSheetMaterial : RedGL Instance만 허용.",n),o=o||60,s=s||1,d=d||1,u=u||1,this.makeProgramList(this,n,"RedSheetMaterialProgram",e,t,i),this.diffuseTexture=a,this._sheetRect=new Float32Array(4),this.alpha=1,this.usePreMultiply=!1,this._perFrameTime=0,this._nextFrameTime=0,this._playYn=!0,this.segmentW=s,this.segmentH=d,this.totalFrame=u,this.frameRate=o,this.currentIndex=0,this.loop=!0,this._aniMap={},this.__RedSheetMaterialYn=!0,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedSheetMaterial.prototype.addAction=function(e,t){this._aniMap[e]=t},RedSheetMaterial.prototype.setAction=function(e){this.diffuseTexture=this._aniMap[e].texture,this.segmentW=this._aniMap[e].segmentW,this.segmentH=this._aniMap[e].segmentH,this.totalFrame=this._aniMap[e].totalFrame,this.frameRate=this._aniMap[e].frameRate,this.currentIndex=0,this._nextFrameTime=0},RedSheetMaterial.prototype.play=function(){this._playYn=!0},RedSheetMaterial.prototype.stop=function(){this._playYn=!1,this.currentIndex=0},RedSheetMaterial.prototype.pause=function(){this._playYn=!1},RedSheetMaterial.prototype.gotoAndStop=function(e){e>this.totalFrame-1&&(e=this.totalFrame-1),e<0&&(e=0),this._playYn=!1,this.currentIndex=e},RedSheetMaterial.prototype.gotoAndPlay=function(e){e>this.totalFrame-1&&(e=this.totalFrame-1),e<0&&(e=0),this._playYn=!0,this.currentIndex=e,this._nextFrameTime=0},RedDefinePropertyInfo.definePrototypes("RedSheetMaterial",["diffuseTexture","sampler2D",{essential:!0}],["totalFrame","number",{min:1}],["loop","boolean"],["frameRate","number",{min:1,callback:function(){this._perFrameTime=1e3/this._frameRate}}],["segmentW","number",{min:1}],["segmentH","number",{min:1}],["alpha","number",{min:0,max:1}],["usePreMultiply","boolean",n]),Object.freeze(RedSheetMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","specularTexture","emissiveTexture","displacementTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform float u_alpha;
vec4 texelColor;
vec4 emissiveColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
vec4 finalColor;
vec3 N;
void main(void) {
texelColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
if(texelColor.a == 0.0) discard;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture# specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a * u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedStandardMaterialProgram",i)}};(RedStandardMaterial=function(n,a,o,s,d,u){if(!(this instanceof RedStandardMaterial))return new RedStandardMaterial(n,a,o,s,d,u);n instanceof RedGL||RedGLUtil.throwFunc("RedStandardMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedStandardMaterialProgram",e,t,i),this.diffuseTexture=a,this.normalTexture=o,this.specularTexture=s,this.emissiveTexture=u,this.displacementTexture=d,this.normalPower=1,this.shininess=16,this.specularPower=1,this.emissiveFactor=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=1,this._UUID=RedGL.makeUUID(),this.useFlatMode=!1,this.usePreMultiply=!1,r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedStandardMaterial",["alpha","number",{min:0,max:1}],["diffuseTexture","sampler2D",{essential:!0,callback:n.callback}],["normalTexture","sampler2D",n],["specularTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["displacementTexture","sampler2D",n],["normalPower","number",{min:0}],["shininess","number",{min:0}],["specularPower","number",{min:0}],["emissiveFactor","number",{min:0}],["displacementPower","number",{min:0}],["displacementFlowSpeedX","number"],["displacementFlowSpeedY","number"],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedStandardMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_videoTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_videoTexture, vTexcoord);
if(finalColor.a ==0.0) discard;
finalColor.a = u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedVideoMaterial=function(i,n){if(!(this instanceof RedVideoMaterial))return new RedVideoMaterial(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedVideoMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedVideoMaterialProgram",e,t),this.videoTexture=n,this.alpha=1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedVideoMaterial",["alpha","number",{min:0,max:1}],["videoTexture","samplerVideo",{essential:!0}]),Object.freeze(RedVideoMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","environmentTexture","occlusionTexture","emissiveTexture","roughnessTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
uniform vec4 uBaseColorFactor;
uniform float u_emissiveFactor;
uniform float u_cutOff;
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#occlusionTexture# uniform sampler2D u_occlusionTexture;
//#REDGL_DEFINE#environmentTexture# uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#roughnessTexture# uniform sampler2D u_roughnessTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_specularPower;
uniform float u_metallicFactor;
uniform float u_roughnessFactor;
uniform float u_occlusionPower;
uniform float u_alpha;
vec4 la;
vec4 ld;
vec4 ls;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 roughnessColor;
vec4 occlusionColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec4 finalColor;
vec3 N;
vec3 L;
float lambertTerm;
float specular;
float specularTextureValue;
float distanceLength;
float attenuation;
void main(void) {
la = uAmbientLightColor * uAmbientLightColor.a;
ld = vec4(0.0, 0.0, 0.0, 1.0);
ls = vec4(0.0, 0.0, 0.0, 1.0);
float tMetallicPower = u_metallicFactor;
float tRoughnessPower = u_roughnessFactor;
//#REDGL_DEFINE#roughnessTexture# roughnessColor = texture2D(u_roughnessTexture, vTexcoord);
//#REDGL_DEFINE#roughnessTexture# tMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b
//#REDGL_DEFINE#roughnessTexture# tRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g
texelColor = uBaseColorFactor;
//#REDGL_DEFINE#diffuseTexture# texelColor *= texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
if(texelColor.a <= u_cutOff) discard;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
vec3 R = reflect( vVertexPosition.xyz-uCameraPosition, N);
//#REDGL_DEFINE#environmentTexture# reflectionColor = textureCube(u_environmentTexture, R);
//#REDGL_DEFINE#environmentTexture# reflectionColor.rgb *= reflectionColor.a;
//#REDGL_DEFINE#environmentTexture# texelColor.rgb = mix( texelColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.0)*(1.0-tRoughnessPower));
//#REDGL_DEFINE#environmentTexture# texelColor = mix( texelColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);
float shininess = 128.0 ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue =  1.0 ;
for(int i=0; i<cDIRETIONAL_MAX; i++){
if(i == uDirectionalLightNum) break;
L = normalize(-uDirectionalLightPositionList[i]);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;
specular = pow( max(dot(reflect(L, N), -L), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * u_specularPower * specularTextureValue * uDirectionalLightIntensityList[i]* uDirectionalLightColorList[i].a * (1.0-tRoughnessPower+0.04);
}
}
for(int i=0;i<cPOINT_MAX;i++){
if(i== uPointLightNum) break;
L =  -uPointLightPositionList[i] + vVertexPosition.xyz;
distanceLength = abs(length(L));
if(uPointLightRadiusList[i]> distanceLength){
attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;
L = normalize(L);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;
specular = pow( max(dot(reflect(L, N), -N), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * uPointLightIntensityList[i]  * uPointLightColorList[i].a * (1.0-tRoughnessPower+0.04) ;
}
}
}
finalColor = la * uAmbientIntensity + ld + ls;
finalColor.a = texelColor.a * u_alpha ;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= emissiveColor.a * u_emissiveFactor;
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= u_emissiveFactor;
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb;
//#REDGL_DEFINE#occlusionTexture# occlusionColor = texture2D(u_occlusionTexture, vTexcoord);
//#REDGL_DEFINE#occlusionTexture# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * u_occlusionPower);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedPBRMaterial=function(n,a,o,s,d,u,c){if(!(this instanceof RedPBRMaterial))return new RedPBRMaterial(n,a,o,s,d,u,c);n instanceof RedGL||RedGLUtil.throwFunc("RedPBRMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedPBRMaterialProgram",e,t,i),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.occlusionTexture=d,this.emissiveTexture=u,this.roughnessTexture=c,this.normalPower=1,this.specularPower=1,this.occlusionPower=1,this.metallicFactor=1,this.roughnessFactor=.1,this.baseColorFactor=[1,1,1,1],this.emissiveFactor=1,this.alpha=1,this.cutOff=0,this.useFlatMode=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("RedPBRMaterialProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedPBRMaterial",["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["diffuseTexture","sampler2D",n],["environmentTexture","samplerCube",{callback:n.callback}],["normalTexture","sampler2D",n],["occlusionTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["roughnessTexture","sampler2D",n],["normalPower","number",{min:0}],["specularPower","number",{min:0}],["metallicFactor","number",{min:0,max:1}],["emissiveFactor","number",{min:0,max:1}],["roughnessFactor","number",{min:0,max:1}],["occlusionPower","number",{min:0}],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedPBRMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vVertexColor = aVertexColor;
if(uMode2DYn){
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform float u_alpha;
void main(void) {
vec4 finalColor = vVertexColor;
finalColor.a *= u_alpha;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedColorPointCloudMaterial=function(i){if(!(this instanceof RedColorPointCloudMaterial))return new RedColorPointCloudMaterial(i);i instanceof RedGL||RedGLUtil.throwFunc("RedColorPointCloudMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"colorPointCloudProgram",e,t),this.alpha=1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedColorPointCloudMaterial","alpha","number",{min:0,max:1}),Object.freeze(RedColorPointCloudMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","environmentTexture","occlusionTexture","emissiveTexture","roughnessTexture","useFlatMode","useMaterialDoubleSide","useVertexTangent","useVertexColor_0","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#useVertexColor_0# attribute vec4 aVertexColor_0;
//#REDGL_DEFINE#useVertexColor_0# varying vec4 vVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# attribute vec4 aVertexTangent;
//#REDGL_DEFINE#useVertexTangent# varying vec4 vVertexTangent;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
vTexcoord1 = aTexcoord1;
//#REDGL_DEFINE#useVertexColor_0# vVertexColor_0 = aVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# vVertexTangent = aVertexTangent;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#useVertexColor_0# varying vec4 vVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# varying vec4 vVertexTangent;
uniform vec4 uBaseColorFactor;
uniform vec3 uEmissiveFactor;
uniform float u_cutOff;
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#occlusionTexture# uniform sampler2D u_occlusionTexture;
//#REDGL_DEFINE#environmentTexture# uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#roughnessTexture# uniform sampler2D u_roughnessTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_specularPower;
uniform float u_metallicFactor;
uniform float u_roughnessFactor;
uniform float u_occlusionPower;
uniform float u_alpha;
uniform int u_diffuseTexCoordIndex;
uniform int u_occlusionTexCoordIndex;
uniform int u_emissiveTexCoordIndex;
uniform int u_roughnessTexCoordIndex;
uniform int u_normalTexCoordIndex;
vec4 la;
vec4 ld;
vec4 ls;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 roughnessColor;
vec4 occlusionColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec4 finalColor;
vec3 N;
vec3 L;
float lambertTerm;
float specular;
float specularTextureValue;
float distanceLength;
float attenuation;
vec2 u_diffuseTexCoord ;
vec2 u_occlusionTexCoord;
vec2 u_emissiveTexCoord;
vec2 u_roughnessTexCoord;
vec2 u_normalTexCoord;
void main(void) {
la = uAmbientLightColor * uAmbientLightColor.a;
ld = vec4(0.0, 0.0, 0.0, 1.0);
ls = vec4(0.0, 0.0, 0.0, 1.0);
u_diffuseTexCoord = u_diffuseTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_normalTexCoord = u_normalTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_occlusionTexCoord = u_occlusionTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_emissiveTexCoord = u_emissiveTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_roughnessTexCoord  = u_roughnessTexCoordIndex==0 ? vTexcoord : vTexcoord1;
float tMetallicPower = u_metallicFactor;
float tRoughnessPower = u_roughnessFactor;
//#REDGL_DEFINE#roughnessTexture# roughnessColor = texture2D(u_roughnessTexture, u_roughnessTexCoord);
//#REDGL_DEFINE#roughnessTexture# tMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b
//#REDGL_DEFINE#roughnessTexture# tRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g
texelColor = uBaseColorFactor;
//#REDGL_DEFINE#useVertexColor_0# texelColor *= clamp(vVertexColor_0,0.0,1.0) ;
//#REDGL_DEFINE#diffuseTexture# texelColor *= texture2D(u_diffuseTexture, u_diffuseTexCoord);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#diffuseTexture# texelColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 fdx = dFdx(vVertexPosition.xyz);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 fdy = dFdy(vVertexPosition.xyz);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 faceNormal = normalize(cross(fdx,fdy));
bool backFaceYn = false;
//#REDGL_DEFINE#useMaterialDoubleSide# if (dot (vVertexNormal, faceNormal) < 0.0) { N = -N; backFaceYn = true; };
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, u_normalTexCoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, backFaceYn ?  1.0 - u_normalTexCoord : u_normalTexCoord, vec3(normalColor.r, 1.0- normalColor.g, normalColor.b) );
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 pos_dx = dFdx(vVertexPosition.xyz);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 pos_dy = dFdy(vVertexPosition.xyz);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 tex_dx = dFdx(vec3(u_normalTexCoord, 0.0));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 tex_dy = dFdy(vec3(u_normalTexCoord, 0.0));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 ng = normalize(vVertexNormal);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# t = normalize(t - ng * dot(ng, t));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 b = normalize(cross(ng, t));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# mat3 tbn = mat3(t, b, ng);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# N = normalize(tbn * ((2.0 * normalColor.rgb - 1.0) * vec3(1.0, 1.0 * vVertexTangent.w,1.0)));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# N = backFaceYn ? -N : N;
vec3 R = reflect( vVertexPosition.xyz-uCameraPosition, N);
//#REDGL_DEFINE#environmentTexture# reflectionColor = textureCube(u_environmentTexture, R);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#environmentTexture# reflectionColor.rgb *= reflectionColor.a;
//#REDGL_DEFINE#environmentTexture# texelColor.rgb = mix( texelColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.0)*(1.0-tRoughnessPower));
//#REDGL_DEFINE#environmentTexture# texelColor = mix( texelColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);
if(texelColor.a <= u_cutOff) discard;
float shininess = 128.0 ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue =  1.0 ;
for(int i=0; i<cDIRETIONAL_MAX; i++){
if(i == uDirectionalLightNum) break;
L = normalize(-uDirectionalLightPositionList[i]);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;
specular = pow( max(dot(reflect(L, N), -L), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * u_specularPower * specularTextureValue * uDirectionalLightIntensityList[i]* uDirectionalLightColorList[i].a * (1.0-tRoughnessPower+0.04);
}
}
for(int i=0;i<cPOINT_MAX;i++){
if(i== uPointLightNum) break;
L =  -uPointLightPositionList[i] + vVertexPosition.xyz;
distanceLength = abs(length(L));
if(uPointLightRadiusList[i]> distanceLength){
attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;
L = normalize(L);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;
specular = pow( max(dot(reflect(L, N), -N), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * uPointLightIntensityList[i]  * uPointLightColorList[i].a * (1.0-tRoughnessPower+0.04) ;
}
}
}
finalColor = la * uAmbientIntensity + ld + ls;
finalColor.a = texelColor.a * u_alpha ;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, u_emissiveTexCoord);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= emissiveColor.a;
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= uEmissiveFactor;
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb;
//#REDGL_DEFINE#occlusionTexture# occlusionColor = texture2D(u_occlusionTexture, u_occlusionTexCoord);
//#REDGL_DEFINE#occlusionTexture# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * u_occlusionPower);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedPBRMaterial_System=function(n,a,o,s,d,u,c){if(!(this instanceof RedPBRMaterial_System))return new RedPBRMaterial_System(n,a,o,s,d,u,c);n instanceof RedGL||RedGLUtil.throwFunc("RedPBRMaterial_System : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedPBRMaterialSystemProgram",RedGLUtil.getStrFromComment(e.toString()),RedGLUtil.getStrFromComment(t.toString()),i),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.occlusionTexture=d,this.emissiveTexture=u,this.roughnessTexture=c,this.normalPower=1,this.specularPower=1,this.metallicFactor=1,this.roughnessFactor=1,this.diffuseTexCoordIndex=0,this.occlusionTexCoordIndex=0,this.emissiveTexCoordIndex=0,this.roughnessTexCoordIndex=0,this.normalTexCoordIndex=0,this.occlusionPower=1,this.baseColorFactor=null,this.emissiveFactor=null,this.alpha=1,this.cutOff=0,this.useMaterialDoubleSide=!1,this.useVertexColor_0=!1,this.useFlatMode=!1,this.useVertexTangent=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0),this._needSearchProgram=null}).prototype=new RedBaseMaterial;var n={callback:function(){var e=this;cancelAnimationFrame(this._needSearchProgram),this._needSearchProgram=requestAnimationFrame(function(){e._searchProgram("RedPBRMaterialSystemProgram",i),e._needSearchProgram=null})}};RedDefinePropertyInfo.definePrototypes("RedPBRMaterial_System",["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["diffuseTexture","sampler2D",n],["diffuseTexCoordIndex","number"],["environmentTexture","samplerCube",{callback:n.callback}],["normalTexture","sampler2D",n],["normalTexCoordIndex","number"],["occlusionTexture","sampler2D",n],["occlusionTexCoordIndex","number"],["emissiveTexture","sampler2D",n],["emissiveTexCoordIndex","number"],["roughnessTexture","sampler2D",n],["roughnessTexCoordIndex","number"],["normalPower","number",{min:0}],["specularPower","number",{min:0}],["metallicFactor","number",{min:0,max:1}],["roughnessFactor","number",{min:0,max:1}],["occlusionPower","number",{min:0}],["useFlatMode","boolean",n],["useMaterialDoubleSide","boolean",n],["useVertexColor_0","boolean",n],["useVertexTangent","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedPBRMaterial_System)}(),function(){var e,t,r,i=[];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
uniform float u_width;
uniform float u_height;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
mat4 targetMatrix;
if(uMode2DYn){
targetMatrix = uMMatrix * mat4(
u_width, 0.0, 0.0, 0.0,
0.0, u_height, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0
) ;
gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}else{
targetMatrix = uMMatrix * mat4(
u_width/uResolution.y, 0.0, 0.0, 0.0,
0.0, u_height/uResolution.y, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0
) ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
finalColor.a *= u_alpha;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedTextMaterial=function(n,a){if(!(this instanceof RedTextMaterial))return new RedTextMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedTextMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedTextMaterialProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.width=2,this.height=2,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedTextMaterial",["diffuseTexture","sampler2D",{essential:!0}],["alpha","number",{min:0,max:1}],["width","number",{min:2,callback:function(e){this._width=e}}],["height","number",{min:2,callback:function(e){this._height=e}}]),Object.freeze(RedTextMaterial)}(),(RedAmbientLight=function(e,t,r,i){if(!(this instanceof RedAmbientLight))return new RedAmbientLight(e,t,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedAmbientLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=null==i?1:i,this.alpha=null==r?.1:r,this.color=t||"#fff",this._UUID=RedGL.makeUUID()}).TYPE="RedAmbientLight",RedAmbientLight.prototype=new RedBaseLight,Object.defineProperty(RedAmbientLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedAmbientLight.TYPE}),Object.freeze(RedAmbientLight),(RedDirectionalLight=function(e,t,r,i){if(!(this instanceof RedDirectionalLight))return new RedDirectionalLight(e,t,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=null==i?1:i,this.alpha=null==r?1:r,this.color=t||"#fff",this.x=0,this.y=-1,this.z=0,this._UUID=RedGL.makeUUID(),this.debug=!1,this._debugObject=RedSprite3D(e,RedBitmapMaterial(e,RedBitmapTexture(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA25pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozQjcyMEREMTUyMDYxMUU4OTRDNTgzQTBBMEY2MkFFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDODA1NTI0RjUyMDYxMUU4QkVBQTg3NjZCN0M1OUI2OCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDODA1NTI0RTUyMDYxMUU4QkVBQTg3NjZCN0M1OUI2OCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cykiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNmFjYmZjZi05YjBkLThlNGItODZiNy1kNWViYWNjZDg4OGMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6M0I3MjBERDE1MjA2MTFFODk0QzU4M0EwQTBGNjJBRTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4vVcpuAAAHNUlEQVR42uxbeWyURRT/tiw9OAJYUekfeBCFNmqlkAgRtURQaTywWIhGSfDAAzmkggcoKopKRQXFKKZqNGmkqGAkGEQFhaQenGrAI3iUpKilaiPSytKt74XfF6evM/vN7n67+xn6kl/Sb3bmvTdvZt68eTMNtbe3O8cyhboM0GWALgN0LKkJpUv2lYQFBFbgYcI7aZF6bcf+ZmXI8L0IlYShhBLCbELPTCiSKQOcTRimfA8nFP/fDTCEMJrQw2bpEVqV71ZLXXpARmHQDDCZ8DnhI8IrFkZoI0SVb/77iEXnX4WMzyAzEAbIJSwk9Mb3RMKMFMzWmYQK/N0bMnODYAB2q42i7B5CkY+dZ153i7JGyM64Af4hVIk13cdjFoQsy1yaAZ6qz6iC7ED4gJWEjaLsRkKpoX53MX1zUaajUvBSaSNkBmoXuI/QonyHCXMIeZq6PxJ+Vb5/I/ykqZcHHmGljGXcG8RtcCfhRVFWpjgulfahEzvQjn1GvaZeBXio9AJhV1ADoUcITaJsmKHuKvxWgr91NFx8N0FG2gOhbpb1WMGbxXRd6SE/lg61wrneRPjdT51tDkOTELe3YvrVWPC9CnH+h4SPlfKLCKMQChco/oEN1UD4krAF7Vy6EO14uay2kH0N4XZCDmFJpwEQhyEvAwxF1OV66MOEd8G4znIkuJNTCNcjhO3jUb+ZsIfwOqLKFks5IzFQlxOyURYhnAvjJXQa7Cu2J2Y8gbCBsJhwskf7SzCizxJGWHTejSFGoM0W8IhFA6HLBuiWLbbbvsn4gJ2GKd8T29NWeGodHx6NdXByWQn6pxLwqDT8XgEd5hiO0zXog5HCHkr8QbiO8AMOHwPF78fDUZWL9cmeep6B527CNsK3hAMKn8HYFYo0HX2S0I8wXyRUag0y6nFwWuBl5bDFSPCiuR/WvItwg6bO+YoB7jR0fjthBXxIg0FWAdbwVIy+SvOwyzytyNTRyzDYnlSlxEYh6hunePCLsV75t82aNrx7PCiiv1h0IurfajC2K+t9ZSd5j7AIv1mnxBLNCXJK61KMEiuxCdvOds0U5o48lGCcsgDt5RIqwUGoFMbfAQMcjDcn6GdSlPfe5aJsKWFWksHaM8gFqDSN8HxC3FKUFM3CulXpa2xPydJi8FJpql+6+2WACwiDNCPX4APvBvBSaRBkBsYAY+AXXOItbo2PZ5Y14Kn6oDF+MA7HyPMVI5I6IrI2XPY9Yb9SfpZoX6c5FSZDTeA5OIZM3jnOgL7t4lDUhiN0i40BLkNkVYjGUc0pqxGxQS1m0QBR5xvHf5I8B0A268eJWL5d6q/RNwSD7EYaba2XAZZrIj5J/bA9rYbFszUj5jdJntnoWHfoMtjCT50iDZCpm6HAkG4GTMMSKFKmjzRaI6wewfdhUSc/BbpKnoehXwS6LMQSaNPo24bQuMrGAGuRkChWHIi6nrjNd0pYGxUOkWlICgwgee5X1nstQvDTYZB20ccInGCr7S7A3vLTOJT7inCFSE7k++gL8sFTypQG2Z+pOOADEYezQxrv4+iPF07uIGQGJhD6hLBXlM3C8TZZKtCcJ/ZCZmAMEMVZX6UzCXN94D0XvFRaodnv02qAXkhHLXL+u/6qRrCh0kybrIzHcXim5jhcjb9LocPVIhS3pmM+IRLPDCiE5TcrnXegQDn+ZuGzNW25I5zcvMXDLxSgzjpD52crHSx3Ot47joNu1U4cL0hsZkAIcfbkGCFyKpOiLj3qdEyK8uXL24a65qRonBkhjvmf42YGQQeQCXpL45QqkcxI1tFG4QiXaPzXBJxd+hvaciL3DudodjuhJXCOofN/I6zky8tVBo/MCvPN7vYEPXYUbcs0nXd/XwUdqqBTp/FGHxLeBf5EGOkSJyLfJIzFqPzs0X49nNV0RJbNFh1vRt3paLveo349dBmLmaieSyLoQ1I+QL0c5UTkGxad4PVZgmjNj8vRMfAbNlkmvhy9DUmdpC9H1ZliO41V59SKkTFtTe4Vdpvh9/NgxFyFt22qrZuWb4LboG3n+dDykkitTfTgG4v3JKfjW6LqOI7abekMhV2ar1Fwq6FuBZzcNkf/jEbX9jixFSZNfl6McP6gTgQn6xCmymQkxxP80us05XDDT2D3iXp5cLpl4qg+0kn0nVAKX4s/Jjp/BNuT7oED5+ZOEKHvqYa8RJXTMTOdB1m+kF8GmIQRdMR63WSoH3E6P5aOGOpuUg4/Lo2GzEAYIAc5xFyxly+L0abdssylZSKGyIXMnCAYIKQJRZ/QHI2TIeb1uCjr74f+fhiApy9fkvyFbw5Plzr+E88C90UIy3rAsX9AZaSwT8q9RviCcJJz9FXZIQu5WWIgvN71Mc8pyC384li+AEmXARwoZKtU1On8WNrm6fshp/Oj7EDsAvHSLhHkbMM5IO0UzpAB+Oj6FPJ4IRxaDmZCka5/nOwyQJcBjm0D/CvAAF/S81D+EWScAAAAAElFTkSuQmCC")))}).TYPE="RedDirectionalLight",RedDirectionalLight.prototype=new RedBaseLight,Object.defineProperty(RedDirectionalLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedDirectionalLight.TYPE}),Object.freeze(RedDirectionalLight),(RedPointLight=function(e,t,r,i,n){if(!(this instanceof RedPointLight))return new RedPointLight(e,t,r,i,n);e instanceof RedGL||RedGLUtil.throwFunc("RedPointLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=null==n?1:n,this.alpha=null==r?1:r,this.radius=null==i?1:i,this.color=t||"#fff",this.x=0,this.y=0,this.z=0,this.radius=1,this.debug=!1,this._debugObject=RedMesh(e,RedSphere(e,1,16,16,16),RedColorMaterial(e)),this._debugObject.drawMode=e.gl.LINE_STRIP,this._UUID=RedGL.makeUUID()}).TYPE="RedPointLight",RedPointLight.prototype=new RedBaseLight,Object.defineProperty(RedPointLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedPointLight.TYPE}),RedDefinePropertyInfo.definePrototype("RedPointLight","radius","number",{min:0}),Object.freeze(RedPointLight),function(){var e,t;t=function(){},RedMTLLoader=function(r,i,n,a){if(!(this instanceof RedMTLLoader))return new RedMTLLoader(r,i,n,a);var o=this,s=new XMLHttpRequest;s.open("GET",i+n,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.onreadystatechange=function(){if(4==s.readyState){var i;if(o.complete=!0,200==s.status)i=e(o,r,s.responseText),o.parseData=i;else o.parseData=new t;a&&a(o.parseData)}},s.addEventListener("error",function(e){}),s.send(),this.path=i,this.fileName=n,this.complete=!1,this.parseData=null},e=function(e,r,i){var n,a,o,s,d,u,c,l,f,h,R,m,p,_;for(var g in n={},o=/^(newmtl )/,s=/^(Ns )/,d=/^(Ka )/,u=/^(Kd )/,c=/^(Ks )/,l=/^(Ni )/,f=/^(d )/,h=/^(illum )/,R=/^(map_Kd )/,/^(map_Ks )/,m=/^(map_Ns )/,p=/^(map_bump )/,(i=i.replace(/^\#[\s\S]+?\n/g,"")).split("\n").forEach(function(t){var r;o.test(t)?(r=t.replace("newmtl ","").trim(),_={name:r},n[r]=_):d.test(t)?_.Ka=t.replace("Ka ","").split(" "):u.test(t)?_.Kd=t.replace("Kd ","").split(" "):c.test(t)?_.Ks=t.replace("Ks ","").split(" "):s.test(t)?_.Ns=+t.replace("Ns ",""):l.test(t)?_.Ni=+t.replace("Ni ",""):f.test(t)?_.d=+t.replace("d ",""):h.test(t)?(_.illum=+t.replace("illum ",""),_.illum):R.test(t)?_.map_Kd=e.path+t.replace("map_Kd ",""):m.test(t)?_.map_Ns=e.path+t.replace("map_Ns ",""):p.test(t)&&(_.map_bump=e.path+t.replace("map_bump ","").split(" ")[2])}),a=new t,n)a[g]=n[g];return a},Object.freeze(RedMTLLoader)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R;RedOBJLoader=function(t,r,i,n){if(!(this instanceof RedOBJLoader))return new RedOBJLoader(t,r,i,n);var a=this,o=new XMLHttpRequest;o.open("GET",r+i,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){4===o.readyState&&(a.result=e(a,t,o.responseText),a.modelParsingComplete=!0,a.resultMesh=void 0,n&&(a.mtlLoader?a.mtlLoader.complete&&n(a.result):n(a.result)))},o.send(),this.path=r,this.fileName=i,this.mtlLoader=null,this.modelParsingComplete=!1,this.callback=n,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedOBJLoader_"+RedGL.makeUUID(),this.result=null},r=function(e,t,r){var i,n,a,o;for(i in o={},t){var s,d,u,c,l,f;if((a=t[i]).mesh,a.use&&a.resultInterleave.length)f=a.ableLight,(n=r.parseData[a.materialKey])&&(n.map_Kd?(o[n.map_Kd]?d=o[n.map_Kd]:(d=RedBitmapTexture(e,n.map_Kd),o[n.map_Kd]=d),s=f?RedStandardMaterial(e,d):RedBitmapMaterial(e,d)):n.Kd&&(u=255*n.Kd[0],c=255*n.Kd[1],l=255*n.Kd[2],s=f?RedColorPhongTextureMaterial(e,RedGLUtil.rgb2hex(u,c,l)):a.ableNormal?RedColorPhongMaterial(e,RedGLUtil.rgb2hex(u,c,l)):RedColorMaterial(e,RedGLUtil.rgb2hex(u,c,l))),s&&(n.map_Ns&&(o[n.map_Ns]?d=o[n.map_Ns]:(d=RedBitmapTexture(e,n.map_Ns),o[n.map_Ns]=d),s.specularTexture=d),n.map_bump&&(o[n.map_bump]?d=o[n.map_bump]:(d=RedBitmapTexture(e,n.map_bump),o[n.map_bump]=d),s.normalTexture=d),void 0!==n.Ns&&(s.shininess=n.Ns),a.mesh.material=s))}},t=function(e,r,i){for(var n in i){var a,o;if((a=i[n]).use){var s,d,u,c=[];a.resultPosition.length&&c.push(RedInterleaveInfo("aVertexPosition",3)),a.resultNormal.length&&c.push(RedInterleaveInfo("aVertexNormal",3)),a.resultUV.length&&c.push(RedInterleaveInfo("aTexcoord",2)),s=RedBuffer(e,n+"_interleave",RedBuffer.ARRAY_BUFFER,new Float32Array(a.resultInterleave.length?a.resultInterleave:a.resultPosition),c),a.index.length&&a.index.length&&(d=RedBuffer(e,n+"_index",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.index))),u=a.resultUV.length&&a.resultNormal.length?RedColorPhongTextureMaterial(e,"#00ff00"):a.resultNormal?RedColorPhongMaterial(e,"#00ff00"):RedColorMaterial(e,"#0000ff"),o=RedMesh(e,RedGeometry(s,d),u),a.ableUV=!!a.resultUV.length,a.ableNormal=!!a.resultNormal.length,a.ableLight=!!(a.ableUV&a.ableNormal)}else o=RedMesh(e);o.name=n,a.mesh=o,r.addChild(o),t(e,o,a.childrenInfo)}},h=/^(mtllib )/,R=/^(usemtl )/,n=/^o /,a=/^g /,o=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,s=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,d=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,u=/f\s+(([\d]{1,}[\s]?){3,})+/,c=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,l=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,f=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,i=function(e,t,i){var m,p,_,g,v,E,M,b,L,P;for(_={position:[],normal:[],uv:[],points:[],normalPoints:[],uvPoints:[]},p={},m={},M=i.length;M--;)if(n.test(i[M])){b=!0;break}return b||(P={name:L="objModel"+RedGL.makeUUID(),groupName:L,index:[],position:[],resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},p[L]=g=P,m[L]=g,v=L),i.forEach(function(i){if(h.test(i))return E=RedMTLLoader(e,t.path,i.split(" ")[1],function(i){t.mtlLoader=i,t.modelParsingComplete&&t.callback&&(r(e,m,E),t.callback(t.result))}),void(t.mtlLoader=E);var M;if(R.test(i))b=i.split(" ").slice(1).join("").trim(),m[v].materialKey=b;else if(a.test(i))b=i.split(" ").slice(1).join("").trim(),p[v].use=!1,L={name:b,groupName:v,materialKey:b.replace(v+"_",""),index:[],position:g.position,resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},m[b]=g=L,p[v].childrenInfo[b]=g;else if(n.test(i)){var b,L;L={name:b=i.split(" ").slice(1).join("").trim(),groupName:b,materialKey:b,index:[],position:[],resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},p[b]=g=L,m[b]=g,v=b}if(o.test(i))M=i.split(" "),_.position.push(+M[1],+M[2],+M[3]),g.position.push(+M[1],+M[2],+M[3]),_.points[_.points.length]=[+M[1],+M[2],+M[3]];else if(s.test(i)){var P;P=i.split(" "),_.normal.push(+P[1],+P[2],+P[3]),_.normalPoints[_.normalPoints.length]=[+P[1],+P[2],+P[3]]}else if(d.test(i)){var T;T=i.split(" "),_.uv.push(+T[1],1-T[2]),_.uvPoints[_.uvPoints.length]=[+T[1],1-T[2]]}else if(f.test(i))(w=i.split(" ").slice(1,4)).forEach(function(e){var t,r,i;i=0,e=e.split("/"),U=+e[0]-1,y=+e[2]-1,t=_.points[U],r=_.normalPoints[y],_.position.length&&(i+=3),_.normal.length&&(i+=3),g.index.push(g.resultInterleave.length/i),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.normal.length&&(g.resultNormal.push(r[0],r[1],r[2]),g.resultInterleave.push(r[0],r[1],r[2]))});else if(l.test(i)){var y;if(4===(w=i.split(" ").slice(1,5)).length){var x=w[3];w[3]=w[0],w[4]=w[2],w[5]=x}w.forEach(function(e){var t,r,i,n;n=0,e=e.split("/"),U=+e[0]-1,I=+e[1]-1,y=+e[2]-1,t=_.points[U],i=_.uvPoints[I],r=_.normalPoints[y],_.position.length&&(n+=3),_.normal.length&&(n+=3),_.uv.length&&(n+=2),g.index.push(g.resultInterleave.length/n),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.normal.length&&(g.resultNormal.push(r[0],r[1],r[2]),g.resultInterleave.push(r[0],r[1],r[2])),_.uv.length&&(g.resultUV.push(i[0],i[1]),g.resultInterleave.push(i[0],i[1]))})}else if(c.test(i)){var w,I;(w=i.split(" ").slice(1,4)).forEach(function(e){var t,r,i;i=0,e=e.split("/"),U=+e[0]-1,I=+e[1]-1,t=_.points[U],r=_.uvPoints[I],_.position.length&&(i+=3),_.uv.length&&(i+=2),g.index.push(g.resultInterleave.length/i),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.uv.length&&(g.resultUV.push(r[0],r[1]),g.resultInterleave.push(r[0],r[1]))})}else if(u.test(i)){var U;U=i.split(" "),g.resultInterleave=g.resultPosition=g.position,g.index.push(+U[1]-1,+U[2]-1,+U[3]-1),g.index.push(+U[1]-1,+U[3]-1,+U[4]-1)}}),{info:m,infoHierarchy:p}},e=function(e,r,n){n=n.replace(/^\#[\s\S]+?\n/g,"");var a=i(r,e,n.split("\n"));return t(r,e.resultMesh,a.infoHierarchy),new function(e){for(var t in e)this[t]=e[t]}({fileName:e.fileName,path:e.path,resultMesh:e.resultMesh,parseRawInfo:a.info,parseInfoHierarchy:a.infoHierarchy,parseInfoMaterial:e.mtlLoader})},Object.freeze(RedOBJLoader)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p,_,g;Red3DSLoader=function(t,r,i,n){if(!(this instanceof Red3DSLoader))return new Red3DSLoader(t,r,i,n);var a=this,o=new XMLHttpRequest;o.open("GET",r+i,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){4==o.readyState&&200===o.status&&(a.result=e(a,t,o.response),n&&n(a.result))},o.send(),this.redGL=t,this.position=0,this.materials={},this.meshs=[],this.path=r,this.fileName=i,this.callback=n,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRed3DSLoader_"+RedGL.makeUUID(),this.result=null},r=function(e,t){var r={};return r.cur=e.position,r.id=a(e,t),r.size=o(e,t),r.end=r.cur+r.size,r.cur+=6,r},i=function(e,t,i){if(i.cur>=i.end)return 0;e.position=i.cur;try{var n=r(e,t);return i.cur+=n.size,n.id}catch(e){return 0}},n=function(e,t){e.position=t.end},a=function(e,t){var r=t.getUint16(e.position,!0);return e.position+=2,r},o=function(e,t){var r=t.getUint32(e.position,!0);return e.position+=4,r},d=function(e,t){var r=t.getUint8(e.position,!0);return e.position+=1,r},s=function(e,t,r){var i,n,a="";for(i=0;i<r&&(n=d(e,t));i++)a+=String.fromCharCode(n);return a},R=function(e,t){try{var r=t.getFloat32(e.position,!0);return e.position+=4,r}catch(e){}},u=function(e,t){var i,a=r(e,t);return 17===a.id||18===a.id?i=RedGLUtil.rgb2hex(d(e,t),d(e,t),d(e,t)):16!==a.id&&19!==a.id||(i=RedGLUtil.rgb2hex(d(e,t),d(e,t),d(e,t))),n(e,a),i},l=function(e){e.position-=6},c=function(e,t,a){for(var o=r(e,t),d=i(e,t,o),u={};0!==d;){switch(d){case 41728:var c=s(e,t,128);u=RedBitmapTexture(e.redGL,a+c);break;case 41816:u.offset||(u.offset={}),u.offset.x=R(e,t);break;case 41818:u.offset||(u.offset={}),u.offset.y=R(e,t);break;case 41812:u.repeat||(u.repeat={}),u.repeat.x=R(e,t);break;case 41814:u.repeat||(u.repeat={}),u.repeat.y=R(e,t)}d=i(e,t,o)}return n(e,o),u},_=function(e,t,o){for(var f,h=r(e,t),R=i(e,t,h),m={};0!==R;){switch(R){case 40960:m.name=s(e,t,64);break;case 41093:m.wireframe=!0;break;case 41095:d(e,t);break;case 41089:case 41091:break;case 40992:m.color=u(e,t);break;case 41008:case 40976:break;case 41024:var p=a(e,t);m.shininess=p;break;case 41472:l(e),m.diffuseTexture=c(e,t,o);break;case 41520:l(e),m.normalTexture=c(e,t,o);break;case 41488:l(e);break;case 41476:l(e),m.specularTexture=c(e,t,o)}R=i(e,t,h)}m.diffuseTexture?"shininess"in m?((f=RedStandardMaterial(e.redGL,m.diffuseTexture)).normalTexture=m.normalTexture,f.specularTexture=m.specularTexture):f=RedBitmapTexture(e.redGL,m.diffuseTexture):(m.normalTexture||m.specularTexture?f=RedColorPhongTextureMaterial(e.redGL):"shininess"in m?f=RedColorPhongMaterial(e.redGL):RedColorMaterial(e.redGL),f.color=m.color),n(e,h),f.shininess=m.shininess,f.name=m.name,e.materials[m.name]=f},f=function(e,t,n){for(var a=r(e,t),s=i(e,t,a);0!==s;){switch(s){case 15678:o(e,t);break;case 256:var d=R(e,t);e.resultMesh.scaleX=d,e.resultMesh.scaleY=d,e.resultMesh.scaleZ=d;break;case 16384:l(e),m(e,t);break;case 45055:l(e),_(e,t,n)}s=i(e,t,a)}},g=function(e,t){r(e,t);for(var i=s(e,t,64),n=a(e,t),o=[],d=0;d<n;++d)o.push(a(e,t));return{name:i,index:o}},p=function(e,t,i){for(var o=r(e,t),s=a(e,t),d=[],u=0;u<s;++u)d.push(a(e,t),a(e,t),a(e,t)),a(e,t);for(;e.position<o.end;){if(16688===(o=r(e,t)).id){l(e);var c=g(e,t),f=e.materials[c.name];void 0!==f&&(i.material=f,""===f.name&&(f.name=i.name))}n(e,o)}return n(e,o),d},h=function(e,t){for(var o,s,d,u,c,f=r(e,t),h=i(e,t,f),m=[],_=RedMesh(e.redGL);0!==h;){switch(h){case 16656:var g=a(e,t),v=[];for(s=0;s<g;s++)v.push(R(e,t),R(e,t),R(e,t));break;case 16672:l(e),o=p(e,t,_);break;case 16704:var E=a(e,t);for(m=[],s=0;s<E;s++)m.push(R(e,t)),m.push(1-R(e,t));break;case 16736:var M=[];for(s=0;s<12;s++)M[s]=R(e,t);var b=mat4.create();b[0]=M[0],b[1]=M[6],b[2]=M[3],b[3]=M[9],b[4]=M[2],b[5]=M[8],b[6]=M[5],b[7]=M[11],b[8]=M[1],b[9]=M[7],b[10]=M[4],b[11]=M[10],b[12]=0,b[13]=0,b[14]=0,b[15]=1}h=i(e,t,f)}n(e,f);var L=RedGLUtil.calculateNormals(v,o),P=[];for(s=0,d=v.length/3;s<d;s++)P.push(v[3*s+0],v[3*s+1],v[3*s+2]),P.push(L[3*s+0],L[3*s+1],L[3*s+2]),m.length&&P.push(m[2*s+0],m[2*s+1]);var T=[];T.push(RedInterleaveInfo("aVertexPosition",3)),T.push(RedInterleaveInfo("aVertexNormal",3)),m.length&&T.push(RedInterleaveInfo("aTexcoord",2)),u=RedBuffer(e.redGL,"testRed3DS",RedBuffer.ARRAY_BUFFER,new Float32Array(P),T),c=RedBuffer(e.redGL,"testRed3DS",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(o));var y=RedGeometry(u,c);return _.geometry=y,_.name="mesh"+RedGL.makeUUID(),_.matrix=b,_},m=function(e,t){var a=r(e,t),o=s(e,t,64);a.cur=e.position;for(var d,u=i(e,t,a);0!==u;)16640===u&&(l(e),(d=h(e,t)).name=o,e.meshs.push(d)),u=i(e,t,a);n(e,a)},t=function(e,t,n){var a=new DataView(t),o=r(e,a);if(15786===o.id||49725===o.id||19789===o.id)for(var s=i(e,a,o);0!==s;){switch(s){case 2:break;case 15677:l(e),f(e,a,n)}s=i(e,a,o)}},e=function(e,r,i){return t(e,i,e.path),e.meshs.forEach(function(t){e.resultMesh.addChild(t)}),{fileName:e.fileName,path:e.path,resultMesh:e.resultMesh}},Object.freeze(Red3DSLoader)}(),function(){var e,t,r,i,n,a,o;RedDAELoader=function(t,r,i,n){if(!(this instanceof RedDAELoader))return new RedDAELoader(t,r,i,n);var a=r+i,o=this,s=new XMLHttpRequest;s.open("GET",a,!0),s.setRequestHeader("Content-Type","application/xml; charset=UTF-8"),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){var r=new DOMParser;o.result=e(o,t,r.parseFromString(s.responseText,"text/xml")),n&&n(o.result)}},s.send(),this.path=r,this.fileName=i,this.callback=n,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedDAELoader_"+RedGL.makeUUID(),this.result=null},i=function(e){var t,r,i,n,a,o,s,d=[],u=[],c=[];for(a=(n=e[0].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,o=(n=e[1].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,s=(n=e[2].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,t=0,r=a.length/3;t<r;t++)i=3*t,d.push([a[i],a[i+1],a[i+2]]);if(o)for(t=0,r=o.length/3;t<r;t++)i=3*t,u.push([o[i],o[i+1],o[i+2]]);if(s)for(t=0,r=s.length/2;t<r;t++)i=2*t,c.push([s[i],1-s[i+1]]);return{pointList:d,normalPointList:u,uvPointList:c}},n=function(e,t,r){var i={};return r.querySelectorAll("library_images image").forEach(function(r){i[r.getAttribute("id")]=RedBitmapTexture(e,t.path+r.querySelector("init_from").textContent)}),i},a=function(e,t){var r={};return e.querySelectorAll("library_effects effect").forEach(function(e){e.querySelector("newparam init_from")&&(r[e.getAttribute("id")]={texture:t[e.querySelector("newparam init_from").textContent]})}),r},o=function(e,t){var r={};return e.querySelectorAll("library_materials material").forEach(function(e){r[e.getAttribute("id")]={effect:t[e.querySelector("instance_effect").getAttribute("url").replace("#","")]}}),r},t=function(e,t,r){var i=n(e,t,r),s=a(r,i);return{textureMap:i,effectMap:s,materialMap:o(r,s)}},r=function(e,r,n){n.querySelectorAll("library_geometries geometry mesh").forEach(function(a){var o,s,d;o=a.querySelectorAll("source"),s=i(o),d=t(r,e,n);var u=a.querySelectorAll("source").length;a.querySelectorAll("polylist").forEach(function(t){var i,n,a,o,c=[],l=t.querySelector("p").textContent.split(" "),f=[],h=[],R=[],m=[];l.forEach(function(e,t){t%u==0?f.push(+e):t%u==1?h.push(+e):t%u==2&&R.push(+e)});var p={};if(f.forEach(function(e,t){c[o=8*e]=s.pointList[e][0],c[o+1]=s.pointList[e][1],c[o+2]=s.pointList[e][2],p[e]||(p[e]=[]),p[e].push(t),c[o+3]=s.normalPointList[h[t]][0],c[o+4]=s.normalPointList[h[t]][1],c[o+5]=s.normalPointList[h[t]][2],c[o+6]=s.uvPointList[R[t]][0],c[o+7]=s.uvPointList[R[t]][1],m.push(e)}),i=RedBuffer(r,"daeInterleaveBuffer"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(c),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),n=RedBuffer(r,"daeIndexData"+RedGL.makeUUID(),RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(m)),(a=RedMesh(r)).geometry=RedGeometry(i,n),d.materialMap[t.getAttribute("material")].effect){var _=d.materialMap[t.getAttribute("material")].effect.texture;a.material=RedStandardMaterial(r,_)}else a.material=RedColorPhongMaterial(r);e.resultMesh.addChild(a)})})},e=function(e,t,i){return r(e,t,i),{fileName:e.fileName,path:e.path,resultMesh:e.resultMesh}},Object.freeze(RedDAELoader)}(),function(){var e,t,r={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},i=(t={},function(e,r,i,n){if(t[e])requestAnimationFrame(function(){i(t[e])});else{var a=new XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(r){4===a.readyState&&200===a.status?(t[e]=a,i(a)):n(a,r)},a.send()}}),n=function(){var e={};return function(t,r,i){if(e[t])requestAnimationFrame(function(){r(e[t])});else{var n=new XMLHttpRequest;n.open("GET",t,!0),n.overrideMimeType("application/octet-stream"),n.responseType="arraybuffer",n.onreadystatechange=function(a){4===n.readyState&&200===n.status?(e[t]=n,r(n)):i(n,a)},n.send()}}}();RedGLTFLoader=function(t,r,o,s,d,u){if(!(this instanceof RedGLTFLoader))return new RedGLTFLoader(t,r,o,s,d,u);var c=this;if(o.indexOf(".glb")>-1){var l;l=function(e){var t="";return e.map(function(e){t+=String.fromCharCode(e)}),t},n(r+o,function(r){for(var i=null,n=null,a=null,o=null,d=0,u=0,f=null,h=new DataView(r.response,12),R=(l(new Uint8Array(r.response,0,4)),h.getUint32(4,!0),h.getUint32(8,!0),new DataView(r.response,12));d<R.byteLength;)u=R.getUint32(d,!0),d+=4,f=R.getUint32(d,!0),d+=4,1313821514===f?(n=new Uint8Array(r.response,12+d,u),i=l(n)):5130562===f&&(o=12+d,a=r.response.slice(o,o+u)),d+=u;if(null===i)throw new Error("JSON content not found");var m=JSON.parse(i),p=a;m.images&&m.images.forEach(function(e){if("image/png"===e.mimeType||"image/jpeg"===e.mimeType||"image/gif"===e.mimeType){var t;t=m.bufferViews[e.bufferView].byteOffset||0;var r=p.slice(t,t+m.bufferViews[e.bufferView].byteLength),i=new Blob([new Uint8Array(r)],{type:e.mimeType});e.uri=URL.createObjectURL(i)}}),e(c,t,m,function(){s&&s(c)},p)},function(e,t){})}else i(r+o,null,function(r){e(c,t,JSON.parse(r.response),function(){s&&s(c)})},function(e,t){});this.redGL=t,this.path=r,this.fileName=o,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedGLTFLoader_"+RedGL.makeUUID(),this.parsingResult={groups:[],materials:[],uris:{buffers:[]},textures:{},cameras:[],animations:[]},this.parsingOption=u,this.environmentTexture=d||null;var f=null;this.stopAnimation=function(){a.indexOf(f)>-1&&a.splice(a.indexOf(f),1)},this.playAnimation=function(e){a.push(f={startTime:performance.now(),targetAnimationData:e})}},RedDefinePropertyInfo.definePrototype("RedGLTFLoader","environmentTexture","samplerCube",{callback:function(e){this.parsingResult.materials.forEach(function(t){"environmentTexture"in t&&(t.environmentTexture=e)})}});var a=[];RedGLTFLoader.animationLooper=function(e){for(var t,r,i,n,o,s,d,u,c,l,f,h,R,m,p,_,g,v,E,M,b,L,P,T,y,x,w,I,U,D,B,G,S,A,F,C,O,N,k,Y,X,j,z,V,Z,W,H,q,J,K,Q,$,ee,te,re,ie,ne=a.length;ne--;)for(w=(T=(x=a[ne]).targetAnimationData).length;w--;){for(I=T[w],t=(e-x.startTime)%(1e3*T.maxTime)/1e3,U=I.target,G=I.time,S=I.time,A=G.length,F=0,D=0,r=G[B=G.length-1],i=G[D];F<A;F++){var ae=G[F];if(ae<t&&(r=G[B=F],i=null==G[B+1]?G[D=0]:G[D=B+1]),0==F&&t<G[F]){r=G[B=A-1],i=G[D=F],t=ae;break}if(F==A-1&&t>ae){r=G[B=0],i=G[D=A-1],t=ae;break}}if("CUBICSPLINE"==I.interpolation){"NaN"==(y=i-r).toString()&&(y=0);var oe=(t-r)/y;"NaN"==oe.toString()&&(oe=0);var se=oe*oe,de=se*oe,ue=-2*de+3*se,ce=de-se,le=1-ue,fe=ce-se+oe;if(U){var he,Re,me,pe,_e=I.data;switch(I.key){case"rotation":if((P=(E=_e[12*B+4])*E+(M=_e[12*B+5])*M+(b=_e[12*B+6])*b+(L=_e[12*B+7])*L)>0&&(P=1/Math.sqrt(P)),f=E*P,h=M*P,R=b*P,m=L*P,(P=(E=_e[12*D+4])*E+(M=_e[12*D+5])*M+(b=_e[12*D+6])*b+(L=_e[12*D+7])*L)>0&&(P=1/Math.sqrt(P)),n=E*P,o=M*P,s=b*P,d=L*P,(P=(E=_e[12*B+8])*E+(M=_e[12*B+9])*M+(b=_e[12*B+10])*b+(L=_e[12*B+11])*L)>0&&(P=1/Math.sqrt(P)),p=E*P,_=M*P,g=b*P,v=L*P,(P=(E=_e[12*B+0])*E+(M=_e[12*B+1])*M+(b=_e[12*B+2])*b+(L=_e[12*B+3])*L)>0&&(P=1/Math.sqrt(P)),B!=A-1){var ge=[0,0,0],ve=(E=le*(he=f)+fe*(Re=p*y)+ue*(me=n)+ce*(pe=E*P*y))*(Ne=E+E),Ee=E*(ke=(M=le*(he=h)+fe*(Re=_*y)+ue*(me=o)+ce*(pe=M*P*y))+M),Me=E*(Ye=(b=le*(he=R)+fe*(Re=g*y)+ue*(me=s)+ce*(pe=b*P*y))+b),be=M*Ye,Le=(L=le*(he=m)+fe*(Re=v*y)+ue*(me=d)+ce*(pe=L*P*y))*Ne,Pe=L*ke,Te=L*Ye;(Oe=[])[0]=1-((Xe=M*ke)+(je=b*Ye)),Oe[4]=Ee-Te,Oe[8]=Me+Pe,Oe[1]=Ee+Te,Oe[5]=1-(ve+je),Oe[9]=be-Le,Oe[2]=Me-Pe,Oe[6]=be+Le,Oe[10]=1-(ve+Xe),Oe[3]=0,Oe[7]=0,Oe[11]=0,Oe[12]=0,Oe[13]=0,Oe[14]=0,Oe[15]=1;var ye=Oe[0],xe=Oe[4],we=Oe[8],Ie=(Oe[1],Oe[5]),Ue=Oe[9],De=(Oe[2],Oe[6]),Be=Oe[10];ge[1]=Math.asin(Math.max(-1,Math.min(1,we))),Math.abs(we)<.99999?(ge[0]=Math.atan2(-Ue,Be),ge[2]=Math.atan2(-xe,ye)):(ge[0]=Math.atan2(De,Ie),ge[2]=0),ge[0]=-180*ge[0]/Math.PI,ge[1]=-180*ge[1]/Math.PI,ge[2]=-180*ge[2]/Math.PI,U.rotationX=ge[0],U.rotationY=ge[1],U.rotationZ=ge[2]}break;case"translation":n=_e[9*B+3],o=_e[9*B+4],s=_e[9*B+5],f=_e[9*D+3],h=_e[9*D+4],R=_e[9*D+5],p=_e[9*B+6],_=_e[9*B+7],g=_e[9*B+8],u=_e[9*D+0],c=_e[9*D+1],l=_e[9*D+2],B!=A-1&&(he=f,Re=p*y,me=n,pe=u*y,U.x=le*he+fe*Re+ue*me+ce*pe,he=h,Re=_*y,me=o,pe=c*y,U.y=le*he+fe*Re+ue*me+ce*pe,he=R,Re=g*y,me=s,pe=l*y,U.z=le*he+fe*Re+ue*me+ce*pe);break;case"scale":n=_e[9*B+3],o=_e[9*B+4],s=_e[9*B+5],f=_e[9*D+3],h=_e[9*D+4],R=_e[9*D+5],p=_e[9*B+6],_=_e[9*B+7],g=_e[9*B+8],u=_e[9*D+0],c=_e[9*D+1],l=_e[9*D+2],B!=A-1&&(he=f,Re=p*y,me=n,pe=u*y,U.scaleX=le*he+fe*Re+ue*me+ce*pe,he=h,Re=_*y,me=o,pe=c*y,U.scaleY=le*he+fe*Re+ue*me+ce*pe,he=R,Re=g*y,me=s,pe=l*y,U.scaleZ=le*he+fe*Re+ue*me+ce*pe);break;case"weights":for(C=I.targets.length;C--;){for(N=(O=I.targets[C]).geometry.interleaveBuffer.data,k=O._morphInfo.origin,Y=O.geometry.interleaveBuffer.stride,j=N.length/Y,K=O._morphInfo.list.length,S=I.data,(Q=O._morphInfo.list).cacheData||(Q.cacheData={}),X=0;X<j;X++){if(J=X*Y,ie=Q.cacheData[J+"_"+B+"_"+D])z=ie[0],V=ie[1],Z=ie[2],W=ie[3],H=ie[4],q=ie[5];else{for(z=k[J],V=k[J],Z=k[J+1],W=k[J+1],H=k[J+2],q=k[J+2],$=K;$--;)$%3==1&&(ee=S[B*K+$],te=S[D*K+$],z+=ee*(ze=(re=Q[$].interleaveData)[J]),V+=te*ze,Z+=ee*(ze=re[J+1]),W+=te*ze,H+=ee*(ze=re[J+2]),q+=te*ze);Q.cacheData[J+"_"+B+"_"+D]=[z,V,Z,W,H,q]}N[J]=z+y*(V-z),N[J+1]=Z+y*(W-Z),N[J+2]=H+y*(q-H)}O.geometry.interleaveBuffer.upload(N)}}}}else if("NaN"==(y="STEP"==I.interpolation?0:(t-r)/(i-r)).toString()&&(y=0),U){_e=I.data;switch(I.key){case"rotation":var Ge,Se,Ae,Fe,Ce;(P=(E=_e[4*B])*E+(M=_e[4*B+1])*M+(b=_e[4*B+2])*b+(L=_e[4*B+3])*L)>0&&(P=1/Math.sqrt(P)),f=E*P,h=M*P,R=b*P,m=L*P,(P=(E=_e[4*D])*E+(M=_e[4*D+1])*M+(b=_e[4*D+2])*b+(L=_e[4*D+3])*L)>0&&(P=1/Math.sqrt(P)),(Se=f*(n=E*P)+h*(o=M*P)+R*(s=b*P)+m*(d=L*P))<0&&(Se=-Se,n=-n,o=-o,s=-s,d=-d),1-Se>glMatrix.EPSILON?(Ge=Math.acos(Se),Ae=Math.sin(Ge),Fe=Math.sin((1-y)*Ge)/Ae,Ce=Math.sin(y*Ge)/Ae):(Fe=1-y,Ce=y);var Oe,Ne,ke,Ye,Xe,je;ge=[0,0,0],ve=(E=Fe*f+Ce*n)*(Ne=E+E),Ee=E*(ke=(M=Fe*h+Ce*o)+M),Me=E*(Ye=(b=Fe*R+Ce*s)+b),be=M*Ye,Le=(L=Fe*m+Ce*d)*Ne,Pe=L*ke,Te=L*Ye;(Oe=[])[0]=1-((Xe=M*ke)+(je=b*Ye)),Oe[4]=Ee-Te,Oe[8]=Me+Pe,Oe[1]=Ee+Te,Oe[5]=1-(ve+je),Oe[9]=be-Le,Oe[2]=Me-Pe,Oe[6]=be+Le,Oe[10]=1-(ve+Xe),Oe[3]=0,Oe[7]=0,Oe[11]=0,Oe[12]=0,Oe[13]=0,Oe[14]=0,Oe[15]=1;ye=Oe[0],xe=Oe[4],we=Oe[8],Oe[1],Ie=Oe[5],Ue=Oe[9],Oe[2],De=Oe[6],Be=Oe[10];ge[1]=Math.asin(Math.max(-1,Math.min(1,we))),Math.abs(we)<.99999?(ge[0]=Math.atan2(-Ue,Be),ge[2]=Math.atan2(-xe,ye)):(ge[0]=Math.atan2(De,Ie),ge[2]=0),ge[0]=-180*ge[0]/Math.PI,ge[1]=-180*ge[1]/Math.PI,ge[2]=-180*ge[2]/Math.PI,U.rotationX=ge[0],U.rotationY=ge[1],U.rotationZ=ge[2];break;case"translation":n=_e[3*D],o=_e[3*D+1],s=_e[3*D+2],f=_e[3*B],h=_e[3*B+1],R=_e[3*B+2],U.x=f+y*(n-f),U.y=h+y*(o-h),U.z=R+y*(s-R);break;case"scale":n=_e[3*D],o=_e[3*D+1],s=_e[3*D+2],f=_e[3*B],h=_e[3*B+1],R=_e[3*B+2],U.scaleX=f+y*(n-f),U.scaleY=h+y*(o-h),U.scaleZ=R+y*(s-R);break;case"weights":for(C=I.targets.length;C--;){var ze;for(N=(O=I.targets[C]).geometry.interleaveBuffer.data,k=O._morphInfo.origin,Y=O.geometry.interleaveBuffer.stride,j=N.length/Y,K=O._morphInfo.list.length,S=I.data,(Q=O._morphInfo.list).cacheData||(Q.cacheData={}),X=0;X<j;X++){if(J=X*Y,ie=Q.cacheData[J+"_"+B+"_"+D])z=ie[0],V=ie[1],Z=ie[2],W=ie[3],H=ie[4],q=ie[5];else{for(z=k[J],V=k[J],Z=k[J+1],W=k[J+1],H=k[J+2],q=k[J+2],$=K;$--;)ee=S[B*K+$],te=S[D*K+$],z+=ee*(ze=(re=Q[$].interleaveData)[J]),V+=te*ze,Z+=ee*(ze=re[J+1]),W+=te*ze,H+=ee*(ze=re[J+2]),q+=te*ze;Q.cacheData[J+"_"+B+"_"+D]=[z,V,Z,W,H,q]}N[J]=z+y*(V-z),N[J+1]=Z+y*(W-Z),N[J+2]=H+y*(q-H)}O.geometry.interleaveBuffer.upload(N)}}}}},e=function(){var e,t,i,a,o,s,d,u,c,l,f,h,R,m;e=function(e){void 0===e.asset&&RedGLUtil.throwFunc("RedGLTFLoader - asset은 반드시 정의되어야함"),e.asset.version[0]<2&&RedGLUtil.throwFunc("RedGLTFLoader - asset의 버전은 2.0이상이어야함")},i=function(e,t,r){var i=0,a=0,o=[];t.buffers.forEach(function(e,t){e._redURIkey="buffers",e._redURIIndex=t,o.push(e)}),o.forEach(function(t){if(i++,t.uri instanceof ArrayBuffer)a++,e.parsingResult.uris[t._redURIkey][t._redURIIndex]=new DataView(t.uri),a==i&&r&&r();else{var o="data:"==t.uri.substr(0,5)?t.uri:e.path+t.uri;n(o,function(n){a++,e.parsingResult.uris[t._redURIkey][t._redURIIndex]=new DataView(n.response),a==i&&r&&r()},function(e,t){})}})},t=function(e,t,r){i(e,t,r)},u=function(e,t){t.cameras&&t.cameras.forEach(function(t){var r=RedCamera();"orthographic"==t.type?r.mode2DYn=!0:(r.fov=180*t.perspective.yfov/Math.PI,r.farClipping=t.perspective.zfar,r.nearClipping=t.perspective.znear),e.parsingResult.cameras.push(r)})},a=function(e,t,r){var i,n,a,o;a=t.scenes[0].nodes,i=0,n=a.length;var s=function(){o=a[i],d(e,t,o,t.nodes[o],e.resultMesh),++i===n?r&&r():requestAnimationFrame(s)};requestAnimationFrame(s)},f=mat4.create(),h=[0,0,0],R=[],m=[],c=function(e,t){"matrix"in t&&(l=t.matrix,RedGLUtil.mat4ToEuler(l,h),e.rotationX=-180*h[0]/Math.PI,e.rotationY=-180*h[1]/Math.PI,e.rotationZ=-180*h[2]/Math.PI,e.x=l[12],e.y=l[13],e.z=l[14],mat4.getScaling(m,l),e.scaleX=m[0],e.scaleY=m[1],e.scaleZ=m[2]),"rotation"in t&&(R=t.rotation,RedGLUtil.quaternionToRotationMat4(R,f),RedGLUtil.mat4ToEuler(f,h),e.rotationX=-180*h[0]/Math.PI,e.rotationY=-180*h[1]/Math.PI,e.rotationZ=-180*h[2]/Math.PI),"translation"in t&&(e.x=t.translation[0],e.y=t.translation[1],e.z=t.translation[2]),"scale"in t&&(e.scaleX=t.scale[0],e.scaleY=t.scale[1],e.scaleZ=t.scale[2])};var p=function(e,t,r,i){if(n=r[i].RedMesh){var n=r[i].RedMesh;t.joints.push(n),n.material=RedColorMaterial(e.redGL,"#ff0000"),n.drawMode=e.redGL.gl.LINE_LOOP,n.depthTestFunc=e.redGL.gl.NEVER}else requestAnimationFrame(function(){p(e,t,r,i)})},_=function(e,t,r,i){var n={joints:[],inverseBindMatrices:[]},a=t.nodes;r.joints.forEach(function(t){p(e,n,a,t)}),r.skeleton&&(n.skeleton=t.nodes[r.skeleton].RedMesh);var o,s=r.inverseBindMatrices,d=new b(e,t,s),u=d.componentType_BYTES_PER_ELEMENT,c=d.bufferViewByteStride,l=d.bufferURIDataView,f=d.getMethod,h=d.accessor.type,R=d.accessor.count,m=0,_=c/u,g=d.startIndex;switch(h){case"MAT4":if(c)for(o=g+R*(c/u);g<o;g++)m%_<16&&n.inverseBindMatrices.push(l[f](g*u,!0)),m++;else for(o=g+16*R;g<o;g++)n.inverseBindMatrices.push(l[f](g*u,!0)),m++}n.inverseBindMatrices=new Float32Array(n.inverseBindMatrices),i.skinInfo=n};d=function(e,t,r,i,n){if("mesh"in i){var a=i.mesh;o(e,t,t.meshes[a]).forEach(function(r){i.RedMesh=r,n.addChild(r),c(r,i),"children"in i&&i.children.forEach(function(i){d(e,t,i,t.nodes[i],r)}),"skin"in i&&requestAnimationFrame(function(){_(e,t,t.skins[i.skin],r)})})}else{var s;if(e.parsingResult.groups[r]?(s=e.parsingResult.groups[r],i.RedMesh=s):(s=RedMesh(e.redGL),n.addChild(s),i.RedMesh=s,e.parsingResult.groups[r]=s,e.parsingResult.groups[r].name=i.name),c(s,i),"camera"in i){e.parsingResult.cameras[i.camera]._parentMesh=n,e.parsingResult.cameras[i.camera]._targetMesh=s;var u=RedMesh(e.redGL);s.addChild(u),e.parsingResult.cameras[i.camera]._cameraMesh=u}"children"in i&&i.children.forEach(function(r){d(e,t,r,t.nodes[r],s)}),"skin"in i&&requestAnimationFrame(function(){_(e,t,t.skins[i.skin],s)})}};var g,v,E,M=function(e,t,i,n,a,o,s,d,u,c){if(i.sparse){var l=[],f=[],h=[];!function(){var a,o,s,d,u,c=i.sparse,R=c.values,m=n.bufferViews[R.bufferView],p=m.buffer;n.buffers[p].uri&&(a=e.parsingResult.uris.buffers[p]),(d=r[i.componentType])==Float32Array&&(u="getFloat32"),d==Uint32Array&&(u="getUint32"),d==Uint16Array&&(u="getUint16"),d==Int16Array&&(u="getInt16"),d==Uint8Array&&(u="getUint8"),d==Int8Array&&(u="getInt8");var _=i.byteOffset||0;switch(o=((m.byteOffset||0)+_)/d.BYTES_PER_ELEMENT,i.type){case"VEC3":for(s=o+d.BYTES_PER_ELEMENT*c.count/d.BYTES_PER_ELEMENT*3;o<s;o++)"NORMAL"==t?f.push(a[u](o*d.BYTES_PER_ELEMENT,!0)):"POSITION"==t&&l.push(a[u](o*d.BYTES_PER_ELEMENT,!0));break;case"VEC2":for(s=o+d.BYTES_PER_ELEMENT*c.count/d.BYTES_PER_ELEMENT*2;o<s;o++)"TEXCOORD_0"==t&&h.push(a[u](o*d.BYTES_PER_ELEMENT,!0))}}();var R,m,p,_,g,v=i.sparse,E=v.indices,M=n.bufferViews[E.bufferView],b=M.buffer;n.buffers[b].uri&&(R=e.parsingResult.uris.buffers[b]),(_=r[E.componentType])==Uint16Array?g="getUint16":_==Uint8Array&&(g="getUint8");var L=E.byteOffset||0;p=(m=((M.byteOffset||0)+L)/_.BYTES_PER_ELEMENT)+_.BYTES_PER_ELEMENT*v.count/_.BYTES_PER_ELEMENT;for(var P=0;m<p;m++){var T=R[g](m*_.BYTES_PER_ELEMENT,!0);a[3*T]=l[3*P],a[3*T+1]=l[3*P+1],a[3*T+2]=l[3*P+2],P++}}},b=function(e,t,i){switch(this.accessor=t.accessors[i],this.bufferView=t.bufferViews[this.accessor.bufferView],this.bufferIndex=this.bufferView.buffer,this.buffer=t.buffers[this.bufferIndex],this.bufferURIDataView=null,this.buffer.uri&&(this.bufferURIDataView=e.parsingResult.uris.buffers[this.bufferIndex]),this.componentType=r[this.accessor.componentType],this.componentType_BYTES_PER_ELEMENT=this.componentType.BYTES_PER_ELEMENT,this.componentType){case Float32Array:this.getMethod="getFloat32";break;case Uint32Array:this.getMethod="getUint32";break;case Uint16Array:this.getMethod="getUint16";break;case Int16Array:this.getMethod="getInt16";break;case Uint8Array:this.getMethod="getUint8";break;case Int8Array:this.getMethod="getInt8";break;default:RedGLUtil.throwFunc("파싱할수없는 타입",this.componentType)}this.accessorBufferOffset=this.accessor.byteOffset||0,this.bufferViewOffset=this.bufferView.byteOffset||0,this.bufferViewByteStride=this.bufferView.byteStride||0,this.startIndex=(this.bufferViewOffset+this.accessorBufferOffset)/this.componentType_BYTES_PER_ELEMENT},L=function(e,t,r,i,n,a,o,s,d,u,c,l){var f,h=i.componentType_BYTES_PER_ELEMENT,R=i.bufferViewByteStride,m=i.bufferURIDataView,p=i.getMethod,_=i.accessor.type,g=i.accessor.count,v=0,E=R/h,M=i.startIndex;switch(_){case"VEC4":if(R)for(f=M+g*(R/h);M<f;M++)v%E<4&&("WEIGHTS_0"==r?d.push(m[p](M*h,!0)):"JOINTS_0"==r?u.push(m[p](M*h,!0)):"COLOR_0"==r?c.push(m[p](M*h,!0)):"TANGENT"==r&&l.push(m[p](M*h,!0))),v++;else for(f=M+4*g;M<f;M++)"WEIGHTS_0"==r?d.push(m[p](M*h,!0)):"JOINTS_0"==r?u.push(m[p](M*h,!0)):"COLOR_0"==r?c.push(m[p](M*h,!0)):"TANGENT"==r&&l.push(m[p](M*h,!0)),v++;break;case"VEC3":if(R)for(f=M+g*(R/h);M<f;M++)v%E<3&&("NORMAL"==r?s.push(m[p](M*h,!0)):"POSITION"==r?n.push(m[p](M*h,!0)):"COLOR_0"==r&&(c.push(m[p](M*h,!0)),v%E==2&&c.push(1))),v++;else for(f=M+3*g;M<f;M++)"NORMAL"==r?s.push(m[p](M*h,!0)):"POSITION"==r?n.push(m[p](M*h,!0)):"COLOR_0"==r&&(c.push(m[p](M*h,!0)),v%3==2&&c.push(1)),v++;break;case"VEC2":if(R)for(f=M+g*(R/h);M<f;M++)v%E<2&&("TEXCOORD_0"==r?a.push(m[p](M*h,!0)):"TEXCOORD_1"==r?o.push(m[p](M*h,!0)):RedGLUtil.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r)),v++;else for(f=M+2*g;M<f;M++)"TEXCOORD_0"==r?a.push(m[p](M*h,!0)):"TEXCOORD_1"==r?o.push(m[p](M*h,!0)):RedGLUtil.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r),v++}},P=function(e,t,r,i){var n=[];r.targets&&r.targets.forEach(function(r){var i={vertices:[],verticesColor_0:[],normals:[],uvs:[],uvs1:[],jointWeights:[],joints:[],tangents:[]};for(var a in n.push(i),r){var o=i.vertices,s=i.verticesColor_0,d=i.normals,u=i.uvs,c=i.uvs1,l=i.jointWeights,f=i.joints,h=i.tangents,R=r[a],m=new b(e,t,R);L(0,0,a,m,o,u,c,d,l,f,s,h),m.accessor.sparse&&M(e,a,m.accessor,t,o)}}),this.list=n,n.weights=i||[],this.origin=null},T=(g=function(e,t,r){return t.images[r].uri.indexOf("blob:http")>-1?t.images[r].uri:(t.images[r].uri.indexOf(";base64,")>-1?"":e.path)+t.images[r].uri},v=function(e,t,r){var i={};if(t.samplers){var n=t.samplers[r];"magFilter"in n&&(i.mag=n.magFilter),"minFilter"in n&&(i.min=n.minFilter),"wrapS"in n&&(i.wrap_s=n.wrapS),"wrapT"in n&&(i.wrap_t=n.wrapT)}return i.string=JSON.stringify(i),i},function(e,t,r){var i,n,a=!1,o=.5;if("material"in r){var s,d,u,c,l,f=r.material,h=t.materials[f];if("doubleSided"in h&&(a=!!h.doubleSided),"alphaMode"in h&&(n=h.alphaMode),"alphaCutoff"in h&&(o=h.alphaCutoff),"baseColorTexture"in h.pbrMetallicRoughness){var R=h.pbrMetallicRoughness.baseColorTexture.index,m=t.textures[R],p=m.source,_=g(e,t,p),E=m.sampler,M=_+(S=v(0,t,E)).string;s=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,S)}if("metallicRoughnessTexture"in h.pbrMetallicRoughness){var b=h.pbrMetallicRoughness.metallicRoughnessTexture.index,L=t.textures[b],P=L.source;_=g(e,t,P),E=L.sampler,M=_+(S=v(0,t,E)).string,u=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,S)}var T=h.normalTexture;if(null!=T){T=T.index;var y=t.textures[T],x=y.source;_=g(e,t,x),E=y.sampler,M=_+(S=v(0,t,E)).string,d=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,S)}var w=h.emissiveTexture;if(null!=w){w=w.index;var I=t.textures[w],U=I.source;_=g(e,t,U),E=I.sampler,M=_+(S=v(0,t,E)).string,c=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,S)}var D,B,G=h.occlusionTexture;if(null!=G){G=G.index;var S,A=t.textures[G],F=A.source;_=g(e,t,F),E=A.sampler,M=_+(S=v(0,t,E)).string,l=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,S)}"metallicFactor"in h.pbrMetallicRoughness&&(D=h.pbrMetallicRoughness.metallicFactor),"roughnessFactor"in h.pbrMetallicRoughness&&(B=h.pbrMetallicRoughness.roughnessFactor);var C=e.environmentTexture;i=RedPBRMaterial_System(e.redGL,s,C,d,l,c,u,null),O=h.pbrMetallicRoughness&&h.pbrMetallicRoughness.baseColorFactor?h.pbrMetallicRoughness.baseColorFactor:[1,1,1,1],i.baseColorFactor=new Float32Array(O),h.pbrMetallicRoughness&&(i.metallicFactor=null!=D?D:1,i.roughnessFactor=null!=B?B:1),i.emissiveFactor=null!=h.emissiveFactor?h.emissiveFactor:new Float32Array([1,1,1]),h.pbrMetallicRoughness&&(h.pbrMetallicRoughness.metallicRoughnessTexture&&(i.roughnessTexCoordIndex=h.pbrMetallicRoughness.metallicRoughnessTexture.texCoord||0),h.pbrMetallicRoughness.baseColorTexture&&(i.diffuseTexCoordIndex=h.pbrMetallicRoughness.baseColorTexture.texCoord||0)),h.occlusionTexture&&(i.occlusionTexCoordIndex=h.occlusionTexture.texCoord||0,i.occlusionPower=h.occlusionTexture.strength||1),h.emissiveTexture&&(i.emissiveTexCoordIndex=h.emissiveTexture.texCoord||0),h.normalTexture&&(i.normalTexCoordIndex=h.normalTexture.texCoord||0)}else{var O=[Math.random(),Math.random(),Math.random(),1];(i=RedPBRMaterial_System(e.redGL)).baseColorFactor=new Float32Array(O)}return[i,a,n,o]}),y=function(e,t,r,i,n,a,o,s,d){for(var u=0,c=t.length/3,l=0;u<c;u++)t.length&&(e[l++]=t[3*u+0],e[l++]=t[3*u+1],e[l++]=t[3*u+2]),r.length?(e[l++]=r[4*u+0],e[l++]=r[4*u+1],e[l++]=r[4*u+2],e[l++]=r[4*u+3]):(e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=0),i.length&&(e[l++]=i[3*u+0],e[l++]=i[3*u+1],e[l++]=i[3*u+2]),n.length||n.push(0,0),n.length&&(e[l++]=n[2*u+0],e[l++]=n[2*u+1]),a.length?(e[l++]=a[2*u+0],e[l++]=a[2*u+1]):n.length&&(e[l++]=n[2*u+0],e[l++]=n[2*u+1]),o.length&&(e[l++]=o[4*u+0],e[l++]=o[4*u+1],e[l++]=o[4*u+2],e[l++]=o[4*u+3]),s.length&&(e[l++]=s[4*u+0],e[l++]=s[4*u+1],e[l++]=s[4*u+2],e[l++]=s[4*u+3]),d.length?(e[l++]=d[4*u+0],e[l++]=d[4*u+1],e[l++]=d[4*u+2],e[l++]=d[4*u+3]):(e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=0)};return o=function(e,t,r){var i,n,a,o;r.name&&(i=r.name);var s=[];return r.primitives.forEach(function(d,u){var c,l,f,h,R=[],m=[],p=[],_=[],g=[],v=[],E=[],x=[],w=[];if(d.attributes)for(var I in d.attributes){var U=d.attributes[I],D=new b(e,t,U);L(0,0,I,D,m,_,g,v,E,x,p,w),D.accessor.sparse&&M(e,I,D.accessor,t,m)}if("indices"in d){U=d.indices;!function(e,t,r,i,n){var a,o=i.componentType_BYTES_PER_ELEMENT,s=i.bufferURIDataView,d=i.getMethod,u=i.accessor.type,c=i.accessor.count,l=i.startIndex;switch(u){case"SCALAR":for(a=l+c;l<a;l++)n.push(s[d](l*o,!0))}}(0,0,0,D=new b(e,t,U),R)}if(l=T(e,t,d),n=l[1],a=l[2],o=l[3],(l=l[0])instanceof RedPBRMaterial_System&&e.parsingResult.materials.push(l),"mode"in d)switch(d.mode){case 0:f=e.redGL.gl.POINTS;break;case 1:f=e.redGL.gl.LINES;break;case 2:f=e.redGL.gl.LINE_LOOP;break;case 3:f=e.redGL.gl.LINE_STRIP;break;case 4:f=e.redGL.gl.TRIANGLES;break;case 5:f=e.redGL.gl.TRIANGLE_STRIP;break;case 6:f=e.redGL.gl.TRIANGLE_FAN}h=v.length?v:RedGLUtil.calculateNormals(m,R);var B,G=[];y(G,m,p,h,_,g,E,x,w);var S=[];if(m.length&&S.push(RedInterleaveInfo("aVertexPosition",3)),S.push(RedInterleaveInfo("aVertexColor_0",4)),h.length&&S.push(RedInterleaveInfo("aVertexNormal",3)),_.length&&S.push(RedInterleaveInfo("aTexcoord",2)),g.length?S.push(RedInterleaveInfo("aTexcoord1",2)):_.length&&S.push(RedInterleaveInfo("aTexcoord1",2)),E.length&&S.push(RedInterleaveInfo("aVertexWeight",4)),x.length&&S.push(RedInterleaveInfo("aVertexJoint",4)),S.push(RedInterleaveInfo("aVertexTangent",4)),B=RedGeometry(RedBuffer(e.redGL,"testGLTF_interleaveBuffer_"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(G),S),R.length?RedBuffer(e.redGL,"testGLTF_indexBuffer_"+RedGL.makeUUID(),RedBuffer.ELEMENT_ARRAY_BUFFER,e.redGL.gl.glExtension.OES_element_index_uint?new Uint32Array(R):new Uint16Array(R)):null),l||RedGLUtil.throwFunc("재질을 파싱할수없는경우 ",d),c=RedMesh(e.redGL,B,l),i&&(c.name=i,e.parsingOption))for(var A in e.parsingOption)i.toLowerCase().indexOf(A)>-1&&e.parsingOption[A](c);switch(c.drawMode=f||e.redGL.gl.TRIANGLES,n&&(c.useCullFace=!1,l.useMaterialDoubleSide=!0),a){case"BLEND":c.useTransparentSort=!0;break;case"MASK":c.useBlendMode=!1,l.cutOff=o;break;default:c.useBlendMode=!1,l._cutOff=-.1}p.length&&(l.useVertexColor_0=!0),w.length&&(l.useVertexTangent=!0);var F=new P(e,t,d,r.weights);F.list.forEach(function(e){var t;t=e.normals.length?e.normals:RedGLUtil.calculateNormals(e.vertices,R);var r=[];y(r,e.vertices,e.verticesColor_0,t,e.uvs,e.uvs1,e.jointWeights,e.joints,e.tangents),e.interleaveData=r}),c._morphInfo=F,c._morphInfo.origin=new Float32Array(G);var C=c.geometry.interleaveBuffer.data,O=0;S.forEach(function(e){O+=e.size});c._morphInfo.list.forEach(function(e,t){for(var r=0,i=C.length/O,n=null==c._morphInfo.list.weights[t]?.5:c._morphInfo.list.weights[t];r<i;r++)C[r*O+0]+=e.vertices[3*r+0]*n,C[r*O+1]+=e.vertices[3*r+1]*n,C[r*O+2]+=e.vertices[3*r+2]*n}),c.geometry.interleaveBuffer.upload(C),c._morphInfo.origin=new Float32Array(C),d.RedMesh=c,s.push(c)}),s},E=function(e,t,r){var i,n=[],a=new b(e,t,r),o=a.componentType_BYTES_PER_ELEMENT,s=a.bufferURIDataView,d=a.getMethod,u=a.accessor.type,c=a.accessor.count,l=a.startIndex;switch(u){case"SCALAR":for(i=l+1*c;l<i;l++)n.push(s[d](l*o,!0));break;case"VEC4":for(i=l+4*c;l<i;l++)n.push(s[d](l*o,!0));break;case"VEC3":for(i=l+3*c;l<i;l++)n.push(s[d](l*o,!0))}return n},s=function(e,t){var r=t.nodes,i=t.meshes;t.accessors,t.animations||(t.animations=[]),t.animations.forEach(function(n,a){var o=n.samplers,s=[];s.minTime=1e7,s.maxTime=-1,s.name=n.name,e.parsingResult.animations.push(s),n.channels.forEach(function(n,a){var d,u,c,l,f,h=[];if(d=o[n.sampler],u=n.target,"mesh"in(l=r[u.node]))c=l.RedMesh,i[l.mesh].primitives.forEach(function(t){h.push(t.RedMesh),t.RedMesh.geometry.drawMode=e.redGL.gl.DYNAMIC_DRAW});else{if(!e.parsingResult.groups[u.node])return;c=e.parsingResult.groups[u.node]}"scale"!=u.path&&"rotation"!=u.path&&"translation"!=u.path&&"weights"!=u.path||s.push(f={key:u.path,time:E(e,t,d.input),data:E(e,t,d.output),interpolation:d.interpolation,target:c,targets:h}),f&&(s.minTime>f.time[0]&&(s.minTime=f.time[0]),s.maxTime<f.time[f.time.length-1]&&(s.maxTime=f.time[f.time.length-1]))})}),e.parsingResult.animations.length&&e.parsingResult.animations.forEach(function(t){e.playAnimation(t)})},function(r,i,n,o,d){e(n),d?(n.buffers[0].uri=d,t(r,n,function(){u(r,n),a(r,n,function(){s(r,n),o&&o()})})):t(r,n,function(){u(r,n),a(r,n,function(){s(r,n),o&&o()})})}}(),Object.freeze(RedGLTFLoader)}(),RedLinePoint=function(e,t,r,i,n,a,o,s,d){if(!(this instanceof RedLinePoint))return new RedLinePoint(e,t,r,i,n,a,o,s,d);this._inPoint=[i||0,n||0,a||0],this._point=[e||0,t||0,r||0],this._outPoint=[o||0,s||0,d||0],this._UUID=RedGL.makeUUID()},Object.freeze(RedLinePoint),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p,_,g;t=function(e,t,r){var i,n,a,o=[],s=!1,d=!1,u=0,c="",l=[],f=[0,0],h=[0,0];function R(){if(c.length>0){var e=parseFloat(c);if(l.push(e),2===l.length){if(s&&(l[0]+=f[0],l[1]+=f[1]),o.push(l),d&&(h=l.slice()),!--u){if("l"===i){var t=o.pop(),r=o.pop(),n=vec2.lerp([0,0],r,t,.25),a=vec2.lerp([0,0],r,t,.75);o.push(r,n,a,t)}f=h}l=[]}c=""}}var m,p=e.split("");for(n=0,a=p.length;n<a;n++)(m=p[n])>="0"&&m<="9"||"."===m?c+=m:"-"===m?(R(),c="-"):"m"===m?(R(),d=!0,u=1,s=!0,i="m"):"c"===m?(R(),d=!0,u=3,s=!0,i="c"):"l"===m?(R(),d=!0,u=1,s=!1,i="l"):"M"===m?(R(),d=!0,u=1,s=!1,i="m"):"C"===m?(R(),d=!0,u=3,s=!1,i="c"):"L"===m?(R(),d=!0,u=1,s=!1,i="l"):"Z"===m||(","===m?R():" "===m&&R());R();var _=o[0].slice(),g=o[0].slice();for(n=1,a=o.length;n<a;++n)_=vec2.min([0,0],_,o[n]),g=vec2.max([0,0],g,o[n]);var v,E=vec2.sub([0,0],g,_),M=vec2.scale([0,0],E,.5);for(n=0;n<a;++n)(v=o[n])[0]=t?g[0]-v[0]:v[0]-_[0],v[1]=r?M[1]-(v[1]-_[0]):v[1]-_[0]-M[1];return o},r=function(e,t,r){return e+(t-e)*r},d=function(e){for(l=[],f=0,h=0,R=e.length;h<R-1;++h)l[h]=f,f+=vec2.distance(e[h],e[h+1]);return l.push(f),l=l.map(function(e){return e/f})},u=function(){var e,t,i,n,a,o,s=mat4.create();return function(d,u,c,l,f,h,R){var m=[],p=[];for(i=0;i<=f;++i){var _;for(a=r(c,l,n=i/f)%(2*Math.PI),o=mat4.fromYRotation(s,a),h&&(m.push(0,d[0][1],0),p.push(n,0)),e=0,t=d.length;e<t;e++)_=d[e],_=vec3.transformMat4([0,0,0],[_[0],_[1],0],o),m.push(_[0],_[1],_[2]),p.push(n,u[e]);R&&(m.push(0,d[d.length-1][1],0),p.push(n,1))}return{positions:m,texcoords:p}}}(),g=0,c=function(e,t,r){var i=[];for(g=0;g<e;++g)for(p=(m=g*t)+t,_=0;_<r;++_)i.push(m+_,m+_+1,p+_),i.push(m+_+1,p+_+1,p+_);return i},i=function(e,t,r,i,n,a,o){var s=n?1:0,l=e.length+s+(a?1:0),f=l-1,h=d(e),R=u(e,h,t,r,i,n,a);return{position:R.positions,texcoord:R.texcoords,indices:c(i,l,f,o)}},n=function(e){var t=e.indices,r=0,i=function(){return t[r++]};return i.reset=function(){r=0},i.numElements=t.length,i},a=function(e){var t=0,r=function(){return t++};return r.reset=function(){t=0},r.numElements=e.positions.length/3,r},o=function(e){return e.indices?n(e):a(e)},s=function(e,t){for(var r,i=e.position,n=e.texcoord,a=o(e),s=a.numElements,d=e.position.length,u=s/3,c=[],l=0;l<u;++l){var f=3*a(),h=3*a(),R=3*a(),m=i.slice(f,f+3),p=i.slice(h,h+3),_=i.slice(R,R+3);c.push(vec3.normalize([0,0,0],vec3.cross([0,0,0],vec3.sub([0,0,0],m,p),vec3.sub([0,0,0],_,p))))}var g={},v=0;function E(e){var t=e,r=g[t];if(void 0!==r)return r;var i=v++;return g[t]=i,i}var M=[];for(l=0;l<d;++l){var b=3*l,L=i.slice(b,b+3);M.push(E(L))}var P=[];for(a.reset(),l=0;l<u;++l)for(r=0;r<3;++r){(S=P[G=M[B=a()]])||(S=[],P[G]=S),S.push(l)}g={},v=0;var T=[],y=[],x=[];function w(e,t,r,i,n,a,o,s){var d=e+","+t+","+r+","+i+","+n+","+a+","+o+","+s,u=g[d];if(void 0!==u)return u;var c=v++;return g[d]=c,T.push(e,t,r),x.push(i,n,a),y.push(o,s),c}var I=[];a.reset();var U=Math.cos(t);for(l=0;l<u;++l){var D=c[l];for(r=0;r<3;++r){var B,G,S=P[G=M[B=a()]],A=[0,0,0];S.forEach(function(e){var t=c[e];vec3.dot(D,t)>U&&vec3.add(A,A,t)}),vec3.normalize(A,A);var F=3*B,C=2*B;I.push(w(i[F+0],i[F+1],i[F+2],A[0],A[1],A[2],n[C+0],n[C+1]))}}return{position:T,texcoord:y,normal:x,indices:I}},e=function(e,t,r){var i,n=[],a=r.position,o=r.normal,s=r.texcoord;i=r.indices;for(var d,u=0,c=a.length/3;u<c;u++)d=3*u,n.push(a[d+0],a[d+1],a[d+2]),n.push(o[d+0],o[d+1],o[d+2]),d=2*u,n.push(s[d+0],s[d+1]);return{interleaveData:n,indexData:i,type:t,interleaveBuffer:RedBuffer(e,t+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(n),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,t+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(i))}},(RedLathe=function(r,n,a,o,d,u,c,l,f,h,R,m){if(!(this instanceof RedLathe))return new RedLathe(r,n,a,o,d,u,c,l,f,h,R,m);var p,_;if(r instanceof RedGL||RedGLUtil.throwFunc("RedLathe : RedGL Instance만 허용.",r),f=void 0!==f?f:.4,(h=void 0!==h?h:.15)<.1&&(h=.1),p="RedLathe_"+n+"_"+(a=Math.floor(a)||16)+"_"+(o=void 0!==o&&o)+"_"+(d=void 0!==d&&d)+"_"+(u=void 0!==u?u:0)+"_"+(c=void 0!==c?c:2*Math.PI)+"_"+(l=void 0!==l?l:Math.PI/180*30)+"_"+f+"_"+h+"_"+R+"_"+m,r._datas.Primitives||(r._datas.Primitives={}),r._datas.Primitives[p])return r._datas.Primitives[p];r._datas.Primitives[p]=this;var g=t(n,R,m),v=RedLine.prototype._getPointsOnBezierCurves(g,h),E=RedLine.prototype._simplifyPoints(v,0,v.length,f),M=i(E,u,c,a,o,d);_=e(r,p,s(M,l)),this.interleaveBuffer=_.interleaveBuffer,this.indexBuffer=_.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._UUID=RedGL.makeUUID()}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedLathe)}(),(RedAxis=function(e){if(!(this instanceof RedAxis))return new RedAxis(e);var t,r,i,n,a,o,s;e instanceof RedGL||RedGLUtil.throwFunc("RedAxis : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),i=RedBox(e),n=RedCylinder(e,0,.5),a=RedColorMaterial(e,"#ff0000"),o=RedColorMaterial(e,"#00ff00"),s=RedColorMaterial(e,"#0000ff"),t=RedMesh(e,n,a),(r=RedMesh(e,i,a)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleX=5,t.x=5,t.rotationZ=90,r.x=2.5,this.children.push(r),this.children.push(t),t=RedMesh(e,n,o),(r=RedMesh(e,i,o)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleY=5,t.y=5,r.y=2.5,this.children.push(r),this.children.push(t),t=RedMesh(e,n,s),(r=RedMesh(e,i,s)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleZ=5,t.z=5,t.rotationX=-90,r.z=2.5,this.children.push(r),this.children.push(t),this.children.push(RedMesh(e,RedSphere(e,.25,16,16,16),RedColorMaterial(e,"#ff00ff"))),this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,Object.freeze(RedAxis),function(){var e,t,r,i,n,a;(RedGrid=function(e,t,r,i,n){if(!(this instanceof RedGrid))return new RedGrid(e,t,r,i,n);var a;e instanceof RedGL||RedGLUtil.throwFunc("RedGrid : RedGL Instance만 허용.",e),a=e.gl,RedBaseObject3D.build.call(this,a),this._redGL=e,this.size=t||100,this.divisions=r||100,this.color1=i||"#cccccc",this.color2=n||"#666666",this.geometry=this._makeGridGeometry(),this.material=RedGridMaterial(e),this.drawMode=a.LINES,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedGrid.prototype._makeGridGeometry=function(){if(this.color2){var o=[];for(e=this._divisions/2,t=this._size/this._divisions,r=this._size/2,i=0,n=-r;i<=this._divisions;i++,n+=t)a=i===e?RedGLUtil.hexToRGB_ZeroToOne(this.color1):RedGLUtil.hexToRGB_ZeroToOne(this.color2),o.push(-r,0,n,a[0],a[1],a[2],1,r,0,n,a[0],a[1],a[2],1,n,0,-r,a[0],a[1],a[2],1,n,0,r,a[0],a[1],a[2],1);return RedGeometry(RedBuffer(this._redGL,"gridInterleaveBuffer_"+this._size+"_"+this._divisions+"_"+this.color1+"_"+this.color2,RedBuffer.ARRAY_BUFFER,new Float32Array(o),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexColor",4)]))}},RedGrid.prototype._update=function(){this.geometry=this._makeGridGeometry()},RedDefinePropertyInfo.definePrototype("RedGrid","size","number",{min:1,callback:function(){this._update()}}),RedDefinePropertyInfo.definePrototype("RedGrid","divisions","uint",{min:1,callback:function(){this._update()}}),Object.defineProperty(RedGrid.prototype,"color1",{get:function(){return this._color1},set:function(e){return RedGLUtil.regHex(e)||RedGLUtil.throwFunc("RedGrid : color1 hex 형식만 허용.",e),this._color1=e,this._update(),this._color1}}),Object.defineProperty(RedGrid.prototype,"color2",{get:function(){return this._color2},set:function(e){return RedGLUtil.regHex(e)||RedGLUtil.throwFunc("RedGrid : color2 hex 형식만 허용.",e),this._color2=e,this._update(),this._color2}}),Object.defineProperty(RedGrid.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedGridMaterial||RedGLUtil.throwFunc("RedGrid : RedGridMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedGrid)}(),(RedMesh=function(e,t,r){if(!(this instanceof RedMesh))return new RedMesh(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedMesh : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=t,this.material=r,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedDefinePropertyInfo.definePrototypes("RedMesh",["perspectiveScale","boolean"],["sprite3DYn","boolean"]),Object.freeze(RedMesh),function(){var e,t,r,i,n,a,o,s,d,u;s=function(e,t,r){var i=vec2.sqrDist(t,r);if(0===i)return vec2.sqrDist(e,t);var n=((e[0]-t[0])*(r[0]-t[0])+(e[1]-t[1])*(r[1]-t[1]))/i;return n=Math.max(0,Math.min(1,n)),vec2.sqrDist(e,vec2.lerp([0,0],t,r,n))},o=function(e,t,r,i,n){for(var a=n||[],d=e[t],u=e[r-1],c=0,l=1,f=t+1;f<r-1;++f){var h=s(e[f],d,u);h>c&&(c=h,l=f)}return Math.sqrt(c)>i?(o(e,t,l+1,i,a),o(e,l,r,i,a)):a.push(d,u),a},e=function(e,t){null==t&&(t=1);for(var r,i,n,a,o=e.length,s=o-2,d=0;d<o-1;d++)r=d?e[d-1]._point:e[d]._point,i=e[d]._point,n=e[d+1]._point,a=d==s?n:e[d+2]._point,e[d]._outPoint[0]=i[0]+(n[0]-r[0])/6*t,e[d]._outPoint[1]=i[1]+(n[1]-r[1])/6*t,e[d]._outPoint[2]=i[2]+(n[2]-r[2])/6*t,e[d+1]._inPoint[0]=n[0]-(a[0]-i[0])/6*t,e[d+1]._inPoint[1]=n[1]-(a[1]-i[1])/6*t,e[d+1]._inPoint[2]=n[2]-(a[2]-i[2])/6*t;return e},r=function(e){var t,r,i,n=[],a=0;for(t=0,r=e.length;t<r;t++)i=e[t],0==a?(n[a++]=i._point,n[a++]=i._outPoint):(n[a++]=i._inPoint,n[a++]=i._point,e[t+1]&&(n[a++]=i._outPoint));return n},d=function(e,t){var r=e[t+0],i=e[t+1],n=e[t+2],a=e[t+3],o=3*i[0]-2*r[0]-a[0],s=3*i[1]-2*r[1]-a[1],d=3*n[0]-2*a[0]-r[0],u=3*n[1]-2*a[1]-r[1];return(o*=o)<(d*=d)&&(o=d),(s*=s)<(u*=u)&&(s=u),o+s},u=function(e,t,r,i){var n=i||[];if(d(e,t)<r)n.push(e[t+0]),n.push(e[t+3]);else{var a=.5,o=e[t+0],s=e[t+1],c=e[t+2],l=e[t+3],f=vec3.lerp([0,0],o,s,a),h=vec3.lerp([0,0],s,c,a),R=vec3.lerp([0,0],c,l,a),m=vec3.lerp([0,0],f,h,a),p=vec3.lerp([0,0],h,R,a),_=vec3.lerp([0,0],m,p,a);u([o,f,m,_],0,r,n),u([_,p,R,l],0,r,n)}return n},t=function(e,t){var r=[],i=(e.length-1)/3;i=Math.floor(i);for(var n=0;n<i;++n)u(e,3*n,t,r);return r},a=function(e){e.points.forEach(function(t,r){var i;t._debugObjectInPointMesh&&(t._debugObjectPointMesh.removeChild(i=t._debugObjectInPointMesh),i.disposeAll(),t._debugObjectInPointMesh=null),t._debugObjectOutPointMesh&&(t._debugObjectPointMesh.removeChild(i=t._debugObjectOutPointMesh),i.disposeAll(),t._debugObjectOutPointMesh=null),t._debugObjectPointMesh&&(e.removeChild(i=t._debugObjectPointMesh),i.disposeAll(),t._debugObjectPointMesh=null)})},n=function(e){var t,r,i,n=e._redGL;a(e),e.points.forEach(function(a,o){a._debugObjectPointMesh||(a._debugObjectPointMesh=RedMesh(n,RedBox(n,1,1,1),RedColorMaterial(n,"#00ff00")),e.addChild(a._debugObjectPointMesh)),r=a._debugObjectPointMesh,e._type==RedLine.LINEAR||(o&&(a._debugObjectInPointMesh||(a._debugObjectInPointMesh=RedMesh(n,RedBox(n,.5,.5,.5),RedColorMaterial(n,e._type==RedLine.BEZIER?"#0000ff":"#fff",e._type==RedLine.BEZIER?1:.5)),(i=RedLine(n,RedColorMaterial(n,"#fff",.5))).drawMode=n.gl.LINES,r.addChild(a._debugObjectInPointMesh),a._debugObjectInPointMesh.addChild(i)),(i=a._debugObjectInPointMesh.getChildAt(0))._interleaveData.length=0,i._interleaveData.push(0,0,0),i._interleaveData.push(a._point[0]-a._inPoint[0],a._point[1]-a._inPoint[1],a._point[2]-a._inPoint[2]),i._upload()),o!=e.points.length-1&&(a._debugObjectOutPointMesh||(a._debugObjectOutPointMesh=RedMesh(n,RedBox(n,.5,.5,.5),RedColorMaterial(n,e._type==RedLine.BEZIER?"#ff0000":"#fff",e._type==RedLine.BEZIER?1:.5)),(i=RedLine(n,RedColorMaterial(n,"#fff",.5))).drawMode=n.gl.LINES,r.addChild(a._debugObjectOutPointMesh),a._debugObjectOutPointMesh.addChild(i)),(i=a._debugObjectOutPointMesh.getChildAt(0))._interleaveData.length=0,i._interleaveData.push(0,0,0),i._interleaveData.push(a._point[0]-a._outPoint[0],a._point[1]-a._outPoint[1],a._point[2]-a._outPoint[2]),i._upload())),a._debugObjectPointMesh&&((t=a._debugObjectPointMesh).x=a._point[0],t.y=a._point[1],t.z=a._point[2]),a._debugObjectOutPointMesh&&(a._debugObjectOutPointMesh.x=a._outPoint[0]-a._point[0],a._debugObjectOutPointMesh.y=a._outPoint[1]-a._point[1],a._debugObjectOutPointMesh.z=a._outPoint[2]-a._point[2]),a._debugObjectInPointMesh&&(a._debugObjectInPointMesh.x=a._inPoint[0]-a._point[0],a._debugObjectInPointMesh.y=a._inPoint[1]-a._point[1],a._debugObjectInPointMesh.z=a._inPoint[2]-a._point[2])})},i=function(i,a,s,d){switch(i._interleaveData.length=0,i._type){case RedLine.CATMULL_ROM:if(i.points.length>1){var u=e(i.points,a);i._serializedPoints=r(u),u=t(i._serializedPoints,s);for(var c=0,l=(u=o(u,0,u.length,d)).length;c<l;c++)i._interleaveData.push(u[c][0],u[c][1],u[c][2])}else i._interleaveData.push(0,0,0);break;case RedLine.BEZIER:if(i.points.length>1){i._serializedPoints=r(i.points),u=t(i._serializedPoints,s);for(c=0,l=(u=o(u,0,u.length,d)).length;c<l;c++)i._interleaveData.push(u[c][0],u[c][1],u[c][2])}else i._interleaveData.push(0,0,0);break;default:i.points.forEach(function(e){i._interleaveData.push(e._point[0],e._point[1],e._point[2])})}i.debug&&n(i),i._upload()},(RedLine=function(e,t,r){if(!(this instanceof RedLine))return new RedLine(e,t,r);var i;e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),(t=t||RedColorMaterial(e))instanceof RedColorMaterial||RedGLUtil.throwFunc("RedLine : RedColorMaterial Instance만 허용."),i=e.gl,RedBaseObject3D.build.call(this,i),this._redGL=e,this._interleaveData=[0,0,0],this._UUID=RedGL.makeUUID(),this._interleaveBuffer=RedBuffer(e,"RedLine_InterleaveBuffer_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(this._interleaveData),[RedInterleaveInfo("aVertexPosition",3)]),this.geometry=RedGeometry(this._interleaveBuffer),this.material=t,this.drawMode=i.LINE_STRIP,this.points=[],this._serializedPoints=[],this._tension=1,this._tolerance=.01,this._distance=.1,this.type=r||RedLine.LINEAR,this._debug=!1}).LINEAR="linear",RedLine.CATMULL_ROM="catmullRom",RedLine.BEZIER="bezier",RedLine.prototype=new RedBaseContainer,RedLine.prototype.addPoint=function(e,t,r,n,a,o,s,d,u){"number"==typeof e||RedGLUtil.throwFunc("RedLine : addPoint - x값은 숫자만 허용","입력값 : "+e),"number"==typeof t||RedGLUtil.throwFunc("RedLine : addPoint - y값은 숫자만 허용","입력값 : "+t),"number"==typeof r||RedGLUtil.throwFunc("RedLine : addPoint - z값은 숫자만 허용","입력값 : "+r),a=a||0,o=o||0,"number"==typeof(n=n||0)||RedGLUtil.throwFunc("RedLine : addPoint - inX값은 숫자만 허용","입력값 : "+n),"number"==typeof a||RedGLUtil.throwFunc("RedLine : addPoint - inY값은 숫자만 허용","입력값 : "+a),"number"==typeof o||RedGLUtil.throwFunc("RedLine : addPoint - inZ값은 숫자만 허용","입력값 : "+o),d=d||0,u=u||0,"number"==typeof(s=s||0)||RedGLUtil.throwFunc("RedLine : addPoint - outX값은 숫자만 허용","입력값 : "+s),"number"==typeof d||RedGLUtil.throwFunc("RedLine : addPoint - outY값은 숫자만 허용","입력값 : "+d),"number"==typeof u||RedGLUtil.throwFunc("RedLine : addPoint - outZ값은 숫자만 허용","입력값 : "+u),this.points.push(RedLinePoint(e,t,r,n,a,o,s,d,u)),i(this,this._tension,this._tolerance,this._distance)},RedLine.prototype.addPointAt=function(e,t,r,n,a,o,s,d,u,c){"number"==typeof t||RedGLUtil.throwFunc("RedLine : addPoint - x값은 숫자만 허용","입력값 : "+t),"number"==typeof r||RedGLUtil.throwFunc("RedLine : addPoint - y값은 숫자만 허용","입력값 : "+r),"number"==typeof n||RedGLUtil.throwFunc("RedLine : addPoint - z값은 숫자만 허용","입력값 : "+n),o=o||0,s=s||0,"number"==typeof(a=a||0)||RedGLUtil.throwFunc("RedLine : addPoint - inX값은 숫자만 허용","입력값 : "+a),"number"==typeof o||RedGLUtil.throwFunc("RedLine : addPoint - inY값은 숫자만 허용","입력값 : "+o),"number"==typeof s||RedGLUtil.throwFunc("RedLine : addPoint - inZ값은 숫자만 허용","입력값 : "+s),u=u||0,c=c||0,"number"==typeof(d=d||0)||RedGLUtil.throwFunc("RedLine : addPoint - outX값은 숫자만 허용","입력값 : "+d),"number"==typeof u||RedGLUtil.throwFunc("RedLine : addPoint - outY값은 숫자만 허용","입력값 : "+u),"number"==typeof c||RedGLUtil.throwFunc("RedLine : addPoint - outZ값은 숫자만 허용","입력값 : "+c),"number"==typeof e||RedGLUtil.throwFunc("addPointAt","index는 숫자만 입력가능","입력값 : "+e),this.points.length<e&&(e=this.points.length),null!=e?this.points.splice(e,0,RedLinePoint(t,r,n,a,o,s,d,u,c)):this.points.push(RedLinePoint(t,r,n,a,o,s,d,u,c)),i(this,this._tension,this._tolerance,this._distance)},RedLine.prototype.removePointAt=function(e){"number"!=typeof e&&RedGLUtil.throwFunc("removeChildAt","index가 Number형이 아님 ","입력값 : "+e),this.points[e]?this.points.splice(e,1):RedGLUtil.throwFunc("removeChildAt","index 해당인덱스에 위치한 포인트가 없음.","입력값 : "+e),i(this,this._tension,this._tolerance,this._distance)},RedLine.prototype.removeAllPoint=function(){this.points.length=0,i(this,this._tension,this._tolerance,this._distance),this._upload()},RedLine.prototype._upload=function(){this._interleaveBuffer.upload(new Float32Array(this._interleaveData))},Object.defineProperty(RedLine.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedLine : geometry - 임의로 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedLine.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorMaterial||RedGLUtil.throwFunc("RedLine : RedColorMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.defineProperty(RedLine.prototype,"type",{get:function(){return this._type},set:function(e){e!=RedLine.LINEAR&&e!=RedLine.CATMULL_ROM&&e!=RedLine.BEZIER&&RedGLUtil.throwFunc("RedLine : 허용하지 않는 타입","입력값 : "+e),this._type=e,i(this,this._tension,this._tolerance,this._distance)}}),RedDefinePropertyInfo.definePrototype("RedLine","tension","number",{callback:function(e){i(this,this._tension,this._tolerance,this._distance)}}),RedDefinePropertyInfo.definePrototype("RedLine","distance","number",{min:0,callback:function(e){i(this,this._tension,this._tolerance,this._distance)}}),RedDefinePropertyInfo.definePrototype("RedLine","debug","boolean",{callback:function(e){e?n(this):a(this)}}),RedLine.prototype._simplifyPoints=o,RedLine.prototype._getPointsOnBezierCurves=t,Object.freeze(RedLine)}(),function(){(RedLatheMesh=function(t,r,i,n,a,o,s,d,u,c,l,f,h){if(!(this instanceof RedLatheMesh))return new RedLatheMesh(t,r,i,n,a,o,s,d,u,c,l,f,h);t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),RedBaseObject3D.build.call(this,t.gl),this._pathString=r,this._redGL=t,this.numDivisions=n=Math.floor(n)||16,this.capStart=void 0!==a&&a,this.capEnd=void 0!==o&&o,this.startAngle=void 0!==s?s:0,this.endAngle=void 0!==d?d:2*Math.PI,this.distance=void 0!==c?c:.4,this.maxAngle=void 0!==u?u:Math.PI/180*30,this.tolerance=void 0!==l?l:.15,this.flipX=!!f,this.flipY=!!h,this._tolerance<.1&&(this._tolerance=.1),e.call(this),this.material=i,this.useCullFace=!1,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer;var e=function(){this._geometry=RedLathe(this._redGL,this._pathString,this._numDivisions,this._capStart,this._capEnd,this._startAngle,this._endAngle,this._maxAngle,this._distance,this._tolerance,this._flipX,this._flipY)};Object.defineProperty(RedLatheMesh.prototype,"pathString",{get:function(){return this._pathString},set:function(t){this._pathString=t,e.call(this)}}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","numDivisions","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","capStart","boolean",{callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","capEnd","boolean",{callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","startAngle","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","endAngle","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","maxAngle","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","distance","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","tolerance","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","flipX","boolean",{callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","flipY","boolean",{callback:e}),Object.freeze(RedLatheMesh)}(),(RedSkyBox=function(e,t,r){if(!(this instanceof RedSkyBox))return new RedSkyBox(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedSkyBox : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=RedBox(e),this.material=RedSkyBoxMaterial(e,RedBitmapCubeTexture(e,t)),this.cullFace=e.gl.FRONT,this.alpha=null==r?1:r,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseObject3D,RedDefinePropertyInfo.definePrototype("RedSkyBox","alpha","number",{min:0,max:1,callback:function(e){this.material.alpha=e}}),Object.defineProperty(RedSkyBox.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedSkyBox : geometry - 임의로 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedSkyBox.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedSkyBoxMaterial||RedGLUtil.throwFunc("RedSkyBox : RedSkyBoxMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedSkyBox),(RedSprite3D=function(e,t){if(!(this instanceof RedSprite3D))return new RedSprite3D(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedSprite3D : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=RedPlane(e,1,1,0),this.material=t,this.perspectiveScale=!0,this.sprite3DYn=!0,this.useCullFace=!1,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedDefinePropertyInfo.definePrototypes("RedSprite3D",["perspectiveScale","boolean"],["sprite3DYn","boolean"]),Object.defineProperty(RedSprite3D.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorMaterial||e instanceof RedBitmapMaterial||e instanceof RedSheetMaterial||e instanceof RedVideoMaterial||RedGLUtil.throwFunc("RedSprite3D : RedColorMaterial or RedBitmapMaterial or RedSheetMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedSprite3D),function(){var e=function(e,t){switch(e.boundBoxMode){case RedTransformController.AABB:!function(e,t){var r=t.volumeCalculateAABB(),i=0;i<r.volume[0]&&(i=r.volume[0]),i<r.volume[1]&&(i=r.volume[1]),i<r.volume[2]&&(i=r.volume[2]),e.useScale&&(e.rotationGroup.scaleX=e.rotationGroup.scaleY=e.rotationGroup.scaleZ=i),e.boundBox.matrix=r.worldMatrix}(e,t);break;case RedTransformController.OBB:!function(e,t){var r=t.volumeCalculateOBB(),i=0;i<t.scaleX&&(i=t.scaleX),i<t.scaleY&&(i=t.scaleY),i<t.scaleZ&&(i=t.scaleZ),e.useScale&&(e.rotationGroup.scaleX=e.rotationGroup.scaleY=e.rotationGroup.scaleZ=i),e.boundBox.matrix=r.worldMatrix}(e,t)}},t=[];(RedTransformController=function(e){if(!(this instanceof RedTransformController))return new RedTransformController(e);e instanceof RedGL||RedGLUtil.throwFunc("RedTransformController : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this._setRotationGroup(e),this._setScaleGroup(e),this._setPositionGroup(e),this.boundBox=RedMesh(e,RedBox(e),RedColorMaterial(e)),this.boundBox.drawMode=e.gl.LINE_LOOP,this.boundBox.autoUpdateMatrix=!1,this.children.push(this.boundBox),this._boundBoxMode=RedTransformController.AABB,this.downed=!1,this.useScale=!0,this.usePosition=!0,this.useRotation=!0,t.push(this),this._UUID=RedGL.makeUUID()}).AABB="AABB",RedTransformController.OBB="OBB",RedTransformController.prototype=new RedBaseContainer,Object.defineProperty(RedTransformController.prototype,"boundBoxMode",{get:function(){return this._boundBoxMode},set:function(t){t!==RedTransformController.AABB&&t!==RedTransformController.OBB&&RedGLUtil.throwFunc("RedTransformController : boundBoxMode는 RedTransformController.AABB or RedTransformController.OBB만 허용함"),this._boundBoxMode=t,e(this,this._targetMesh)}}),RedDefinePropertyInfo.definePrototype("RedTransformController","useScale","boolean",{callback:function(e){t.forEach(function(t){t.scaleGroup.scaleX=t.scaleGroup.scaleY=t.scaleGroup.scaleZ=e?1:0})}}),RedDefinePropertyInfo.definePrototype("RedTransformController","usePosition","boolean",{callback:function(e){t.forEach(function(t){t.positionGroup.scaleX=t.positionGroup.scaleY=t.positionGroup.scaleZ=e?1:0})}}),RedDefinePropertyInfo.definePrototype("RedTransformController","useRotation","boolean",{callback:function(e){t.forEach(function(t){t.rotationGroup.scaleX=t.rotationGroup.scaleY=t.rotationGroup.scaleZ=e?1:0})}}),RedTransformController.prototype._setScaleGroup=function(e){var t,r,i=RedColorMaterial(e,"#ff0000",.5),n=RedColorMaterial(e,"#00ff00",.5),a=RedColorMaterial(e,"#0000ff",.5);r=RedSphere(e,.25),this.scaleGroup=RedMesh(e),this.children.push(this.scaleGroup),(t=RedMesh(e,r,i)).x=4,t.useCullFace=!1,t.depthTestFunc=e.gl.ALWAYS,this.scalePointX=t,this.scaleGroup.addChild(t),(t=RedMesh(e,r,n)).y=4,t.useCullFace=!1,t.depthTestFunc=e.gl.ALWAYS,this.scalePointY=t,this.scaleGroup.addChild(t),(t=RedMesh(e,r,a)).z=4,t.useCullFace=!1,t.depthTestFunc=e.gl.ALWAYS,this.scalePointZ=t,this.scaleGroup.addChild(t)},RedTransformController.prototype._setRotationGroup=function(e){var t,r,i,n=RedColorMaterial(e,"#ff0000",0),a=RedColorMaterial(e,"#00ff00",0),o=RedColorMaterial(e,"#0000ff",0);this.rotationGroup=RedMesh(e),this.children.push(this.rotationGroup),(t=RedMesh(e,RedSphere(e,1,32,32,32),n)).scaleZ=0,t.rotationX=90,t.rotationY=90,this.rotationGroup.addChild(t),(r=RedMesh(e,RedSphere(e,1,32,32,32),a)).scaleZ=0,r.rotationZ=90,r.rotationX=90,this.rotationGroup.addChild(r),(i=RedMesh(e,RedSphere(e,1,32,32,32),o)).scaleZ=0,this.rotationGroup.addChild(i),this.rotationXLine=t,this.rotationYLine=r,this.rotationZLine=i,t=RedLine(e,RedColorMaterial(e,"#ff0000",.75)),r=RedLine(e,RedColorMaterial(e,"#00ff00",.75)),i=RedLine(e,RedColorMaterial(e,"#0000ff",.75));var s=36,d=2*Math.PI/s;for(s=36;s--;)t.addPoint(Math.sin(d*s),Math.cos(d*s),0);for(t.addPoint(Math.sin(d*s),Math.cos(d*s),0),s=36;s--;)r.addPoint(Math.sin(d*s),Math.cos(d*s),0);for(r.addPoint(Math.sin(d*s),Math.cos(d*s),0),s=36;s--;)i.addPoint(Math.sin(d*s),Math.cos(d*s),0);i.addPoint(Math.sin(d*s),Math.cos(d*s),0),this.rotationXLine.addChild(t),this.rotationYLine.addChild(r),this.rotationZLine.addChild(i)},RedTransformController.prototype._setPositionGroup=function(e){var t,r,i,n,a,o,s;this.positionGroup=RedMesh(e),this.addChild(this.positionGroup),i=RedBox(e),n=RedCylinder(e,0,.5),a=RedColorMaterial(e,"#ff0000",.5),o=RedColorMaterial(e,"#00ff00",.5),s=RedColorMaterial(e,"#0000ff",.5),t=RedMesh(e,n,a),(r=RedMesh(e,i,a)).depthTestFunc=e.gl.ALWAYS,t.depthTestFunc=e.gl.ALWAYS,r.scaleX=r.scaleY=r.scaleZ=.01,r.scaleX=5,t.x=5,t.rotationZ=90,r.x=2.5,this.arrowX=t,this.positionGroup.addChild(r),this.positionGroup.addChild(t),t=RedMesh(e,n,o),(r=RedMesh(e,i,o)).depthTestFunc=e.gl.ALWAYS,t.depthTestFunc=e.gl.ALWAYS,r.scaleX=r.scaleY=r.scaleZ=.01,r.scaleY=5,t.y=5,r.y=2.5,this.arrowY=t,this.positionGroup.addChild(r),this.positionGroup.addChild(t),t=RedMesh(e,n,s),(r=RedMesh(e,i,s)).depthTestFunc=e.gl.ALWAYS,t.depthTestFunc=e.gl.ALWAYS,r.scaleX=r.scaleY=r.scaleZ=.01,r.scaleZ=5,t.z=5,t.rotationX=-90,r.z=2.5,this.arrowZ=t,this.positionGroup.addChild(r),this.positionGroup.addChild(t);var d=RedMesh(e,RedSphere(e,.1,32,32,32),RedColorMaterial(e,"#5b52aa",1));d.depthTestFunc=e.gl.ALWAYS,this.move=d,this.positionGroup.addChild(d)},RedTransformController.prototype.setTarget=function(t,r){var i,n,a=this,o=t.scene,s=t.camera,d=0,u=[],c=[],l=[],f=0;a._targetMesh=r,a.scaleGroup.rotationX=r.rotationX,a.scaleGroup.rotationY=r.rotationY,a.scaleGroup.rotationZ=r.rotationZ,a.rotationGroup.rotationX=r.rotationX,a.rotationGroup.rotationY=r.rotationY,a.rotationGroup.rotationZ=r.rotationZ,a.x=r.x,a.y=r.y,a.z=r.z;var h=function(o){var h,R,m,p,_,g=RedGLUtil.screenToWorld([o.layerX,o.layerY,t._viewRect[2],t._viewRect[3]],s),v=[c[0]+g[0]-u[0],c[1]+g[1]-u[1],c[2]+g[2]-u[2]];a.usePosition&&(3===d?(a.x=r.x=v[0],a.y=r.y=v[1],a.z=r.z=v[2]):0===d?a.x=r.x=v[0]:1===d?a.y=r.y=v[1]:2===d&&(a.z=r.z=v[2])),a.useScale&&(7===d&&(r.scaleX=l[0]+(g[0]-u[0])),8===d&&(r.scaleY=l[1]+(g[1]-u[1])),9===d&&(r.scaleZ=l[2]+(g[2]-u[2]))),a.useRotation&&(4!==d&&5!==d&&6!==d||(a.scaleGroup.rotationX=r.rotationX,a.scaleGroup.rotationY=r.rotationY,a.scaleGroup.rotationZ=r.rotationZ,a.rotationGroup.rotationX=r.rotationX,a.rotationGroup.rotationY=r.rotationY,a.rotationGroup.rotationZ=r.rotationZ),4===d?(h=f<t._viewRect[2]/2?r.localToWorld(1,0,0):r.localToWorld(-1,0,0),R=vec3.dot(h,g),m=vec3.dot(h,u),p=mat4.clone(n),mat4.scale(p,p,[1/r.scaleX,1/r.scaleY,1/r.scaleZ]),mat4.rotateX(p,p,-i[0]*Math.PI/180),mat4.rotateY(p,p,-i[1]*Math.PI/180),mat4.rotateZ(p,p,-i[2]*Math.PI/180),mat4.rotateZ(p,p,i[2]*Math.PI/180),mat4.rotateY(p,p,i[1]*Math.PI/180),mat4.rotateX(p,p,i[0]*Math.PI/180+R-m),RedGLUtil.quaternionToRotationMat4(mat4.getRotation(quat.create(),p),p),_=RedGLUtil.mat4ToEuler(p,[]),r.rotationX=180*-_[0]/Math.PI,r.rotationY=180*-_[1]/Math.PI,r.rotationZ=180*-_[2]/Math.PI):5===d?(h=f<t._viewRect[2]/2?r.localToWorld(0,-1,0):r.localToWorld(0,1,0),R=vec3.dot(h,g),m=vec3.dot(h,u),p=mat4.clone(n),mat4.scale(p,p,[1/r.scaleX,1/r.scaleY,1/r.scaleZ]),mat4.rotateY(p,p,-i[1]*Math.PI/180),mat4.rotateZ(p,p,-i[2]*Math.PI/180),mat4.rotateZ(p,p,i[2]*Math.PI/180),mat4.rotateY(p,p,i[1]*Math.PI/180+R-m),RedGLUtil.quaternionToRotationMat4(mat4.getRotation(quat.create(),p),p),_=RedGLUtil.mat4ToEuler(p,[]),r.rotationX=180*-_[0]/Math.PI,r.rotationY=180*-_[1]/Math.PI,r.rotationZ=180*-_[2]/Math.PI):6===d&&(h=f<t._viewRect[2]/2?[0,0,-1]:[0,0,1],R=180*vec3.dot(h,g)/Math.PI,m=180*vec3.dot(h,u)/Math.PI,r.rotationZ+=R-m,u=JSON.parse(JSON.stringify(g)))),e(a,r)};[a.rotationXLine,a.rotationYLine,a.rotationZLine].forEach(function(e){o.mouseManager.add(e,"over",function(){a.downed||(a.rotationXLine.material.alpha=0,a.rotationYLine.material.alpha=0,a.rotationZLine.material.alpha=0,this.material.alpha=.25)}),o.mouseManager.add(e,"out",function(){a.downed||(a.rotationXLine.material.alpha=0,a.rotationYLine.material.alpha=0,a.rotationZLine.material.alpha=0)})}),[a.arrowX,a.arrowY,a.arrowZ,a.move,a.rotationXLine,a.rotationYLine,a.rotationZLine,a.scalePointX,a.scalePointY,a.scalePointZ].forEach(function(e,R){o.mouseManager.remove(e,"down"),o.mouseManager.add(e,"down",function(e){a.downed=!0,d=R,c=[a.x,a.y,a.z],l=[r.scaleX,r.scaleY,r.scaleZ],i=[r.rotationX,r.rotationY,r.rotationZ],n=mat4.clone(r.localMatrix),u=RedGLUtil.screenToWorld([e.nativeEvent.layerX,e.nativeEvent.layerY,t._viewRect[2],t._viewRect[3]],s),f=e.nativeEvent.layerX,s.camera&&(s.needUpdate=!1),document.body.addEventListener("mousemove",h),window.addEventListener("click",function(){s.camera&&(s.needUpdate=!0),a.downed=!1,a.rotationXLine.material.alpha=0,a.rotationYLine.material.alpha=0,a.rotationZLine.material.alpha=0,document.body.removeEventListener("mousemove",h)})})}),e(a,r)},Object.freeze(RedTransformController)}(),(RedPointCloud=function(){}).prototype=new RedBaseContainer,RedPointCloud.prototype.update=function(e){this._geometry.interleaveBuffer.upload(new Float32Array(e))},Object.defineProperty(RedPointCloud.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedPointCloud : geometry - 임의 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.freeze(RedPointCloud),(RedParticleUnit=function(e){this.startTime=null,this.age=0,this.lifeTime=2==e.length?Math.random()*(e[1]-e[0])+e[0]:e[0],this.initLifeTime=this.lifeTime,this._gravitySum=0}).prototype.addRule=function(e,t){this[e]={startCenter:null,start:2==t.start.length?Math.random()*(t.start[1]-t.start[0])+t.start[0]:t.start,end:2==t.end.length?Math.random()*(t.end[1]-t.end[0])+t.end[0]:t.end,ease:t.ease},this[e].gap=this[e].end-this[e].start},Object.freeze(RedParticleUnit),(RedColorPointCloud=function(e,t,r){if(!(this instanceof RedColorPointCloud))return new RedColorPointCloud(e,t,r);var i;t instanceof Array||RedGLUtil.throwFunc("RedLine : interleaveData - Array Instance만 허용.","입력값 :",e),e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),i=e.gl,RedBaseObject3D.build.call(this,i),this._UUID=RedGL.makeUUID(),this.geometry=RedGeometry(RedBuffer(e,"RedColorPointCloud_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(t),r,e.gl.DYNAMIC_DRAW)),this._material=RedColorPointCloudMaterial(e),this.drawMode=i.POINTS,this.useDepthMask=!1}).prototype=new RedPointCloud,Object.defineProperty(RedColorPointCloud.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorPointCloudMaterial||RedGLUtil.throwFunc("RedColorPointCloud : material - RedColorPointCloudMaterial Instance 만 허용."),this._material=e}}),Object.freeze(RedColorPointCloud),(RedBitmapPointCloud=function(e,t,r,i){if(!(this instanceof RedBitmapPointCloud))return new RedBitmapPointCloud(e,t,r,i);var n;t instanceof Array||RedGLUtil.throwFunc("RedLine : interleaveData - Array Instance만 허용.","입력값 :",e),e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),n=e.gl,RedBaseObject3D.build.call(this,n),this._UUID=RedGL.makeUUID(),this.geometry=RedGeometry(RedBuffer(e,"RedBitmapPointCloud_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(t),r,e.gl.DYNAMIC_DRAW)),this.material=i,this.drawMode=n.POINTS,this.useDepthMask=!1}).prototype=new RedPointCloud,Object.defineProperty(RedBitmapPointCloud.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedBitmapPointCloudMaterial||RedGLUtil.throwFunc("RedBitmapPointCloud : material - RedBitmapPointCloudMaterial Instance만 허용."),this._material=e}}),Object.freeze(RedBitmapPointCloud),(RedParticleEmitter=function(e,t,r){if(!(this instanceof RedParticleEmitter))return new RedParticleEmitter(e,t,r);RedBaseObject3D.build.call(this,e.gl),this.list=[],this._interleaveData=[],this.info=t,this.geometry=RedGeometry(RedBuffer(e,"RedParticleEmitter_Buffer"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(this._interleaveData),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aPointSize",1),RedInterleaveInfo("aVertexColor",4)],e.gl.DYNAMIC_DRAW)),this._material=RedParticleMaterial(e,r),this.drawMode=e.gl.POINTS,this.blendSrc=e.gl.SRC_ALPHA,this.blendDst=e.gl.ONE,this.useDepthMask=!1,this._UUID=RedGL.makeUUID()}).TINT_RANDOM="random",RedParticleEmitter.QuintIn=1,RedParticleEmitter.QuintOut=2,RedParticleEmitter.QuintInOut=3,RedParticleEmitter.BackIn=4,RedParticleEmitter.BackOut=5,RedParticleEmitter.BackInOut=6,RedParticleEmitter.CircIn=7,RedParticleEmitter.CircOut=8,RedParticleEmitter.CircInOut=9,RedParticleEmitter.CubicIn=10,RedParticleEmitter.CubicOut=11,RedParticleEmitter.CubicInOut=12,RedParticleEmitter.ExpoIn=13,RedParticleEmitter.ExpoOut=14,RedParticleEmitter.ExpoInOut=15,RedParticleEmitter.QuadIn=16,RedParticleEmitter.QuadOut=17,RedParticleEmitter.QuadInOut=18,RedParticleEmitter.QuartIn=19,RedParticleEmitter.QuartOut=20,RedParticleEmitter.QuartInOut=21,RedParticleEmitter.SineIn=22,RedParticleEmitter.SineOut=23,RedParticleEmitter.SineInOut=24,RedParticleEmitter.ElasticIn=25,RedParticleEmitter.ElasticOut=26,RedParticleEmitter.ElasticInOut=27,RedParticleEmitter.prototype=new RedBaseObject3D,RedParticleEmitter.prototype.reset=function(){this.list.length=0,this._interleaveData.length=0},RedParticleEmitter.prototype.update=function(e){var t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p,_,g,v,E;if(e+=2e3,t=Math.pow,r=Math.sin,i=Math.cos,n=Math.sqrt,s=.5*(a=Math.PI),o=2*a,d=this.list.length,R=(h=this.info).particle,d<h.max)for((u=h.emitCount)+d>h.max&&(u=h.max-d);u--;)m=this.list[d+u]=new RedParticleUnit(h.lifeTime),this._interleaveData.push(this.x,this.y,this.z),this._interleaveData.push(0),h.tint==RedParticleEmitter.TINT_RANDOM?this._interleaveData.push(Math.random(),Math.random(),Math.random(),1):this._interleaveData.push(h.tint[0],h.tint[1],h.tint[2],1),h.particle&&(R.movementX&&m.addRule("movementX",R.movementX),R.movementY&&m.addRule("movementY",R.movementY),R.movementZ&&m.addRule("movementZ",R.movementZ),R.scale&&m.addRule("scale",R.scale),R.alpha&&m.addRule("alpha",R.alpha));for(d=this.list.length,_="movementX,movementY,movementZ,scale,alpha".split(",");d--;)if((c=this.list[d]).startTime||(c.startTime=e,c.age=0),c.age=e-c.startTime,f=8*d,(l=c.age/c.lifeTime)<1)for(E=l,c.startCenter||(c.startCenter=[this.x,this.y,this.z]),u=_.length;u--;)E=l,(p=c[g=_[u]].ease)&&(1==p?E*=E*E*E*E:2==p?E=(E-=1)*E*E*E*E+1:3==p?E=(E*=2)<1?E*E*E*E*E*.5:.5*((E-=2)*E*E*E*E+2):4==p?E=E*E*(1.70158*E+E-1.70158):5==p?E=(E-=1)*E*(1.70158*E+E+1.70158)+1:6==p?E=(E*=2)<1?.5*E*E*(1.70158*E+E-1.70158):.5*(E-=2)*E*(1.70158*E+E+1.70158)+1:7==p?E=-1*(n(1-E*E)-1):8==p?E=n(1-(E-=1)*E):9==p?E=(E*=2)<1?-.5*(n(1-E*E)-1):.5*n(1-(E-=2)*E)+.5:10==p?E*=E*E:11==p?E=(E-=1)*E*E+1:12==p?E=(E*=2)<1?E*E*E*.5:.5*((E-=2)*E*E+2):13==p?E=0==E?0:t(2,10*(E-1)):14==p?E=1==E?1:1-t(2,-10*E):15==p?E=(E*=2)<1?0==E?0:.5*t(2,10*(E-1)):2==E?1:-.5*t(2,-10*(E-1))+1:16==p?E*=E:17==p?E*=2-E:18==p?E=(E*=2)<1?E*E*.5:.5*((2-(E-=1))*E+1):19==p?E*=E*E*E:20==p?E=1-(E-=1)*E*E*E:21==p?E=(E*=2)<1?E*E*E*E*.5:1-(E-=2)*E*E*E*.5:22==p?E=1-i(E*s):23==p?E=r(E*s):24==p?E=.5*(1-i(E*a)):25==p?E=0===E?0:1===E?1:-1*t(2,10*(E-=1))*r((E-.075)*o/.3):26==p?E=0===E?0:1===E?1:t(2,-10*E)*r((E-.075)*o/.3)+1:27==p&&(0===E||1===E||(E*=2),E=E<1?-.5*t(2,10*(E-=1))*r((E-.075)*o/.3):.5*t(2,-10*(E-=1))*r((E-.075)*o/.3)+1)),"movementX"==g&&(v=0),"movementY"==g&&(v=1),"movementZ"==g&&(v=2),"scale"==g&&(v=3),"alpha"==g&&(v=7),this._interleaveData[f+v]=v<3?c.startCenter[v]+c[g].start+c[g].gap*E:c[g].start+c[g].gap*E,h.gravity&&(c._gravitySum-=h.gravity),this._interleaveData[f+1]+=c._gravitySum;else this._interleaveData[f+0]=c.startCenter[0]=this.x,this._interleaveData[f+1]=c.startCenter[1]=this.y,this._interleaveData[f+2]=c.startCenter[2]=this.z,this._interleaveData[f+3]=c.scale.start,h.tint==RedParticleEmitter.TINT_RANDOM?(this._interleaveData[f+4]=Math.random(),this._interleaveData[f+5]=Math.random(),this._interleaveData[f+6]=Math.random()):(this._interleaveData[f+4]=h.tint[0],this._interleaveData[f+5]=h.tint[1],this._interleaveData[f+6]=h.tint[2]),this._interleaveData[f+7]=0,c._gravitySum=0,c.startTime=null,c.age=-1;this._geometry.interleaveBuffer.upload(new Float32Array(this._interleaveData))},RedDefinePropertyInfo.definePrototype("RedParticleEmitter","diffuseTexture","sampler2D",{callback:function(e){this.material.diffuseTexture=e}}),Object.freeze(RedParticleEmitter),function(){var e,t,r;r=function(e,r,i,n,a,o,s,d,u,c,l,f){var h,R,m=d/l,p=u/f,_=d/2,g=u/2,v=c/2,E=l+1,M=f+1,b=0,L=[];for(R=0;R<M;R++){var P=R*p-g;for(h=0;h<E;h++){var T=h*m-_;L[i]=T*o,L[n]=P*s,L[a]=v,e.push(L.x,L.y,L.z),L[i]=0,L[n]=0,L[a]=c>0?1:-1,e.push(L.x,L.y,L.z),e.push(h/l,R/f),b+=1}}for(R=0;R<f;R++)for(h=0;h<l;h++){var y=t+h+E*R,x=t+h+E*(R+1),w=t+(h+1)+E*(R+1),I=t+(h+1)+E*R;r.push(y,x,I,x,w,I),6}t+=b},e=function(e,i,n,a,o,s,d,u){var c=[],l=[];return t=0,r(c,l,"z","y","x",-1,-1,o,a,n,u,d),r(c,l,"z","y","x",1,-1,o,a,-n,u,d),r(c,l,"x","z","y",1,1,n,o,a,s,u),r(c,l,"x","z","y",1,-1,n,o,-a,s,u),r(c,l,"x","y","z",1,-1,n,a,o,s,d),r(c,l,"x","y","z",-1,-1,n,a,-o,s,d),{interleaveData:c,indexData:l,type:i,interleaveBuffer:RedBuffer(e,i+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(c),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,i+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(l))}},(RedBox=function(t,r,i,n,a,o,s){return this instanceof RedBox?(t instanceof RedGL||RedGLUtil.throwFunc("RedBox : RedGL Instance만 허용.",t),d="RedBox_"+(r=r||1)+"_"+(i=i||1)+"_"+(n=n||1)+"_"+(a=a||1)+"_"+(o=o||1)+"_"+(s=s||1),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[d]?t._datas.Primitives[d]:(t._datas.Primitives[d]=this,u=e(t,d,r,i,n,a,o,s),this.interleaveBuffer=u.interleaveBuffer,this.indexBuffer=u.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._makeInfo={width:r,height:i,depth:n,wSegments:a,hSegments:o,dSegments:s},void(this._UUID=RedGL.makeUUID()))):new RedBox(t,r,i,n,a,o,s);var d,u}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedBox)}(),function(){var e,t;e=function(e,r,i,n,a,o,s,d,u,c){var l=[],f=[],h=0,R=[],m=a/2;return t=function(e){var t,r,a,s=[],d=[],R=!0===e?i:n,p=!0===e?1:-1;for(r=h,t=1;t<=o;t++)l.push(0,m*p,0),l.push(0,p,0),l.push(.5,.5),h++;for(a=h,t=0;t<=o;t++){var _=t/o*c+u,g=Math.cos(_),v=Math.sin(_);d[0]=R*v,d[1]=m*p,d[2]=R*g,l.push(d[0],d[1],d[2]),l.push(0,p,0),s[0]=.5*g+.5,s[1]=.5*v*p+.5,l.push(s[0],1-s[1]),h++}for(t=0;t<o;t++){var E=r+t,M=a+t;!0===e?f.push(M,M+1,E):f.push(M+1,M,E),3}},function(){var e,t,r=[],d=[],p=(n-i)/a;for(t=0;t<=s;t++){var _=[],g=t/s,v=g*(n-i)+i;for(e=0;e<=o;e++){var E=e/o,M=E*c+u,b=Math.sin(M),L=Math.cos(M);d[0]=v*b,d[1]=-g*a+m,d[2]=v*L,l.push(d[0],d[1],d[2]),r[0]=b,r[1]=p,r[2]=L,vec3.normalize(r,r),l.push(r[0],r[1],r[2]),l.push(E,g),_.push(h++)}R.push(_)}for(e=0;e<o;e++)for(t=0;t<s;t++){var P=R[t][e],T=R[t+1][e],y=R[t+1][e+1],x=R[t][e+1];f.push(P,T,x),f.push(T,y,x),6}}(),!1===d&&(i>0&&t(!0),n>0&&t(!1)),{interleaveData:l,indexData:f,type:r,interleaveBuffer:RedBuffer(e,r+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(l),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,r+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(f))}},(RedCylinder=function(t,r,i,n,a,o,s,d,u){return this instanceof RedCylinder?(t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),c="RedCylinder_"+(r=void 0!==r?r:1)+"_"+(i=void 0!==i?i:1)+"_"+(n=void 0!==n?n:1)+"_"+(a=Math.floor(a)||8)+"_"+(o=Math.floor(o)||1)+"_"+(s=void 0!==s&&s)+"_"+(d=void 0!==d?d:0)+"_"+(u=void 0!==u?u:2*Math.PI),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[c]?t._datas.Primitives[c]:(t._datas.Primitives[c]=this,l=e(t,c,r,i,n,a,o,s,d,u),this.interleaveBuffer=l.interleaveBuffer,this.indexBuffer=l.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,void(this._UUID=RedGL.makeUUID()))):new RedCylinder(t,r,i,n,a,o,s,d,u);var c,l}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedCylinder)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p;e=function(e,_,g,v,E,M,b){t=g/2,r=v/2,i=Math.floor(E)||1,n=Math.floor(M)||1,a=i+1,o=n+1,s=g/i,d=v/n;var L=[],P=[];for(c=0;c<o;c++)for(f=c*d-r,u=0;u<a;u++)l=u*s-t,L.push(l,-f,0,0,0,1,u/i,b?1-c/n:c/n);for(c=0;c<n;c++)for(u=0;u<i;u++)h=u+a*c,R=u+a*(c+1),m=u+1+a*(c+1),p=u+1+a*c,P.push(h,R,p,R,m,p);return{interleaveData:L,indexData:P,type:_,interleaveBuffer:RedBuffer(e,_+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(L),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,_+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint32Array(P))}},(RedPlane=function(t,r,i,n,a,o){return this instanceof RedPlane?(t instanceof RedGL||RedGLUtil.throwFunc("RedPlane : RedGL Instance만 허용.",t),s="RedPlane_"+(r=r||1)+"_"+(i=i||1)+"_"+(n=n||1)+"_"+(a=a||1)+"_"+(o=!!o),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[s]?t._datas.Primitives[s]:(t._datas.Primitives[s]=this,d=e(t,s,r,i,n,a,o),this.interleaveBuffer=d.interleaveBuffer,this.indexBuffer=d.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._makeInfo={width:r,height:i,wSegments:n,hSegments:a,flipY:o},void(this._UUID=RedGL.makeUUID()))):new RedPlane(t,r,i,n,a,o);var s,d}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedPlane)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l;u=[],c=new Float32Array([0,0,0]),l=new Float32Array([0,0,0]),e=function(e,f,h,R,m,p,_,g,v){t=g+v,n=0,u.length=0,c[0]=0,c[1]=0,c[2]=0,l[0]=0,l[1]=0,l[2]=0;var E=[],M=[];for(i=0;i<=m;i++){var b=[],L=i/m;for(r=0;r<=R;r++){var P=r/R;c.x=-h*Math.cos(p+P*_)*Math.sin(g+L*v),c.y=h*Math.cos(g+L*v),c.z=h*Math.sin(p+P*_)*Math.sin(g+L*v),E.push(c.x,c.y,c.z),l[0]=c.x,l[1]=c.y,l[2]=c.z,vec3.normalize(l,l),E.push(l[0],l[1],l[2]),E.push(P,L),b.push(n++)}u.push(b)}for(i=0;i<m;i++)for(r=0;r<R;r++)a=u[i][r+1],o=u[i][r],s=u[i+1][r],d=u[i+1][r+1],(0!==i||g>0)&&M.push(a,o,d),(i!==m-1||t<Math.PI)&&M.push(o,s,d);return{interleaveData:E,indexData:M,type:f,interleaveBuffer:RedBuffer(e,f+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(E),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,f+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(M))}},(RedSphere=function(t,r,i,n,a,o,s,d){return this instanceof RedSphere?(t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),u="RedSphere_"+(r=r||1)+"_"+(i=Math.max(3,Math.floor(i)||8))+"_"+(n=Math.max(2,Math.floor(n)||6))+"_"+(a=void 0!==a?a:0)+"_"+(o=void 0!==o?o:2*Math.PI)+"_"+(s=void 0!==s?s:0)+"_"+(d=void 0!==d?d:Math.PI),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[u]?t._datas.Primitives[u]:(t._datas.Primitives[u]=this,c=e(t,u,r,i,n,a,o,s,d),this.interleaveBuffer=c.interleaveBuffer,this.indexBuffer=c.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._makeInfo={radius:r,widthSegments:i,heightSegments:n,phiStart:a,phiLength:o,thetaStart:s,thetaLength:d},void(this._UUID=RedGL.makeUUID()))):new RedSphere(t,r,i,n,a,o,s,d);var u,c}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedSphere)}(),function(){var e,t,r,i,n,a,o,s,d,u,c;r=2,e=function(e,t,r,i){if(n=e.createProgram(),e.attachShader(n,r.webglShader),e.attachShader(n,i.webglShader),r.parseData.uniform)for(s in a=r.parseData.uniform.map,o=i.parseData.uniform.map,a)o[s]&&RedGLUtil.throwFunc("vertexShader와 fragmentShader에 중복된 유니폼 선언이 존재함.","중복선언 : "+s);if(r.parseData.const)for(s in a=r.parseData.const.map,o=i.parseData.const.map,a)o[s]&&RedGLUtil.throwFunc("vertexShader와 fragmentShader에 중복된 상수 선언이 존재함.","중복선언 : "+s);return e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||RedGLUtil.throwFunc("RedProgram : 프로그램을 초기화 할 수 없습니다.",e.getProgramInfoLog(n)),n.key=t,n.vShaderKey=r.key,n.vShaderOriginSource=r.originSource,n.fShaderKey=i.key,n.fShaderOriginKey=r.originSource,n},c={},d=function(){},u=function(){},t=function(e,t,n){var a,o,s,l;if(n.parseData.attribute)for(a=(s=n.parseData.attribute.list).length;a--;)o=s[a],(p=new d)._UUID=RedGL.makeUUID(),p.location=t.getAttribLocation(e.webglProgram,o.name),-1==p.location?(p.msg="쉐이더 main 함수에서 사용되고 있지 않음",p.use=!1):p.use=!0,p.attributeType=o.attributeType,p.name=o.name,p.enabled=!1,l=e.attributeLocation.length,-1!=p.location&&(e.attributeLocation[l]=p),e.attributeLocation[p.name]=p;if(n.parseData.uniform)for(a=(s=n.parseData.uniform.list).length;a--;){var f,h,R,m,p;switch(o=s[a],(p=new u)._UUID=RedGL.makeUUID(),p.uniformType=o.uniformType,f=o.arrayNum,R=1e5,o.uniformType){case"sampler2D":h="sampler2D",R=0,m="uniform1i",p.samplerIndex=r,++r===i&&(r=2);break;case"samplerCube":h="samplerCube",R=1,m="uniform1i",p.samplerIndex=r,++r===i&&(r=2);break;case"float":h="float",R=f?12:11,m=f?"uniform1fv":"uniform1f";break;case"int":h="int",R=f?12:11,m=f?"uniform1iv":"uniform1i";break;case"bool":h="bool",R=f?12:11,m=f?"uniform1iv":"uniform1i";break;case"vec4":h="vec",R=12,m="uniform4fv";break;case"vec3":h="vec",R=12,m="uniform3fv";break;case"vec2":h="vec",R=12,m="uniform2fv";break;case"ivec4":h="vec",R=12,m="uniform4iv";break;case"ivec3":h="vec",R=12,m="uniform3iv";break;case"ivec2":h="vec",R=12,m="uniform2iv";break;case"bvec4":h="vec",R=12,m="uniform4iv";break;case"bvec3":h="vec",R=12,m="uniform3iv";break;case"bvec2":h="vec",R=12,m="uniform2iv";break;case"mat4":h="mat",R=13,m="uniformMatrix4fv";break;case"mat3":h="mat",R=13,m="uniformMatrix3fv";break;case"mat2":h="mat",R=13,m="uniformMatrix2fv"}p.location=t.getUniformLocation(e.webglProgram,o.name),p.renderType=h,p.renderMethod=m,p.renderTypeIndex=R,p.name=o.name,c[o.name]||(c[o.name]=o.name.charAt(1).toLowerCase()+o.name.substr(2)),p.materialPropertyName=c[o.name],p.arrayNum=o.arrayNum,p.location?p.use=!0:(p.msg="쉐이더 main 함수에서 사용되고 있지 않음",p.use=!1),o.systemUniformYn?(l=e.systemUniformLocation.length,p.use&&(e.systemUniformLocation[l]=p),e.systemUniformLocation[o.name]=p):(l=e.uniformLocation.length,p.use&&(e.uniformLocation[l]=p),e.uniformLocation[o.name]=p)}},(RedProgram=function(r,n,a,o){var s,d,u;return this instanceof RedProgram?(r instanceof RedGL||RedGLUtil.throwFunc("RedProgram : RedGL Instance만 허용.","입력값 : "+r),"string"==typeof n||RedGLUtil.throwFunc("RedProgram : key - 문자열만 허용.","입력값 : "+n),s=r.gl,r._datas.RedProgram||(r._datas.RedProgram={},r._datas.RedProgramList=[]),RedProgram.hasKey(r,n)?r._datas.RedProgram[n]:(d=a?RedShader(r,n+"_VS",RedShader.VERTEX,a):null,u=o?RedShader(r,n+"_FS",RedShader.FRAGMENT,o):null,d&&u?r._datas.RedProgram[n]=this:RedGLUtil.throwFunc("RedProgram : 신규 생성시 vertexShader, fragmentShader 모두 입력해야함."),r._datas.RedProgramList.push(this),this.key=n,this.webglProgram=e(s,n,d,u),this.attributeLocation=[],this.uniformLocation=[],this.systemUniformLocation=[],s.useProgram(this.webglProgram),i=r.detect.texture.MAX_COMBINED_TEXTURE_IMAGE_UNITS,t(this,s,d),t(this,s,u),void(this._UUID=RedGL.makeUUID()))):new RedProgram(r,n,a,o)}).prototype={},RedProgram.hasKey=function(e,t){return e instanceof RedGL||RedGLUtil.throwFunc("RedProgram : RedGL Instance만 허용.","입력값 : "+e),e._datas.RedProgram||(e._datas.RedProgram={},e._datas.RedProgramList=[]),!!e._datas.RedProgram[t]},RedProgram.makeProgram=function(e,t,r,i,n){var a;t.indexOf("_")>-1&&RedGLUtil.throwFunc("RedProgram : 프로그램이름에 _ 는 허용하지 않음.","입력값 : "+t),r="string"==typeof r?r:RedGLUtil.getStrFromComment(r.toString()),i="string"==typeof i?i:RedGLUtil.getStrFromComment(i.toString());var o=!1,s=!1,d=!1,u=!1;for(var c in RedSystemShaderCode.vertexShareFunc)a=new RegExp("//#REDGL_DEFINE#vertexShareFunc#"+c+"#","gi"),r=r.replace(a,RedSystemShaderCode.vertexShareFunc[c]);for(var c in RedSystemShaderCode.fragmentShareFunc)a=new RegExp("//#REDGL_DEFINE#fragmentShareFunc#"+c+"#","gi"),i=i.replace(a,RedSystemShaderCode.fragmentShareFunc[c]);if(n){n.sort(),t+="_"+n.join("_");for(var l=n.length;l--;)"fog"===n[l]&&(o=!0),"sprite3D"===n[l]&&(s=!0),"directionalShadow"===n[l]&&(d=!0),"skin"===n[l]&&(u=!0),"fog"!==n[l]&&"sprite3D"!=n[l]&&"directionalShadow"!=n[l]&&"skin"!=n[l]&&(a=new RegExp("//#REDGL_DEFINE#"+n[l]+"#","gi"),r=r.replace(a,""),i=i.replace(a,""))}return a=new RegExp("//#REDGL_DEFINE#fog#"+(o?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),a=new RegExp("//#REDGL_DEFINE#sprite3D#"+(s?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),a=new RegExp("//#REDGL_DEFINE#directionalShadow#"+(d?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),a=new RegExp("//#REDGL_DEFINE#skin#"+(u?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),RedProgram(e,t,r,i,n)},Object.freeze(RedProgram)}(),(RedSystemShaderCode={}).init=function(e){var t,r,i=e.detect;r=parseInt(Math.floor(Math.min((i.vertexShader.MAX_VERTEX_UNIFORM_VECTORS-64)/8,128))),t=parseInt(Math.floor(Math.min((i.fragmentShader.MAX_FRAGMENT_UNIFORM_VECTORS-64)/4,128))),(RedSystemShaderCode={vertexShareDeclare:["attribute vec3 aVertexPosition","attribute vec3 aVertexNormal","attribute vec4 aVertexColor","attribute vec4 aVertexWeight","attribute vec4 aVertexJoint","varying vec4 vVertexPosition","varying vec3 vVertexNormal","varying vec4 vVertexColor","attribute float aPointSize","uniform float uPointSize","attribute vec2 aTexcoord","attribute vec2 aTexcoord1","varying vec2 vTexcoord","varying vec2 vTexcoord1","uniform bool uMode2DYn","uniform float uTime","varying float vTime","uniform vec2 uResolution","varying vec2 vResolution","uniform mat4 uMMatrix","uniform mat4 uNMatrix","uniform mat4 uPMatrix","uniform mat4 uCameraMatrix","uniform bool u_PerspectiveScale","uniform mat4 uDirectionalShadowLightMatrix","varying highp vec4 vShadowPos","const mat4 cTexUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0)","uniform mat4 uJointMatrix["+r+"]","uniform mat4 uInverseBindMatrixForJoint["+r+"]","uniform mat4 uGlobalTransformOfNodeThatTheMeshIsAttachedTo"],fragmentShareDeclare:["varying vec4 vVertexPosition","varying vec3 vVertexNormal","varying vec4 vVertexColor","varying vec2 vTexcoord","varying vec2 vTexcoord1","varying float vTime","varying vec2 vResolution","uniform vec3 uCameraPosition","uniform float u_FogDistance","uniform float u_FogDensity","uniform vec4 uFogColor","const int cDIRETIONAL_MAX = 3","uniform vec3 uDirectionalLightPositionList[3]","uniform vec4 uDirectionalLightColorList[3]","uniform float uDirectionalLightIntensityList[3]","uniform int uDirectionalLightNum","const int cPOINT_MAX = "+t,"uniform vec3 uPointLightPositionList["+t+"]","uniform vec4 uPointLightColorList["+t+"]","uniform float uPointLightRadiusList["+t+"]","uniform float uPointLightIntensityList["+t+"]","uniform int uPointLightNum","uniform vec4 uAmbientLightColor","uniform float uAmbientIntensity","uniform sampler2D uDirectionalShadowTexture","varying highp vec4 vShadowPos"],systemUniform:{},vertexShareFunc:{getSkinMatrix:["//#REDGL_DEFINE#skin#true#  mat4 getSkinMatrix(){","//#REDGL_DEFINE#skin#true#      mat4 skinMat =","//#REDGL_DEFINE#skin#true#      aVertexWeight.x * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.x) ] * uInverseBindMatrixForJoint[int(aVertexJoint.x)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.y * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.y) ] * uInverseBindMatrixForJoint[int(aVertexJoint.y)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.z * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.z) ] * uInverseBindMatrixForJoint[int(aVertexJoint.z)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.w * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.w) ] * uInverseBindMatrixForJoint[int(aVertexJoint.w)];","//#REDGL_DEFINE#skin#true#      return skinMat;","//#REDGL_DEFINE#skin#true#  }"].join("\n"),getSprite3DMatrix:["mat4 getSprite3DMatrix(mat4 cameraMTX, mat4 mvMatrix){","   mat4 cacheScale = mat4(","      mvMatrix[0][0], 0.0, 0.0, 0.0,","       0.0, mvMatrix[1][1], 0.0, 0.0,","      0.0, 0.0, 1.0, mvMatrix[2][2],","      0.0, 0.0, 0.0, 1.0","   );","   mat4 tMTX = cameraMTX * mvMatrix;","   tMTX[0][0] = 1.0, tMTX[0][1] = 0.0, tMTX[0][2] = 0.0,","   tMTX[1][0] = 0.0, tMTX[1][1] = 1.0, tMTX[1][2] = 0.0,","   tMTX[2][0] = 0.0, tMTX[2][1] = 0.0, tMTX[2][2] = 1.0;","   return tMTX * cacheScale;","}"].join("\n")},fragmentShareFunc:{getFlatNormal:["vec3 getFlatNormal(vec3 vertexPosition){","   vec3 dx = dFdx(vVertexPosition.xyz);","   vec3 dy = dFdy(vVertexPosition.xyz);","   return normalize(cross(normalize(dx), normalize(dy)));","}"].join("\n"),getDirectionalLightColor:["vec4 getDirectionalLightColor(      vec4 texelColor,      vec3 N,      float shininess,      vec4 specularLightColor,      float specularTextureValue,      float specularPower) {","   vec3 L;","   float specular;","   float lambertTerm;","   vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);","   vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);","   for(int i=0; i<cDIRETIONAL_MAX; i++){","      if(i == uDirectionalLightNum) break;","      L = normalize(-uDirectionalLightPositionList[i]);","      lambertTerm = dot(N,-L);","      if(lambertTerm > 0.0){","         ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i];","         specular = pow( max(dot(reflect(L, N), -L), 0.0), shininess) * specularPower * specularTextureValue;","         ls +=  specularLightColor * specular * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;","      }","   }","   return ld + ls;","}"].join("\n"),getPointLightColor:["vec4 getPointLightColor(      vec4 texelColor,      vec3 N,      float shininess,      vec4 specularLightColor,      float specularTextureValue,      float specularPower) {","   vec3 L;","   float specular;","   float lambertTerm;","   vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);","   vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);","   float distanceLength;","   float attenuation;","   for(int i=0;i<cPOINT_MAX;i++){","      if(i== uPointLightNum) break;","      L =  -uPointLightPositionList[i] + vVertexPosition.xyz;","      distanceLength = abs(length(L));","      if(uPointLightRadiusList[i]> distanceLength){","          attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;","          L = normalize(L);","          lambertTerm = dot(N,-L);","          if(lambertTerm > 0.0){","             ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;","             specular = pow( max(dot( reflect(L, N), -N), 0.0), shininess) * specularPower * specularTextureValue;","             ls +=  specularLightColor * specular  * uPointLightIntensityList[i]  * uPointLightColorList[i].a ;","          }","      }","   }","   return ld + ls;","}"].join("\n"),fogFactor:["float fogFactor(float perspectiveFar, float density){","   float flog_cord = gl_FragCoord.z / gl_FragCoord.w / perspectiveFar;","   float fog = flog_cord * density;","   if(1.0 - fog < 0.0) discard;","   return clamp(1.0 - fog, 0.0,  1.0);","}"].join("\n"),fog:["vec4 fog(float fogFactor, vec4 fogColor, vec4 currentColor) {","   return mix(fogColor, currentColor, fogFactor);","}"].join("\n"),decodeFloatShadow:["float decodeFloatShadow (vec4 color) {","   const vec4 cBitShift = vec4(","       1.0 / (256.0 * 256.0 * 256.0),","       1.0 / (256.0 * 256.0),","       1.0 / 256.0,","       1.0","   );","   return dot(color, cBitShift);","}"].join("\n"),getShadowColor:["float getShadowColor ( vec4 shadowPos, vec2 resolution, sampler2D directionalShadowTexture ) {","   vec3 fragmentDepth = shadowPos.xyz;","   fragmentDepth.z -= 0.007; // cShadowAcneRemover","   float amountInLight = 0.0;","   for (int x = -1; x <= 1; x++) {","       for (int y = -1; y <= 1; y++) {","           vec2 tUV = fragmentDepth.xy + vec2( float(x)/resolution.x, float(y)/resolution.y );","           if(tUV.x<0.0) return 1.0;","           if(tUV.x>1.0) return 1.0;","           if(tUV.y<0.0) return 1.0;","           if(tUV.y>1.0) return 1.0;","           float texelDepth = decodeFloatShadow( texture2D(directionalShadowTexture, tUV) );","           if (fragmentDepth.z < texelDepth ) amountInLight += 1.0;","      }","   }","   amountInLight /= 9.0;","   amountInLight =  amountInLight;","   return amountInLight;","}"].join("\n"),cotangent_frame:["mat3 cotangent_frame(vec3 N, vec3 p, vec2 uv)","{","   vec3 dp1 = dFdx( p );","   vec3 dp2 = dFdy( p );","   vec2 duv1 = dFdx( uv );","   vec2 duv2 = dFdy( uv );","   ","   vec3 dp2perp = cross( dp2, N );","   vec3 dp1perp = cross( N, dp1 );","   vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;","   vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;","   ","   float invmax = inversesqrt( max( dot(T,T), dot(B,B) ) );","   return mat3( T * invmax, B * invmax, N );","}"].join("\n"),perturb_normal:["vec3 perturb_normal( vec3 N, vec3 V, vec2 texcoord, vec3 normalColor )","   {","   ","   vec3 map = normalColor;","   map =  map * 255./127. - 128./127.;","   map.xy *= u_normalPower;","   mat3 TBN = cotangent_frame(N, V, texcoord);","   return normalize(TBN * map);","}"].join("\n")}}).MAX_DIRECTIONAL_LIGHT=3,RedSystemShaderCode.MAX_POINT_LIGHT=t,RedSystemShaderCode.MAX_JOINT=r,[RedSystemShaderCode.vertexShareDeclare,RedSystemShaderCode.fragmentShareDeclare].forEach(function(e){e.forEach(function(e){"uniform"===(e=e.split(" "))[0]&&(RedSystemShaderCode.systemUniform[e[2]]=1)})});var n=[],a=[],o={bool:4,float:4,int:4,uint:4,sampler2D:4,samplerCube:4,vec2:4,vec3:4,vec4:4,mat2:4,mat3:8,mat4:16};RedSystemShaderCode.vertexShareDeclare.forEach(function(e){var t;"uniform"===(e=e.split(" "))[0]&&(t={value:e,type:e[1],num:e[2].indexOf("[")>-1?+e[2].split("[")[1].replace("]","")*o[e[1]]:o[e[1]]},n.push(t))}),a=[],RedSystemShaderCode.fragmentShareDeclare.forEach(function(e){var t;"uniform"===(e=e.split(" "))[0]&&(t={value:e,type:e[1],num:e[2].indexOf("[")>-1?+e[2].split("[")[1].replace("]","")*o[e[1]]:o[e[1]]},a.push(t))}),Object.freeze(RedSystemShaderCode)},function(){var e,t,r,i,n,a,o,s,d,u;e=function(e,t,r){switch(r){case RedShader.VERTEX:return(n=e.createShader(e.VERTEX_SHADER))||(e.isContextLost()?RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - WebGL 컨텍스트가 손실"):RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - GPU메모리가 부족일 가능성이 큼")),n.key=t,n.type=r,n;case RedShader.FRAGMENT:return(n=e.createShader(e.FRAGMENT_SHADER))||(e.isContextLost()?RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - WebGL 컨텍스트가 손실"):RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - GPU메모리가 부족일 가능성이 큼")),n.key=t,n.type=r,n;default:RedGLUtil.throwFunc("RedShader : 쉐이더 타입을 확인하세요. RedShader.VERTEX or RedShader.FRAGMENT 만 허용")}},t=function(e,t,r,i){e.shaderSource(r,i.lastSource),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||RedGLUtil.throwFunc("RedShader : 쉐이더 컴파일에 실패하였습니다.\n",e.getShaderInfoLog(r))},i=function(e,t){var r;switch(e){case RedShader.VERTEX:r=RedSystemShaderCode.vertexShareDeclare.concat();break;case RedShader.FRAGMENT:r=RedSystemShaderCode.fragmentShareDeclare.concat();break;default:RedGLUtil.throwFunc("RedShader : 쉐이더 타입을 확인하세요. RedShader.VERTEX or RedShader.FRAGMENT 만 허용")}for(a=t.length;a--;)o=(o=t[a]).replace(";",""),-1===r.indexOf(o)?r.push(o):RedGLUtil.throwFunc("RedShader : ","\n1. 중복 선언 이거나","\n2. RedSystemShaderCode에 정의된 선언\n","입력값 : "+o);return r},r=function(e,t){return t=(t=t.replace(/\s+$/,"")).replace(/  /g,"").trim(),s={etc:""},d=t.match(/attribute[\s\S]+?\;|uniform[\s\S]+?\;|varying[\s\S]+?\;|const[\s\S]+?\;|precision[\s\S]+?\;/g),(d=i(e,d=d||[])).sort(),d.forEach(function(e){var r,i,n,a,o,d,u,c,l;if(e=e.trim(),t=t.replace(e+";",""),("highp"===(r=e.split(" "))[1]||"mediump"===r[1]||"lowp"===r[1])&&(l=r[1],r.splice(1,1),r.push(l),c=l),r[2])switch(i=r[0],a=r[1],n=r[2].replace(";","").split("["),d=(d=e.split("="))[1]?d[1].trim().replace(";",""):null,o=n.length>1?+n[1].split("]")[0]:0,n=n[0],i){case"precision":break;case"attribute":"a"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : attribute의 첫글자는 a로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : attribute의 두번째 글자는 대문자 시작해야합니다.",n,r);break;case"uniform":"u"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : uniform의 첫글자는 u로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : uniform의 두번째 글자는 대문자 시작해야합니다.",n,r);break;case"varying":"v"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : varying의 첫글자는 v로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : varying의 두번째 글자는 대문자 시작해야합니다.",n,r);break;case"const":"c"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : const의 첫글자는 c로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : const의 두번째 글자는 대문자 시작해야합니다.",n,r);break;default:RedGLUtil.throwFunc("RedShader : 체크되지 못하는값인데 뭐냐",n,r)}else RedGLUtil.throwFunc("RedShader : 체크되지 못하는값인데 뭐냐",r);s[i]||(s[i]={},s[i].list=[],s[i].map={},s[i].source=""),u={name:n,arrayNum:o,value:d,precision:c,systemUniformYn:!!RedSystemShaderCode.systemUniform[o?n+"["+o+"]":n]},"uniform"===i&&(u.uniformType=a),"attribute"===i&&(u.attributeType=a),"varying"===i&&(u.varyingType=a),s[i].list.push(u),s[i].map[n]=e,s[i].source+=e+";\n"}),t=(t+="\n").trim(),s.etc=t+"\n",u=e===RedShader.FRAGMENT?"#extension GL_OES_standard_derivatives : enable\n":"",s.precision&&(u+=s.precision.source+"\n//const\n"),s.const&&(u+=s.const.source+"\n//attribute\n"),s.attribute&&(u+=s.attribute.source+"\n//uniform\n"),s.uniform&&(u+=s.uniform.source+"\n//varying\n"),s.varying&&(u+=s.varying.source+"\n//etc\n"),s.etc&&(u+=s.etc),s.lastSource=u,e!==RedShader.FRAGMENT||s.precision||RedGLUtil.throwFunc("RedShader : FRAGMENT Shader는 precision를 반드시 선언해야함"),s},(RedShader=function(i,n,a,o){var s;if(!(this instanceof RedShader))return new RedShader(i,n,a,o);if(i instanceof RedGL||RedGLUtil.throwFunc("RedShader : RedGL Instance만 허용.","입력값 : "+i),"string"==typeof n||RedGLUtil.throwFunc("RedShader : key - 문자열만 허용.","입력값 : "+n),a!==RedShader.VERTEX&&a!==RedShader.FRAGMENT&&RedGLUtil.throwFunc("RedShader : type - RedShader.VERTEX or RedShader.FRAGMENT 만 허용.","입력값 : "+a),i._datas.RedShader||(i._datas.RedShader={},i._datas.RedShader[RedShader.VERTEX]={},i._datas.RedShader[RedShader.FRAGMENT]={}),o)"string"==typeof o||RedGLUtil.throwFunc("RedShader : source - 문자열만 허용."),RedShader.hasKey(i,n,a)?RedGLUtil.throwFunc("RedShader : key - 이미 정의된 키로 생성을 시도.","\n키 :",n,"\n타입 :"+a):i._datas.RedShader[a][n]=this;else{if(RedShader.hasKey(i,n,a))return i._datas.RedShader[a][n];RedGLUtil.throwFunc("RedShader : "+a+" 타입에 존재하지 않는 key를 검색하려고합니다.","입력값 : "+n)}s=i.gl,this.webglShader=e(s,n,a),this.parseData=r(a,o),this.originSource=o,t(s,0,this.webglShader,this.parseData),this.key=n,this.type=a,this._UUID=RedGL.makeUUID(),Object.freeze(this)}).hasKey=function(e,t,r){return!!e._datas.RedShader[r][t]},RedShader.FRAGMENT="fragmentShader",RedShader.VERTEX="vertexShader",Object.freeze(RedShader)}(),function(){var e,t,r,i=[];e=function(t){for(var r,n=i.length;n--;)(r=i[n]).worldRender(r._redGL,t),r._callback&&r._callback(t);requestAnimationFrame(e)},requestAnimationFrame(e),(RedRenderer=function(){if(!(this instanceof RedRenderer))return new RedRenderer;this.world=null,this._tickKey=null,this._callback=null,this._UUID=RedGL.makeUUID(),this.renderInfo={},this.cacheState=[],this.cacheInfo={cacheUniformInfo:[],cacheAttrInfo:[],cacheSamplerIndex:[],cacheTexture:[],cacheSystemUniformInfo:[]},this.renderDebuger=RedRenderDebuger(),this.worldRect=[],this._glInitialized=!1}).prototype={start:function(e,t){e instanceof RedGL||RedGLUtil.throwFunc("RedGL Instance만 허용"),e.world instanceof RedWorld||RedGLUtil.throwFunc("RedWorld Instance만 허용");this.stop(),this.world=e.world,this._redGL=e,this._callback=t,i.push(this)},setDebugButton:function(){var e,t=this;window.document&&(document.body.appendChild(e=document.createElement("button")),e.style.cssText="position:fixed;left:10px;top:10px;background:rgb(91, 82, 170);color:#fff;z-index:10001;border:0;outline:none;cursor:pointer;padding:8px;font-size:11px;border-radius:5px",e.innerHTML="debugRenderInfo - "+RedGL_VERSION.version,e.addEventListener("click",function(){t.renderDebuger.visible=!t.renderDebuger.visible}))},render:function(e,t){e instanceof RedGL||RedGLUtil.throwFunc("RedGL Instance만 허용"),t=t||0,this.world=e.world,this.worldRender(e,t)},stop:function(){-1===(t=i.indexOf(this))||i.splice(t,1)}};var n,a,o,s,d,u,c,l,f,h,R,m=[];u=[],o=function(e){for(c=e.length;c--;)"number"==typeof e[c]?e[c]=e[c]:e[c]=c<2?n[c+2]*parseFloat(e[c])/100:n[c]*parseFloat(e[c])/100;return e},s=function(e,t,i){r=RedSystemUniformUpdater.update(e,this,t,i,r,u)},d=function(e){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.SCISSOR_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.disable(e.DITHER),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1)},RedRenderer.prototype.worldRender=function(e,t){var r,i,c,l,f,h,R,p,_;for(r=e.gl,a=this,window.RedGLTFLoader&&RedGLTFLoader.animationLooper(t),(n=a.worldRect)[0]=0,n[1]=0,n[2]=r.drawingBufferWidth,n[3]=r.drawingBufferHeight,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.scissor(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),m.length=0,a._glInitialized||(d(r),a._glInitialized=!0),a.renderInfo={},a.cacheInfo.cacheAttrInfo.length=0,e.gl.activeTexture(e.gl.TEXTURE0),e.gl.bindTexture(e.gl.TEXTURE_2D,e._datas.emptyTexture["2d"].webglTexture),e.gl.activeTexture(e.gl.TEXTURE0+1),e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,e._datas.emptyTexture["3d"].webglTexture),h=0,R=a.world._viewList.length;h<R;h++)(_=(p=a.world._viewList[h])._viewRect)[0]=p._x,_[1]=p._y,_[2]=p._width,_[3]=p._height,f=p.camera,i=p.scene,o(_),a.renderInfo[p.key]||(a.renderInfo[p.key]={}),(c=a.renderInfo[p.key]).mode2DYn=f instanceof RedBaseController?f.camera.mode2DYn:f.mode2DYn,c.x=p._x,c.y=p._y,c.width=p._width,c.height=p._height,c.viewRectX=_[0],c.viewRectY=_[1],c.viewRectWidth=_[2],c.viewRectHeight=_[3],c.key=p.key,c.call=0,c.triangleNum=0,c.viewRenderTime=0,c.postEffectRenderTime=0,r.viewport(_[0],n[3]-_[3]-_[1],_[2],_[3]),r.scissor(_[0],n[3]-_[3]-_[1],_[2],_[3]),i._useBackgroundColor?(i._useFog?r.clearColor(i._fogR,i._fogG,i._fogB,1):r.clearColor(i._r,i._g,i._b,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):(r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),f instanceof RedBaseController&&(f.update(),f=f.camera),f.autoUpdateMatrix&&f.update(),l=f.perspectiveMTX,mat4.identity(l),f.mode2DYn?(mat4.ortho(l,-.5,.5,-.5,.5,-f.farClipping,f.farClipping),mat4.translate(l,l,[-.5,.5,0]),mat4.scale(l,l,[1/_[2]*e.renderScale*window.devicePixelRatio,-1/_[3]*e.renderScale*window.devicePixelRatio,1]),mat4.identity(f.matrix),r.disable(r.CULL_FACE),a.cacheState.useCullFace=!1):(mat4.perspective(l,f.fov*Math.PI/180,_[2]/_[3],f.nearClipping,f.farClipping),r.enable(r.CULL_FACE),a.cacheState.useCullFace=!0),!a.cacheState.useDepthMask&&r.depthMask(a.cacheState.useDepthMask=!0),i.mouseManager&&(s.apply(a,[e,t,p]),i.mouseManager.render(e,a,p,t,c,h==R-1)),i.shadowManager._directionalShadow&&(s.apply(a,[e,t,p]),r.disable(r.BLEND),r.blendFunc(r.ONE,r.ONE),a.cacheState.useBlendMode=!0,a.cacheState.blendSrc=r.ONE,a.cacheState.blendDst=r.ONE,i.shadowManager.render(e,a,p,t,c),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),a.cacheState.useBlendMode=!0,a.cacheState.blendSrc=r.SRC_ALPHA,a.cacheState.blendDst=r.ONE_MINUS_SRC_ALPHA),p.postEffectManager.postEffectList.length&&(p.postEffectManager.bind(r),r.viewport(0,0,p.postEffectManager.frameBuffer.width,p.postEffectManager.frameBuffer.height),r.scissor(0,0,p.postEffectManager.frameBuffer.width,p.postEffectManager.frameBuffer.height)),s.apply(a,[e,t,p]),i.skyBox&&(i.skyBox.x=f.x,i.skyBox.y=f.y,i.skyBox.z=f.z,i.skyBox.scaleX=i.skyBox.scaleY=i.skyBox.scaleZ=.6*f.farClipping,a.sceneRender(e,i,f,f.mode2DYn,[i.skyBox],t,c)),i.grid&&a.sceneRender(e,i,f,f.mode2DYn,[i.grid],t,c),a.sceneRender(e,i,f,f.mode2DYn,i.children,t,c),m.length&&a.sceneRender(e,i,f,f.mode2DYn,m,t,c,null,!0),i.mirrorManager&&i.mirrorManager.render(e,a,p,t,c,s),i.axis&&a.sceneRender(e,i,f,f.mode2DYn,i.axis.children,t,c),u.length&&a.sceneRender(e,i,f,f.mode2DYn,u,t,c),c.viewRenderTime=performance.now(),p.postEffectManager.postEffectList.length&&p.postEffectManager.render(e,r,a,p,t,c),c.postEffectRenderTime=performance.now()-c.viewRenderTime,c.viewRenderTime-=t;this.renderDebuger.visible&&this.renderDebuger.update(e,a.renderInfo)},l=function(e,t,i,n,a,o,s,d,u,c,p,_){var g,v,E,M,b,L,P,T,y,x,w,I,U,D,B,G,S,A,F,C,O,N,k,Y,X,j,z,V,Z,W,H,q,J,K,Q,$,ee,te,re,ie,ne,ae,oe,se,de,ue,ce,le,fe,he,Re,me,pe,_e,ge,ve,Ee,Me,be,Le,Pe,Te,ye,xe,we,Ie,Ue,De,Be,Ge,Se,Ae,Fe,Ce,Oe,Ne,ke,Ye,Xe,je,ze,Ve,Ze,We,He=e.gl,qe=d.cacheAttrInfo,Je=d.cacheUniformInfo,Ke=d.cacheSamplerIndex,Qe=d.cacheTexture;E=Math.PI/180,Oe=3.141592653589793,Ne=6.283185307179586,ke=1.27323954,Ye=.405284735,Xe=1.5707963267948966,g=i.length;var $e=i.length-1;for(H=t._useFog,(Ve=t.shadowManager._directionalShadow)?Q=H?"directionalShadow_fog":"directionalShadow":H&&(Q="fog");g--;){if(s.call++,N=(M=i[$e-g]).matrix,k=M.normalMatrix,Y=M.localMatrix,b=M._geometry,z=M._sprite3DYn,W=M.skinInfo,M.useLOD&&(ae=n.x-M.x,oe=n.y-M.y,se=n.z-M.z,je=Math.abs(Math.sqrt(ae*ae+oe*oe+se*se)),(V=(P=M._lodLevels)[0])&&V.distance<je&&(ze=V),(V=P[1])&&V.distance<je&&(ze=V),(V=P[2])&&V.distance<je&&(ze=V),(V=P[3])&&V.distance<je&&(ze=V),(V=P[4])&&V.distance<je&&(ze=V),ze&&(M._geometry=ze.geometry,M._material=ze.material)),b){if(Z=(L=p||M._material)._RedDirectionalShadowYn,L._RedMouseEventMaterialYn&&(L.color=M._mouseColorID),L.__RedSheetMaterialYn){if(L._nextFrameTime||(L._nextFrameTime=L._perFrameTime+o),L._playYn&&L._nextFrameTime<o){var et=parseInt((o-L._nextFrameTime)/L._perFrameTime);et=et||1,L._nextFrameTime=L._perFrameTime+o,L.currentIndex+=et,L.currentIndex>=L.totalFrame&&(L._loop?(L._playYn=!0,L.currentIndex=0):(L._playYn=!1,L.currentIndex=L.totalFrame-1))}L._sheetRect[0]=1/L._segmentW,L._sheetRect[1]=1/L._segmentH,L._sheetRect[2]=L.currentIndex%L._segmentW/L._segmentW,L._sheetRect[3]=Math.floor(L.currentIndex/L._segmentH)/L._segmentH}for((q=L.program)._prepareProgramYn&&(q=L.program=q._makePrepareProgram()),We=q.key,W||z?Ve?J=H&&z?"directionalShadow_fog_sprite3D":H&&W?"directionalShadow_fog_skin":W?"directionalShadow_skin":z?"directionalShadow_sprite3D":H?"directionalShadow_fog":"directionalShadow":H&&z?J="fog_sprite3D":H&&W?J="fog_skin":W?J="skin":z?J="sprite3D":H&&(J="fog"):J=Q,(Ze=L._programList)&&J&&((K=Ze[J][We])._prepareProgramYn&&(K=Ze[J][We]=K._makePrepareProgram()),q=K),r!=q._UUID&&He.useProgram(q.webglProgram),r=q._UUID,T=q.attributeLocation,I=q.uniformLocation,U=q.systemUniformLocation,S=b.interleaveBuffer,A=b.indexBuffer,X=S._UUID,v=T.length,I.length>v&&(v=I.length),x=S.interleaveDefineInfoList,h!=X&&He.bindBuffer(He.ARRAY_BUFFER,S.webglBuffer),h=X;v--;)(y=T[v])&&(w=x[y.name],G=y.location,w&&qe[G]!=w._UUID&&(!y.enabled&&He.enableVertexAttribArray(G),y.enabled=1,He.vertexAttribPointer(G,w.size,S.glArrayType,w.normalize,S.stride_BYTES_PER_ELEMENT,w.offset_BYTES_PER_ELEMENT),qe[G]=w._UUID)),(D=I[v])&&(B=D.location,X=D._UUID,O=D.renderTypeIndex,C=D.renderType,F=L[D.materialPropertyName],O<2?(j=D.samplerIndex,F?Qe[j]!=F._UUID&&(R!=j&&He.activeTexture(He.TEXTURE0+(R=j)),F._videoDom?(He.bindTexture(He.TEXTURE_2D,F.webglTexture),F._videoDom.loaded&&He.texImage2D(He.TEXTURE_2D,0,He.RGBA,He.RGBA,He.UNSIGNED_BYTE,F._videoDom),Qe=[]):He.bindTexture(0==O?He.TEXTURE_2D:He.TEXTURE_CUBE_MAP,F.webglTexture),Ke[X]!=j&&He.uniform1iv(B,[Ke[X]=j]),Qe[j]=F._UUID):Qe[j]!=O&&(Ke[X]!=O&&He.uniform1iv(B,[Ke[X]=O]),Qe[j]=O,R=O)):(null==F&&RedGLUtil.throwFunc("RedRenderer : Material에 ",D.materialPropertyName,"이 정의 되지않았습니다."),O<13?Je[X]!=F&&He[D.renderMethod](B,(Je[X]=12==O?null:F,F)):13==O?He[D.renderMethod](B,!1,F):RedGLUtil.throwFunc("RedRenderer : 처리할수없는 타입입니다.","tRenderType -",C)))}if(L&&L._RedMouseEventMaterialYn)b&&He.uniformMatrix4fv(U.uMMatrix.location,!1,N);else if(M.autoUpdateMatrix&&(de=1,ue=0,ce=0,fe=0,he=1,Re=0,pe=0,_e=0,ge=1,Y[12]=M.x+M.pivotX,Y[13]=M.y+M.pivotY,Y[14]=M.z+M.pivotZ,Y[15]=1,z?ae=oe=se=0:(ae=M.rotationX*E,oe=M.rotationY*E,se=M.rotationZ*E),(Ce=ae%Ne)<-Oe?Ce+=Ne:Ce>Oe&&(Ce-=Ne),$=(Ce=Ce<0?ke*Ce+Ye*Ce*Ce:ke*Ce-Ye*Ce*Ce)<0?.225*(Ce*-Ce-Ce)+Ce:.225*(Ce*Ce-Ce)+Ce,(Ce=(ae+Xe)%Ne)<-Oe?Ce+=Ne:Ce>Oe&&(Ce-=Ne),re=(Ce=Ce<0?ke*Ce+Ye*Ce*Ce:ke*Ce-Ye*Ce*Ce)<0?.225*(Ce*-Ce-Ce)+Ce:.225*(Ce*Ce-Ce)+Ce,(Ce=oe%Ne)<-Oe?Ce+=Ne:Ce>Oe&&(Ce-=Ne),ee=(Ce=Ce<0?ke*Ce+Ye*Ce*Ce:ke*Ce-Ye*Ce*Ce)<0?.225*(Ce*-Ce-Ce)+Ce:.225*(Ce*Ce-Ce)+Ce,(Ce=(oe+Xe)%Ne)<-Oe?Ce+=Ne:Ce>Oe&&(Ce-=Ne),ie=(Ce=Ce<0?ke*Ce+Ye*Ce*Ce:ke*Ce-Ye*Ce*Ce)<0?.225*(Ce*-Ce-Ce)+Ce:.225*(Ce*Ce-Ce)+Ce,(Ce=se%Ne)<-Oe?Ce+=Ne:Ce>Oe&&(Ce-=Ne),te=(Ce=Ce<0?ke*Ce+Ye*Ce*Ce:ke*Ce-Ye*Ce*Ce)<0?.225*(Ce*-Ce-Ce)+Ce:.225*(Ce*Ce-Ce)+Ce,(Ce=(se+Xe)%Ne)<-Oe?Ce+=Ne:Ce>Oe&&(Ce-=Ne),we=ie*(ne=(Ce=Ce<0?ke*Ce+Ye*Ce*Ce:ke*Ce-Ye*Ce*Ce)<0?.225*(Ce*-Ce-Ce)+Ce:.225*(Ce*Ce-Ce)+Ce),Ie=$*ee*ne-re*te,Ue=re*ee*ne+$*te,De=ie*te,Be=$*ee*te+re*ne,Ge=re*ee*te-$*ne,Se=-ee,Ae=$*ie,Fe=re*ie,ae=M.scaleX,oe=M.scaleY*(a?-1:1),se=M.scaleZ,Y[0]=(de*we+fe*Ie+pe*Ue)*ae,Y[1]=(ue*we+he*Ie+_e*Ue)*ae,Y[2]=(ce*we+Re*Ie+ge*Ue)*ae,Y[3]=Y[3]*ae,Y[4]=(de*De+fe*Be+pe*Ge)*oe,Y[5]=(ue*De+he*Be+_e*Ge)*oe,Y[6]=(ce*De+Re*Be+ge*Ge)*oe,Y[7]=Y[7]*oe,Y[8]=(de*Se+fe*Ae+pe*Fe)*se,Y[9]=(ue*Se+he*Ae+_e*Fe)*se,Y[10]=(ce*Se+Re*Ae+ge*Fe)*se,Y[11]=Y[11]*se,(M.pivotX||M.pivotY||M.pivotZ)&&(de=Y[0],ue=Y[1],ce=Y[2],le=Y[3],fe=Y[4],he=Y[5],Re=Y[6],me=Y[7],pe=Y[8],_e=Y[9],ge=Y[10],ve=Y[11],Ee=Y[12],Me=Y[13],be=Y[14],Le=Y[15],Pe=1,Te=0,ye=0,xe=0,Y[0]=Pe*de+Te*fe+ye*pe+xe*Ee,Y[1]=Pe*ue+Te*he+ye*_e+xe*Me,Y[2]=Pe*ce+Te*Re+ye*ge+xe*be,Y[3]=Pe*le+Te*me+ye*ve+xe*Le,Pe=0,Te=1,ye=0,xe=0,Y[4]=Pe*de+Te*fe+ye*pe+xe*Ee,Y[5]=Pe*ue+Te*he+ye*_e+xe*Me,Y[6]=Pe*ce+Te*Re+ye*ge+xe*be,Y[7]=Pe*le+Te*me+ye*ve+xe*Le,Pe=0,Te=0,ye=1,xe=0,Y[8]=Pe*de+Te*fe+ye*pe+xe*Ee,Y[9]=Pe*ue+Te*he+ye*_e+xe*Me,Y[10]=Pe*ce+Te*Re+ye*ge+xe*be,Y[11]=Pe*le+Te*me+ye*ve+xe*Le,Pe=M.pivotX,Te=M.pivotY,ye=M.pivotZ,xe=1,Y[12]=Pe*de+Te*fe+ye*pe+xe*Ee,Y[13]=Pe*ue+Te*he+ye*_e+xe*Me,Y[14]=Pe*ce+Te*Re+ye*ge+xe*be,Y[15]=Pe*le+Te*me+ye*ve+xe*Le),c?(de=c[0],ue=c[1],ce=c[2],le=c[3],fe=c[4],he=c[5],Re=c[6],me=c[7],pe=c[8],_e=c[9],ge=c[10],ve=c[11],Ee=c[12],Me=c[13],be=c[14],Le=c[15],Pe=Y[0],Te=Y[1],ye=Y[2],xe=Y[3],N[0]=Pe*de+Te*fe+ye*pe+xe*Ee,N[1]=Pe*ue+Te*he+ye*_e+xe*Me,N[2]=Pe*ce+Te*Re+ye*ge+xe*be,N[3]=Pe*le+Te*me+ye*ve+xe*Le,Pe=Y[4],Te=Y[5],ye=Y[6],xe=Y[7],N[4]=Pe*de+Te*fe+ye*pe+xe*Ee,N[5]=Pe*ue+Te*he+ye*_e+xe*Me,N[6]=Pe*ce+Te*Re+ye*ge+xe*be,N[7]=Pe*le+Te*me+ye*ve+xe*Le,Pe=Y[8],Te=Y[9],ye=Y[10],xe=Y[11],N[8]=Pe*de+Te*fe+ye*pe+xe*Ee,N[9]=Pe*ue+Te*he+ye*_e+xe*Me,N[10]=Pe*ce+Te*Re+ye*ge+xe*be,N[11]=Pe*le+Te*me+ye*ve+xe*Le,Pe=Y[12],Te=Y[13],ye=Y[14],xe=Y[15],N[12]=Pe*de+Te*fe+ye*pe+xe*Ee,N[13]=Pe*ue+Te*he+ye*_e+xe*Me,N[14]=Pe*ce+Te*Re+ye*ge+xe*be,N[15]=Pe*le+Te*me+ye*ve+xe*Le):(N[0]=Y[0],N[1]=Y[1],N[2]=Y[2],N[3]=Y[3],N[4]=Y[4],N[5]=Y[5],N[6]=Y[6],N[7]=Y[7],N[8]=Y[8],N[9]=Y[9],N[10]=Y[10],N[11]=Y[11],N[12]=Y[12],N[13]=Y[13],N[14]=Y[14],N[15]=Y[15])),b&&(He.uniformMatrix4fv(U.uMMatrix.location,!1,N),U.uNMatrix.location&&(de=N[0],ue=N[1],ce=N[2],le=N[3],fe=N[4],he=N[5],Re=N[6],me=N[7],pe=N[8],_e=N[9],ge=N[10],ve=N[11],Me=N[12],be=N[13],Ge=_e*(Le=N[14])-ge*be,Fe=1/(Fe=(Ee=de*he-ue*fe)*(Ge=ge*(Pe=N[15])-ve*Le)-(Te=de*Re-ce*fe)*(Se=_e*Pe-ve*be)+(ye=de*me-le*fe)*Ge+(xe=ue*Re-ce*he)*(Be=pe*Pe-ve*Me)-(we=ue*me-le*he)*(De=pe*Le-ge*Me)+(Ie=ce*me-le*Re)*(Ue=pe*be-_e*Me)),k[0]=(he*Ge-Re*Se+me*Ge)*Fe,k[4]=(-ue*Ge+ce*Se-le*Ge)*Fe,k[8]=(be*Ie-Le*we+Pe*xe)*Fe,k[12]=(-_e*Ie+ge*we-ve*xe)*Fe,k[1]=(-fe*Ge+Re*Be-me*De)*Fe,k[5]=(de*Ge-ce*Be+le*De)*Fe,k[9]=(-Me*Ie+Le*ye-Pe*Te)*Fe,k[13]=(pe*Ie-ge*ye+ve*Te)*Fe,k[2]=(fe*Se-he*Be+me*Ue)*Fe,k[6]=(-de*Se+ue*Be-le*Ue)*Fe,k[10]=(Me*we-be*ye+Pe*Ee)*Fe,k[14]=(-pe*we+_e*ye-ve*Ee)*Fe,k[3]=(-fe*Ge+he*De-Re*Ue)*Fe,k[7]=(de*Ge-ue*De+ce*Ue)*Fe,k[11]=(-Me*xe+be*Te-Le*Ee)*Fe,k[15]=(pe*xe-_e*Te+ge*Ee)*Fe,He.uniformMatrix4fv(U.uNMatrix.location,!1,k))),W){var tt,rt=W.joints,it=0,nt=rt.length,at=new Float32Array(16*nt),ot=[N[0],N[1],N[2],N[3],N[4],N[5],N[6],N[7],N[8],N[9],N[10],N[11],N[12],N[13],N[14],N[15]],st=ot,dt=ot[0],ut=ot[1],ct=ot[2],lt=ot[3],ft=ot[4],ht=ot[5],Rt=ot[6],mt=ot[7],pt=ot[8],_t=ot[9],gt=ot[10],vt=ot[11],Et=ot[12],Mt=ot[13],bt=ot[14],Lt=ot[15],Pt=_t*bt*mt-Mt*gt*mt+Mt*Rt*vt-ht*bt*vt-_t*Rt*Lt+ht*gt*Lt,Tt=Et*gt*mt-pt*bt*mt-Et*Rt*vt+ft*bt*vt+pt*Rt*Lt-ft*gt*Lt,yt=pt*Mt*mt-Et*_t*mt+Et*ht*vt-ft*Mt*vt-pt*ht*Lt+ft*_t*Lt,xt=Et*_t*Rt-pt*Mt*Rt-Et*ht*gt+ft*Mt*gt+pt*ht*bt-ft*_t*bt,wt=dt*Pt+ut*Tt+ct*yt+lt*xt;if(0===wt)return mat4.identity(ot);var It=1/wt;for(st[0]=Pt*It,st[1]=(Mt*gt*lt-_t*bt*lt-Mt*ct*vt+ut*bt*vt+_t*ct*Lt-ut*gt*Lt)*It,st[2]=(ht*bt*lt-Mt*Rt*lt+Mt*ct*mt-ut*bt*mt-ht*ct*Lt+ut*Rt*Lt)*It,st[3]=(_t*Rt*lt-ht*gt*lt-_t*ct*mt+ut*gt*mt+ht*ct*vt-ut*Rt*vt)*It,st[4]=Tt*It,st[5]=(pt*bt*lt-Et*gt*lt+Et*ct*vt-dt*bt*vt-pt*ct*Lt+dt*gt*Lt)*It,st[6]=(Et*Rt*lt-ft*bt*lt-Et*ct*mt+dt*bt*mt+ft*ct*Lt-dt*Rt*Lt)*It,st[7]=(ft*gt*lt-pt*Rt*lt+pt*ct*mt-dt*gt*mt-ft*ct*vt+dt*Rt*vt)*It,st[8]=yt*It,st[9]=(Et*_t*lt-pt*Mt*lt-Et*ut*vt+dt*Mt*vt+pt*ut*Lt-dt*_t*Lt)*It,st[10]=(ft*Mt*lt-Et*ht*lt+Et*ut*mt-dt*Mt*mt-ft*ut*Lt+dt*ht*Lt)*It,st[11]=(pt*ht*lt-ft*_t*lt-pt*ut*mt+dt*_t*mt+ft*ut*vt-dt*ht*vt)*It,st[12]=xt*It,st[13]=(pt*Mt*ct-Et*_t*ct+Et*ut*gt-dt*Mt*gt-pt*ut*bt+dt*_t*bt)*It,st[14]=(Et*ht*ct-ft*Mt*ct-Et*ut*Rt+dt*Mt*Rt+ft*ut*bt-dt*ht*bt)*It,st[15]=(ft*_t*ct-pt*ht*ct+pt*ut*Rt-dt*_t*Rt-ft*ut*gt+dt*ht*gt)*It;it<nt;it++)tt=rt[it].matrix,at[16*it+0]=tt[0],at[16*it+1]=tt[1],at[16*it+2]=tt[2],at[16*it+3]=tt[3],at[16*it+4]=tt[4],at[16*it+5]=tt[5],at[16*it+6]=tt[6],at[16*it+7]=tt[7],at[16*it+8]=tt[8],at[16*it+9]=tt[9],at[16*it+10]=tt[10],at[16*it+11]=tt[11],at[16*it+12]=tt[12],at[16*it+13]=tt[13],at[16*it+14]=tt[14],at[16*it+15]=tt[15];He.uniformMatrix4fv(U.uGlobalTransformOfNodeThatTheMeshIsAttachedTo.location,!1,ot),He.uniformMatrix4fv(U.uJointMatrix.location,!1,at),W.inverseBindMatrices._UUID||(W.inverseBindMatrices._UUID=JSON.stringify(W.inverseBindMatrices)),Je[X=U.uInverseBindMatrixForJoint._UUID]!=W.inverseBindMatrices._UUID&&(He.uniformMatrix4fv(U.uInverseBindMatrixForJoint.location,!1,W.inverseBindMatrices),Je[X]=W.inverseBindMatrices._UUID)}if(b){if(u.useCullFace!=M.useCullFace&&((u.useCullFace=M.useCullFace)?He.enable(He.CULL_FACE):He.disable(He.CULL_FACE)),u.useCullFace&&(u.cullFace!=M.cullFace&&He.cullFace(u.cullFace=M.cullFace)),u.useDepthMask!=M.useDepthMask&&He.depthMask(u.useDepthMask=M.useDepthMask),u.useDepthTest!=M.useDepthTest&&((u.useDepthTest=M.useDepthTest)?He.enable(He.DEPTH_TEST):He.disable(He.DEPTH_TEST)),u.useDepthTest&&(u.depthTestFunc!=M.depthTestFunc&&He.depthFunc(u.depthTestFunc=M.depthTestFunc)),U.uPointSize.use&&u.pointSize!=M.pointSize&&He.uniform1f(U.uPointSize.location,u.pointSize=M.pointSize),U.u_PerspectiveScale.location&&(X=U.u_PerspectiveScale._UUID,F=M._perspectiveScale,Je[X]!=F&&(He[U.u_PerspectiveScale.renderMethod](U.u_PerspectiveScale.location,F),Je[X]=F)),Z||(u.useBlendMode!=M.useBlendMode&&((u.useBlendMode=M.useBlendMode)?He.enable(He.BLEND):He.disable(He.BLEND)),u.blendSrc==M.blendSrc&&u.blendDst==M.blendDst||(He.blendFunc(M.blendSrc,M.blendDst),u.blendSrc=M.blendSrc,u.blendDst=M.blendDst)),_)M.autoUpdateMatrix=M._renderAutoUpdateMatrix;else if(M.useTransparentSort){m.push(M),M._renderAutoUpdateMatrix=M.autoUpdateMatrix,M.autoUpdateMatrix=!1;continue}A?(f!=A._UUID&&He.bindBuffer(He.ELEMENT_ARRAY_BUFFER,A.webglBuffer),He.drawElements(M.drawMode,A.pointNum,A.glArrayType,0),f=A._UUID,s.triangleNum+=A.triangleNum):(He.drawArrays(M.drawMode,0,S.pointNum),s.triangleNum+=S.triangleNum)}M.children.length&&l(e,t,M.children,n,a,o,s,d,u,N,p,_)}},RedRenderer.prototype.sceneRender=function(e,t,r,i,n,a,o,s,d){this.cacheInfo.cacheTexture.length=0,f=null,h=null,R=null,l(e,t,n,r,i,a,o,this.cacheInfo,this.cacheState,void 0,s,d)},Object.freeze(RedRenderer)}(),(RedRenderDebuger=function(){if(!(this instanceof RedRenderDebuger))return new RedRenderDebuger;if(window.HTMLCanvasElement&&!this.renderResult){this.renderResult=document.createElement("div"),this._contentBox=document.createElement("div"),this._etcBox=document.createElement("div"),this.renderResult.appendChild(this._contentBox),this.renderResult.appendChild(this._etcBox),this.renderResult.style.cssText="position:absolute;bottom:0px;left:0px;color:#fff;font:11px Lucida Grande,sans-serif;font-size:11px;background:rgba(0,0,0,0.75);padding:3px;width:300px",this._etcBox.style.cssText="position:relative;color:#fff;font:11px Lucida Grande,sans-serif;font-size:11px;padding:3px;margin-top:10px;";var e=document.createElement("a");e.style.padding="5px",e.style.borderRadius="2px",e.style.background="rgba(91, 82, 170,0.8)",e.style.color="#fff",e.style.textDecoration="none",e.style.display="block",e.setAttribute("href","https://redcamel.github.io/RedGL2/redDoc/index.html"),e.innerHTML="API document",this._etcBox.appendChild(e),(e=document.createElement("a")).style.padding="5px",e.style.borderRadius="2px",e.style.background="rgba(91, 82, 170,0.8)",e.style.color="#fff",e.style.textDecoration="none",e.style.display="block",e.style.marginTop="2px",e.setAttribute("href","https://github.com/redcamel/RedGL2"),e.innerHTML="GITHUB",this._etcBox.appendChild(e)}this._visible=!1}).prototype={update:function(e,t){if(window.HTMLCanvasElement){this._contentBox.innerHTML="";var r="",i=0,n=0;for(var a in t)r+='<div style="padding:5px"><div><b style="color:rgb(242, 169, 113)">RedView : key - '+t[a].key+'</b></div> mode2DYn - <b style="color:rgb(191, 82, 170)">'+t[a].mode2DYn+'</b> <br>call - <b style="color:rgb(191, 82, 170)">'+t[a].call+'</b> <br>triangleNum - <b style="color:rgb(191, 82, 170)">'+t[a].triangleNum+'</b> <br> width - <b style="color:rgb(191, 82, 170)">'+t[a].width+'</b> / height - <b style="color:rgb(191, 82, 170)">'+t[a].height+'</b> <br> viewRectWidth - <b style="color:rgb(191, 82, 170)">'+t[a].viewRectWidth+'</b> / viewRectHeight - <b style="color:rgb(191, 82, 170)">'+t[a].viewRectHeight+'</b> <br> x - <b style="color:rgb(191, 82, 170)">'+t[a].x+'</b> / y - <b style="color:rgb(191, 82, 170)">'+t[a].y+'</b><div>renderTime</div><div style="padding:5px 7px 7px 7px;background:rgba(0,0,0, 0.5);"><div>viewRenderTime - <b style="color:rgb(191, 82, 170)">'+t[a].viewRenderTime.toFixed(2)+'ms</b></div><div>baseRenderTime - <b style="color:rgb(191, 82, 170)">'+(t[a].viewRenderTime-t[a].postEffectRenderTime).toFixed(2)+'ms</b></div><div>postEffectRenderTime - <b style="color:rgb(191, 82, 170)">'+t[a].postEffectRenderTime.toFixed(2)+"ms</b></div></div></div>",i+=t[a].viewRenderTime,n+=t[a].postEffectRenderTime;r+='<div style="padding:0px 5px">',r+='<div>renderScale : <span style="padding:3px;background:#000">'+e.renderScale+"</span></div>",r+='<div>totalRenderTime : <span style="padding:3px;background:#000">'+i.toFixed(2)+"ms</span></div>",r+='<div>baseRenderTime : <span style="padding:3px;background:#000">'+(i-n).toFixed(2)+"ms</span></div>",r+='<div>postEffectRenderTime : <span style="padding:3px;background:#000">'+n.toFixed(2)+"ms</span></div>",r+="</div>",this._contentBox.innerHTML=r}}},Object.defineProperty(RedRenderDebuger.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,window.HTMLCanvasElement&&(this._visible?document.body.appendChild(this.renderResult):this.renderResult.parentNode&&document.body.removeChild(this.renderResult))}}),Object.freeze(RedRenderDebuger),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p,_,g,v,E,M,b,L,P,T,y,x,w,I,U,D,B,G,S,A,F,C,O,N;RedSystemUniformUpdater={update:(N=0,E=new Float32Array(3),function(k,Y,X,j,z,V){for(e!=k&&(L=null),e=k,L||(F=RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT,C=RedSystemShaderCode.MAX_POINT_LIGHT,L={uTime:{cacheData:null,data:0},uResolution:{cacheData:null,data:new Float32Array([0,0])},u_FogDensity:{cacheData:null,data:0},uFogColor:{cacheData:null,data:new Float32Array([0,0,0,0])},u_FogDistance:{cacheData:null,data:0},uCameraMatrix:{cacheData:null,data:null},uCameraPosition:{cacheData:null,data:new Float32Array([0,0,0])},uPMatrix:{cacheData:null,data:null},uMode2DYn:{cacheData:null,data:!1},uAmbientLightColor:{cacheData:null,data:new Float32Array([0,0,0,0])},uAmbientIntensity:{cacheData:null,data:1},uDirectionalLightPositionList:{cacheData:null,data:[]},uDirectionalLightColorList:{cacheData:null,data:[]},uDirectionalLightIntensityList:{cacheData:null,data:[]},uDirectionalLightNum:{cacheData:null,data:0},uPointLightPositionList:{cacheData:null,data:[]},uPointLightColorList:{cacheData:null,data:[]},uPointLightIntensityList:{cacheData:null,data:[]},uPointLightRadiusList:{cacheData:null,data:[]},uPointLightNum:{cacheData:null,data:0}},w=new Float32Array(3),T=new Float32Array(16),x=new Float32Array(16),u=new Float32Array(3*F),c=new Float32Array(4*F),l=new Float32Array(F),f=new Float32Array(3*C),h=new Float32Array(4*C),R=new Float32Array(C),m=new Float32Array(C)),t=k.gl,B=j.scene,G=(G=j.camera)instanceof RedBaseController?G.camera:G,S=j._viewRect,D=Y.cacheInfo.cacheSystemUniformInfo,U=null,P={},V.length=0,A=N!=k._datas.RedProgramList.length,N=0,(O=L.uTime).cacheData!=X&&(P.uTime=O.data=X,O.cacheData=X),d=JSON.stringify(S),((O=L.uResolution).cacheData!=d||A)&&(O.data[0]=S[2],O.data[1]=S[3],P.uResolution=O.data,O.cacheData=d),d=B._fogDensity,((O=L.u_FogDensity).cacheData!=d||A)&&(P.u_FogDensity=O.data=d,O.cacheData=d),d=B._fogR+"_"+B._fogG+"_"+B._fogB+"_1",((O=L.uFogColor).cacheData!=d||A)&&(O.data[0]=B._fogR,O.data[1]=B._fogG,O.data[2]=B._fogB,O.data[3]=1,P.uFogColor=O.data,O.cacheData=d),d=B._fogDistance,((O=L.u_FogDistance).cacheData!=d||A)&&(P.u_FogDistance=O.data=d,O.cacheData=d),d=JSON.stringify(G.matrix),((O=L.uCameraMatrix).cacheData!=d||A)&&(P.uCameraMatrix=O.data=G.matrix,O.cacheData=d),d=G.camera?[G.camera.x,G.camera.y,G.camera.z]:[G.x,G.y,G.z],((O=L.uCameraPosition).cacheData!=d.join(",")||A)&&(P.uCameraPosition=O.data=d,O.cacheData=d.join(",")),d=JSON.stringify(G.mode2DYn),((O=L.uMode2DYn).cacheData!=d||A)&&(P.uMode2DYn=O.data=G.mode2DYn,O.cacheData=d),d=JSON.stringify(G.perspectiveMTX),((O=L.uPMatrix).cacheData!=d||A)&&(P.uPMatrix=O.data=G.perspectiveMTX,O.cacheData=d),(g=B._lightInfo[RedAmbientLight.TYPE])&&(d=JSON.stringify(g._lightColor),((O=L.uAmbientLightColor).cacheData!=d||A)&&(P.uAmbientLightColor=O.data=[g._lightColor[0],g._lightColor[1],g._lightColor[2],g._lightColor[3]],O.cacheData=d,P.uAmbientLightColor[0]*=P.uAmbientLightColor[3],P.uAmbientLightColor[1]*=P.uAmbientLightColor[3],P.uAmbientLightColor[2]*=P.uAmbientLightColor[3]),d=g._intensity,((O=L.uAmbientIntensity).cacheData!=d||A)&&(P.uAmbientIntensity=O.data=g._intensity,O.cacheData=d)),p=B._lightInfo[RedDirectionalLight.TYPE],M=p.length;M--;)g=p[M],E[0]=g.x,E[1]=g.y,E[2]=g.z,g.debug&&((v=g._debugObject).x=E[0],v.y=E[1],v.z=E[2],v._material._color=g._lightColor,V.push(v)),vec3.normalize(E,E),u[0+3*M]=E[0],u[1+3*M]=E[1],u[2+3*M]=E[2],c[0+4*M]=g._lightColor[0]*g._lightColor[3],c[1+4*M]=g._lightColor[1]*g._lightColor[3],c[2+4*M]=g._lightColor[2]*g._lightColor[3],c[3+4*M]=g._lightColor[3],l[M]=g._intensity;for(d=JSON.stringify(u),((O=L.uDirectionalLightPositionList).cacheData!=d||A)&&(P.uDirectionalLightPositionList=O.data=u,O.cacheData=d),d=JSON.stringify(c),((O=L.uDirectionalLightColorList).cacheData!=d||A)&&(P.uDirectionalLightColorList=O.data=c,O.cacheData=d),d=JSON.stringify(l),((O=L.uDirectionalLightIntensityList).cacheData!=d||A)&&(P.uDirectionalLightIntensityList=O.data=l,O.cacheData=d),d=p.length,((O=L.uDirectionalLightNum).cacheData!=d||A)&&(P.uDirectionalLightNum=O.data=d,O.cacheData=d),p=B._lightInfo[RedPointLight.TYPE],M=p.length;M--;)g=p[M],E[0]=g.x,E[1]=g.y,E[2]=g.z,g.debug&&((v=g._debugObject).x=E[0],v.y=E[1],v.z=E[2],v.scaleX=v.scaleY=v.scaleZ=g._radius,v._material._color=g._lightColor,V.push(v)),f[0+3*M]=E[0],f[1+3*M]=E[1],f[2+3*M]=E[2],h[0+4*M]=g._lightColor[0]*g._lightColor[3],h[1+4*M]=g._lightColor[1]*g._lightColor[3],h[2+4*M]=g._lightColor[2]*g._lightColor[3],h[3+4*M]=g._lightColor[3],R[M]=g._intensity,m[M]=g._radius;for(d=JSON.stringify(f),((O=L.uPointLightPositionList).cacheData!=d||A)&&(P.uPointLightPositionList=O.data=f,O.cacheData=d),d=JSON.stringify(h),((O=L.uPointLightColorList).cacheData!=d||A)&&(P.uPointLightColorList=O.data=h,O.cacheData=d),d=JSON.stringify(R),((O=L.uPointLightIntensityList).cacheData!=d||A)&&(P.uPointLightIntensityList=O.data=R,O.cacheData=d),d=JSON.stringify(m),((O=L.uPointLightRadiusList).cacheData!=d||A)&&(P.uPointLightRadiusList=O.data=m,O.cacheData=d),d=p.length,((O=L.uPointLightNum).cacheData!=d||A)&&(P.uPointLightNum=O.data=d,O.cacheData=d),B.shadowManager._directionalShadow&&(T[1]=T[2]=T[3]=T[4]=T[6]=T[7]=T[8]=T[9]=T[11]=T[12]=T[13]=T[14]=0,T[0]=T[5]=T[10]=T[15]=1,y=B.shadowManager._directionalShadow.size,_=B.shadowManager._directionalShadow._light,mat4.ortho(x,-y,y,-y,y,-y,y),w[0]=0,w[1]=0,w[2]=0,_&&(w[0]=_.x,w[1]=_.y,w[2]=_.z,vec3.normalize(w,w),mat4.lookAt(T,w,[0,0,0],[0,1,0]),mat4.multiply(T,x,T))),M=k._datas.RedProgramList.length;M--;)for(b in N++,r=k._datas.RedProgramList[M],t.useProgram(r.webglProgram),z=r._UUID,i=r.systemUniformLocation,n=i.uDirectionalShadowLightMatrix,a=n.location,o=n._UUID,a&&B.shadowManager._directionalShadow&&(_=B.shadowManager._directionalShadow._light)&&(d=JSON.stringify(T),D[o]!=d&&(t.uniformMatrix4fv(a,!1,T),D[o]=d)),(n=i.uDirectionalShadowTexture)&&(a=n.location)&&(o=n._UUID,s=B.shadowManager._directionalShadow?B.shadowManager.directionalShadow.frameBuffer.texture:k._datas.emptyTexture["2d"],(I=n.samplerIndex)!=U&&(t.activeTexture(t.TEXTURE0+I),t.bindTexture(t.TEXTURE_2D,s.webglTexture),t[n.renderMethod](a,I)),U=I),P)n=i[b],(a=n.location)&&(o=n._UUID,s=P[b],"mat"==n.renderType?t[n.renderMethod](a,!1,s):t[n.renderMethod](a,s),D[o]=null);return z})},Object.freeze(RedSystemUniformUpdater)}(),(RedView=function(e,t,r){if(!(this instanceof RedView))return new RedView(e,t,r);!t||t instanceof RedScene||RedGLUtil.throwFunc("RedView : RedScene Instance만 허용","입력값 : "+t),r?!r||r instanceof RedCamera||r instanceof RedBaseController||RedGLUtil.throwFunc("RedView : RedCamera or XXController Instance만 허용"):RedGLUtil.throwFunc("RedView : RedCamera or XXController Instance만 허용","입력값 : "+r),this.scene=t,this.postEffectManager=RedPostEffectManager(e),this.camera=r,this._width="100%",this._height="100%",this._x=0,this._y=0,this._viewRect=[0,0,0,0],this._UUID=RedGL.makeUUID()}).prototype={setSize:function(e,t){null==e&&RedGLUtil.throwFunc("RedView setSize : width가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedView setSize : height가 입력되지 않았습니다."),"number"==typeof e?this._width=e<0?0:e:e.indexOf("%")>-1&&+e.replace("%","")>=0?this._width=e:RedGLUtil.throwFunc("RedView setSize : width는 0이상의 숫자나 %만 허용.",e),"number"==typeof t?this._height=t<0?0:t:t.indexOf("%")>-1&&+t.replace("%","")>=0?this._height=t:RedGLUtil.throwFunc("RedView setSize : height는 0이상의 숫자나 %만 허용.",t)},setLocation:function(e,t){null==e&&RedGLUtil.throwFunc("RedView setLocation : x가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedView setLocation : y가 입력되지 않았습니다."),"number"==typeof e?this._x=e<0?0:e:e.indexOf("%")>-1&&+e.replace("%","")>=0?this._x=e:RedGLUtil.throwFunc("RedView setLocation : x는 0이상의 숫자나 %만 허용.",e),"number"==typeof t?this._y=t<0?0:t:t.indexOf("%")>-1&&+t.replace("%","")>=0?this._y=t:RedGLUtil.throwFunc("RedView setLocation : y는 0이상의 숫자나 %만 허용.",t)}},Object.freeze(RedView),function(){var e,t;(RedWorld=function(){if(!(this instanceof RedWorld))return new RedWorld;this._viewList=[],this._viewMap={},this._UUID=RedGL.makeUUID()}).prototype={addView:function(e,t){e instanceof RedView||RedGLUtil.throwFunc("RedWorld :addView Instance만 허용함.","입력값 : "+e),t&&(this._viewMap[t]?RedGLUtil.throwFunc("RedWorld :key 중복","입력값 : "+t):this._viewMap[t]=e),this._viewList.push(e)},getView:function(e){return"string"==typeof e||RedGLUtil.throwFunc("RedWorld :getView 문자열만 허용함.","입력값 : "+e),this._viewMap[e]},delView:function(r){if("string"==typeof r||r instanceof RedView||RedGLUtil.throwFunc("RedWorld :delView 문자열이나 RedView 만 허용함.","입력값 : "+r),"string"==typeof r)(e=this._viewMap[r])&&(t=this._viewList.indexOf(e),this._viewList.splice(t,1),delete this._viewMap[r]);else for(var i in t=this._viewList.indexOf(r),this._viewList.splice(t,1),this._viewMap)this._viewMap[i]==r&&delete this._viewMap[i]},hasView:function(e){if("string"==typeof e||e instanceof RedView||RedGLUtil.throwFunc("RedWorld :hasView 문자열이나 RedView 만 허용함.","입력값 : "+e),"string"==typeof e)return!!this._viewMap[e];var t=this._viewList.indexOf(e);return!!this._viewList[t]},getViewList:function(){return this._viewList.concat()}},Object.freeze(RedWorld)}(),function(){RedScene=function(e,t){if(!(this instanceof RedScene))return new RedScene(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedScene : RedGL Instance만 허용.",e),this.backgroundColor=t||"#000000",this.useBackgroundColor=!0,this.useFog=!1,this.fogDensity=.5,this.fogDistance=25,this.fogColor="#ffffff",this.children=[],this.shadowManager=RedShadowManager(e),this.mouseManager=RedMouseEventManager(e),this._lightInfo={RedAmbientLight:null,RedDirectionalLight:[],RedPointLight:[]},this._UUID=RedGL.makeUUID()};var e,t,r={addLight:function(e){switch(e.TYPE){case RedAmbientLight.TYPE:this._lightInfo[e.TYPE]=e;break;case RedDirectionalLight.TYPE:this._lightInfo[e.TYPE].length===RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT&&RedGLUtil.throwFunc("RedScene : RedDirectionalLight "+RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT+"개 까지 허용."),this._lightInfo[e.TYPE].push(e);break;case RedPointLight.TYPE:this._lightInfo[e.TYPE].length===RedSystemShaderCode.MAX_POINT_LIGHT&&RedGLUtil.throwFunc("RedScene : RedPointLight "+RedSystemShaderCode.MAX_POINT_LIGHT+"개 까지 허용."),this._lightInfo[e.TYPE].push(e);break;default:RedGLUtil.throwFunc("RedScene : RedBaseLight 인스턴스만 가능")}},removeLight:function(t){switch(t.TYPE){case RedAmbientLight.TYPE:this._lightInfo[t.TYPE]===t&&(this._lightInfo[t.TYPE]=null);break;case RedDirectionalLight.TYPE:case RedPointLight.TYPE:(e=this._lightInfo[t.TYPE].indexOf(t))>-1&&this._lightInfo[t.TYPE].splice(e,1);break;default:RedGLUtil.throwFunc("RedScene : RedBaseLight 인스턴스만 가능")}},removeLightAll:function(){this._lightInfo[RedAmbientLight.TYPE]=null,this._lightInfo[RedDirectionalLight.TYPE].length=0,this._lightInfo[RedPointLight.TYPE].length=0}};for(var i in RedScene.prototype=new RedBaseContainer,r)RedScene.prototype[i]=r[i];RedDefinePropertyInfo.definePrototype("RedScene","backgroundColor","hex",{callback:function(){t=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._backgroundColor),this._r=t[0],this._g=t[1],this._b=t[2]}}),RedDefinePropertyInfo.definePrototype("RedScene","useBackgroundColor","boolean"),RedDefinePropertyInfo.definePrototype("RedScene","useFog","boolean"),RedDefinePropertyInfo.definePrototype("RedScene","fogDensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedScene","fogDistance","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedScene","fogColor","hex",{callback:function(){var e;return function(){e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._fogColor),this._fogR=e[0],this._fogG=e[1],this._fogB=e[2]}}()}),Object.defineProperty(RedScene.prototype,"skyBox",{get:function(){return this._skyBoxMesh},set:function(e){return!e||e instanceof RedSkyBox||RedGLUtil.throwFunc("RedScene : RedSkyBox Instance만 허용."),this._skyBoxMesh=e,this._skyBoxMesh}}),Object.defineProperty(RedScene.prototype,"grid",{get:function(){return this._gridMesh},set:function(e){return!e||e instanceof RedGrid||RedGLUtil.throwFunc("RedScene : RedGrid Instance만 허용."),this._gridMesh=e,this._gridMesh}}),Object.defineProperty(RedScene.prototype,"axis",{get:function(){return this._axisMesh},set:function(e){return!e||e instanceof RedAxis||RedGLUtil.throwFunc("RedScene : RedAxis Instance만 허용."),this._axisMesh=e,this._axisMesh}}),Object.freeze(RedScene)}(),function(){var e,t;(RedCamera=function(){if(!(this instanceof RedCamera))return new RedCamera;this.x=this.y=this.z=0,this.targetX=this.targetY=this.targetZ=0,this.fov=60,this.nearClipping=.1,this.farClipping=1e5,this.mode2DYn=!1,this.matrix=mat4.create(),this.perspectiveMTX=mat4.create(),this.autoUpdateMatrix=!0,this._UUID=RedGL.makeUUID()}).prototype.update=function(){this.lookAt(this.targetX,this.targetY,this.targetZ)},RedCamera.prototype.lookAt=(e=new Float32Array([0,1,0]),t=[],function(r,i,n){t[0]=this.targetX=r,t[1]=this.targetY=i,t[2]=this.targetZ=n,mat4.identity(this.matrix),mat4.lookAt(this.matrix,[this.x,this.y,this.z],t,e)}),Object.freeze(RedCamera)}(),(RedBasicController=function(e){if(!(this instanceof RedBasicController))return new RedBasicController(e);this.targetView=null,this.keyBuffer={},this.keyNameMapper={moveForward:"w",moveBack:"s",moveLeft:"a",moveRight:"d",moveUp:"t",moveDown:"g",turnLeft:"q",turnRight:"e",turnUp:"r",turnDown:"f"},this.speed=1,this.delay=.1,this.speedRotation=1,this.delayRotation=.1,this.maxAcceleration=3,this._currentAcceleration=0,this.camera=RedCamera(),this._desirePosition=[0,0,0],this._desirePan=0,this._desireTilt=0,this._targetObject=RedMesh(e),function(t){var r,i,n,a,o,s,d,u,c,l,f,h,R,m,p;"ie"==RedGLDetect.BROWSER_INFO.browser&&11==RedGLDetect.BROWSER_INFO.browserVer?(R="offsetX",m="offsetY"):(R="layerX",m="layerY"),p=function(r){if(r||((r={clientX:e._mouseX,clientY:e._mouseY})[R]=e._mouseX,r[m]=e._mouseY),t.targetView){var i,n;if(RedGLDetect.BROWSER_INFO.isMobile?(i=r.clientX,n=r.clientY):(i=r[R],n=r[m]),!(t.targetView._viewRect[0]<i&&i<t.targetView._viewRect[0]+t.targetView._viewRect[2]))return;if(!(t.targetView._viewRect[1]<n&&n<t.targetView._viewRect[1]+t.targetView._viewRect[3]))return}return!0},l=RedGLDetect.BROWSER_INFO.move,f=RedGLDetect.BROWSER_INFO.up,h=RedGLDetect.BROWSER_INFO.down,s=0,d=0,u=0,c=0,r=function(e){p()&&(t.keyBuffer[e.key]=1)},i=function(e){t.keyBuffer[e.key]=0},n=function(t){RedGLDetect.BROWSER_INFO.isMobile&&(t=t.targetTouches[0]),p(t)&&(RedGLDetect.BROWSER_INFO.isMobile?(s=t.clientX,d=t.clientY):(s=t[R],d=t[m]),e._canvas.addEventListener(l,a),window.addEventListener(f,o))},a=function(e){RedGLDetect.BROWSER_INFO.isMobile?(e=e.targetTouches[0],u=e.clientX-s,c=e.clientY-d,s=e.clientX,d=e.clientY):(u=e[R]-s,c=e[m]-d,s=e[R],d=e[m]),t._desirePan-=u*t._speedRotation*.1,t._desireTilt-=c*t._speedRotation*.1},o=function(){e._canvas.removeEventListener(l,a),window.removeEventListener(f,o)},window.addEventListener("keydown",r),window.addEventListener("keyup",i),e._canvas.addEventListener(h,n)}(this)}).prototype=new RedBaseController,RedDefinePropertyInfo.definePrototypes("RedBasicController",["speed","number",{min:0}],["delay","number",{min:0}],["speedRotation","number",{min:0}],["delayRotation","number",{min:0}],["maxAcceleration","number",{min:0}]),["x","y","z"].forEach(function(e,t){Object.defineProperty(RedBasicController.prototype,e,{get:function(){return this._targetObject[e]},set:function(r){this._targetObject[e]=r,this._desirePosition[t]=r}})}),Object.defineProperty(RedBasicController.prototype,"tilt",{get:function(){return this._desireTilt},set:function(e){this._targetObject.rotationX=e,this._desireTilt=e}}),Object.defineProperty(RedBasicController.prototype,"pan",{get:function(){return this._desirePan},set:function(e){this._targetObject.rotationY=e,this._desirePan=e}}),RedBasicController.prototype.update=function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p;return new Float32Array([0,1,0]),l=mat4.create(),u=mat4.create(),c=mat4.create(),f=vec3.create(),function(){e=0,t=0,i=!1,n=!1,a=this._speed,o=this._speedRotation,s=this._delay,d=this._delayRotation,h=this.camera,p=this._desirePosition,R=this.keyBuffer,m=this.keyNameMapper,f[0]=0,f[1]=0,f[2]=0,R[m.turnLeft]&&(n=!0,e=o),R[m.turnRight]&&(n=!0,e=-o),R[m.turnUp]&&(n=!0,t=o),R[m.turnDown]&&(n=!0,t=-o),R[m.moveForward]&&(i=!0,f[2]=-this._currentAcceleration*a),R[m.moveBack]&&(i=!0,f[2]=this._currentAcceleration*a),R[m.moveLeft]&&(i=!0,f[0]=-this._currentAcceleration*a),R[m.moveRight]&&(i=!0,f[0]=this._currentAcceleration*a),R[m.moveUp]&&(i=!0,f[1]=this._currentAcceleration*a),R[m.moveDown]&&(i=!0,f[1]=-this._currentAcceleration*a),n||i?(this._currentAcceleration+=.1,this._currentAcceleration>this._maxAcceleration&&(this._currentAcceleration=this._maxAcceleration)):(this._currentAcceleration+=-.1,this._currentAcceleration<0&&(this._currentAcceleration=0)),r=this._targetObject,n&&(this._desirePan+=e,this._desireTilt+=t),r.rotationY+=(this._desirePan-r.rotationY)*d,r.rotationX+=(this._desireTilt-r.rotationX)*d,(i||n)&&(u=r.matrix,mat4.identity(l),mat4.rotateY(l,l,r.rotationY*Math.PI/180),mat4.rotateX(l,l,r.rotationX*Math.PI/180),mat4.translate(l,l,f),mat4.identity(u),mat4.translate(u,u,[r.x,r.y,r.z]),mat4.multiply(u,u,l),p[0]=u[12],p[1]=u[13],p[2]=u[14]),r.x+=(p[0]-r.x)*s,r.y+=(p[1]-r.y)*s,r.z+=(p[2]-r.z)*s,r.rotationY+=(this._desirePan-r.rotationY)*d,r.rotationX+=(this._desireTilt-r.rotationX)*d,u=r.matrix,mat4.identity(u),mat4.translate(u,u,[r.x,r.y,r.z]),mat4.rotateY(u,u,r.rotationY*Math.PI/180),mat4.rotateX(u,u,r.rotationX*Math.PI/180),c=mat4.clone(u),mat4.translate(c,c,[0,0,.01]),h.x=c[12],h.y=c[13],h.z=c[14],h.lookAt(r.x,r.y,r.z)}}(),Object.freeze(RedBasicController),function(){var e,t,r,i;(RedObitController=function(e){if(!(this instanceof RedObitController))return new RedObitController(e);this.centerX=0,this.centerY=0,this.centerZ=0,this.distance=15,this.speedDistance=2,this.delayDistance=.1,this.speedRotation=3,this.delayRotation=.1,this.tilt=0,this.minTilt=-90,this.maxTilt=90,this.pan=0,this.camera=RedCamera(),this._currentPan=0,this._currentTilt=0,this._currentDistance=0,this.needUpdate=!0,this.targetView=null,function(t){var r,i,n,a,o,s,d,u,c,l,f,h,R,m;h=function(e){if(t.targetView){var r,i;if(RedGLDetect.BROWSER_INFO.isMobile?(r=e.clientX,i=e.clientY):(r=e[R],i=e[m]),!(t.targetView._viewRect[0]<r&&r<t.targetView._viewRect[0]+t.targetView._viewRect[2]))return;if(!(t.targetView._viewRect[1]<i&&i<t.targetView._viewRect[1]+t.targetView._viewRect[3]))return}return!0},c=RedGLDetect.BROWSER_INFO.move,l=RedGLDetect.BROWSER_INFO.up,f=RedGLDetect.BROWSER_INFO.down,o=0,s=0,d=0,u=0,"ie"==RedGLDetect.BROWSER_INFO.browser&&11==RedGLDetect.BROWSER_INFO.browserVer?(R="offsetX",m="offsetY"):(R="layerX",m="layerY"),r=function(r){if(t.needUpdate){if(RedGLDetect.BROWSER_INFO.isMobile&&(r=r.targetTouches[0]),!h(r))return;RedGLDetect.BROWSER_INFO.isMobile?(o=r.clientX,s=r.clientY):(o=r[R],s=r[m]),e._canvas.addEventListener(c,i),window.addEventListener(l,n)}},i=function(e){t.needUpdate&&(RedGLDetect.BROWSER_INFO.isMobile?(e=e.targetTouches[0],d=e.clientX-o,u=e.clientY-s,o=e.clientX,s=e.clientY):(d=e[R]-o,u=e[m]-s,o=e[R],s=e[m]),t._pan-=d*t._speedRotation*.1,t._tilt-=u*t._speedRotation*.1)},n=function(){e._canvas.removeEventListener(c,i),window.removeEventListener(l,n)},a=function(e){if(t.needUpdate){if(!h(e))return;t.distance+=e.deltaY/100*t._speedDistance}},e._canvas.addEventListener(f,r),e._canvas.addEventListener("wheel",a)}(this)}).prototype=new RedBaseController,RedDefinePropertyInfo.definePrototypes("RedObitController",["centerX","number"],["centerY","number"],["centerZ","number"],["distance","number",{min:1}],["speedDistance","number",{min:0}],["delayDistance","number",{min:0}],["speedRotation","number",{min:0}],["delayRotation","number",{min:0}],["pan","number"],["tilt","number"],["maxTilt","number",{min:-90,max:90}],["minTilt","number",{min:-90,max:90}]),RedObitController.prototype.update=(i=Math.PI/180,function(){this.needUpdate&&(this._tilt<this._minTilt&&(this._tilt=this._minTilt),this._tilt>this._maxTilt&&(this._tilt=this._maxTilt),e=this._delayRotation,t=this.camera,r=t.matrix,this._currentPan+=(this._pan-this._currentPan)*e,this._currentTilt+=(this._tilt-this._currentTilt)*e,this._currentDistance+=(this._distance-this._currentDistance)*this._delayDistance,mat4.identity(r),mat4.translate(r,r,[this._centerX,this._centerY,this._centerZ]),mat4.rotateY(r,r,this._currentPan*i),mat4.rotateX(r,r,this._currentTilt*i),mat4.translate(r,r,[0,0,this._currentDistance]),t.x=r[12],t.y=r[13],t.z=r[14],t.lookAt(this._centerX,this._centerY,this._centerZ))}),Object.freeze(RedObitController)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vVertexColor = aVertexColor;
gl_Position = uPMatrix * uCameraMatrix* uMMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
void main(void) {
vec4 finalColor = vVertexColor;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedGridMaterial=function(i){if(!(this instanceof RedGridMaterial))return new RedGridMaterial(i);this.makeProgramList(this,i,"RedGridMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedGridMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
varying vec3 vReflectionCubeCoord;
void main(void) {
vReflectionCubeCoord = (uMMatrix *vec4(aVertexPosition, 0.0)).xyz;
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform samplerCube u_skyBoxTexture;
varying vec3 vReflectionCubeCoord;
uniform float u_alpha;
uniform bool u_mirrorMode;
void main(void) {
vec4 finalColor ;
if(u_mirrorMode) finalColor = textureCube(u_skyBoxTexture, vec3(1.0-vReflectionCubeCoord.x,vReflectionCubeCoord.y,1.0-vReflectionCubeCoord.z));
else finalColor = textureCube(u_skyBoxTexture, vReflectionCubeCoord);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
gl_FragColor.a = u_alpha;
}
*/},(RedSkyBoxMaterial=function(i,n,a){if(!(this instanceof RedSkyBoxMaterial))return new RedSkyBoxMaterial(i,n,a);i instanceof RedGL||RedGLUtil.throwFunc("RedSkyBoxMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedSkyBoxMaterialProgram",e,t),this.skyBoxTexture=n,this._UUID=RedGL.makeUUID(),this.alpha=null==a?1:a,this.mirrorMode=!1,r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","skyBoxTexture","samplerCube",{essential:!0}),RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","mirrorMode","boolean"),Object.freeze(RedSkyBoxMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = getSprite3DMatrix(uDirectionalShadowLightMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
vec4 encodeFloat (float depth) {
const vec4 cBitShift = vec4(
256.0 * 256.0 * 256.0,
256.0 * 256.0,
256.0,
1.0
);
const vec4 cBitMask = vec4(
0.0,
1.0 / 256.0,
1.0 / 256.0,
1.0 / 256.0
);
vec4 comp = fract(depth * cBitShift);
comp -= comp.xxyz * cBitMask;
return comp;
}
void main(void) {
vec4 finalColor = encodeFloat(gl_FragCoord.z);
// if(finalColor.a < 0.5) finalColor = vec4(0.0, 0.0, 0.0, 1.0);
gl_FragColor = finalColor;
}
*/},(RedDirectionalShadowMaterial=function(i){if(!(this instanceof RedDirectionalShadowMaterial))return new RedDirectionalShadowMaterial(i);i instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalShadowMaterial : RedGL Instance만 허용.",i),this._RedDirectionalShadowYn=!0,this.makeProgramList(this,i,"RedDirectionalShadowMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedDirectionalShadowMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
gl_FragColor = texture2D(u_diffuseTexture, vTexcoord);
}
*/},(RedPostEffectMaterial=function(i,n){if(!(this instanceof RedPostEffectMaterial))return new RedPostEffectMaterial(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffectMaterial : RedGL Instance만 허용.",i),this.diffuseTexture=n,this.program=RedProgram.makeProgram(i,"RedPostEffectMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedPostEffectMaterial","diffuseTexture","sampler2D",{essential:!0}),Object.freeze(RedPostEffectMaterial)}(),function(){var e;(RedDirectionalShadow=function(e,t){if(!(this instanceof RedDirectionalShadow))return new RedDirectionalShadow(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalShadow : RedGL Instance만 허용.",e),this._directionalShadowMaterial=RedDirectionalShadowMaterial(e),this.frameBuffer=RedFrameBuffer(e),this.light=t,this.width=2048,this.height=2048,this.size=20,this._UUID=RedGL.makeUUID(),this._castingList=[]}).prototype.addCasting=function(e){e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addCasting","RedBaseObject3D Instance만 가능","입력값 : "+e),this._castingList.push(e)},RedDirectionalShadow.prototype.removeCasting=function(t){-1==(e=this._castingList.indexOf(t))?RedGLUtil.throwFunc("removeCasting","존재하지 않는 대상을 삭제하려고 함"):this._castingList.splice(e,1)},Object.defineProperty(RedDirectionalShadow.prototype,"light",{get:function(){return this._light},set:function(e){e&&e instanceof RedDirectionalLight||RedGLUtil.throwFunc("RedDirectionalShadow - light : RedDirectionalLight Instance만 허용.",e),this._light=e}}),RedDefinePropertyInfo.definePrototypes("RedDirectionalShadow",["width","number",{min:1}],["height","number",{min:1}],["size","number",{min:1}]),Object.freeze(RedDirectionalShadow)}(),function(){var e,t,r,i,n,a;(RedShadowManager=function(e){if(!(this instanceof RedShadowManager))return new RedShadowManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedShadowManager : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID()}).prototype={render:function(o,s,d,u,c){(i=this._directionalShadow)&&(e=o.gl,r=s.worldRect,t=d._viewRect,n=i.width,a=i.height,i.frameBuffer.width=n,i.frameBuffer.height=a,i.frameBuffer.bind(o.gl),e.viewport(0,0,n,a),e.scissor(0,0,n,a),e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),s.sceneRender(o,d.scene,d.camera,d.camera.mode2DYn,i._castingList,u,c,i._directionalShadowMaterial),i.frameBuffer.unbind(o.gl),e.viewport(t[0],r[3]-t[3]-t[1],t[2],t[3]),e.scissor(t[0],r[3]-t[3]-t[1],t[2],t[3]))}},Object.defineProperty(RedShadowManager.prototype,"directionalShadow",{get:function(){return this._directionalShadow},set:function(e){!e||e instanceof RedDirectionalShadow||RedGLUtil.throwFunc("RedShadowManager - directionalShadow : RedDirectionalShadow Instance만 허용.",e),this._directionalShadow=e}}),Object.freeze(RedShadowManager)}(),function(){var e,t,r,i;t=function(t,r,i){var n;n=t._svg.querySelector("td").style,t["_"+r]=i,Object.defineProperty(t,r,{get:function(){return t["_"+r]},set:function(i){t["_"+r]=i,n[r]="number"==typeof i?i+="px":i,e(t)}}),t[r]=i},e=function(e){e._height=+e._height,e._svg.setAttribute("width",e._width),e._svg.setAttribute("height",e._height),e._svg.querySelector("foreignObject").setAttribute("height",e._height),e._svg.querySelector("table").style.height=e._height+"px",e._img.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e._svg.outerHTML)},(RedText=function(e,r,i){if(!(this instanceof RedText))return new RedText(e,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedText : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl);var n=this;this._cvs=null,this._ctx=null,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this._svg.style="position:absolute;top:0px;left:0px;text-align:center;z-index:10",this._svg.innerHTML='<foreignObject  width="100%" style="position:absolute;top:0;left:0">   <table xmlns="http://www.w3.org/1999/xhtml" style="border-collapse: collapse;position:table;top:0;left:0;width:100%;table-layout:fixed">       <tr xmlns="http://www.w3.org/1999/xhtml">       <td xmlns="http://www.w3.org/1999/xhtml"  > </td>       </tr>   </table></foreignObject>',this.geometry=RedPlane(e,1,1),this.material=RedTextMaterial(e,RedBitmapTexture(e,this._cvs)),this.blendSrc=e.gl.ONE,this.blendDst=e.gl.ONE_MINUS_SRC_ALPHA,this.useCullFace=!1,this.perspectiveScale=!0,this.sprite3DYn=!1,this._img=new Image,i=i||256,(r=r||256)>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),i>e.detect.texture.MAX_TEXTURE_SIZE&&(i=e.detect.texture.MAX_TEXTURE_SIZE),this.width=r,this.height=i,t(this,"padding",0),t(this,"background",""),t(this,"color","#000"),t(this,"fontFamily","Arial"),t(this,"fontSize",16),t(this,"fontWeight","normal"),t(this,"fontStyle","normal"),t(this,"lineHeight",24),t(this,"letterSpacing",0),t(this,"wordBreak","break-all"),t(this,"verticalAlign","middle"),t(this,"textAlign","center"),this._img.onload=function(){var t,r;(t=n._width)%2==0&&(t+=1),(r=n._height)%2==0&&(r+=1),n._cvs=window.OffscreenCanvas?new OffscreenCanvas(t,r):document.createElement("canvas"),n._ctx=n._cvs.getContext("2d"),n._cvs.width=t,n._cvs.height=r,n._ctx.clearRect(0,0,t,r),n._ctx.drawImage(n._img,0,0,t,r),n.material.width=t,n.material.height=r,n.material.diffuseTexture.src=n._cvs,n.material.diffuseTexture.option={min:e.gl.LINEAR,mag:e.gl.LINEAR,wrap_s:e.gl.CLAMP_TO_EDGE,wrap_t:e.gl.CLAMP_TO_EDGE}},this.useTransparentSort=!0,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseObject3D,RedDefinePropertyInfo.definePrototypes("RedText",["perspectiveScale","boolean"],["sprite3DYn","boolean"],["width","uint",{min:2,callback:function(t){this._width=t,this.material.width=t,e(this)}}],["height","uint",{min:2,callback:function(t){this._height=t,this.material.height=t,e(this)}}]),Object.defineProperty(RedText.prototype,"text",{get:function(){return this._text},set:function(t){r=this._svg,i=r.querySelector("foreignObject td"),this._text=t.replace(/\<br\>/gi,"<div/>");var n=this,a=this._text.match(/<img .*?>/g),o=[],s=this._text,d=(a=a||[]).length,u=0;a.forEach(function(t){var r=t.match(/src\s*=\s*(\'|\").*?(\'|\")/g)[0];r=r.replace(/src\s*=\s*(\'|\")/g,"").replace(/(\'|\")/g,"");var a=document.createElement("div");a.innerHTML=t;var c=a.querySelector("img");c.onload=function(){var t=document.createElement("canvas");t.width=c.style.width?+c.style.width:c.width,t.height=c.style.height?+c.style.height:c.height;var r=t.getContext("2d");r.scale(t.width/c.naturalWidth,t.height/c.naturalHeight),r.drawImage(c,0,0),l.result='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink" width="'+c.width+'" height="'+c.height+'" display="inline" style="vertical-align: middle;display: inline-block"><image xlink:href="'+t.toDataURL("image/png")+'" height="'+c.height+'px" width="'+c.width+'px" /></svg>',++u==d&&(o.forEach(function(e){s=s.replace(e.source,e.result)}),i.innerHTML=s,e(n)),c.onload=null};var l={source:t,sourceSrc:r,result:""};o.push(l)}),0==a.length&&(i.innerHTML=s,e(this))}}),Object.freeze(RedText)}(),function(){var e,t,r,i,n,a,o,s,d;(RedMouseEventManager=function(e){if(!(this instanceof RedMouseEventManager))return new RedMouseEventManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedMouseEventManager : RedGL Instance만 허용.",e),this.frameBuffer=RedFrameBuffer(e),this._mouseEventMaterial=RedMouseEventMaterial(e),this._mouseEventListObject={},this._mouseEventList=[],this._prevInfo={},this._UUID=RedGL.makeUUID()}).prototype={add:function(e,t,r){var i=e._mouseColorID;this._mouseEventListObject[i]||(this._mouseEventListObject[i]={target:e},this._mouseEventList.push(e)),this._mouseEventListObject[i][t]=r},remove:function(e,t){var r=e._mouseColorID;if(this._mouseEventListObject[r]){var i=0;for(var n in this._mouseEventListObject[r][t]&&delete this._mouseEventListObject[r][t],this._mouseEventListObject[r])i++;if(1===i){var a=this._mouseEventList.indexOf(e);a>-1&&(this._mouseEventList.splice(a,1),delete this._mouseEventListObject[r])}}},render:(n=new Uint8Array(4),a=1,o=[],s="default",d=function(){if(o.length){var e=o.shift();e.info[e.type].call(e.info.target,{target:e.info.target,type:"out"})}},function(u,c,l,f,h,R){if(this._mouseEventList.length){a=u.renderScale*window.devicePixelRatio,e=u.gl,t=c.worldRect,l._viewRect,r=t[2],i=t[3],this.frameBuffer.width=r,this.frameBuffer.height=i,this.frameBuffer.bind(u.gl),c.sceneRender(u,l.scene,l.camera,l.camera.mode2DYn,this._mouseEventList,f,h,this._mouseEventMaterial);var m,p,_,g=u._mouseEventInfo;for(m=0,p=g.length;m<p;m++){_=g[m],e.readPixels(_.x*a,i-_.y*a,1,1,e.RGBA,e.UNSIGNED_BYTE,n);var v,E=this._mouseEventListObject[n[0]+","+n[1]+","+n[2]+","+n[3]];E?(E.target._UUID,_.type==RedGLDetect.BROWSER_INFO.down&&(v="down")&&E[v]&&E[v].call(E.target,{target:E.target,type:v,nativeEvent:_.nativeEvent}),_.type==RedGLDetect.BROWSER_INFO.up&&(v="up")&&E[v]&&E[v].call(E.target,{target:E.target,type:v,nativeEvent:_.nativeEvent}),this._prevInfo[l._UUID]&&this._prevInfo[l._UUID]!=E&&(v="out")&&this._prevInfo[l._UUID][v]&&this._prevInfo[l._UUID][v].call(this._prevInfo[l._UUID].target,{target:this._prevInfo[l._UUID].target,type:v}),this._prevInfo[l._UUID]!=E&&(v="over")&&E[v]&&E[v].call(E.target,{target:E.target,type:v,nativeEvent:_.nativeEvent}),this._prevInfo[l._UUID]=E):(v="out",this._prevInfo[l._UUID]&&this._prevInfo[l._UUID][v]&&o.push({info:this._prevInfo[l._UUID],type:v,nativeEvent:_.nativeEvent}),this._prevInfo[l._UUID]=null),d()}this._prevInfo[l._UUID]&&(s="pointer"),R&&(u._mouseEventInfo.length=0,document.body.style.cursor=s,s="default"),this.frameBuffer.unbind(u.gl)}})},Object.freeze(RedMouseEventManager)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform vec4 uColor;
void main(void) {
gl_FragColor = uColor / 255.0;
}
*/},(RedMouseEventMaterial=function(i){if(!(this instanceof RedMouseEventMaterial))return new RedMouseEventMaterial(i);i instanceof RedGL||RedGLUtil.throwFunc("RedMouseEventMaterial : RedGL Instance만 허용.",i),this._RedMouseEventMaterialYn=!0,this.color=null,this.makeProgramList(this,i,"RedMouseEventMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedMouseEventMaterial)}(),function(){var e,t,r,i,n,a,o,s,d,u,c,l,f,h,R,m,p,_,g,v,E,M,b,L,P,T,y,x;(RedPostEffectManager=function(e){if(!(this instanceof RedPostEffectManager))return new RedPostEffectManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedPostEffectManager : RedGL Instance만 허용.",e),Object.defineProperty(this,"frameBuffer",{value:RedFrameBuffer(e)}),Object.defineProperty(this,"finalMaterial",{value:RedPostEffectMaterial(e,this.frameBuffer.texture)}),Object.defineProperty(this,"postEffectList",{value:[]}),Object.defineProperty(this,"children",{value:[RedMesh(e,RedPlane(e,1,1,1,1,!0),this.finalMaterial)]}),this._UUID=RedGL.makeUUID()}).prototype={addEffect:function(e){e instanceof RedBasePostEffect||RedGLUtil.throwFunc("RedPostEffectManager : addEffect - RedBasePostEffect Instance만 허용.","입력값 : "+e),this.postEffectList.push(e)},removeEffect:function(e){-1!=(x=this.postEffectList.indexOf(e))&&this.postEffectList.splice(x,1)},removeAllEffect:function(){this.postEffectList.length=0},bind:function(e){this.frameBuffer.bind(e)},unbind:function(e){this.frameBuffer.unbind(e)},render:(p=mat4.create(),m=new Float32Array(2),d=function(t,r,i,n,a){e._material=i,c=e._material.program,t.useProgram(c.webglProgram),f=c.systemUniformLocation,(l=f.uPMatrix)&&(h=l.location,R=l._UUID,h&&(mat4.ortho(p,-.5,.5,-.5,.5,-r.farClipping,r.farClipping),mat4.scale(p,p,[1,-1,1]),_=JSON.stringify(p),u[R]!=_&&(t.uniformMatrix4fv(h,!1,p),u[R]=_))),(l=f.uResolution)&&(h=l.location,R=l._UUID,h&&(m[0]=n,m[1]=a,_=JSON.stringify(m),u[R]!=_&&(t.uniform2fv(h,m),u[R]=_)))},i=function(e,t,r,i){g=r.frameBuffer.width=i[2],v=r.frameBuffer.height=i[3],n==g&&a==v||(e.viewport(0,0,g,v),e.scissor(0,0,g,v)),d(e,t,r,g,v),n=g,a=v},s=function(e,t,d,u,c,l,f){var h,R,m,p,_,g,v,E,M,b;if(m=e.gl,M=u.scene,b=u._viewRect,t._process&&t._process.length)for(h=r,p=0,_=t._process.length;p<_;p++)s(e,t._process[p],d,u,c,l,f);if((R=t._subFrameBufferList)&&R.length)for(g=0,v=R.length;g<v;g++)if((E=R[g]).frameBuffer.width=b[2],E.frameBuffer.height=b[3],E.frameBuffer.bind(m),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),c.sceneRender(e,M,o,o.mode2DYn,M.children,l,f,E.renderMaterial,!0,!0),E.frameBuffer.unbind(m),n=E.frameBuffer.width,a=E.frameBuffer.height,E._process&&E._process.length)for(p=0,_=E._process.length;p<_;p++)s(e,E._process[p],d,M,c,l,f);t.frameBuffer&&(i(m,o,t,b),t.bind(m),t.updateTexture(r,h),c.sceneRender(e,M,o,!0,d,l,f,null,!0,!0),t.unbind(m),r=t.frameBuffer.texture)},M=[],function(i,c,l,f,h,R){for(E=this,n=null,a=null,P=f.scene,o=f.camera instanceof RedBaseController?f.camera.camera:f.camera,T=f._viewRect,y=l.worldRect,u=l.cacheInfo.cacheSystemUniformInfo,E.unbind(c),e=E.children[0],r=t=E.frameBuffer.texture,E.frameBuffer.width=T[2],E.frameBuffer.height=T[3],M.length=0,b=0,L=E.postEffectList.length;b<L;b++)M[b]=E.postEffectList[b];for(E.antialiasing&&M.push(E.antialiasing),b=0,L=M.length;b<L;b++)s(i,M[b],E.children,f,l,h,R);r!=t&&(E.finalMaterial.diffuseTexture=r,c.viewport(T[0],y[3]-T[3]-T[1],T[2],T[3]),c.scissor(T[0],y[3]-T[3]-T[1],T[2],T[3]),d(c,o,E.finalMaterial,T[2],T[3],!0),l.sceneRender(i,P,o,!0,E.children,h,R,null,!0)),E.finalMaterial.diffuseTexture=E.frameBuffer.texture})},Object.defineProperty(RedPostEffectManager.prototype,"antialiasing",{get:function(){return this._antialiasing},set:function(e){e&&(e instanceof RedPostEffect_FXAA||RedGLUtil.throwFunc("RedPostEffectManager : antialiasing - RedPostEffect_FXAA Instance만 허용.","입력값 : "+e)),this._antialiasing=e}}),Object.freeze(RedPostEffectManager)}(),function(){var e;(e=(RedBasePostEffect=function(){}).prototype=new RedBaseMaterial).bind=RedPostEffectManager.prototype.bind,e.unbind=RedPostEffectManager.prototype.unbind,e.updateTexture=function(){RedGLUtil.throwFunc("RedBasePostEffect - updateTexture : 반드시 재정의해야함")},e._process=[],e._subFrameBufferList=[],RedBasePostEffect.baseVertexShaderSource1=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
vTime = uTime;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},Object.freeze(RedBasePostEffect)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform float u_exposure;
uniform float u_bloomStrength;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
vec4 thresholdColor = finalColor;
vec4 blurColor = texture2D(u_blurTexture, vTexcoord);
finalColor.rgb = (finalColor.rgb  + blurColor.rgb * u_bloomStrength) * u_exposure;
gl_FragColor = finalColor ;
}
*/},(RedPostEffect_Bloom=function(i){if(!(this instanceof RedPostEffect_Bloom))return new RedPostEffect_Bloom(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Bloom : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.blurTexture=null,this.exposure=1,this.bloomStrength=1.2,this._process=[RedPostEffect_BloomThreshold(i),RedPostEffect_BlurX(i),RedPostEffect_BlurY(i)],this.blur=20,this.threshold=75,this.program=RedProgram.makeProgram(i,"RedPostEffectBloomProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Bloom.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Bloom",["diffuseTexture","sampler2D"],["blurTexture","sampler2D"],["exposure","number",{min:0}],["bloomStrength","number",{min:0}],["threshold","number",{min:0,callback:function(e){this._process[0].threshold=e,this._threshold=this._process[0].threshold}}],["blur","number",{min:0,callback:function(e){this._process[1].size=e,this._process[2].size=e}}]),Object.freeze(RedPostEffect_Bloom)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision highp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b < u_threshold_value)  finalColor.r = finalColor.g = finalColor.b = 0.0;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_BloomThreshold=function(i){if(!(this instanceof RedPostEffect_BloomThreshold))return new RedPostEffect_BloomThreshold(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BloomThreshold : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.threshold=128,this.program=RedProgram.makeProgram(i,"RedPostEffectBloomThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BloomThreshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BloomThreshold",["diffuseTexture","sampler2D"],["threshold","number",{min:0,max:255,callback:function(e){this._threshold_value=e/255}}]),Object.freeze(RedPostEffect_BloomThreshold)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec2 px = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-7.0*px.x, -7.0*px.y))*0.0044299121055113265;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-6.0*px.x, -6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-5.0*px.x, -5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-4.0*px.x, -4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-3.0*px.x, -3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-2.0*px.x, -2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-1.0*px.x, -1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, vTexcoord                             )*0.159576912161;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 1.0*px.x,  1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 2.0*px.x,  2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 3.0*px.x,  3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 4.0*px.x,  4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 5.0*px.x,  5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 6.0*px.x,  6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 7.0*px.x,  7.0*px.y))*0.0044299121055113265;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Blur=function(i){if(!(this instanceof RedPostEffect_Blur))return new RedPostEffect_Blur(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Blur : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Blur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Blur","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Blur)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(u_size/vResolution.x,0.0);
for (float t = -10.0; t <= 10.0; t++) {
float percent = (t + offset - 0.5) / 10.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =  finalColor ;
}
*/},(RedPostEffect_BlurX=function(i){if(!(this instanceof RedPostEffect_BlurX))return new RedPostEffect_BlurX(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BlurX : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(i,"RedPostEffectBlurXProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BlurX.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BlurX",["diffuseTexture","sampler2D"],["size","number",{min:0}]),Object.freeze(RedPostEffect_BlurX)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(0.0, u_size/vResolution.y);
for (float t = -10.0; t <= 10.0; t++) {
float percent = (t + offset - 0.5) / 10.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =   finalColor ;
}
*/},(RedPostEffect_BlurY=function(i){if(!(this instanceof RedPostEffect_BlurY))return new RedPostEffect_BlurY(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BlurY : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(i,"RedPostEffectBlurYProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BlurY.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BlurY",["diffuseTexture","sampler2D"],["size","number",{min:0}]),Object.freeze(RedPostEffect_BlurY)}(),(RedPostEffect_GaussianBlur=function(e){if(!(this instanceof RedPostEffect_GaussianBlur))return new RedPostEffect_GaussianBlur(e);e instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_GaussianBlur : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID(),this._process=[RedPostEffect_BlurX(e),RedPostEffect_BlurY(e)],this.radius=1}).prototype=new RedBasePostEffect,RedPostEffect_GaussianBlur.prototype.updateTexture=function(){},RedDefinePropertyInfo.definePrototype("RedPostEffect_GaussianBlur","radius","number",{min:.1,max:255,callback:function(e){this._process[0].size=e,this._process[1].size=e}}),Object.freeze(RedPostEffect_GaussianBlur),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_amount_value;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main(void) {
vec4 finalColor = vec4(0.0);
vec2 center = vec2(u_centerX+0.5,-u_centerY+0.5);
vec2 toCenter = center - vTexcoord ;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
float total = 0.0;
for (float t = 0.0; t <= 30.0; t++) {
float percent = (t + offset) / 30.0;
float weight = 3.0 * (percent - percent * percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + toCenter * percent * u_amount_value );
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
gl_FragColor = finalColor / total;
gl_FragColor.rgb /= gl_FragColor.a + 0.00001;
}
*/},(RedPostEffect_ZoomBlur=function(i){if(!(this instanceof RedPostEffect_ZoomBlur))return new RedPostEffect_ZoomBlur(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_ZoomBlur : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.amount=38,this.program=RedProgram.makeProgram(i,"RedPostEffectZoomBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_ZoomBlur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_ZoomBlur",["diffuseTexture","sampler2D"],["centerX","number"],["centerY","number"],["amount","number",{min:1,max:100,callback:function(e){this._amount_value=e/100}}]),Object.freeze(RedPostEffect_ZoomBlur)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_brightness_value;
uniform float u_contrast_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
if (u_contrast_value > 0.0) finalColor.rgb = (finalColor.rgb - 0.5) / (1.0 - u_contrast_value) + 0.5;
else finalColor.rgb = (finalColor.rgb - 0.5) * (1.0 + u_contrast_value) + 0.5;
finalColor.rgb += u_brightness_value;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_BrightnessContrast=function(i){if(!(this instanceof RedPostEffect_BrightnessContrast))return new RedPostEffect_BrightnessContrast(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BrightnessContrast : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.brightness=0,this.contrast=0,this.program=RedProgram.makeProgram(i,"RedPostEffectBrightnessContrastProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BrightnessContrast.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BrightnessContrast",["diffuseTexture","sampler2D"],["brightness","number",{min:-150,max:150,callback:function(e){this._brightness_value=e/255}}],["contrast","number",{min:-50,max:100,callback:function(e){this._contrast_value=e/255}}]),Object.freeze(RedPostEffect_BrightnessContrast)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision highp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
float v;
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b >= u_threshold_value) v = 1.0;
else v = 0.0;
finalColor.r = finalColor.g = finalColor.b = v;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Threshold=function(i){if(!(this instanceof RedPostEffect_Threshold))return new RedPostEffect_Threshold(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Threshold : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.threshold=128,this.program=RedProgram.makeProgram(i,"RedPostEffectThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Threshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Threshold",["diffuseTexture","sampler2D"],["threshold","number",{min:1,max:255,callback:function(e){this._threshold_value=e/255}}]),Object.freeze(RedPostEffect_Threshold)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
finalColor.r = 1.0 - finalColor.r;
finalColor.g = 1.0 - finalColor.g;
finalColor.b = 1.0 - finalColor.b;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Invert=function(i){if(!(this instanceof RedPostEffect_Invert))return new RedPostEffect_Invert(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Invert : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectInvertProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Invert.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Invert","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Invert)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
highp float gray = (finalColor.r  + finalColor.g + finalColor.b)/3.0;
gl_FragColor = vec4( gray, gray, gray, 1.0);
}
*/},(RedPostEffect_Gray=function(i){if(!(this instanceof RedPostEffect_Gray))return new RedPostEffect_Gray(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Gray : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectGrayProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Gray.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Gray","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Gray)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_hue_value;
uniform float u_saturation_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
float angle = u_hue_value * 3.1415926535897932384626433832795;
float s = sin(angle), c = cos(angle);
vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
float len = length(finalColor.rgb);
finalColor.rgb = vec3(
dot(finalColor.rgb, weights.xyz),
dot(finalColor.rgb, weights.zxy),
dot(finalColor.rgb, weights.yzx)
);
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
if (u_saturation_value > 0.0) finalColor.rgb += (average - finalColor.rgb) * (1.0 - 1.0 / (1.001 - u_saturation_value));
else finalColor.rgb += (average - finalColor.rgb) * (-u_saturation_value);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_HueSaturation=function(i){if(!(this instanceof RedPostEffect_HueSaturation))return new RedPostEffect_HueSaturation(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_HueSaturation : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.hue=0,this.saturation=0,this.program=RedProgram.makeProgram(i,"RedPostEffectHueSaturationProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_HueSaturation.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_HueSaturation",["diffuseTexture","sampler2D"],["hue","number",{min:-180,max:180,callback:function(e){this._hue_value=e/180}}],["saturation","number",{min:-100,max:100,callback:function(e){this._saturation_value=e/100}}]),Object.freeze(RedPostEffect_HueSaturation)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_angle;
uniform float u_radius;
uniform bool u_grayMode;
float pattern(float angle) {
angle = angle * 3.141592653589793/180.0;
float s = sin(angle), c = cos(angle);
vec2 tex = vTexcoord;
tex.x -= u_centerX + 0.5;
tex.y -= u_centerY + 0.5;
vec2 point = vec2(
c * tex.x - s * tex.y,
s * tex.x + c * tex.y
) * vResolution / u_radius;
return (sin(point.x) * sin(point.y)) * 4.0;
}
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
if(u_grayMode) {
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern(u_angle)), finalColor.a);
}else{
vec3 cmy = 1.0 - finalColor.rgb;
float k = min(cmy.x, min(cmy.y, cmy.z));
cmy = (cmy - k) / (1.0 - k);
cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(u_angle + 0.26179), pattern(u_angle + 1.30899), pattern(u_angle)), 0.0, 1.0);
k = clamp(k * 10.0 - 5.0 + pattern(u_angle + 0.78539), 0.0, 1.0);
gl_FragColor = vec4(1.0 - cmy - k, finalColor.a);
}
}
*/},(RedPostEffect_HalfTone=function(i){if(!(this instanceof RedPostEffect_HalfTone))return new RedPostEffect_HalfTone(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_HalfTone : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.angle=0,this.radius=2,this.grayMode=!1,this.program=RedProgram.makeProgram(i,"RedPostEffectHalfToneProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_HalfTone.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_HalfTone",["diffuseTexture","sampler2D"],["centerX","number"],["centerY","number"],["angle","number"],["grayMode","boolean"],["radius","number",{min:0}]),Object.freeze(RedPostEffect_HalfTone)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_width;
uniform float u_height;
void main(void) {
vec4 finalColor;
float dx = 1.0/vResolution.x * u_width;
float dy = 1.0/vResolution.y * u_height;
vec2 coord = vec2(
dx * (floor(vTexcoord.x / dx) + 0.5),
dy * (floor(vTexcoord.y / dy) + 0.5)
);
finalColor = texture2D(u_diffuseTexture, coord);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Pixelize=function(i){if(!(this instanceof RedPostEffect_Pixelize))return new RedPostEffect_Pixelize(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Pixelize : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.width=5,this.height=5,this.program=RedProgram.makeProgram(i,"RedPostEffectPixelizeProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Pixelize.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Pixelize",["diffuseTexture","sampler2D"],["width","number",{min:0}],["height","number",{min:0}]),Object.freeze(RedPostEffect_Pixelize)}(),function(){var e,t,r,i,n;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform mat3 u_kernel;
uniform float uKernelWeight;
void main(void) {
vec2 perPX = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0, -1.0)) * u_kernel[0][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0, -1.0)) * u_kernel[0][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0, -1.0)) * u_kernel[0][2] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0,  0.0)) * u_kernel[1][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0,  0.0)) * u_kernel[1][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0,  0.0)) * u_kernel[1][2] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0,  1.0)) * u_kernel[2][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0,  1.0)) * u_kernel[2][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0,  1.0)) * u_kernel[2][2] ;
highp float weight;
weight = uKernelWeight;
if (0.01 > weight) {
weight = 1.0;
}
gl_FragColor = vec4((finalColor / uKernelWeight).rgb, 1.0);
}
*/},(RedPostEffect_Convolution=function(i,n){if(!(this instanceof RedPostEffect_Convolution))return new RedPostEffect_Convolution(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Convolution : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.kernel=n,this.program=RedProgram.makeProgram(i,"RedPostEffectConvolutionProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Convolution.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Convolution","diffuseTexture","sampler2D"),Object.defineProperty(RedPostEffect_Convolution.prototype,"kernel",{get:function(){return this._kernel||(this._kernel=RedPostEffect_Convolution.NORMAL),this._kernel},set:function(e){this._kernel=e}}),Object.defineProperty(RedPostEffect_Convolution.prototype,"kernelWeight",{get:function(){for(n in i=0,this.kernel)i+=this.kernel[n];return i}}),RedPostEffect_Convolution.NORMAL=[0,0,0,0,1,0,0,0,0],RedPostEffect_Convolution.SHARPEN=[0,-1,0,-1,5,-1,0,-1,0],RedPostEffect_Convolution.BLUR=[1,1,1,1,1,1,1,1,1],RedPostEffect_Convolution.EDGE=[0,1,0,1,-4,1,0,1,0],RedPostEffect_Convolution.EMBOSS=[-2,-1,0,-1,1,1,0,1,2],Object.freeze(RedPostEffect_Convolution)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform sampler2D u_depthTexture;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
vec4 blurColor = texture2D(u_blurTexture, vTexcoord);
vec4 depthColor = texture2D(u_depthTexture, vTexcoord);
finalColor.rgb *= (depthColor.r);
blurColor.rgb *= (1.0-depthColor.r);
gl_FragColor =  (finalColor + blurColor) ;
}
*/},(RedPostEffect_DoF=function(i){if(!(this instanceof RedPostEffect_DoF))return new RedPostEffect_DoF(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_DoF : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.blurTexture=null,this.depthTexture=null,this._subFrameBufferList=[{frameBuffer:RedFrameBuffer(i),renderMaterial:RedPostEffect_DoF_DepthMaterial(i),process:[]}],this._process=[RedPostEffect_BlurX(i),RedPostEffect_BlurY(i)],this.focusLength=15,this.blur=10,this.program=RedProgram.makeProgram(i,"RedPostEffectDoFProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_DoF.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e,this.depthTexture=this._subFrameBufferList[0].frameBuffer.texture},RedDefinePropertyInfo.definePrototypes("RedPostEffect_DoF",["diffuseTexture","sampler2D"],["blurTexture","sampler2D"],["depthTexture","sampler2D"],["blur","number",{min:0,callback:function(e){this._process[0].size=e,this._process[1].size=e}}]),Object.defineProperty(RedPostEffect_DoF.prototype,"focusLength",{get:function(){return this._subFrameBufferList[0].renderMaterial.focusLength},set:function(e){this._subFrameBufferList[0].renderMaterial.focusLength=e}}),Object.freeze(RedPostEffect_DoF)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2(targetMatrix[0][0],targetMatrix[1][1] * uResolution.x/uResolution.y);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform float u_focusLength;
void main(void) {
float depth = 1.0 - gl_FragCoord.z / gl_FragCoord.w / u_focusLength;
gl_FragColor = vec4(depth, depth, depth, 1.0);
}
*/},(RedPostEffect_DoF_DepthMaterial=function(i){if(!(this instanceof RedPostEffect_DoF_DepthMaterial))return new RedPostEffect_DoF_DepthMaterial(i);this.focusLength=15,this.makeProgramList(this,i,"RedPostEffectDoFdepthProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF_DepthMaterial","focusLength","number",{min:0}),Object.freeze(RedPostEffect_DoF_DepthMaterial)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform bool u_grayMode;
uniform sampler2D u_diffuseTexture;
uniform float u_noiseIntensity; // noise effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineIntensity; // scanlines effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineCount; // scanlines effect count value (0 = no effect, 4096 = full effect)
void main() {
vec4 diffuseColor = texture2D( u_diffuseTexture, vTexcoord );
float x = vTexcoord.x * vTexcoord.y * vTime;
x = mod( x, 13.0 ) * mod( x, 123.0 );
float dx = mod( x, 0.01 );
vec3 finalColor = diffuseColor.rgb + diffuseColor.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );
vec2 sc = vec2( sin( vTexcoord.y * u_scanlineCount ), cos( vTexcoord.y * u_scanlineCount ) );
finalColor += diffuseColor.rgb * vec3( sc.x, sc.y, sc.x ) * u_scanlineIntensity;
finalColor = diffuseColor.rgb + clamp( u_noiseIntensity, 0.0, 1.0 ) * ( finalColor - diffuseColor.rgb );
if( u_grayMode ) finalColor = vec3( finalColor.r * 0.3 + finalColor.g * 0.59 + finalColor.b * 0.11 );
gl_FragColor =  vec4( finalColor, diffuseColor.a );
}
*/},(RedPostEffect_Film=function(i){if(!(this instanceof RedPostEffect_Film))return new RedPostEffect_Film(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Film : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.grayMode=!1,this.scanlineIntensity=.5,this.noiseIntensity=.5,this.scanlineCount=2048,this.program=RedProgram.makeProgram(i,"RedPostEffectFilmProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Film.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Film",["diffuseTexture","sampler2D"],["grayMode","boolean"],["scanlineIntensity","number",{min:0}],["noiseIntensity","number",{min:0}],["scanlineCount","number",{min:0}]),Object.freeze(RedPostEffect_Film)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
uniform float u_intensity;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
float dist = distance(vTexcoord, vec2(0.5, 0.5));
finalColor.rgb *= smoothstep(0.8, u_size * 0.799, dist * (u_intensity + u_size));
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Vignetting=function(i){if(!(this instanceof RedPostEffect_Vignetting))return new RedPostEffect_Vignetting(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Vignetting : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.size=.1,this.intensity=.85,this.program=RedProgram.makeProgram(i,"RedPostEffectVignettingProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Vignetting.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Vignetting",["diffuseTexture","sampler2D"],["intensity","number",{min:0}],["size","number",{min:0}]),Object.freeze(RedPostEffect_Vignetting)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
const float cFXAA_REDUCE_MIN = 1.0/ 128.0;
const float cFXAA_REDUCE_MUL = 1.0 / 8.0;
const float cFXAA_SPAN_MAX = 8.0;
void main() {
vec4 finalColor;
vec2 inverseVP = vec2(1.0 / vResolution.x, 1.0 / vResolution.y);
vec2 fragCoord = gl_FragCoord.xy;
vec3 rgbNW = texture2D(u_diffuseTexture, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
vec3 rgbNE = texture2D(u_diffuseTexture, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
vec3 rgbSW = texture2D(u_diffuseTexture, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
vec3 rgbSE = texture2D(u_diffuseTexture, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
vec3 rgbM  = texture2D(u_diffuseTexture, fragCoord  * inverseVP).xyz;
vec3 luma = vec3(0.299, 0.587, 0.114);
float lumaNW = dot(rgbNW, luma);
float lumaNE = dot(rgbNE, luma);
float lumaSW = dot(rgbSW, luma);
float lumaSE = dot(rgbSE, luma);
float lumaM  = dot(rgbM,  luma);
float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
vec2 dir;
dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * cFXAA_REDUCE_MUL), cFXAA_REDUCE_MIN);
float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
dir = min(
vec2(cFXAA_SPAN_MAX, cFXAA_SPAN_MAX),
max( vec2(-cFXAA_SPAN_MAX, -cFXAA_SPAN_MAX), dir * rcpDirMin)
) * inverseVP;
vec3 rgbA = 0.5 * (
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz
);
vec3 rgbB = rgbA * 0.5 + 0.25 * (
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * -0.5).xyz +
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * 0.5).xyz
);
float lumaB = dot(rgbB, luma);
if ((lumaB < lumaMin) || (lumaB > lumaMax)) finalColor = vec4(rgbA, 1.0);
else finalColor = vec4(rgbB, 1.0);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_FXAA=function(i){if(!(this instanceof RedPostEffect_FXAA))return new RedPostEffect_FXAA(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_FXAA : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectFXAAProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_FXAA.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_FXAA","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_FXAA)}(),function(){var e,t,r,i,n,a;(RedGLOffScreen=function(e,t,r,i,n){if(!(this instanceof RedGLOffScreen))return new RedGLOffScreen(e,t,r,i,n);RedGLDetect.getBrowserInfo();var a=this;a.htmlCanvas=e,a.redGLSrc=i,fetch(n).then(function(e){e.text().then(function(e){a.hostCode="\ncanvas.tagName = 'CANVAS';\nreturn RedGL(canvas, function (v) {\nvar _host_ = "+e+";\n_host_.call(this);\n\n});",a.setSize(t,r)})}).catch(function(e){})}).prototype.updatePostMessage=function(e){if(!e)throw"RedGLOffScreen.prototype['updatePostMessage'] - run을 정의해야합니다."+e;if(!e.name)throw"RedGLOffScreen.prototype['updatePostMessage'] - run객체의 name을 정의해야합니다."+e.name;this.worker.postMessage({state:"update",run:e})},RedGLOffScreen.prototype._init=function(r,i,n){var a=this;this.worker&&this.worker.terminate();var o=this.htmlCanvas.parentNode,s=r.cloneNode(!0);o.replaceChild(s,this.htmlCanvas),this.htmlCanvas=s;var d="x,y,clientX,clientY,pageX,pageY,screenX,screenY,layerX,layerY,detail,shiftKey,altKey,ctrlKey,movementX,movementY,button,type,which,deltaX,deltaY,deltaZ,timeStamp,targetTouches".split(","),u="shiftKey,altKey,ctrlKey,key,keyCode,location,code,charCode,detail,timeStamp,which,type".split(","),c=[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up],l="keydown,keyup,keypress".split(",");c.forEach(function(e){a.htmlCanvas.addEventListener(e,function(e){var t={};d.forEach(function(r){if("targetTouches"==r&&e[r]){for(var i=[],n=e[r].length;n--;){var a=e[r][n];i.push({clientX:a.clientX,clientY:a.clientY,force:a.force,identifier:a.identifier,pageX:a.pageX,pageY:a.pageY,radiusX:a.radiusX,radiusY:a.radiusY,rotationAngle:a.rotationAngle,screenX:a.screenX,screenY:a.screenY})}t[r]=i}else t[r]=e[r]}),a.worker.postMessage({state:e.type,event:t})})}),l.forEach(function(e){window.addEventListener(e,function(e){var t={};u.forEach(function(r){t[r]=e[r]}),a.worker.postMessage({state:e.type,event:t})})}),this.offScreenCanvas=this.htmlCanvas.transferControlToOffscreen(),this.offScreenCanvas.width=i,this.offScreenCanvas.height=n,this.worker=null,t=new Blob([e],{type:"application/javascript"}),this.worker=new Worker(URL.createObjectURL(t));var f=document.location.pathname.split("/");f[f.length-1].indexOf(".")>-1&&f.pop();var h=this.redGLSrc.split("/");h.forEach(function(e,t){".."===e&&(f.pop(),h[t]=""),"."===e&&(h[t]="")}),this.worker.postMessage({canvas:this.offScreenCanvas,state:"init",redGLSrc:document.location.origin+f.join("/")+"/"+h.join("/"),hostCode:this.hostCode.toString()},[this.offScreenCanvas])},RedGLOffScreen.prototype.setSize=(n=0,a=0,function(e,t,o){void 0===e&&RedGLUtil.throwFunc("RedGL setSize : width가 입력되지 않았습니다."),void 0===t&&RedGLUtil.throwFunc("RedGL setSize : height가 입력되지 않았습니다."),r=this._width=e,i=this._height=t,"number"!=typeof r&&(r.indexOf("%")>-1?r=(document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)*parseFloat(r)/100:RedGLUtil.throwFunc("RedGL setSize : width는 0이상의 숫자나 %만 허용.",r)),"number"!=typeof i&&(i.indexOf("%")>-1?i=window.innerHeight*parseFloat(i)/100:RedGLUtil.throwFunc("RedGL setSize : height는 0이상의 숫자나 %만 허용.",i)),window.devicePixelRatio,this._canvas,(n!==r||a!==i||o)&&(n=r,a=i),r=parseInt(r),i=parseInt(i),this._init(this.htmlCanvas,r,i)}),e=(e=function(){var e,t;this.window=this,onmessage=function(r){switch(r.data.state){case"init":e||(importScripts(r.data.redGLSrc),e=new Function("canvas",r.data.hostCode)),t=new e(r.data.canvas);break;case"update":var i=r.data.run.args;t.userInterface[r.data.run.name]["array"==typeof i?"apply":"call"](t,r.data.run.args);break;case RedGLDetect.BROWSER_INFO.move:var n=new Event(RedGLDetect.BROWSER_INFO.move),a=r.data.event;for(var o in a)n[o]=a[o];t._canvas.dispatchEvent(n);break;case RedGLDetect.BROWSER_INFO.down:for(var o in n=new Event(RedGLDetect.BROWSER_INFO.down),a=r.data.event)n[o]=a[o];t._canvas.dispatchEvent(n);break;case RedGLDetect.BROWSER_INFO.up:for(var o in n=new Event(RedGLDetect.BROWSER_INFO.up),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n);break;case"wheel":for(var o in n=new Event("wheel"),a=r.data.event)n[o]=a[o];t._canvas.dispatchEvent(n);break;case"keydown":for(var o in n=new Event("keydown"),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n);break;case"keyup":for(var o in n=new Event("keyup"),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n);break;case"keypress":for(var o in n=new Event("keypress"),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n)}}}).toString().replace(/^function ?. ?\) ?\{|\}\;?$/g,"")}();var RedGL_VERSION={version:"RedGL Release. last update( 2019-07-09 12:27:18)"};